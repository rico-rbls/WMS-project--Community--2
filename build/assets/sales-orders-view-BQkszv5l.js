import{c as Ae,i as us,r as x,j as e,C as b,o as D,p as P,v as as,q as S,az as Z,w as H,aA as rs,B as u,a1 as xs,I as p,aa as Us,P as Hs,S as je,x as g,aB as Qs,M as Gs,_ as is,D as ze,$ as Js,y as Ee,z as Ve,A as Me,E as _e,L as w,d as ke,F as ls,a0 as Ws,a9 as Ys,m as Ke,aC as Xs,ak as Zs,aD as ns,aE as et,aF as st,aG as tt,aH as at,aI as rt,aJ as it,aK as lt}from"./index-C5vXYdME.js";import{g as nt,h as Ue}from"./permissions-DeuZZz56.js";import{P as Q,u as ct,a as dt,T as ot,E as He,b as cs,F as mt,B as ut,S as xt}from"./select-all-banner-Bgx-7BLx.js";import{T as te,e as fe,f as Se,g as B,h as c,j as Ce,k as l,S as me,a as ue,b as xe,c as he,d as ee,i as U}from"./sortable-table-head-4SXmLKLX.js";import{u as ht,P as jt,D as pt}from"./printable-receipt-D6oaOcNI.js";import{C as gt}from"./skeleton-DL8BnTe6.js";import{T as ds}from"./trending-up-VF5BW0F6.js";import{F as vt}from"./file-text-B4nMFmxx.js";import{D as Nt,A as we,a as os}from"./dollar-sign-DrtkTal3.js";import{C as yt}from"./circle-alert-COh3Jime.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],St=Ae("arrow-left",ft);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],wt=Ae("arrow-right",Ct);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=[["path",{d:"M5 12h14",key:"1ays0h"}]],ms=Ae("minus",bt);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],Pt=Ae("sparkles",Dt),se=d=>`₱${d.toLocaleString("en-PH",{minimumFractionDigits:2})}`;function It({inventoryData:d,customersData:pe,onSubmitOrder:E,onCancel:j}){const{user:$}=us(),[f,G]=x.useState([]),[J,ae]=x.useState(""),[T,z]=x.useState(""),[be,W]=x.useState(0),[De,Pe]=x.useState(!1),[L,re]=x.useState(null),Y=x.useMemo(()=>$?.email?pe.find(r=>r.email===$.email):null,[$?.email,pe]),V=x.useMemo(()=>d.filter(r=>{const o=r.quantity>0,y=!J||r.name.toLowerCase().includes(J.toLowerCase())||r.category.toLowerCase().includes(J.toLowerCase());return o&&y}),[d,J]),M=x.useMemo(()=>f.reduce((r,o)=>r+o.totalPrice,0),[f]),ie=x.useMemo(()=>f.reduce((r,o)=>r+o.quantity,0),[f]),I=r=>{const o=f.findIndex(y=>y.inventoryItemId===r.id);if(o>=0){const y=[...f],k=Math.min(y[o].quantity+1,r.quantity);y[o]={...y[o],quantity:k,totalPrice:k*y[o].unitPrice},G(y)}else G([...f,{inventoryItemId:r.id,itemName:r.name,quantity:1,unitPrice:r.price??0,totalPrice:r.price??0,availableStock:r.quantity}]);g.success(`Added ${r.name} to cart`)},X=(r,o)=>{const y=[...f],k=y[r].quantity+o;k<=0?y.splice(r,1):k<=y[r].availableStock&&(y[r]={...y[r],quantity:k,totalPrice:k*y[r].unitPrice}),G(y)},ge=r=>{const o=[...f];o.splice(r,1),G(o)},le=async()=>{if(f.length===0){g.error("Please add items to your cart");return}Pe(!0);try{const r=await E({items:f.map(({availableStock:o,...y})=>y),notes:T,amountPaid:be,customerName:Y?.name||$?.displayName||$?.email||"Customer",customerId:Y?.id||"",customerCountry:Y?.country||"",customerCity:Y?.city||""});re(r),g.success("Order placed successfully!")}catch(r){g.error(r instanceof Error?r.message:"Failed to place order")}finally{Pe(!1)}};return L?e.jsx("div",{className:"flex flex-col items-center justify-center py-12 px-4",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs(b,{className:"border-green-200 bg-green-50/50",children:[e.jsxs(D,{className:"text-center pb-2",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(gt,{className:"h-10 w-10 text-green-600"})}),e.jsx(P,{className:"text-2xl text-green-800",children:"Order Confirmed!"}),e.jsx(as,{className:"text-green-700",children:"Thank you for your order"})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Order ID"}),e.jsx("span",{className:"font-mono font-semibold",children:L.id})]}),e.jsx(Z,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date"}),e.jsx("span",{children:new Date(L.soDate).toLocaleDateString()})]}),e.jsx(Z,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Items"}),e.jsxs("span",{children:[L.items.length," item(s)"]})]}),e.jsx(Z,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Amount"}),e.jsx("span",{className:"font-semibold text-lg",children:se(L.totalAmount)})]}),L.amountPaid>0&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount Paid"}),e.jsx("span",{className:"text-green-600",children:se(L.amountPaid)})]})]}),e.jsx(Z,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:"Status"}),e.jsx(H,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:"Pending"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Order Items"}),e.jsx("div",{className:"space-y-2",children:L.items.map((r,o)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[r.itemName," × ",r.quantity]}),e.jsx("span",{children:se(r.totalPrice)})]},o))})]})]}),e.jsx(rs,{children:e.jsx(u,{className:"w-full",onClick:j,children:"Continue Shopping"})})]})})}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:e.jsxs(b,{children:[e.jsx(D,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(Pt,{className:"h-5 w-5 text-primary"}),"Product Catalog"]}),e.jsx(as,{children:"Browse and add products to your order"})]}),e.jsxs("div",{className:"relative w-64",children:[e.jsx(xs,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(p,{placeholder:"Search products...",value:J,onChange:r=>ae(r.target.value),className:"pl-9"})]})]})}),e.jsx(S,{children:e.jsx(Us,{className:"h-[400px]",children:V.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:[e.jsx(Hs,{className:"h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{children:"No products found"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:V.map(r=>{const o=f.find(y=>y.inventoryItemId===r.id);return e.jsxs("div",{className:"border rounded-lg p-4 hover:border-primary/50 hover:bg-accent/30 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:r.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.category})]}),e.jsxs(H,{variant:"outline",className:"text-xs",children:[r.quantity," in stock"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsx("span",{className:"text-lg font-semibold text-primary",children:se(r.price??0)}),o?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{size:"icon",variant:"outline",className:"h-8 w-8",onClick:()=>X(f.indexOf(o),-1),children:e.jsx(ms,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-8 text-center font-medium",children:o.quantity}),e.jsx(u,{size:"icon",variant:"outline",className:"h-8 w-8",onClick:()=>X(f.indexOf(o),1),disabled:o.quantity>=r.quantity,children:e.jsx(Q,{className:"h-3 w-3"})})]}):e.jsxs(u,{size:"sm",onClick:()=>I(r),children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),"Add"]})]})]},r.id)})})})})]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs(b,{className:"sticky top-4",children:[e.jsx(D,{className:"pb-3",children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5"}),"Your Cart",ie>0&&e.jsxs(H,{variant:"secondary",className:"ml-auto",children:[ie," item",ie!==1?"s":""]})]})}),e.jsx(S,{children:f.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(je,{className:"h-12 w-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"Your cart is empty"}),e.jsx("p",{className:"text-sm",children:"Add products to get started"})]}):e.jsx("div",{className:"space-y-3",children:f.map((r,o)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-accent/30",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:r.itemName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[se(r.unitPrice)," each"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{size:"icon",variant:"ghost",className:"h-7 w-7",onClick:()=>X(o,-1),children:e.jsx(ms,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-6 text-center text-sm",children:r.quantity}),e.jsx(u,{size:"icon",variant:"ghost",className:"h-7 w-7",onClick:()=>X(o,1),disabled:r.quantity>=r.availableStock,children:e.jsx(Q,{className:"h-3 w-3"})})]}),e.jsx("div",{className:"text-right w-20",children:e.jsx("p",{className:"font-medium",children:se(r.totalPrice)})}),e.jsx(u,{size:"icon",variant:"ghost",className:"h-7 w-7 text-destructive hover:text-destructive",onClick:()=>ge(o),children:e.jsx(te,{className:"h-3 w-3"})})]},r.inventoryItemId))})}),f.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{}),e.jsxs(S,{className:"pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Special Instructions (optional)"}),e.jsx(p,{placeholder:"Any special requests...",value:T,onChange:r=>z(r.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Amount to Pay Now (optional)"}),e.jsx(p,{type:"number",min:"0",step:"0.01",placeholder:"0.00",value:be||"",onChange:r=>W(parseFloat(r.target.value)||0)})]}),e.jsx(Z,{}),e.jsxs("div",{className:"flex justify-between items-center text-lg font-semibold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-primary",children:se(M)})]})]}),e.jsxs(rs,{className:"flex flex-col gap-2",children:[e.jsx(u,{className:"w-full",size:"lg",onClick:le,disabled:De,children:De?"Placing Order...":e.jsxs(e.Fragment,{children:["Place Order",e.jsx(wt,{className:"ml-2 h-4 w-4"})]})}),e.jsx(u,{variant:"ghost",className:"w-full",onClick:j,children:"Cancel"})]})]})]})})]})}const Ot=["Unpaid","Partially Paid","Paid","Overdue"],kt=["Pending","Processing","Shipped","In Transit","Out for Delivery","Delivered","Failed","Returned"],F=d=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(d);function Vt(){const{user:d}=us(),{createNotification:pe}=Qs(),E=d?nt(d.id):"Viewer",j=E==="Customer",$=j||Ue(E,"purchase_orders:create");!j&&Ue(E,"purchase_orders:update");const f=!j&&Ue(E,"purchase_orders:delete"),G=E==="Owner"||E==="Admin",{printReceipt:J}=ht(),[ae,T]=x.useState(null),[z,be]=x.useState([]),[W,De]=x.useState([]),[Pe,L]=x.useState(!0),[re,Y]=x.useState(""),V=Gs(re,300),[M,ie]=x.useState("all"),[I,X]=x.useState(!1),[ge,le]=x.useState(!1),[r,o]=x.useState(null),[y,k]=x.useState(!1),[A,Qe]=x.useState(null),[ve,Te]=x.useState("asc"),[m,Ie]=x.useState(null),[hs,Re]=x.useState(!1),[i,C]=x.useState({soDate:new Date().toISOString().split("T")[0],customerId:"",customerName:"",customerCountry:"",customerCity:"",invoiceNumber:"",items:[],expectedDeliveryDate:"",notes:"",totalReceived:0,amountPaid:0,shippingStatus:"Pending"});x.useEffect(()=>{(async()=>{try{const[t,a,n]=await Promise.all([Ke(),Xs(),Zs()]);T(t),be(a),De(n)}catch{g.error("Failed to load data")}finally{L(!1)}})()},[]),x.useEffect(()=>{if(ge&&j&&d?.email&&z.length>0){const s=z.find(t=>t.email===d.email);C(s?t=>({...t,customerId:s.id,customerName:s.name,customerCountry:s.country??"",customerCity:s.city??""}):t=>({...t,customerName:d.displayName||d.email||"Customer"}))}},[ge,j,d?.email,d?.displayName,z]);const ne=ae??[],R=x.useMemo(()=>ne.filter(s=>{if(j&&d?.email&&s.createdBy!==d.email)return!1;const t=s.archived===!0;if(I!==t)return!1;const a=!V||s.id.toLowerCase().includes(V.toLowerCase())||s.customerName.toLowerCase().includes(V.toLowerCase())||s.items.some(v=>v.itemName.toLowerCase().includes(V.toLowerCase())),n=M==="all"||s.receiptStatus===M;return a&&n}),[ne,V,M,I,j,d?.email]),Ge=x.useMemo(()=>A?[...R].sort((s,t)=>{const a=s[A],n=t[A];if(a==null&&n==null)return 0;if(a==null)return 1;if(n==null)return-1;if(typeof a=="number"&&typeof n=="number")return ve==="asc"?a-n:n-a;const v=String(a).toLowerCase(),h=String(n).toLowerCase();return ve==="asc"?v.localeCompare(h):h.localeCompare(v)}):R,[R,A,ve]),{currentPage:Je,totalPages:js,paginatedData:Fe,goToPage:ps,itemsPerPage:gs,totalItems:vs}=ct(Ge,10),{selectedIds:Oe,isSelected:Ns,toggleItem:ys,toggleAll:fs,selectAllPages:Ss,deselectAll:Ne,isAllSelected:Cs,isAllPageSelected:ws,isAllPagesSelected:bs,isPartiallySelected:Ds,selectionCount:Le,hasSelection:Ps,totalItemCount:We,pageItemCount:Ye}=dt(Fe,Ge),q=x.useMemo(()=>{const s=ne.filter(O=>!O.archived),t=s.length,a=s.reduce((O,$e)=>O+$e.totalAmount,0),n=s.reduce((O,$e)=>O+$e.totalReceived,0),v=s.filter(O=>O.receiptStatus==="Paid").length,h=s.filter(O=>O.receiptStatus==="Unpaid").length,N=s.filter(O=>O.receiptStatus==="Partially Paid").length,oe=s.filter(O=>O.receiptStatus==="Overdue").length,_s=s.filter(O=>O.shippingStatus==="Delivered").length,Be=new Date;Be.setDate(Be.getDate()-7);const Ks=s.filter(O=>new Date(O.createdDate)>=Be).length;return{totalSOs:t,totalValue:a,totalReceived:n,outstandingBalance:a-n,paidCount:v,unpaidCount:h,partiallyPaidCount:N,overdueCount:oe,deliveredCount:_s,newThisWeek:Ks,avgOrderValue:t>0?a/t:0,collectionRate:a>0?Math.round(n/a*100):0}},[ne]),_=s=>{const t=s;A===t?ve==="asc"?Te("desc"):(Qe(null),Te("asc")):(Qe(t),Te("asc"))},K=s=>A===s?ve:null,Is=(s,t)=>`${s}-D${String(t+1).padStart(3,"0")}`,Os=s=>{const t=W.find(a=>a.id===s);return{itemId:t?.id??s,itemType:t?.brand??"-",itemCategory:t?.category??"-",itemSubcategory:t?.subcategory??"-"}},Xe=s=>{Ie(s)},ks=()=>{Ie(null)};x.useEffect(()=>{if(m&&ae){const s=ae.find(t=>t.id===m.id);s&&JSON.stringify(s)!==JSON.stringify(m)?Ie(s):s||Ie(null)}},[ae,m]);const qe=s=>{const t={Unpaid:{variant:"outline",className:"border-gray-500 text-gray-600"},"Partially Paid":{variant:"outline",className:"border-yellow-500 text-yellow-600"},Paid:{variant:"default",className:"bg-green-500"},Overdue:{variant:"destructive"}},{variant:a,className:n}=t[s];return e.jsx(H,{variant:a,className:ke("gap-1",n),children:s})},ye=()=>{const s=j&&d?.displayName?d.displayName:"";C({soDate:new Date().toISOString().split("T")[0],customerId:"",customerName:s,customerCountry:"",customerCity:"",invoiceNumber:"",items:[],expectedDeliveryDate:"",notes:"",totalReceived:0,amountPaid:0,shippingStatus:"Pending"})},Ze=()=>{C(s=>({...s,items:[...s.items,{inventoryItemId:"",itemName:"",quantity:1,unitPrice:0,totalPrice:0}]}))},es=s=>{C(t=>({...t,items:t.items.filter((a,n)=>n!==s)}))},ce=(s,t,a)=>{C(n=>{const v=[...n.items];if(t==="inventoryItemId"){const h=W.find(N=>N.id===a);h&&(v[s]={...v[s],inventoryItemId:h.id,itemName:h.name,unitPrice:h.pricePerPiece,totalPrice:v[s].quantity*h.pricePerPiece})}else if(t==="quantity"){const h=Number(a)||0;v[s]={...v[s],quantity:h,totalPrice:h*v[s].unitPrice}}else if(t==="unitPrice"){const h=Number(a)||0;v[s]={...v[s],unitPrice:h,totalPrice:v[s].quantity*h}}return{...n,items:v}})},ss=s=>{const t=z.find(a=>a.id===s);C(a=>({...a,customerId:s,customerName:t?.name??"",customerCountry:t?.country??"",customerCity:t?.city??""}))},As=async()=>{const s=!j&&!i.expectedDeliveryDate;if(!i.customerId||i.items.length===0||s){g.error("Please fill in all required fields");return}try{const t=await ns({soDate:i.soDate,customerId:i.customerId,customerName:i.customerName,customerCountry:i.customerCountry,customerCity:i.customerCity,invoiceNumber:i.invoiceNumber,items:i.items.map(a=>({...a,quantityShipped:0})),expectedDeliveryDate:i.expectedDeliveryDate||void 0,notes:i.notes,createdBy:d?.email??d?.id??"unknown",totalReceived:j?0:i.totalReceived,amountPaid:i.amountPaid});if(T(a=>[t,...a??[]]),g.success(`Sales Order ${t.id} created successfully`),j&&d?.email){const a=i.items.reduce((n,v)=>n+v.totalPrice,0);await pe({type:"new_sales_order",title:"New Sales Order Created",message:`${d.name||d.email} created order ${t.id} for ${i.customerName} - ${F(a)}`,salesOrderId:t.id,customerName:i.customerName,createdBy:d.email,targetRoles:["Owner","Admin"]})}le(!1),ye()}catch(t){g.error(t instanceof Error?t.message:"Failed to create sales order")}},Ts=async s=>{const t=await ns({soDate:new Date().toISOString().split("T")[0],customerId:s.customerId,customerName:s.customerName,customerCountry:s.customerCountry,customerCity:s.customerCity,invoiceNumber:"",items:s.items.map(a=>({...a,quantityShipped:0})),expectedDeliveryDate:void 0,notes:s.notes,createdBy:d?.email??d?.id??"unknown",totalReceived:0,amountPaid:s.amountPaid});if(T(a=>[t,...a??[]]),d?.email){const a=s.items.reduce((n,v)=>n+v.totalPrice,0);await pe({type:"new_sales_order",title:"New Customer Order",message:`${d.displayName||d.email} placed order ${t.id} - ${F(a)}`,salesOrderId:t.id,customerName:s.customerName,createdBy:d.email,targetRoles:["Owner","Admin"]})}return t},Rs=async s=>{const t=!j&&!i.expectedDeliveryDate;if(!i.customerId||i.items.length===0||t){g.error("Please fill in all required fields");return}try{const a=ne.find(h=>h.id===s),n=new Map(a?.items?.map(h=>[h.inventoryItemId,h.quantityShipped??0])??[]),v=await rt({id:s,soDate:i.soDate,customerId:i.customerId,customerName:i.customerName,customerCountry:i.customerCountry,customerCity:i.customerCity,invoiceNumber:i.invoiceNumber,items:i.items.map(h=>({...h,quantityShipped:n.get(h.inventoryItemId)??0})),expectedDeliveryDate:j?a?.expectedDeliveryDate:i.expectedDeliveryDate,notes:i.notes,totalReceived:j?a?.totalReceived:i.totalReceived,amountPaid:i.amountPaid,shippingStatus:j?a?.shippingStatus:i.shippingStatus});T(h=>h?.map(N=>N.id===s?v:N)??[]),g.success(`Sales Order ${s} updated successfully`),o(null),ye()}catch(a){g.error(a instanceof Error?a.message:"Failed to update sales order")}},Fs=async s=>{try{await at(s),T(t=>t?.filter(a=>a.id!==s)??[]),g.success(`Sales Order ${s} deleted`),o(null)}catch(t){g.error(t instanceof Error?t.message:"Failed to delete sales order")}},Ls=async s=>{try{await tt(s),T(t=>t?.map(a=>a.id===s?{...a,archived:!0}:a)??[]),g.success(`Sales Order ${s} archived`)}catch(t){g.error(t instanceof Error?t.message:"Failed to archive sales order")}},qs=async s=>{try{await st(s),T(t=>t?.map(a=>a.id===s?{...a,archived:!1}:a)??[]),g.success(`Sales Order ${s} restored`)}catch(t){g.error(t instanceof Error?t.message:"Failed to restore sales order")}},Bs=async()=>{try{const s=await lt(Array.from(Oe));s.success?g.success(`${s.successCount} sales orders archived`):g.warning(`${s.successCount} archived, ${s.failedCount} failed`);const t=await Ke();T(t),Ne(),k(!1)}catch{g.error("Failed to archive sales orders")}},$s=async()=>{try{const s=await et(Array.from(Oe));s.success?g.success(`${s.successCount} sales orders restored`):g.warning(`${s.successCount} restored, ${s.failedCount} failed`);const t=await Ke();T(t),Ne()}catch{g.error("Failed to restore sales orders")}},ts=async()=>{try{const s=await it(Array.from(Oe));s.success?g.success(`${s.successCount} sales orders permanently deleted`):g.warning(`${s.successCount} deleted, ${s.failedCount} failed`),T(t=>t?.filter(a=>!Oe.has(a.id))??[]),Ne(),k(!1)}catch{g.error("Failed to permanently delete sales orders")}},zs=s=>{C({soDate:s.soDate??s.createdDate,customerId:s.customerId,customerName:s.customerName,customerCountry:s.customerCountry??"",customerCity:s.customerCity??"",invoiceNumber:s.invoiceNumber??"",items:(s.items??[]).map(t=>({inventoryItemId:t.inventoryItemId,itemName:t.itemName,quantity:t.quantity,unitPrice:t.unitPrice,totalPrice:t.totalPrice})),expectedDeliveryDate:s.expectedDeliveryDate??"",notes:s.notes??"",totalReceived:s.totalReceived??0,amountPaid:s.amountPaid??0,shippingStatus:s.shippingStatus??"Pending"}),o(s.id)},Es=()=>{const s=["Date","SO ID","Customer ID","Customer Name","Invoice #","Country","City","Items","Total Amount","Total Received","SO Balance","Receipt Status","Shipping Status","Expected Delivery","Notes"],t=R.map(N=>[N.soDate??N.createdDate,N.id,N.customerId,N.customerName,N.invoiceNumber??"",N.customerCountry??"",N.customerCity??"",(N.items??[]).map(oe=>`${oe.itemName} (${oe.quantity})`).join("; "),(N.totalAmount??0).toFixed(2),(N.totalReceived??0).toFixed(2),(N.soBalance??N.totalAmount??0).toFixed(2),N.receiptStatus,N.shippingStatus??"Pending",N.expectedDeliveryDate??"",N.notes??""]),a=[s,...t].map(N=>N.map(oe=>`"${oe}"`).join(",")).join(`
`),n=new Blob([a],{type:"text/csv"}),v=URL.createObjectURL(n),h=document.createElement("a");h.href=v,h.download=`sales-orders-${new Date().toISOString().split("T")[0]}.csv`,h.click(),URL.revokeObjectURL(v),g.success("Sales orders exported to CSV")},Vs=()=>{Y(""),ie("all"),X(!1)},de=x.useMemo(()=>i.items.reduce((s,t)=>s+t.totalPrice,0),[i.items]),Ms=s=>{const t={type:"sales-order",documentNumber:s.id,documentDate:s.soDate??s.createdDate,partyType:"Customer",partyName:s.customerName,partyCity:s.customerCity,partyCountry:s.customerCountry,referenceNumber:s.invoiceNumber,referenceLabel:"Invoice No.",items:s.items?.map(a=>({description:a.itemName,quantity:a.quantity,unitPrice:a.unitPrice,total:a.totalPrice}))||[],totalAmount:s.totalAmount??0,amountPaid:s.totalReceived??0,balance:s.soBalance??s.totalAmount-s.totalReceived??0,status:`${s.receiptStatus} / ${s.shippingStatus}`,expectedDeliveryDate:s.expectedDeliveryDate,notes:s.notes,createdBy:s.createdBy};J(t)};return Pe?e.jsx("div",{className:"p-6",children:e.jsx(ot,{rows:8})}):m?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:ks,children:[e.jsx(St,{className:"h-4 w-4 mr-1"}),"Back to List"]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Sales Order Details - ",m.id]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[m.customerName," • ",m.soDate??m.createdDate]})]})]}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>Ms(m),children:[e.jsx(jt,{className:"h-4 w-4 mr-2"}),"Print Invoice"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(b,{children:[e.jsx(D,{className:"pb-2",children:e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:"Customer"})}),e.jsxs(S,{children:[e.jsx("div",{className:"font-medium",children:m.customerName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:m.customerId})]})]}),e.jsxs(b,{children:[e.jsx(D,{className:"pb-2",children:e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:"Location"})}),e.jsxs(S,{children:[e.jsx("div",{className:"font-medium",children:m.customerCity||"-"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:m.customerCountry||"-"})]})]}),e.jsxs(b,{children:[e.jsx(D,{className:"pb-2",children:e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:"Total Amount"})}),e.jsxs(S,{children:[e.jsx("div",{className:"text-lg font-bold text-emerald-600",children:F(m.totalAmount??0)}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[m.items?.length??0," line items"]})]})]}),e.jsxs(b,{children:[e.jsx(D,{className:"pb-2",children:e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:"Status"})}),e.jsx(S,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[qe(m.receiptStatus),e.jsx(H,{variant:m.shippingStatus==="Delivered"?"default":"outline",className:"w-fit mt-1",children:m.shippingStatus??"Pending"})]})})]})]}),e.jsxs(b,{children:[e.jsxs(D,{children:[e.jsx(P,{children:"Line Items"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Detailed breakdown of all items in this sales order"})]}),e.jsxs(S,{children:[!m.items||m.items.length===0?e.jsx(He,{icon:je,title:"No line items",description:"This sales order has no line items"}):e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs(fe,{children:[e.jsx(Se,{children:e.jsxs(B,{children:[e.jsx(c,{children:"SO Date"}),e.jsx(c,{children:"SO ID"}),e.jsx(c,{children:"Detail ID"}),e.jsx(c,{children:"Customer ID"}),e.jsx(c,{children:"Customer Name"}),e.jsx(c,{children:"Country"}),e.jsx(c,{children:"City"}),e.jsx(c,{children:"Invoice Num"}),e.jsx(c,{children:"Item ID"}),e.jsx(c,{children:"Item Type"}),e.jsx(c,{children:"Item Category"}),e.jsx(c,{children:"Item Subcategory"}),e.jsx(c,{children:"Item Name"}),e.jsx(c,{className:"text-right",children:"QTY Sold"}),e.jsx(c,{className:"text-right",children:"Unit Price"}),e.jsx(c,{className:"text-right",children:"Total Sales Price"})]})}),e.jsx(Ce,{children:m.items.map((s,t)=>{const a=Os(s.inventoryItemId);return e.jsxs(B,{children:[e.jsx(l,{className:"whitespace-nowrap",children:m.soDate??m.createdDate}),e.jsx(l,{className:"font-medium",children:m.id}),e.jsx(l,{className:"font-mono text-sm",children:Is(m.id,t)}),e.jsx(l,{className:"text-muted-foreground",children:m.customerId}),e.jsx(l,{children:m.customerName}),e.jsx(l,{children:m.customerCountry||"-"}),e.jsx(l,{children:m.customerCity||"-"}),e.jsx(l,{children:m.invoiceNumber||"-"}),e.jsx(l,{className:"font-mono text-sm",children:a.itemId}),e.jsx(l,{children:a.itemType}),e.jsx(l,{children:a.itemCategory}),e.jsx(l,{children:a.itemSubcategory}),e.jsx(l,{children:s.itemName}),e.jsx(l,{className:"text-right",children:s.quantity}),e.jsx(l,{className:"text-right",children:F(s.unitPrice)}),e.jsx(l,{className:"text-right font-medium",children:F(s.totalPrice)})]},t)})})]})}),m.items&&m.items.length>0&&e.jsx("div",{className:"mt-4 pt-4 border-t flex justify-end",children:e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Grand Total"}),e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:F(m.totalAmount??0)})]})})]})]})]}):j&&hs?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Place New Order"}),e.jsx("p",{className:"text-muted-foreground",children:"Browse products and add them to your cart"})]})}),e.jsx(It,{inventoryData:W,customersData:z,onSubmitOrder:Ts,onCancel:()=>Re(!1)})]}):j?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"My Orders"}),e.jsx("p",{className:"text-muted-foreground",children:"View and track your orders"})]}),e.jsxs(u,{onClick:()=>Re(!0),children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Place New Order"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(b,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:"Total Orders"}),e.jsx(je,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl font-bold",children:R.length})})]}),e.jsxs(b,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:"Pending"}),e.jsx(is,{className:"h-4 w-4 text-amber-600"})]}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:R.filter(s=>s.shippingStatus==="Pending"||s.shippingStatus==="Processing").length})})]}),e.jsxs(b,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:"Delivered"}),e.jsx(ds,{className:"h-4 w-4 text-green-600"})]}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:R.filter(s=>s.shippingStatus==="Delivered").length})})]})]}),e.jsxs(b,{children:[e.jsx(D,{children:e.jsx(P,{children:"Order History"})}),e.jsxs(S,{children:[R.length===0?e.jsx(He,{icon:je,title:"No orders yet",description:"Place your first order to get started",action:e.jsxs(u,{onClick:()=>Re(!0),children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Place New Order"]})}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs(fe,{children:[e.jsx(Se,{children:e.jsxs(B,{children:[e.jsx(c,{children:"Order ID"}),e.jsx(c,{children:"Date"}),e.jsx(c,{children:"Items"}),e.jsx(c,{className:"text-right",children:"Total"}),e.jsx(c,{className:"text-right",children:"Paid"}),e.jsx(c,{children:"Status"})]})}),e.jsx(Ce,{children:Fe.map(s=>e.jsxs(B,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>Xe(s),children:[e.jsx(l,{className:"font-medium font-mono",children:s.id}),e.jsx(l,{children:s.soDate??s.createdDate}),e.jsx(l,{children:e.jsxs("span",{className:"text-muted-foreground",children:[s.items.length," item",s.items.length!==1?"s":""]})}),e.jsx(l,{className:"text-right font-medium",children:F(s.totalAmount)}),e.jsx(l,{className:"text-right text-green-600",children:F(s.amountPaid??0)}),e.jsx(l,{children:e.jsx(H,{variant:s.shippingStatus==="Delivered"?"default":s.shippingStatus==="Shipped"||s.shippingStatus==="In Transit"?"secondary":s.shippingStatus==="Failed"||s.shippingStatus==="Returned"?"destructive":"outline",children:s.shippingStatus??"Pending"})})]},s.id))})]})}),R.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(cs,{totalItems:R.length,pageSize,currentPage:Je,onPageChange:setCurrentPage,onPageSizeChange:setPageSize})})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Sales Orders"}),e.jsx("p",{className:"text-muted-foreground",children:"Create and manage customer orders, track payments, and monitor delivery status"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(b,{className:"relative overflow-hidden",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:"Total SOs"}),e.jsx(vt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold",children:q.totalSOs}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[q.newThisWeek," new this week"]})]})]}),e.jsxs(b,{className:"relative overflow-hidden",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:"Total Value"}),e.jsx(Nt,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:F(q.totalValue)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Avg: ",F(q.avgOrderValue)," per SO"]})]})]}),e.jsxs(b,{className:"relative overflow-hidden",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:"Outstanding"}),e.jsx(is,{className:"h-4 w-4 text-amber-600"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:F(q.outstandingBalance)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[q.unpaidCount," unpaid, ",q.overdueCount," overdue"]})]})]}),e.jsxs(b,{className:"relative overflow-hidden",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:"Collection Rate"}),e.jsx(ds,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(S,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[q.collectionRate,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[q.paidCount," paid of ",q.totalSOs," total"]})]})]})]}),e.jsxs(b,{children:[e.jsxs(D,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Sales Orders"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage customer sales orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:Es,children:[e.jsx(pt,{className:"h-4 w-4 mr-1"}),"Export CSV"]}),$&&e.jsxs(ze,{open:ge,onOpenChange:le,children:[e.jsx(Js,{asChild:!0,children:e.jsxs(u,{size:"sm",children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),"Create SO"]})}),e.jsxs(Ee,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ve,{children:[e.jsx(Me,{children:"Create Sales Order"}),e.jsx(_e,{children:"Create a new sales order for a customer"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs(b,{children:[e.jsx(D,{className:"pb-3",children:e.jsx(P,{className:"text-base",children:"Sales Order Information"})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"SO Date *"}),e.jsx(p,{type:"date",value:i.soDate,onChange:s=>C(t=>({...t,soDate:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Customer *"}),j?e.jsx(p,{value:d?.displayName||d?.email||"Customer",disabled:!0,className:"bg-muted"}):e.jsxs(me,{value:i.customerId,onValueChange:ss,children:[e.jsx(ue,{children:e.jsx(xe,{placeholder:"Select customer"})}),e.jsx(he,{children:z.filter(s=>s.status==="Active").map(s=>e.jsx(ee,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Customer ID"}),e.jsx(p,{value:i.customerId,disabled:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Country"}),e.jsx(p,{value:i.customerCountry,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"City"}),e.jsx(p,{value:i.customerCity,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Invoice #"}),e.jsx(p,{value:i.invoiceNumber,onChange:s=>C(t=>({...t,invoiceNumber:s.target.value})),placeholder:"INV-2025-0001"})]})]}),!j&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Expected Delivery Date *"}),e.jsx(p,{type:"date",value:i.expectedDeliveryDate,onChange:s=>C(t=>({...t,expectedDeliveryDate:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Total Received (₱)"}),e.jsx(p,{type:"number",min:"0",step:"0.01",value:i.totalReceived,onChange:s=>C(t=>({...t,totalReceived:parseFloat(s.target.value)||0}))})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Amount Paid (₱)"}),e.jsx(p,{type:"number",min:"0",step:"0.01",value:i.amountPaid,onChange:s=>C(t=>({...t,amountPaid:parseFloat(s.target.value)||0})),placeholder:"Enter amount paid"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Notes"}),e.jsx(p,{value:i.notes,onChange:s=>C(t=>({...t,notes:s.target.value})),placeholder:"Additional notes..."})]})]})]}),e.jsxs(b,{children:[e.jsxs(D,{className:"pb-3 flex flex-row items-center justify-between",children:[e.jsx(P,{className:"text-base",children:"Line Items"}),e.jsxs(u,{size:"sm",variant:"outline",onClick:Ze,children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),e.jsxs(S,{children:[i.items.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:'No items added. Click "Add Item" to add line items.'}):e.jsxs(fe,{children:[e.jsx(Se,{children:e.jsxs(B,{children:[e.jsx(c,{children:"Item"}),e.jsx(c,{className:"w-24",children:"Qty"}),e.jsx(c,{className:"w-32",children:"Unit Price"}),e.jsx(c,{className:"w-32 text-right",children:"Total"}),e.jsx(c,{className:"w-12"})]})}),e.jsx(Ce,{children:i.items.map((s,t)=>e.jsxs(B,{children:[e.jsx(l,{children:e.jsxs(me,{value:s.inventoryItemId,onValueChange:a=>ce(t,"inventoryItemId",a),children:[e.jsx(ue,{children:e.jsx(xe,{placeholder:"Select item"})}),e.jsx(he,{children:W.map(a=>e.jsx(ee,{value:a.id,children:a.name},a.id))})]})}),e.jsx(l,{children:e.jsx(p,{type:"number",min:"1",value:s.quantity,onChange:a=>ce(t,"quantity",a.target.value)})}),e.jsx(l,{children:e.jsx(p,{type:"number",min:"0",step:"0.01",value:s.unitPrice,onChange:a=>ce(t,"unitPrice",a.target.value)})}),e.jsxs(l,{className:"text-right font-medium",children:["₱",s.totalPrice.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(l,{children:e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>es(t),children:e.jsx(te,{className:"h-4 w-4 text-destructive"})})})]},t))})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grand Total:"}),e.jsxs("span",{className:"ml-2 text-xl font-bold",children:["₱",de.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"SO Balance:"}),e.jsxs("span",{className:ke("ml-2 text-xl font-bold",de-i.totalReceived>0?"text-orange-600":"text-green-600"),children:["₱",(de-i.totalReceived).toLocaleString(void 0,{minimumFractionDigits:2})]})]})]})]})]}),e.jsxs(ls,{children:[e.jsx(u,{variant:"outline",onClick:()=>{le(!1),ye()},children:"Cancel"}),e.jsx(u,{onClick:As,children:"Create Sales Order"})]})]})]})]})]})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(xs,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(p,{placeholder:"Search SO ID, customer, or items...",value:re,onChange:s=>Y(s.target.value),className:"pl-10"})]}),e.jsxs(me,{value:M,onValueChange:ie,children:[e.jsxs(ue,{className:"w-48",children:[e.jsx(mt,{className:"h-4 w-4 mr-2"}),e.jsx(xe,{placeholder:"Filter by status"})]}),e.jsxs(he,{children:[e.jsx(ee,{value:"all",children:"All Statuses"}),Ot.map(s=>e.jsx(ee,{value:s,children:s},s))]})]}),e.jsxs(u,{variant:I?"default":"outline",size:"sm",onClick:()=>X(!I),className:I?"bg-orange-500 hover:bg-orange-600 text-white":"",children:[e.jsx(we,{className:"h-4 w-4 mr-1"}),I?"Viewing Archived":"View Archived"]}),(re||M!=="all"||I)&&e.jsxs(u,{variant:"ghost",size:"sm",onClick:Vs,className:"text-muted-foreground",children:[e.jsx(Ws,{className:"h-4 w-4 mr-1"}),"Clear Filters"]})]}),Ps&&f&&e.jsx(ut,{selectionCount:Le,onClearSelection:Ne,actions:I?[{id:"restore",label:"Restore",icon:e.jsx(os,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:$s},...G?[{id:"permanent-delete",label:"Permanently Delete",icon:e.jsx(te,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>k(!0)}]:[]]:[{id:"archive",label:"Archive",icon:e.jsx(we,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:()=>k(!0)}]}),R.length===0?e.jsx(He,{icon:I?we:je,title:I?"No archived sales orders":"No sales orders found",description:I?"Archived sales orders will appear here":re||M!=="all"?"Try adjusting your search or filters":"Create your first sales order to get started",actionLabel:!I&&$?"Create SO":void 0,onAction:!I&&$?()=>le(!0):void 0}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx(xt,{pageItemCount:Ye,totalItemCount:We,isAllPagesSelected:bs,show:ws&&We>Ye,onSelectAllPages:Ss,onClearSelection:Ne,itemLabel:"orders"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(fe,{children:[e.jsx(Se,{children:e.jsxs(B,{children:[f&&e.jsx(c,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:Cs,ref:s=>{s&&(s.indeterminate=Ds)},onChange:()=>fs(),className:"h-4 w-4"})}),e.jsx(U,{sortKey:"soDate",currentSortKey:A,sortDirection:K("soDate"),onSort:_,children:"Date"}),e.jsx(U,{sortKey:"id",currentSortKey:A,sortDirection:K("id"),onSort:_,children:"SO ID"}),e.jsx(c,{children:"Customer ID"}),e.jsx(U,{sortKey:"customerName",currentSortKey:A,sortDirection:K("customerName"),onSort:_,children:"Customer Name"}),e.jsx(c,{children:"Invoice #"}),e.jsx(c,{children:"Country"}),e.jsx(c,{children:"City"}),e.jsx(U,{sortKey:"totalAmount",currentSortKey:A,sortDirection:K("totalAmount"),onSort:_,className:"text-right",children:"Total Amount"}),e.jsx(U,{sortKey:"totalReceived",currentSortKey:A,sortDirection:K("totalReceived"),onSort:_,className:"text-right",children:"Total Received"}),e.jsx(U,{sortKey:"soBalance",currentSortKey:A,sortDirection:K("soBalance"),onSort:_,className:"text-right",children:"SO Balance"}),e.jsx(U,{sortKey:"receiptStatus",currentSortKey:A,sortDirection:K("receiptStatus"),onSort:_,children:"Receipt Status"}),e.jsx(U,{sortKey:"shippingStatus",currentSortKey:A,sortDirection:K("shippingStatus"),onSort:_,children:"Shipping"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(Ce,{children:Fe.map(s=>e.jsxs(B,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>zs(s),children:[f&&e.jsx(l,{onClick:t=>t.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:Ns(s.id),onChange:()=>ys(s.id),className:"h-4 w-4"})}),e.jsx(l,{className:"whitespace-nowrap",children:s.soDate??s.createdDate}),e.jsx(l,{className:"font-medium",children:s.id}),e.jsx(l,{className:"text-muted-foreground",children:s.customerId}),e.jsx(l,{children:s.customerName}),e.jsx(l,{className:"text-muted-foreground",children:s.invoiceNumber||"-"}),e.jsx(l,{children:s.customerCountry||"-"}),e.jsx(l,{children:s.customerCity||"-"}),e.jsxs(l,{className:"text-right font-medium",children:["₱",(s.totalAmount??0).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs(l,{className:"text-right",children:["₱",(s.totalReceived??0).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(l,{className:"text-right font-medium",children:e.jsxs("span",{className:ke((s.soBalance??s.totalAmount??0)>0?"text-orange-600":"text-green-600"),children:["₱",(s.soBalance??s.totalAmount??0).toLocaleString(void 0,{minimumFractionDigits:2})]})}),e.jsx(l,{children:qe(s.receiptStatus)}),e.jsx(l,{children:e.jsx(H,{variant:s.shippingStatus==="Delivered"?"default":s.shippingStatus==="In Transit"||s.shippingStatus==="Shipped"?"secondary":s.shippingStatus==="Failed"||s.shippingStatus==="Returned"?"destructive":"outline",children:s.shippingStatus??"Pending"})}),e.jsx(l,{onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(u,{size:"sm",variant:"outline",onClick:()=>Xe(s),title:"View Details",children:e.jsx(Ys,{className:"h-4 w-4"})}),I?e.jsx(u,{size:"sm",variant:"outline",onClick:()=>qs(s.id),title:"Restore",children:e.jsx(os,{className:"h-4 w-4"})}):e.jsx(u,{size:"sm",variant:"ghost",className:"text-destructive",onClick:()=>Ls(s.id),title:"Archive",children:e.jsx(we,{className:"h-4 w-4"})})]})})]},s.id))})]})})]}),e.jsx(cs,{currentPage:Je,totalPages:js,itemsPerPage:gs,onPageChange:ps,totalItems:vs})]}),r&&e.jsx(ze,{open:!!r,onOpenChange:s=>{s||(o(null),ye())},children:e.jsxs(Ee,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ve,{children:[e.jsxs(Me,{children:["Edit Sales Order - ",r]}),e.jsx(_e,{children:"Update sales order details"})]}),e.jsx("div",{className:"space-y-6 py-4",children:(()=>{const s=ne.find(t=>t.id===r);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Receipt Status:"}),s&&qe(s.receiptStatus),e.jsx("span",{className:"text-sm text-muted-foreground ml-4",children:"Shipping:"}),e.jsx(H,{variant:s?.shippingStatus==="Delivered"?"default":s?.shippingStatus==="In Transit"||s?.shippingStatus==="Shipped"?"secondary":s?.shippingStatus==="Failed"||s?.shippingStatus==="Returned"?"destructive":"outline",children:s?.shippingStatus??"Pending"})]}),e.jsxs(b,{children:[e.jsx(D,{className:"pb-3",children:e.jsx(P,{className:"text-base",children:"Sales Order Information"})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"SO Date"}),e.jsx(p,{type:"date",value:i.soDate,onChange:t=>C(a=>({...a,soDate:t.target.value})),disabled:j,className:j?"bg-muted":""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Customer"}),j?e.jsx(p,{value:i.customerName||d?.displayName||d?.email||"Customer",disabled:!0,className:"bg-muted"}):e.jsxs(me,{value:i.customerId,onValueChange:ss,children:[e.jsx(ue,{children:e.jsx(xe,{placeholder:"Select customer"})}),e.jsx(he,{children:z.map(t=>e.jsx(ee,{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Customer ID"}),e.jsx(p,{value:i.customerId,disabled:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Country"}),e.jsx(p,{value:i.customerCountry,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"City"}),e.jsx(p,{value:i.customerCity,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Invoice #"}),e.jsx(p,{value:i.invoiceNumber,onChange:t=>C(a=>({...a,invoiceNumber:t.target.value})),disabled:j,className:j?"bg-muted":""})]})]}),!j&&e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Expected Delivery Date"}),e.jsx(p,{type:"date",value:i.expectedDeliveryDate,onChange:t=>C(a=>({...a,expectedDeliveryDate:t.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Total Received (₱)"}),e.jsx(p,{type:"number",min:"0",step:"0.01",value:i.totalReceived,onChange:t=>C(a=>({...a,totalReceived:parseFloat(t.target.value)||0}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Shipping Status"}),e.jsxs(me,{value:i.shippingStatus,onValueChange:t=>C(a=>({...a,shippingStatus:t})),children:[e.jsx(ue,{children:e.jsx(xe,{})}),e.jsx(he,{children:kt.map(t=>e.jsx(ee,{value:t,children:t},t))})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Amount Paid (₱)"}),e.jsx(p,{type:"number",min:"0",step:"0.01",value:i.amountPaid,onChange:t=>C(a=>({...a,amountPaid:parseFloat(t.target.value)||0})),placeholder:"Enter amount paid"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Notes"}),e.jsx(p,{value:i.notes,onChange:t=>C(a=>({...a,notes:t.target.value})),placeholder:"Optional notes..."})]})]})]}),e.jsxs(b,{children:[e.jsxs(D,{className:"pb-3 flex flex-row items-center justify-between",children:[e.jsx(P,{className:"text-base",children:"Line Items"}),e.jsxs(u,{size:"sm",variant:"outline",onClick:Ze,children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),e.jsxs(S,{children:[i.items.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No items added."}):e.jsxs(fe,{children:[e.jsx(Se,{children:e.jsxs(B,{children:[e.jsx(c,{children:"Item"}),e.jsx(c,{className:"w-24",children:"Qty"}),e.jsx(c,{className:"w-32",children:"Unit Price"}),e.jsx(c,{className:"w-32 text-right",children:"Total"}),e.jsx(c,{className:"w-12"})]})}),e.jsx(Ce,{children:i.items.map((t,a)=>e.jsxs(B,{children:[e.jsx(l,{children:e.jsxs(me,{value:t.inventoryItemId,onValueChange:n=>ce(a,"inventoryItemId",n),children:[e.jsx(ue,{children:e.jsx(xe,{placeholder:"Select item"})}),e.jsx(he,{children:W.map(n=>e.jsx(ee,{value:n.id,children:n.name},n.id))})]})}),e.jsx(l,{children:e.jsx(p,{type:"number",min:"1",value:t.quantity,onChange:n=>ce(a,"quantity",n.target.value)})}),e.jsx(l,{children:e.jsx(p,{type:"number",min:"0",step:"0.01",value:t.unitPrice,onChange:n=>ce(a,"unitPrice",n.target.value)})}),e.jsxs(l,{className:"text-right font-medium",children:["₱",t.totalPrice.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(l,{children:e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>es(a),children:e.jsx(te,{className:"h-4 w-4 text-destructive"})})})]},a))})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grand Total:"}),e.jsxs("span",{className:"ml-2 text-xl font-bold",children:["₱",de.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"SO Balance:"}),e.jsxs("span",{className:ke("ml-2 text-xl font-bold",de-i.totalReceived>0?"text-orange-600":"text-green-600"),children:["₱",(de-i.totalReceived).toLocaleString(void 0,{minimumFractionDigits:2})]})]})]})]})]}),e.jsxs(ls,{className:"gap-2",children:[f&&e.jsxs(u,{variant:"destructive",onClick:()=>Fs(r),children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),"Delete"]}),e.jsx(u,{variant:"outline",onClick:()=>{o(null),ye()},children:"Cancel"}),e.jsx(u,{onClick:()=>Rs(r),children:"Save Changes"})]})]})})()})]})})]})]}),e.jsx(ze,{open:y,onOpenChange:k,children:e.jsxs(Ee,{className:"max-w-md",children:[e.jsxs(Ve,{children:[e.jsxs(Me,{className:"flex items-center gap-2",children:[e.jsx(yt,{className:"h-5 w-5 text-destructive"}),"Delete ",Le," Sales Order",Le!==1?"s":""]}),e.jsx(_e,{children:I?"These sales orders are already archived. This action will permanently remove them from the system.":"Choose how you want to delete the selected sales orders:"})]}),I?e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("div",{className:"p-3 border border-destructive/50 rounded-md bg-destructive/10",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(te,{className:"h-4 w-4 mt-0.5 text-destructive"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-destructive",children:"Permanent Deletion"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This cannot be undone. All data will be permanently removed."})]})]})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(u,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsx(u,{variant:"destructive",onClick:ts,children:"Permanently Delete All"})]})]}):e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("div",{className:"p-3 border rounded-md hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(we,{className:"h-4 w-4 mt-0.5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Archive"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Move to archive. Sales orders can be restored later."})]}),e.jsx(u,{variant:"secondary",size:"sm",onClick:Bs,children:"Archive"})]})}),G&&e.jsx("div",{className:"p-3 border border-destructive/50 rounded-md bg-destructive/10",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(te,{className:"h-4 w-4 mt-0.5 text-destructive"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-destructive",children:"Delete Permanently"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cannot be undone. Data will be permanently removed."})]}),e.jsx(u,{variant:"destructive",size:"sm",onClick:ts,children:"Delete"})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(u,{variant:"outline",onClick:()=>k(!1),children:"Cancel"})})]})]})})]})}export{Vt as SalesOrdersView};
