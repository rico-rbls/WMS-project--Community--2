import{F as ze,i as Ve,r as l,G as Ye,$ as Je,a0 as ce,J as i,a1 as Qe,a2 as We,j as e,C as k,m as T,n as F,o as O,D as ue,O as me,B as C,v as he,w as xe,x as fe,y as ge,L as h,I as u,Q as Xe,d as je,t as pe,X as _e,a3 as Ze,S as es,V as ye,a4 as ss,a5 as ts,a6 as as}from"./index-DI4_T8_2.js";import{T as rs,e as ls,f as is,g as ve,h as Se,i as b,j as ns,k as g}from"./sortable-table-head-GUmt4Lm5.js";import{u as ds,a as os,P as cs,B as us,b as ms,T as hs,E as xs,c as P,d as fs}from"./editable-cell-Bag6AwMF.js";import{D as gs}from"./date-range-filter-BLrjlxG_.js";import{S as js,F as ps}from"./save-search-dialog-BSTcOyRp.js";import{u as ys}from"./useTableSort-BQNjhCx3.js";import{c as vs}from"./permissions-M3W24QUc.js";import{S as Ss}from"./star-BcON-H-2.js";import"./calendar-DD1PNvs0.js";const Cs=["Pending","Processing","Shipped","Delivered"];function Es({initialOpenDialog:G,onDialogOpened:z}){const{isFavorite:V,getFavoritesByType:Y}=ze(),{user:J}=Ve(),m=J?vs(J.role):!1,[p,Q]=l.useState(""),[n,A]=l.useState(""),[d,I]=l.useState(""),[j,W]=l.useState(!1),[X,f]=l.useState(null),[Ce,_]=l.useState(!0),[D,B]=l.useState(!1),[K,$]=l.useState(null),[r,c]=l.useState({id:"",customer:"",items:0,total:"",status:"Pending",date:""}),L=Ye(p,300);l.useEffect(()=>{(async()=>{_(!0);const s=await Je();f(s),_(!1)})()},[]),l.useEffect(()=>{G&&!D&&(B(!0),z?.())},[G,z,D]);const Z=l.useMemo(()=>X??[],[X]),U=l.useMemo(()=>Z.filter(s=>{if(j&&!V("orders",s.id))return!1;if(L){const a=L.toLowerCase();if(!(s.id.toLowerCase().includes(a)||s.customer.toLowerCase().includes(a)))return!1}if(n||d)try{const a=new Date(s.date);if(n){const t=new Date(n);if(a<t)return!1}if(d){const t=new Date(d);if(t.setHours(23,59,59,999),a>t)return!1}}catch{return!1}return!0}),[Z,L,n,d,j,V]),be=l.useCallback(s=>{s.searchTerm&&Q(s.searchTerm),s.filters.fromDate&&typeof s.filters.fromDate=="string"&&A(s.filters.fromDate),s.filters.toDate&&typeof s.filters.toDate=="string"&&I(s.filters.toDate),s.filters.favoritesOnly==="true"&&W(!0)},[]),De=l.useMemo(()=>{const s={};return n&&(s.fromDate=n),d&&(s.toDate=d),j&&(s.favoritesOnly="true"),s},[n,d,j]),{sortedData:Ne,sortConfig:y,requestSort:v,getSortDirection:S}=ys(U),{currentPage:ee,totalPages:we,paginatedData:se,goToPage:ke,totalItems:Te,itemsPerPage:Fe}=ds(Ne,25),{selectedIds:E,selectedItems:te,selectionCount:ae,isAllSelected:Oe,isPartiallySelected:Pe,hasSelection:H,toggleItem:Be,toggleAll:M,deselectAll:x,isSelected:Ee}=os(se),[re,le]=l.useState(!1),[Ae,ie]=l.useState(!1),[Ie,R]=l.useState(!1),[bs,Ke]=l.useState(!1);l.useEffect(()=>{x()},[ee,x]),l.useEffect(()=>{const s=a=>{(a.metaKey||a.ctrlKey)&&a.key==="a"&&!D&&!K&&(a.preventDefault(),M()),a.key==="Escape"&&H&&x()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[M,x,H,D,K]);function q(){c({id:"",customer:"",items:0,total:"",status:"Pending",date:""})}function ne(){A(""),I("")}function de(){return r.customer.trim()?r.total.trim()?r.date.trim()?r.items<0?"Items cannot be negative":null:"Date is required":"Total is required":"Customer is required"}async function $e(){const s=de();if(s){i.error(s);return}try{const a=await ts({customer:r.customer,items:r.items,total:r.total,status:r.status,date:r.date});f(t=>[a,...t??[]]),B(!1),q(),i.success("Order created successfully")}catch(a){i.error(a?.message||"Failed to create order")}}async function Le(){const s=de();if(s){i.error(s);return}if(!r.id){i.error("Missing order id");return}try{const a=await ce({id:r.id,customer:r.customer,items:r.items,total:r.total,status:r.status,date:r.date});f(t=>(t??[]).map(o=>o.id===a.id?a:o)),$(null),i.success("Order updated successfully")}catch(a){i.error(a?.message||"Failed to update order")}}async function Ue(s){try{await as(s),f(a=>(a??[]).filter(t=>t.id!==s)),$(null),i.success("Order deleted successfully")}catch(a){i.error(a?.message||"Failed to delete order")}}const N=l.useCallback(async(s,a,t)=>{try{const o={[a]:t},w=await ce({id:s,...o});f(Ge=>(Ge??[]).map(oe=>oe.id===s?w:oe)),i.success(`${a.charAt(0).toUpperCase()+a.slice(1)} updated`)}catch(o){throw i.error(o?.message||"Failed to update"),o}},[f]),He=s=>{switch(s){case"Delivered":return"bg-green-500/10 text-green-700";case"Shipped":return"bg-blue-500/10 text-blue-700";case"Processing":return"bg-orange-500/10 text-orange-700";case"Pending":return"bg-gray-500/10 text-gray-700";default:return"bg-gray-500/10 text-gray-700"}},Me=l.useCallback(async()=>{le(!0);try{const s=Array.from(E),a=await Qe(s);f(t=>t?.filter(o=>!s.includes(o.id))??[]),a.failedCount>0?i.warning(`Deleted ${a.successCount} orders. ${a.failedCount} failed.`):i.success(`Successfully deleted ${a.successCount} order${a.successCount!==1?"s":""}`),x()}catch(s){i.error(s?.message||"Failed to delete orders")}finally{le(!1),R(!1)}},[E,x]),Re=l.useCallback(async s=>{ie(!0);try{const a=Array.from(E),t=await We(a,s);f(o=>o&&o.map(w=>a.includes(w.id)?{...w,status:s}:w)),t.failedCount>0?i.warning(`Updated ${t.successCount} orders. ${t.failedCount} failed.`):i.success(`Successfully updated ${t.successCount} order${t.successCount!==1?"s":""}`),x()}catch(a){i.error(a?.message||"Failed to update orders")}finally{ie(!1),Ke(!1)}},[E,x]),qe=l.useMemo(()=>te.map(s=>`${s.id} - ${s.customer}`),[te]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(k,{children:[e.jsx(T,{className:"pb-2",children:e.jsx(F,{className:"text-sm text-muted-foreground",children:"Total Orders"})}),e.jsx(O,{children:e.jsx("div",{className:"text-2xl",children:"256"})})]}),e.jsxs(k,{children:[e.jsx(T,{className:"pb-2",children:e.jsx(F,{className:"text-sm text-muted-foreground",children:"Pending"})}),e.jsx(O,{children:e.jsx("div",{className:"text-2xl",children:"42"})})]}),e.jsxs(k,{children:[e.jsx(T,{className:"pb-2",children:e.jsx(F,{className:"text-sm text-muted-foreground",children:"In Progress"})}),e.jsx(O,{children:e.jsx("div",{className:"text-2xl",children:"89"})})]}),e.jsxs(k,{children:[e.jsx(T,{className:"pb-2",children:e.jsx(F,{className:"text-sm text-muted-foreground",children:"Completed"})}),e.jsx(O,{children:e.jsx("div",{className:"text-2xl",children:"125"})})]})]}),e.jsxs(k,{children:[e.jsx(T,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(F,{children:"Order Management"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(ue,{open:D,onOpenChange:s=>{B(s),s||q()},children:[e.jsx(me,{asChild:!0,children:e.jsxs(C,{onClick:()=>q(),disabled:!m,title:m?void 0:"You don't have permission to add orders",children:[e.jsx(cs,{className:"h-4 w-4 mr-2"}),"Add Order"]})}),e.jsxs(he,{children:[e.jsxs(xe,{children:[e.jsx(fe,{children:"Add New Order"}),e.jsx(ge,{children:"Enter the details for the new order."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"customer",children:"Customer"}),e.jsx(u,{id:"customer",placeholder:"Customer name",value:r.customer,onChange:s=>c({...r,customer:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"items",children:"Items"}),e.jsx(u,{id:"items",type:"number",placeholder:"0",value:r.items,onChange:s=>c({...r,items:Number(s.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"total",children:"Total (PHP ₱)"}),e.jsx(u,{id:"total",placeholder:"₱0.00",value:r.total,onChange:s=>c({...r,total:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"status",children:"Status"}),e.jsx(u,{id:"status",placeholder:"Pending",value:r.status,onChange:s=>c({...r,status:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"date",children:"Date"}),e.jsx(u,{id:"date",placeholder:"2025-10-15",value:r.date,onChange:s=>c({...r,date:s.target.value})})]}),e.jsx(C,{className:"w-full",onClick:$e,children:"Add Order"})]})]})]})})]})}),e.jsxs(O,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Xe,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(u,{placeholder:"Search orders...",value:p,onChange:s=>Q(s.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx(gs,{fromDate:n,toDate:d,onFromDateChange:A,onToDateChange:I,onClear:ne,label:"Filter by Order Date"}),e.jsxs(C,{variant:j?"default":"outline",size:"sm",onClick:()=>W(!j),className:"gap-1",children:[e.jsx(Ss,{className:je("h-4 w-4",j&&"fill-current")}),"Favorites",Y("orders").length>0&&e.jsx(pe,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:Y("orders").length})]}),e.jsx(js,{entityType:"orders",currentSearchTerm:p,currentFilters:De,onApplySearch:be})]}),(n||d)&&e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(pe,{variant:"secondary",className:"gap-1",children:["Date: ",n||"..."," to ",d||"...",e.jsx("button",{onClick:ne,className:"ml-1 hover:bg-secondary-foreground/20 rounded-full p-0.5",children:e.jsx(_e,{className:"h-3 w-3"})})]})})]}),H&&m&&e.jsx(us,{selectionCount:ae,onClearSelection:x,isLoading:re||Ae,actions:[{id:"delete",label:"Delete",icon:e.jsx(rs,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>R(!0)}],actionGroups:[{id:"status-update",label:"Update Status",icon:e.jsx(Ze,{className:"h-4 w-4 mr-1"}),options:[{value:"Pending",label:"Pending"},{value:"Processing",label:"Processing"},{value:"Shipped",label:"Shipped"},{value:"Delivered",label:"Delivered"}],onSelect:s=>Re(s)}],className:"mb-4"}),e.jsx(ms,{open:Ie,onOpenChange:R,itemCount:ae,itemType:"order",itemNames:qe,onConfirm:Me,isLoading:re}),Ce?e.jsx(hs,{rows:8}):U.length===0?e.jsx(xs,{icon:es,title:"No orders found",description:p||n||d?"Try adjusting your search or date filters":"Get started by creating your first order",actionLabel:p||n||d?void 0:"Create Order",onAction:p||n||d?void 0:()=>B(!0)}):e.jsxs("div",{className:"rounded-md border",children:[e.jsxs(ls,{children:[e.jsx(is,{children:e.jsxs(ve,{children:[e.jsx(Se,{className:"w-12",children:e.jsx(ye,{checked:Oe,ref:s=>{s&&(s.indeterminate=Pe)},onCheckedChange:M,"aria-label":"Select all orders"})}),e.jsx(b,{sortKey:"id",currentSortKey:y.key,sortDirection:S("id"),onSort:s=>v(s),children:"Order ID"}),e.jsx(b,{sortKey:"customer",currentSortKey:y.key,sortDirection:S("customer"),onSort:s=>v(s),children:"Customer"}),e.jsx(b,{sortKey:"items",currentSortKey:y.key,sortDirection:S("items"),onSort:s=>v(s),children:"Items"}),e.jsx(b,{sortKey:"total",currentSortKey:y.key,sortDirection:S("total"),onSort:s=>v(s),children:"Total"}),e.jsx(b,{sortKey:"status",currentSortKey:y.key,sortDirection:S("status"),onSort:s=>v(s),children:"Status"}),e.jsx(b,{sortKey:"date",currentSortKey:y.key,sortDirection:S("date"),onSort:s=>v(s),children:"Date"}),e.jsx(Se,{children:"Actions"})]})}),e.jsx(ns,{children:se.map(s=>{const a=Ee(s.id);return e.jsxs(ve,{className:je(a&&"bg-muted/50"),children:[e.jsx(g,{children:e.jsx(ye,{checked:a,onCheckedChange:()=>Be(s.id),"aria-label":`Select order ${s.id}`})}),e.jsx(g,{children:s.id}),e.jsx(g,{children:e.jsx(P,{value:s.customer,type:"text",onSave:t=>N(s.id,"customer",t),disabled:!m})}),e.jsx(g,{children:e.jsx(P,{value:s.items,type:"number",min:0,step:1,onSave:t=>N(s.id,"items",t),disabled:!m})}),e.jsx(g,{children:e.jsx(P,{value:s.total,type:"text",onSave:t=>N(s.id,"total",t),disabled:!m})}),e.jsx(g,{children:e.jsx(P,{value:s.status,type:"badge",options:Cs.map(t=>({value:t,label:t})),badgeClassName:He(s.status),onSave:t=>N(s.id,"status",t),disabled:!m})}),e.jsx(g,{children:e.jsx(P,{value:s.date,type:"text",onSave:t=>N(s.id,"date",t),disabled:!m})}),e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ps,{entityType:"orders",entityId:s.id,entityName:`${s.id} - ${s.customer}`}),e.jsxs(ue,{open:K===s.id,onOpenChange:t=>{$(t?s.id:null),t&&c({...s})},children:[e.jsx(me,{asChild:!0,children:e.jsx(C,{variant:"ghost",size:"sm",disabled:!m,title:m?void 0:"You don't have permission to edit orders",children:e.jsx(ss,{className:"h-4 w-4"})})}),e.jsxs(he,{children:[e.jsxs(xe,{children:[e.jsxs(fe,{children:["Edit Order - ",s.id]}),e.jsx(ge,{children:"Update fields and save your changes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-customer",children:"Customer"}),e.jsx(u,{id:"edit-customer",value:r.customer,onChange:t=>c({...r,customer:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-items",children:"Items"}),e.jsx(u,{id:"edit-items",type:"number",value:r.items,onChange:t=>c({...r,items:Number(t.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-total",children:"Total (PHP ₱)"}),e.jsx(u,{id:"edit-total",value:r.total,onChange:t=>c({...r,total:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-status",children:"Status"}),e.jsx(u,{id:"edit-status",value:r.status,onChange:t=>c({...r,status:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"edit-date",children:"Date"}),e.jsx(u,{id:"edit-date",value:r.date,onChange:t=>c({...r,date:t.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{className:"flex-1",onClick:Le,children:"Save Changes"}),e.jsx(C,{variant:"destructive",onClick:()=>Ue(s.id),children:"Delete"})]})]})]})]})]})})]},s.id)})})]}),U.length>0&&e.jsx(fs,{currentPage:ee,totalPages:we,onPageChange:ke,itemsPerPage:Fe,totalItems:Te})]})]})]})]})}export{Es as OrdersView};
