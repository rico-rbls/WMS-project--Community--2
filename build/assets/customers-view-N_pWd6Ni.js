import{O as vs,i as Ns,r as n,V as Cs,aD as bs,b0 as Me,A as i,b1 as Ss,b2 as ws,b3 as Fs,b4 as ks,b5 as As,j as e,C as N,q as H,s as G,U as de,t as C,S as Ds,P as Ps,d as D,z as L,x as Ts,D as me,a3 as Es,B as x,E as ue,F as he,G as xe,H as ge,I as o,J as m,K as pe,b6 as Is,a5 as Bs,a4 as Ls,p as $s,ac as Re,aY as ze,ad as Us,b7 as Ks,b8 as Os,b9 as Ms}from"./index-DDci2XN2.js";import{S as Y,a as _,b as J,c as W,d as R,T as Ve,e as Rs,f as zs,g as qe,h as He,i as k,j as Vs,k as f}from"./sortable-table-head-Bpyu4OSg.js";import{u as qs,a as Hs,P as Gs,F as Ys,B as _s,T as Js,E as Ws,S as Xs,b as Qs}from"./select-all-banner-snGFN-6v.js";import{B as Zs}from"./bulk-delete-dialog-DupwYnUY.js";import{F as Ge}from"./favorite-button-C4fBmQDH.js";import{u as et}from"./useTableSort-De0sBm6j.js";import{c as st,i as tt}from"./permissions-DJnvoGTW.js";import{E as je}from"./editable-cell-DugkHHlV.js";import{C as at}from"./circle-check-big-Cqf7XqR1.js";import{S as rt}from"./star-CFGmvzW7.js";import{A as X,a as Ye}from"./archive-JzTJESXI.js";import{P as _e}from"./phone-kU3IBe-O.js";import{S as Je}from"./square-pen-DWwIw9p7.js";import{M as lt}from"./map-pin-BQQ9tX4S.js";import{D as nt}from"./dollar-sign-DfKtBucy.js";import"./skeleton-D6aD9Qan.js";const fe=["Active","Inactive"],ye=["Technology","Startup","Enterprise","Retail","Healthcare","Finance","Other"];function bt({initialOpenDialog:ve,onDialogOpened:Ne,initialCustomerId:Q,onCustomerDialogOpened:Ce}){const{isFavorite:be,getFavoritesByType:Se}=vs(),{user:Z}=Ns(),y=Z?st(Z.role):!1,we=Z?tt(Z.role):!1,[$,Fe]=n.useState(""),[b,ee]=n.useState("all"),[U,ke]=n.useState(!1),[d,Ae]=n.useState(!1),[z,p]=n.useState(null),[We,De]=n.useState(!0),[V,q]=n.useState(!1),[K,P]=n.useState(null),[ae,O]=n.useState(null),[t,c]=n.useState({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0}),re=Cs($,300);n.useEffect(()=>{(async()=>{De(!0);const s=await bs();p(s),De(!1)})()},[]),n.useEffect(()=>{ve&&!V&&(q(!0),Ne?.())},[ve,Ne,V]),n.useEffect(()=>{Q&&z&&z.find(a=>a.id===Q)&&(O(Q),Ce?.())},[Q,z,Ce]);const j=n.useMemo(()=>z??[],[z]),g=n.useMemo(()=>{const s=j.length,a=j.filter(h=>h.status==="Active").length,r=j.filter(h=>h.status==="Inactive").length,l=new Set(j.map(h=>h.category)).size,I=j.reduce((h,B)=>h+B.purchases,0),oe=j.reduce((h,B)=>h+B.payments,0),te=j.reduce((h,B)=>h+B.balance,0);let Oe=null;if(j.length>0){const h=[...j].sort((B,ys)=>ys.purchases-B.purchases);h[0].purchases>0&&(Oe={id:h[0].id,name:h[0].name,value:h[0].purchases})}return{totalCustomers:s,activeCustomers:a,inactiveCustomers:r,uniqueCategories:l,totalPurchases:I,totalPayments:oe,totalBalance:te,topCustomerByPurchases:Oe}},[j]),le=n.useMemo(()=>j.filter(s=>{if(s.archived===!0!==d||U&&!be("customers",s.id)||b!=="all"&&s.status!==b)return!1;if(re){const r=re.toLowerCase();if(!(s.name.toLowerCase().includes(r)||s.id.toLowerCase().includes(r)||s.category.toLowerCase().includes(r)||s.contact.toLowerCase().includes(r)||s.email.toLowerCase().includes(r)))return!1}return!0}),[j,re,b,U,be,d]);function Xe(){Fe(""),ee("all"),ke(!1),Ae(!1)}async function Qe(s){try{const a=await Ms(s);p(r=>(r??[]).map(l=>l.id===s?a:l)),P(null),i.success("Customer archived successfully")}catch(a){i.error(a?.message||"Failed to archive customer")}}async function Ze(s){try{const a=await Ks(s);p(r=>(r??[]).map(l=>l.id===s?a:l)),P(null),i.success("Customer restored successfully")}catch(a){i.error(a?.message||"Failed to restore customer")}}async function es(s){try{await Os(s),p(a=>(a??[]).filter(r=>r.id!==s)),P(null),i.success("Customer permanently deleted")}catch(a){i.error(a?.message||"Failed to permanently delete customer")}}const T=s=>{switch(s){case"Active":return"✓";case"Inactive":return"○";default:return"○"}},se=s=>{switch(s){case"Active":return"bg-emerald-500/15 text-emerald-700 dark:text-emerald-400 border-emerald-200";case"Inactive":return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200";default:return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200"}},{sortedData:Pe,sortConfig:S,requestSort:w,getSortDirection:F}=et(le),{currentPage:Te,totalPages:ss,paginatedData:Ee,goToPage:ts,totalItems:as,itemsPerPage:rs}=qs(Pe,25),{selectedIds:v,selectedItems:Ie,selectionCount:M,isAllSelected:ls,isAllPageSelected:ns,isAllPagesSelected:is,isPartiallySelected:cs,hasSelection:ne,toggleItem:os,toggleAll:ie,selectAllPages:ds,deselectAll:u,isSelected:ms,totalItemCount:Be,pageItemCount:Le}=Hs(Ee,Pe),[$e,A]=n.useState(!1),[us,Ue]=n.useState(!1),[hs,E]=n.useState(!1);n.useEffect(()=>{u()},[Te,u]),n.useEffect(()=>{const s=a=>{(a.metaKey||a.ctrlKey)&&a.key==="a"&&!V&&!K&&(a.preventDefault(),ie()),a.key==="Escape"&&ne&&u()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[ie,u,ne,V,K]);const ce=n.useCallback(async(s,a,r)=>{try{const l={[a]:r},I=await Me({id:s,...l});p(oe=>(oe??[]).map(te=>te.id===s?I:te)),i.success(`${a.charAt(0).toUpperCase()+a.slice(1)} updated`)}catch(l){throw i.error(l?.message||"Failed to update"),l}},[p]);n.useCallback(async()=>{A(!0);try{const s=Array.from(v),a=await Ss(s);p(r=>r?.filter(l=>!s.includes(l.id))??[]),a.failedCount>0?i.warning(`Deleted ${a.successCount} customers. ${a.failedCount} failed.`):i.success(`Successfully deleted ${a.successCount} customer${a.successCount!==1?"s":""}`),u()}catch(s){i.error(s?.message||"Failed to delete customers")}finally{A(!1),E(!1)}},[v,u]);const xs=n.useCallback(async()=>{A(!0);try{const s=Array.from(v),a=await ws(s);p(r=>r&&r.map(l=>s.includes(l.id)?{...l,archived:!0,archivedAt:new Date().toISOString()}:l)),a.failedCount>0?i.warning(`Archived ${a.successCount} customers. ${a.failedCount} failed.`):i.success(`Successfully archived ${a.successCount} customer${a.successCount!==1?"s":""}`),u()}catch(s){i.error(s?.message||"Failed to archive customers")}finally{A(!1),E(!1)}},[v,u]),gs=n.useCallback(async()=>{A(!0);try{const s=Array.from(v),a=await Fs(s);p(r=>r&&r.map(l=>s.includes(l.id)?{...l,archived:!1,archivedAt:void 0}:l)),a.failedCount>0?i.warning(`Restored ${a.successCount} customers. ${a.failedCount} failed.`):i.success(`Successfully restored ${a.successCount} customer${a.successCount!==1?"s":""}`),u()}catch(s){i.error(s?.message||"Failed to restore customers")}finally{A(!1),E(!1)}},[v,u]),ps=n.useCallback(async()=>{A(!0);try{const s=Array.from(v),a=await ks(s);p(r=>r?.filter(l=>!s.includes(l.id))??[]),a.failedCount>0?i.warning(`Permanently deleted ${a.successCount} customers. ${a.failedCount} failed.`):i.success(`Permanently deleted ${a.successCount} customer${a.successCount!==1?"s":""}`),u()}catch(s){i.error(s?.message||"Failed to permanently delete customers")}finally{A(!1),E(!1)}},[v,u]),js=n.useCallback(async s=>{Ue(!0);try{const a=Array.from(v),r=await As(a,s);p(l=>l&&l.map(I=>a.includes(I.id)?{...I,status:s}:I)),r.failedCount>0?i.warning(`Updated ${r.successCount} customers. ${r.failedCount} failed.`):i.success(`Successfully updated ${r.successCount} customer${r.successCount!==1?"s":""}`),u()}catch(a){i.error(a?.message||"Failed to update customers")}finally{Ue(!1)}},[v,u]),Ke=n.useCallback(s=>{c({id:s.id,name:s.name,contact:s.contact,email:s.email,phone:s.phone,category:s.category,status:s.status,country:s.country||"",city:s.city||"",address:s.address||"",purchases:s.purchases||0,payments:s.payments||0}),P(s.id)},[]),fs=n.useMemo(()=>Ie.map(s=>s.name),[Ie]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Customers"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage customer profiles, contact details, and sales relationships"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(N,{className:"relative overflow-hidden",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(G,{className:"text-sm font-medium text-muted-foreground",children:"Total Customers"}),e.jsx(de,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g.totalCustomers}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[g.activeCustomers," active, ",g.inactiveCustomers," inactive"]})]})]}),e.jsxs(N,{className:"relative overflow-hidden",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(G,{className:"text-sm font-medium text-muted-foreground",children:"Active Customers"}),e.jsx(at,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:g.activeCustomers}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:g.totalCustomers>0?`${Math.round(g.activeCustomers/g.totalCustomers*100)}% of total`:"No customers yet"})]})]}),e.jsxs(N,{className:"relative overflow-hidden",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(G,{className:"text-sm font-medium text-muted-foreground",children:"Total Purchases"}),e.jsx(Ds,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["₱",g.totalPurchases.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:g.topCustomerByPurchases?`Top: ${g.topCustomerByPurchases.name}`:"No purchases yet"})]})]}),e.jsxs(N,{className:"relative overflow-hidden",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(G,{className:"text-sm font-medium text-muted-foreground",children:"Categories"}),e.jsx(Ps,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:g.uniqueCategories}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Outstanding balance: ₱",g.totalBalance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]}),e.jsxs("div",{className:"grid gap-3 grid-cols-1 sm:grid-cols-2",children:[e.jsx(N,{className:D("cursor-pointer transition-all hover:shadow-md border-l-4",b==="Active"?"ring-2 ring-primary":"","border-l-emerald-400"),onClick:()=>ee(b==="Active"?"all":"Active"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Active"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:g.activeCustomers})]}),e.jsx(L,{variant:"outline",className:se("Active"),children:T("Active")})]})})}),e.jsx(N,{className:D("cursor-pointer transition-all hover:shadow-md border-l-4",b==="Inactive"?"ring-2 ring-primary":"","border-l-slate-400"),onClick:()=>ee(b==="Inactive"?"all":"Inactive"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Inactive"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:g.inactiveCustomers})]}),e.jsx(L,{variant:"outline",className:se("Inactive"),children:T("Inactive")})]})})})]}),e.jsxs(N,{children:[e.jsx(H,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(G,{className:"text-xl",children:"Customer Management"}),e.jsx(Ts,{className:"mt-1",children:"Manage your customer relationships and contacts"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(me,{open:V,onOpenChange:s=>{q(s),s||c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0})},children:[e.jsx(Es,{asChild:!0,children:e.jsxs(x,{onClick:()=>c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0}),disabled:!y,title:y?void 0:"You don't have permission to add customers",children:[e.jsx(Gs,{className:"h-4 w-4 mr-2"}),"Add Customer"]})}),e.jsxs(ue,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(he,{children:[e.jsx(xe,{children:"Create New Customer"}),e.jsx(ge,{children:"Enter the details for the new customer."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"customer-name",children:"Customer Name *"}),e.jsx(m,{id:"customer-name",placeholder:"Enter customer name",value:t.name,onChange:s=>c({...t,name:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"customer-status",children:"Status"}),e.jsxs(Y,{value:t.status,onValueChange:s=>c({...t,status:s}),children:[e.jsx(_,{children:e.jsx(J,{placeholder:"Select status"})}),e.jsx(W,{children:fe.map(s=>e.jsx(R,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:T(s)}),s]})},s))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"contact-name",children:"Contact Person *"}),e.jsx(m,{id:"contact-name",placeholder:"Enter contact name",value:t.contact,onChange:s=>c({...t,contact:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"email",children:"Email *"}),e.jsx(m,{id:"email",type:"email",placeholder:"email@example.com",value:t.email,onChange:s=>c({...t,email:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"phone",children:"Phone *"}),e.jsx(m,{id:"phone",placeholder:"+1 (555) 000-0000",value:t.phone,onChange:s=>c({...t,phone:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"category",children:"Category *"}),e.jsxs(Y,{value:t.category,onValueChange:s=>c({...t,category:s}),children:[e.jsx(_,{children:e.jsx(J,{placeholder:"Select category"})}),e.jsx(W,{children:ye.map(s=>e.jsx(R,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Location Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"country",children:"Country"}),e.jsx(m,{id:"country",placeholder:"e.g., United States",value:t.country,onChange:s=>c({...t,country:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"city",children:"City"}),e.jsx(m,{id:"city",placeholder:"e.g., San Francisco",value:t.city,onChange:s=>c({...t,city:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2 mt-4",children:[e.jsx(o,{htmlFor:"address",children:"Address"}),e.jsx(m,{id:"address",placeholder:"Full street address",value:t.address,onChange:s=>c({...t,address:s.target.value})})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Financial Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"purchases",children:"Total Purchases (₱)"}),e.jsx(m,{id:"purchases",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.purchases,onChange:s=>c({...t,purchases:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"payments",children:"Total Payments (₱)"}),e.jsx(m,{id:"payments",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.payments,onChange:s=>c({...t,payments:parseFloat(s.target.value)||0})})]})]})]})]}),e.jsxs(pe,{children:[e.jsx(x,{variant:"outline",onClick:()=>q(!1),children:"Cancel"}),e.jsx(x,{onClick:async()=>{if(!t.name.trim()||!t.contact.trim()||!t.email.trim()||!t.phone.trim()||!t.category.trim()){i.error("Please fill all required fields");return}try{const s=await Is({name:t.name,contact:t.contact,email:t.email,phone:t.phone,category:t.category,status:t.status,country:t.country,city:t.city,address:t.address,purchases:t.purchases,payments:t.payments});p(a=>[s,...a??[]]),q(!1),i.success("Customer added successfully"),c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0})}catch(s){i.error(s?.message||"Failed to add customer")}},children:"Create Customer"})]})]})]})})]})}),e.jsxs(C,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Bs,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(m,{placeholder:"Search customers by name, contact, email...",value:$,onChange:s=>Fe(s.target.value),className:"pl-9"})]}),e.jsxs(Y,{value:b,onValueChange:ee,children:[e.jsxs(_,{className:"w-full sm:w-[180px]",children:[e.jsx(Ys,{className:"h-4 w-4 mr-2"}),e.jsx(J,{placeholder:"Filter by status"})]}),e.jsxs(W,{children:[e.jsx(R,{value:"all",children:"All Statuses"}),fe.map(s=>e.jsx(R,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:T(s)}),s]})},s))]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(x,{variant:U?"default":"outline",size:"sm",onClick:()=>ke(!U),className:"gap-1",children:[e.jsx(rt,{className:D("h-4 w-4",U&&"fill-current")}),"Favorites",Se("customers").length>0&&e.jsx(L,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:Se("customers").length})]}),e.jsxs(x,{variant:d?"default":"outline",size:"sm",onClick:()=>Ae(!d),className:d?"bg-orange-500 hover:bg-orange-600 text-white":"",children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),d?"Viewing Archived":"View Archived"]}),($||b!=="all"||U||d)&&e.jsxs(x,{variant:"ghost",size:"sm",onClick:Xe,className:"gap-1 text-muted-foreground hover:text-foreground",children:[e.jsx(Ls,{className:"h-4 w-4"}),"Clear All Filters"]})]})]}),ne&&y&&e.jsx(_s,{selectionCount:M,onClearSelection:u,isLoading:$e||us,actions:d?[{id:"restore",label:"Restore",icon:e.jsx(Ye,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:gs},...we?[{id:"permanent-delete",label:"Permanently Delete",icon:e.jsx(Ve,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>E(!0)}]:[]]:[{id:"archive",label:"Archive",icon:e.jsx(X,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:()=>E(!0)}],actionGroups:d?[]:[{id:"status-update",label:"Update Status",icon:e.jsx($s,{className:"h-4 w-4 mr-1"}),options:[{value:"Active",label:"Active"},{value:"Inactive",label:"Inactive"}],onSelect:s=>js(s)}],className:"mb-4"}),e.jsx(Zs,{open:hs,onOpenChange:E,itemCount:M,itemType:"customer",itemNames:fs,onConfirm:d?ps:xs,isLoading:$e,title:d?"Permanently Delete Customers":"Archive Customers",description:d?`Are you sure you want to permanently delete ${M} customer${M!==1?"s":""}? This action cannot be undone.`:`Are you sure you want to archive ${M} customer${M!==1?"s":""}? Archived customers can be restored later.`,confirmLabel:d?"Permanently Delete":"Archive"}),We?e.jsx(Js,{rows:8}):le.length===0?e.jsx(Ws,{icon:d?X:de,title:d?"No archived customers":"No customers found",description:d?"Archived customers will appear here":$?"Try adjusting your search criteria":"Get started by adding your first customer",actionLabel:!d&&!$?"Add Customer":void 0,onAction:!d&&!$?()=>q(!0):void 0}):e.jsxs("div",{className:"rounded-md border overflow-hidden",children:[e.jsx(Xs,{pageItemCount:Le,totalItemCount:Be,isAllPagesSelected:is,show:ns&&Be>Le,onSelectAllPages:ds,onClearSelection:u,itemLabel:"customers"}),e.jsxs(Rs,{children:[e.jsx(zs,{children:e.jsxs(qe,{children:[e.jsx(He,{className:"w-12",children:e.jsx(Re,{checked:ls,ref:s=>{s&&(s.indeterminate=cs)},onCheckedChange:ie,"aria-label":"Select all customers"})}),e.jsx(k,{sortKey:"id",currentSortKey:S.key,sortDirection:F("id"),onSort:s=>w(s),children:"Customer ID"}),e.jsx(k,{sortKey:"name",currentSortKey:S.key,sortDirection:F("name"),onSort:s=>w(s),children:"Customer Name"}),e.jsx(k,{sortKey:"contact",currentSortKey:S.key,sortDirection:F("contact"),onSort:s=>w(s),children:"Contact"}),e.jsx(k,{sortKey:"category",currentSortKey:S.key,sortDirection:F("category"),onSort:s=>w(s),children:"Category"}),e.jsx(k,{sortKey:"status",currentSortKey:S.key,sortDirection:F("status"),onSort:s=>w(s),children:"Status"}),e.jsx(k,{sortKey:"country",currentSortKey:S.key,sortDirection:F("country"),onSort:s=>w(s),children:"Location"}),e.jsx(k,{sortKey:"purchases",currentSortKey:S.key,sortDirection:F("purchases"),onSort:s=>w(s),children:"Purchases"}),e.jsx(k,{sortKey:"payments",currentSortKey:S.key,sortDirection:F("payments"),onSort:s=>w(s),children:"Payments"}),e.jsx(k,{sortKey:"balance",currentSortKey:S.key,sortDirection:F("balance"),onSort:s=>w(s),children:"Balance"}),e.jsx(He,{children:"Actions"})]})}),e.jsx(Vs,{children:Ee.map(s=>{const a=ms(s.id);return e.jsxs(qe,{className:D("hover:bg-muted/50 transition-colors",a&&"bg-muted/50"),children:[e.jsx(f,{children:e.jsx(Re,{checked:a,onCheckedChange:()=>os(s.id),"aria-label":`Select customer ${s.name}`})}),e.jsx(f,{className:"font-mono text-sm",children:s.id}),e.jsx(f,{children:e.jsx("button",{className:"text-left font-medium text-primary hover:underline cursor-pointer bg-transparent border-none p-0",onClick:()=>O(s.id),children:s.name})}),e.jsx(f,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(ze,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(je,{value:s.email,type:"text",onSave:r=>ce(s.id,"email",r),disabled:!y,className:"text-xs text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(_e,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(je,{value:s.phone,type:"text",onSave:r=>ce(s.id,"phone",r),disabled:!y,className:"text-xs text-muted-foreground"})]})]})}),e.jsx(f,{children:e.jsx(je,{value:s.category,type:"select",options:ye.map(r=>({value:r,label:r})),onSave:r=>ce(s.id,"category",r),disabled:!y})}),e.jsx(f,{children:e.jsxs(L,{variant:"outline",className:D("gap-1",se(s.status)),children:[e.jsx("span",{children:T(s.status)}),s.status]})}),e.jsx(f,{children:e.jsx("div",{className:"text-sm",children:s.city&&s.country?e.jsxs("span",{children:[s.city,", ",s.country]}):s.city||s.country?e.jsx("span",{children:s.city||s.country}):e.jsx("span",{className:"text-muted-foreground",children:"—"})})}),e.jsxs(f,{className:"text-right font-medium",children:["₱",s.purchases.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(f,{className:"text-right font-medium",children:["₱",s.payments.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(f,{className:D("text-right font-medium",s.balance>0?"text-amber-600":s.balance<0?"text-emerald-600":""),children:["₱",s.balance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ge,{entityType:"customers",entityId:s.id,entityName:s.name}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>O(s.id),children:e.jsx(Us,{className:"h-4 w-4"})}),d?e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Ze(s.id),disabled:!y,title:"Restore customer",children:e.jsx(Ye,{className:"h-4 w-4"})}),we&&e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>es(s.id),title:"Permanently delete",children:e.jsx(Ve,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Ke(s),disabled:!y,title:"Edit customer",children:e.jsx(Je,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Qe(s.id),disabled:!y,title:"Archive customer",children:e.jsx(X,{className:"h-4 w-4"})})]})]})})]},s.id)})})]})]}),le.length>0&&e.jsx(Qs,{currentPage:Te,totalPages:ss,totalItems:as,itemsPerPage:rs,onPageChange:ts,className:"mt-4"})]})]}),K&&e.jsx(me,{open:!!K,onOpenChange:s=>{s||P(null)},children:e.jsxs(ue,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(he,{children:[e.jsx(xe,{children:"Edit Customer"}),e.jsx(ge,{children:"Update the customer details."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-customer-name",children:"Customer Name *"}),e.jsx(m,{id:"edit-customer-name",placeholder:"Enter customer name",value:t.name,onChange:s=>c({...t,name:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-customer-status",children:"Status"}),e.jsxs(Y,{value:t.status,onValueChange:s=>c({...t,status:s}),children:[e.jsx(_,{children:e.jsx(J,{placeholder:"Select status"})}),e.jsx(W,{children:fe.map(s=>e.jsx(R,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:T(s)}),s]})},s))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-contact-name",children:"Contact Person *"}),e.jsx(m,{id:"edit-contact-name",placeholder:"Enter contact name",value:t.contact,onChange:s=>c({...t,contact:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-email",children:"Email *"}),e.jsx(m,{id:"edit-email",type:"email",placeholder:"email@example.com",value:t.email,onChange:s=>c({...t,email:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-phone",children:"Phone *"}),e.jsx(m,{id:"edit-phone",placeholder:"+1 (555) 000-0000",value:t.phone,onChange:s=>c({...t,phone:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-category",children:"Category *"}),e.jsxs(Y,{value:t.category,onValueChange:s=>c({...t,category:s}),children:[e.jsx(_,{children:e.jsx(J,{placeholder:"Select category"})}),e.jsx(W,{children:ye.map(s=>e.jsx(R,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Location Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-country",children:"Country"}),e.jsx(m,{id:"edit-country",placeholder:"e.g., United States",value:t.country,onChange:s=>c({...t,country:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-city",children:"City"}),e.jsx(m,{id:"edit-city",placeholder:"e.g., San Francisco",value:t.city,onChange:s=>c({...t,city:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2 mt-4",children:[e.jsx(o,{htmlFor:"edit-address",children:"Address"}),e.jsx(m,{id:"edit-address",placeholder:"Full street address",value:t.address,onChange:s=>c({...t,address:s.target.value})})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Financial Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-purchases",children:"Total Purchases (₱)"}),e.jsx(m,{id:"edit-purchases",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.purchases,onChange:s=>c({...t,purchases:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-payments",children:"Total Payments (₱)"}),e.jsx(m,{id:"edit-payments",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.payments,onChange:s=>c({...t,payments:parseFloat(s.target.value)||0})})]})]})]})]}),e.jsxs(pe,{children:[e.jsx(x,{variant:"outline",onClick:()=>P(null),children:"Cancel"}),e.jsx(x,{onClick:async()=>{if(!t.name.trim()||!t.contact.trim()||!t.email.trim()||!t.phone.trim()||!t.category.trim()){i.error("Please fill all required fields");return}try{const s=await Me({id:K,name:t.name,contact:t.contact,email:t.email,phone:t.phone,category:t.category,status:t.status,country:t.country,city:t.city,address:t.address,purchases:t.purchases,payments:t.payments});p(a=>(a??[]).map(r=>r.id===K?s:r)),P(null),i.success("Customer updated successfully")}catch(s){i.error(s?.message||"Failed to update customer")}},children:"Save Changes"})]})]})}),ae&&(()=>{const s=j.find(a=>a.id===ae);return s?e.jsx(me,{open:!!ae,onOpenChange:a=>{a||O(null)},children:e.jsxs(ue,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsx(he,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(xe,{className:"text-xl",children:s.name}),e.jsxs(ge,{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"font-mono",children:s.id}),e.jsxs(L,{variant:"outline",className:D("gap-1",se(s.status)),children:[e.jsx("span",{children:T(s.status)}),s.status]}),s.archived&&e.jsxs(L,{variant:"outline",className:"bg-orange-500/15 text-orange-700 dark:text-orange-400 border-orange-200",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"Archived"]})]})]}),e.jsx(Ge,{entityType:"customers",entityId:s.id,entityName:s.name})]})}),e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Contact Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Contact Person"}),e.jsx("p",{className:"font-medium",children:s.contact})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Category"}),e.jsx(L,{variant:"secondary",children:s.category})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(ze,{className:"h-3 w-3 text-muted-foreground"}),s.email]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Phone"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(_e,{className:"h-3 w-3 text-muted-foreground"}),s.phone]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(lt,{className:"h-4 w-4"}),"Location"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"City / Country"}),e.jsx("p",{className:"font-medium",children:s.city&&s.country?`${s.city}, ${s.country}`:s.city||s.country||"—"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Address"}),e.jsx("p",{className:"font-medium",children:s.address||"—"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(nt,{className:"h-4 w-4"}),"Financial Summary"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(N,{children:e.jsxs(C,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Purchases"}),e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:["₱",s.purchases.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})}),e.jsx(N,{children:e.jsxs(C,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Payments"}),e.jsxs("p",{className:"text-lg font-bold text-emerald-600",children:["₱",s.payments.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})}),e.jsx(N,{children:e.jsxs(C,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Balance"}),e.jsxs("p",{className:D("text-lg font-bold",s.balance>0?"text-amber-600":s.balance<0?"text-emerald-600":""),children:["₱",s.balance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})})]})]})]}),e.jsxs(pe,{children:[e.jsx(x,{variant:"outline",onClick:()=>O(null),children:"Close"}),!s.archived&&y&&e.jsxs(x,{onClick:()=>{O(null),Ke(s)},children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Edit Customer"]})]})]})}):null})()]})}export{bt as CustomersView};
