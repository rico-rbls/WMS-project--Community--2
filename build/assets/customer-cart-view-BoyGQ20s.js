import{i as Z,c6 as _,aM as G,r as i,aN as J,j as e,C as h,q as p,o as O,aR as X,p as D,B as r,aS as V,s as ee,w as g,_ as se,aK as c,P as q,aL as z,L as F,x as j,bk as te,aZ as ae}from"./index-Dd4T-HZH.js";import{C as re}from"./circle-check-Lnoy0EfQ.js";import{P as ie}from"./printer-CnrWvTbr.js";import{H as le}from"./hash-B8lu59FS.js";import{C as ne}from"./calendar-vZQ1q_ty.js";import{M}from"./map-pin-DamO76va.js";import{B as y}from"./banknote-CAF23-VJ.js";import{A as B}from"./arrow-left-BueXqf_O.js";import{S as T}from"./shopping-bag-BjDhRlaI.js";import{I as de}from"./image-CUGLe68K.js";import{M as L}from"./minus-CQbbzIqP.js";import{P as R}from"./plus-D2NFl2oS.js";import{T as H}from"./trash-2-D9R5o6DI.js";function a(l){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(l)}function Ce({navigateToView:l}){const{user:n}=Z(),{cart:m,updateQuantity:f,removeFromCart:b,clearCart:U,cartTotal:u,itemCount:w}=_(),{sendNotification:E}=G(),[C,Y]=i.useState(""),[N,$]=i.useState(""),[ce,me]=i.useState(""),[P,k]=i.useState(!1),[t,S]=i.useState(null),[I,A]=i.useState([]);i.useEffect(()=>{J().then(A).catch(()=>{})},[]);const o=i.useMemo(()=>n?.email?I.find(s=>s.email===n.email):null,[n?.email,I]),K=async()=>{if(m.length===0){j.error("Your cart is empty");return}if(!n?.email){j.error("Please log in to place an order.");return}k(!0);try{let s=o;if(!s){const d=n.displayName||n.email.split("@")[0];s=await te({name:d,email:n.email,phone:"",address:N||"",city:"",country:"Philippines",status:"Active"}),A(W=>[...W,s]),j.info("Customer profile created automatically.")}const x=m.map(d=>({inventoryItemId:d.inventoryItemId,itemName:d.itemName,quantity:d.quantity,unitPrice:d.unitPrice,totalPrice:d.totalPrice})),v=await ae({customerId:s.id,customerName:s.name,customerCountry:s.country,customerCity:s.city,deliveryAddress:N||s.address||void 0,soDate:new Date().toISOString().split("T")[0],items:x,totalAmount:u,receiptStatus:"Unpaid",notes:C||void 0,amountPaid:0});S(v),U(),await E({title:"New Customer Order",message:`${s.name} placed an order for ${a(u)}`,type:"info",recipientRoles:["Admin","Owner"]}),j.success("Order placed successfully!")}catch(s){console.error("Order error:",s),j.error("Failed to place order. Please try again.")}finally{k(!1)}},Q=()=>{window.print()};if(t){const s=new Date(t.soDate);return e.jsxs("div",{className:"max-w-2xl mx-auto py-4 sm:py-8 px-2 sm:px-0",children:[e.jsx(h,{className:"border-green-200 bg-green-50/50 dark:bg-green-950/20 mb-6",children:e.jsxs(p,{className:"pt-6 pb-4 text-center",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx("div",{className:"rounded-full bg-green-100 dark:bg-green-900/50 p-3",children:e.jsx(re,{className:"h-10 w-10 text-green-600"})})}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-1",children:"Order Placed Successfully!"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Thank you for your order. We'll process it shortly."})]})}),e.jsxs(h,{className:"print:shadow-none print:border-none",id:"order-receipt",children:[e.jsx(O,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-primary"}),e.jsx(D,{className:"text-lg",children:"Order Receipt"})]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:Q,className:"print:hidden gap-1",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Print"})]})]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Order ID"}),e.jsx("p",{className:"font-mono font-medium text-xs sm:text-sm",children:t.id})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Date & Time"}),e.jsxs("p",{className:"font-medium text-xs sm:text-sm",children:[s.toLocaleDateString()," ",s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Customer"}),e.jsx("p",{className:"font-medium text-xs sm:text-sm",children:t.customerName})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Shipping Status"}),e.jsxs(g,{variant:"outline",className:"text-xs mt-0.5",children:[e.jsx(se,{className:"h-3 w-3 mr-1"}),t.shippingStatus||"Pending"]})]})]})]}),t.deliveryAddress&&e.jsxs("div",{className:"flex items-start gap-2 bg-muted/50 rounded-lg p-3",children:[e.jsx(M,{className:"h-4 w-4 text-muted-foreground mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Delivery Address"}),e.jsx("p",{className:"text-sm",children:t.deliveryAddress})]})]}),e.jsx(c,{}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Items Ordered (",t.items.length,")"]}),e.jsx("div",{className:"space-y-2 bg-muted/30 rounded-lg p-3",children:t.items.map((x,v)=>e.jsxs("div",{className:"flex justify-between items-start text-sm",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-2",children:[e.jsx("p",{className:"font-medium line-clamp-1",children:x.itemName}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a(x.unitPrice)," × ",x.quantity]})]}),e.jsx("p",{className:"font-medium shrink-0",children:a(x.totalPrice)})]},v))})]}),e.jsx(c,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsx("span",{children:a(t.totalAmount)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipping"}),e.jsx("span",{className:"text-green-600",children:"Free"})]}),e.jsx(c,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-primary",children:a(t.totalAmount)})]})]}),e.jsx(c,{}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(y,{className:"h-4 w-4 text-amber-600"}),e.jsx("span",{className:"font-medium text-sm",children:"Payment Method"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(g,{variant:"secondary",className:"gap-1",children:[e.jsx(y,{className:"h-3 w-3"}),"Cash on Delivery"]}),e.jsx(g,{variant:t.receiptStatus==="Paid"?"default":"outline",className:t.receiptStatus==="Paid"?"bg-green-600":"text-amber-600 border-amber-300",children:t.receiptStatus==="Paid"?"Paid":"Unpaid - Pay on Delivery"})]}),t.amountPaid>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Amount paid: ",a(t.amountPaid)," • Balance due: ",a(t.totalAmount-t.amountPaid)]})]}),t.notes&&e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Order Notes:"}),e.jsx("p",{className:"italic",children:t.notes})]})]}),e.jsxs(z,{className:"flex flex-col sm:flex-row gap-3 print:hidden",children:[e.jsx(r,{variant:"outline",onClick:()=>l("sales-orders"),className:"w-full sm:w-auto",children:"View My Orders"}),e.jsx(r,{onClick:()=>{S(null),l("products")},className:"w-full sm:w-auto",children:"Continue Shopping"})]})]})]})}return m.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>l("products"),children:e.jsx(B,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Shopping Cart"}),e.jsx("p",{className:"text-muted-foreground",children:"Your cart is empty"})]})]}),e.jsx(h,{children:e.jsx(p,{className:"py-12",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx(T,{className:"h-16 w-16 text-muted-foreground/50 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Your cart is empty"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Looks like you haven't added any items to your cart yet."}),e.jsxs(r,{onClick:()=>l("products"),children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Browse Products"]})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx(r,{variant:"ghost",size:"icon",onClick:()=>l("products"),children:e.jsx(B,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"Shopping Cart"}),e.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground",children:[w," item(s) in your cart"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:m.map(s=>e.jsx(h,{children:e.jsx(p,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-16 h-16 sm:w-24 sm:h-24 bg-muted rounded-lg flex items-center justify-center overflow-hidden shrink-0",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.itemName,className:"w-full h-full object-cover"}):e.jsx(de,{className:"h-6 w-6 sm:h-8 sm:w-8 text-muted-foreground/50"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm sm:text-base line-clamp-2",children:s.itemName}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:s.brand}),e.jsx("p",{className:"text-primary font-medium mt-1 text-sm sm:text-base",children:a(s.unitPrice)}),e.jsxs("div",{className:"flex items-center justify-between mt-2 sm:hidden",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-accent rounded-lg p-0.5",children:[e.jsx(r,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>f(s.inventoryItemId,s.quantity-1),children:e.jsx(L,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-6 text-center font-semibold text-sm",children:s.quantity}),e.jsx(r,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>f(s.inventoryItemId,s.quantity+1),disabled:s.quantity>=s.availableStock,children:e.jsx(R,{className:"h-3 w-3"})})]}),e.jsx("p",{className:"font-semibold text-sm",children:a(s.totalPrice)})]})]}),e.jsxs("div",{className:"hidden sm:flex flex-col items-end gap-2",children:[e.jsx(r,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>b(s.inventoryItemId),children:e.jsx(H,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2 bg-accent rounded-lg p-1",children:[e.jsx(r,{size:"icon",variant:"ghost",className:"h-7 w-7",onClick:()=>f(s.inventoryItemId,s.quantity-1),children:e.jsx(L,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-8 text-center font-semibold",children:s.quantity}),e.jsx(r,{size:"icon",variant:"ghost",className:"h-7 w-7",onClick:()=>f(s.inventoryItemId,s.quantity+1),disabled:s.quantity>=s.availableStock,children:e.jsx(R,{className:"h-3 w-3"})})]}),e.jsx("p",{className:"font-semibold",children:a(s.totalPrice)})]}),e.jsx(r,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive shrink-0 sm:hidden",onClick:()=>b(s.inventoryItemId),children:e.jsx(H,{className:"h-4 w-4"})})]})})},s.inventoryItemId))}),e.jsx("div",{children:e.jsxs(h,{className:"sticky top-6",children:[e.jsx(O,{children:e.jsx(D,{children:"Order Summary"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:m.map(s=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground truncate mr-2",children:[s.itemName," × ",s.quantity]}),e.jsx("span",{children:a(s.totalPrice)})]},s.inventoryItemId))}),e.jsx(c,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Subtotal (",w," items)"]}),e.jsx("span",{children:a(u)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipping"}),e.jsx("span",{className:"text-green-600",children:"Free"})]}),e.jsx(c,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-primary",children:a(u)})]})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4 text-amber-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Payment Method"})]}),e.jsxs(g,{variant:"secondary",className:"gap-1",children:[e.jsx(y,{className:"h-3 w-3"}),"Cash on Delivery"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Pay when your order arrives at your doorstep"})]}),e.jsx(c,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs(F,{htmlFor:"deliveryAddress",className:"flex items-center gap-1",children:[e.jsx(M,{className:"h-3 w-3"}),"Delivery Address"]}),e.jsx("textarea",{id:"deliveryAddress",placeholder:o?.address||"Enter your delivery address...",value:N,onChange:s=>$(s.target.value),className:"mt-1.5 flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"}),o?.address&&!N&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Default: ",o.address,", ",o.city,", ",o.country]})]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"notes",children:"Order Notes (Optional)"}),e.jsx("textarea",{id:"notes",placeholder:"Any special instructions...",value:C,onChange:s=>Y(s.target.value),className:"mt-1.5 flex min-h-[60px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"})]})]})]}),e.jsx(z,{children:e.jsx(r,{className:"w-full",size:"lg",onClick:K,disabled:P||m.length===0,children:P?"Placing Order...":e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Place Order - ",a(u)]})})})]})})]})]})}export{Ce as CustomerCartView};
