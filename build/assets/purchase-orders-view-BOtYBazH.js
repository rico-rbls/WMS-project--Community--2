import{q as ne,V as is,r as l,j as e,B as d,L as o,I as m,W as ns,X as fe,P as Ce,f as cs,Y as ls,Z as ds,t as c,_ as os,p as us,$ as ms,a0 as ps,a1 as hs,a2 as xs,a3 as vs,a4 as js,a5 as ys,a6 as gs,a7 as Ns}from"./index-DwxTSYun.js";import{u as fs,k as Cs,j as Ds,o as Ps,D as K,l as ws,P as ee,a as se,b as ae,c as te,d as re,S as E,e as T,f as _,g as q,h as I,T as ie,m as bs,B as Is,E as Ss,p as ks,q as Os,r as De,s as j,t as As,v as y,w as Rs,n as Fs,C as Es,x as Ts}from"./bulk-delete-dialog-BxTWO0Hw.js";import{F as _s}from"./funnel-ChOvE1Oi.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],$s=ne("download",qs);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Bs=ne("send",Ls);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]],Pe=ne("shopping-bag",Vs),Us={admin:["inventory:read","inventory:create","inventory:update","inventory:delete","orders:read","orders:create","orders:update","orders:delete","shipments:read","shipments:create","shipments:update","shipments:delete","suppliers:read","suppliers:create","suppliers:update","suppliers:delete","purchase_orders:read","purchase_orders:create","purchase_orders:update","purchase_orders:delete","purchase_orders:approve","purchase_orders:receive"],manager:["inventory:read","inventory:create","inventory:update","orders:read","orders:create","orders:update","shipments:read","shipments:create","shipments:update","suppliers:read","suppliers:create","suppliers:update","purchase_orders:read","purchase_orders:create","purchase_orders:update","purchase_orders:approve","purchase_orders:receive"],warehouse_worker:["inventory:read","inventory:update","orders:read","shipments:read","shipments:update","suppliers:read","purchase_orders:read","purchase_orders:receive"],user:["inventory:read","orders:read","shipments:read","suppliers:read","purchase_orders:read"]};function Q(g,$){return Us[g]?.includes($)??!1}const Ms={1:"admin",2:"user",3:"manager",4:"warehouse_worker"};function zs(g){return Ms[g]??"user"}const Qs=["Draft","Pending Approval","Approved","Rejected","Ordered","Partially Received","Received","Cancelled"];function Xs({initialOpenDialog:g,onDialogOpened:$,prefilledItem:v}){const{user:S}=is(),L=S?zs(S.id):"user",H=Q(L,"purchase_orders:create"),we=Q(L,"purchase_orders:approve"),be=Q(L,"purchase_orders:receive"),B=Q(L,"purchase_orders:delete"),[Z,Ie]=l.useState(""),[k,Se]=l.useState("all"),[ce,h]=l.useState(null),[O,ke]=l.useState([]),[W,Oe]=l.useState([]),[Ae,Re]=l.useState(!0),[X,N]=l.useState(!1),[f,A]=l.useState(null),[R,V]=l.useState(null),[C,Fe]=l.useState(null),[U,le]=l.useState("asc"),[n,x]=l.useState({supplierId:"",supplierName:"",items:[],expectedDeliveryDate:"",notes:""}),[de,oe]=l.useState({}),[ue,me]=l.useState(void 0),[Ee,Y]=l.useState(!1),G=fs(Z,300),F=l.useMemo(()=>ce??[],[ce]),{selectedIds:pe,toggleItem:Te,toggleAll:_e,isSelected:qe,isAllSelected:$e,isPartiallySelected:Le,selectionCount:he,hasSelection:Be,deselectAll:xe}=Cs(F);l.useEffect(()=>{async function s(){try{const[a,t,r]=await Promise.all([cs(),ls(),ds()]);h(a),ke(t.filter(i=>i.status==="Active")),Oe(r)}catch{c.error("Failed to load data")}finally{Re(!1)}}s()},[]),l.useEffect(()=>{v&&O.length>0&&(x({supplierId:v.supplierId,supplierName:v.supplierName,items:[{inventoryItemId:v.inventoryItemId,itemName:v.itemName,quantity:v.quantity,unitPrice:v.unitPrice,totalPrice:v.quantity*v.unitPrice}],expectedDeliveryDate:new Date(Date.now()+10080*60*1e3).toISOString().split("T")[0],notes:""}),N(!0))},[v,O]),l.useEffect(()=>{g&&!X&&(N(!0),$?.())},[g,$,X]);const J=l.useMemo(()=>{let s=F;if(G){const a=G.toLowerCase();s=s.filter(t=>t.id.toLowerCase().includes(a)||t.supplierName.toLowerCase().includes(a)||(t.items??[]).some(r=>r.itemName.toLowerCase().includes(a)))}return k!=="all"&&(s=s.filter(a=>a.status===k)),C&&(s=[...s].sort((a,t)=>{const r=a[C],i=t[C];return r==null?1:i==null?-1:typeof r=="string"&&typeof i=="string"?U==="asc"?r.localeCompare(i):i.localeCompare(r):typeof r=="number"&&typeof i=="number"?U==="asc"?r-i:i-r:0})),s},[F,G,k,C,U]),{paginatedData:M,currentPage:Ve,totalPages:Ue,goToPage:Me,itemsPerPage:ze,totalItems:Qe}=Ds(J,10),D=s=>{C===s?le(a=>a==="asc"?"desc":"asc"):(Fe(s),le("asc"))},P=({column:s})=>C!==s?null:U==="asc"?e.jsx(Es,{className:"h-4 w-4"}):e.jsx(Ts,{className:"h-4 w-4"}),ve=s=>{const a={Draft:{variant:"secondary"},"Pending Approval":{variant:"outline",className:"border-yellow-500 text-yellow-600"},Approved:{variant:"outline",className:"border-blue-500 text-blue-600"},Rejected:{variant:"destructive"},Ordered:{variant:"outline",className:"border-purple-500 text-purple-600"},"Partially Received":{variant:"outline",className:"border-orange-500 text-orange-600"},Received:{variant:"default",className:"bg-green-500"},Cancelled:{variant:"secondary",className:"text-gray-500"}},{variant:t,className:r}=a[s];return e.jsx(us,{variant:t,className:r,children:s})},w=()=>{x({supplierId:"",supplierName:"",items:[],expectedDeliveryDate:"",notes:""})},je=()=>{x(s=>({...s,items:[...s.items,{inventoryItemId:"",itemName:"",quantity:1,unitPrice:0,totalPrice:0}]}))},ye=s=>{x(a=>({...a,items:a.items.filter((t,r)=>r!==s)}))},b=(s,a,t)=>{x(r=>{const i=[...r.items];if(a==="inventoryItemId"){const u=W.find(p=>p.id===t);u&&(i[s]={...i[s],inventoryItemId:u.id,itemName:u.name,unitPrice:u.pricePerPiece,totalPrice:i[s].quantity*u.pricePerPiece})}else if(a==="quantity"){const u=Number(t)||0;i[s]={...i[s],quantity:u,totalPrice:u*i[s].unitPrice}}else if(a==="unitPrice"){const u=Number(t)||0;i[s]={...i[s],unitPrice:u,totalPrice:i[s].quantity*u}}return{...r,items:i}})},ge=s=>{const a=O.find(t=>t.id===s);x(t=>({...t,supplierId:s,supplierName:a?.name??""}))},He=async()=>{if(!n.supplierId||n.items.length===0||!n.expectedDeliveryDate){c.error("Please fill in all required fields");return}try{const s=await os({supplierId:n.supplierId,supplierName:n.supplierName,items:n.items,expectedDeliveryDate:n.expectedDeliveryDate,notes:n.notes,createdBy:S?.id??"1"});h(a=>[s,...a??[]]),c.success(`Purchase Order ${s.id} created successfully`),N(!1),w()}catch(s){c.error(s instanceof Error?s.message:"Failed to create purchase order")}},Ze=async s=>{if(!n.supplierId||n.items.length===0||!n.expectedDeliveryDate){c.error("Please fill in all required fields");return}try{const a=await ys({id:s,supplierId:n.supplierId,supplierName:n.supplierName,items:n.items,expectedDeliveryDate:n.expectedDeliveryDate,notes:n.notes});h(t=>t?.map(r=>r.id===s?a:r)??[]),c.success(`Purchase Order ${s} updated successfully`),A(null),w()}catch(a){c.error(a instanceof Error?a.message:"Failed to update purchase order")}},We=async s=>{try{await js(s),h(a=>a?.filter(t=>t.id!==s)??[]),c.success(`Purchase Order ${s} deleted`),A(null)}catch(a){c.error(a instanceof Error?a.message:"Failed to delete purchase order")}},Xe=async s=>{try{const a=await ms(s);h(t=>t?.map(r=>r.id===s?a:r)??[]),c.success(`Purchase Order ${s} submitted for approval`)}catch(a){c.error(a instanceof Error?a.message:"Failed to submit for approval")}},Ye=async s=>{try{const a=await ps(s,S?.id??"1");h(t=>t?.map(r=>r.id===s?a:r)??[]),c.success(`Purchase Order ${s} approved`)}catch(a){c.error(a instanceof Error?a.message:"Failed to approve")}},Ge=async s=>{try{const a=await hs(s,S?.id??"1");h(t=>t?.map(r=>r.id===s?a:r)??[]),c.success(`Purchase Order ${s} rejected`)}catch(a){c.error(a instanceof Error?a.message:"Failed to reject")}},Je=async s=>{try{const a=await xs(s);h(t=>t?.map(r=>r.id===s?a:r)??[]),c.success(`Purchase Order ${s} marked as ordered`)}catch(a){c.error(a instanceof Error?a.message:"Failed to mark as ordered")}},Ke=async s=>{try{const a=await vs(s);h(t=>t?.map(r=>r.id===s?a:r)??[]),c.success(`Purchase Order ${s} cancelled`)}catch(a){c.error(a instanceof Error?a.message:"Failed to cancel")}},es=s=>{const a={};(s.items??[]).forEach(t=>{const r=t.quantity-(t.quantityReceived??0);a[t.inventoryItemId]=r}),oe(a),me(s.totalAmount),V(s.id)},ss=async s=>{try{const a=Object.entries(de).filter(([r,i])=>i>0).map(([r,i])=>({inventoryItemId:r,quantityReceived:i}));if(a.length===0){c.error("Please enter quantities to receive");return}const t=await gs(s,a,ue);if(h(r=>r?.map(i=>i.id===s?t.purchaseOrder:i)??[]),t.inventoryUpdates.length>0){const r=t.inventoryUpdates.map(i=>`${i.itemName}: ${i.previousQty} → ${i.newQty}`).join(", ");c.success(`Items received. Inventory updated: ${r}`)}else c.success("Items received successfully");V(null)}catch(a){c.error(a instanceof Error?a.message:"Failed to receive items")}},as=async()=>{try{const s=await Ns(Array.from(pe));s.success?c.success(`${s.successCount} purchase orders deleted`):c.warning(`${s.successCount} deleted, ${s.failedCount} failed: ${s.errors.join(", ")}`),h(a=>a?.filter(t=>!pe.has(t.id))??[]),xe(),Y(!1)}catch{c.error("Failed to delete purchase orders")}},ts=s=>{x({supplierId:s.supplierId,supplierName:s.supplierName,items:(s.items??[]).map(a=>({inventoryItemId:a.inventoryItemId,itemName:a.itemName,quantity:a.quantity,unitPrice:a.unitPrice,totalPrice:a.totalPrice})),expectedDeliveryDate:s.expectedDeliveryDate,notes:s.notes}),A(s.id)},rs=()=>{const s=["PO ID","Supplier","Items","Total Amount","Status","Created Date","Expected Delivery","Notes"],a=J.map(p=>[p.id,p.supplierName,(p.items??[]).map(z=>`${z.itemName} (${z.quantity})`).join("; "),(p.totalAmount??0).toFixed(2),p.status,p.createdDate,p.expectedDeliveryDate,p.notes]),t=[s,...a].map(p=>p.map(z=>`"${z}"`).join(",")).join(`
`),r=new Blob([t],{type:"text/csv"}),i=URL.createObjectURL(r),u=document.createElement("a");u.href=i,u.download=`purchase-orders-${new Date().toISOString().split("T")[0]}.csv`,u.click(),URL.revokeObjectURL(i),c.success("Purchase orders exported to CSV")},Ne=l.useMemo(()=>n.items.reduce((s,a)=>s+a.totalPrice,0),[n.items]);return Ae?e.jsx("div",{className:"p-6",children:e.jsx(Ps,{rows:8})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Purchase Orders"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage purchase orders and supplier orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{variant:"outline",onClick:rs,children:[e.jsx($s,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),H&&e.jsxs(K,{open:X,onOpenChange:s=>{N(s),s||w()},children:[e.jsx(ws,{asChild:!0,children:e.jsxs(d,{children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Create PO"]})}),e.jsxs(se,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ae,{children:[e.jsx(te,{children:"Create Purchase Order"}),e.jsx(re,{children:"Create a new purchase order for supplier items"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Supplier *"}),e.jsxs(E,{value:n.supplierId,onValueChange:ge,children:[e.jsx(T,{children:e.jsx(_,{placeholder:"Select supplier"})}),e.jsx(q,{children:O.map(s=>e.jsx(I,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Expected Delivery Date *"}),e.jsx(m,{type:"date",value:n.expectedDeliveryDate,onChange:s=>x(a=>({...a,expectedDeliveryDate:s.target.value}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{children:"Line Items *"}),e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:je,children:[e.jsx(ee,{className:"h-4 w-4 mr-1"})," Add Item"]})]}),n.items.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:'No items added. Click "Add Item" to add items.'}):e.jsxs("div",{className:"space-y-2",children:[n.items.map((s,a)=>e.jsxs("div",{className:"flex gap-2 items-end p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Item"}),e.jsxs(E,{value:s.inventoryItemId,onValueChange:t=>b(a,"inventoryItemId",t),children:[e.jsx(T,{children:e.jsx(_,{placeholder:"Select item"})}),e.jsx(q,{children:W.map(t=>e.jsxs(I,{value:t.id,children:[t.name," (",t.id,")"]},t.id))})]})]}),e.jsxs("div",{className:"w-24 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Quantity"}),e.jsx(m,{type:"number",min:"1",value:s.quantity,onChange:t=>b(a,"quantity",t.target.value)})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Unit Price"}),e.jsx(m,{type:"number",min:"0",step:"0.01",value:s.unitPrice,onChange:t=>b(a,"unitPrice",t.target.value)})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Total"}),e.jsx(m,{value:`₱${s.totalPrice.toFixed(2)}`,disabled:!0})]}),e.jsx(d,{type:"button",variant:"ghost",size:"icon",onClick:()=>ye(a),children:e.jsx(ie,{className:"h-4 w-4 text-destructive"})})]},a)),e.jsxs("div",{className:"text-right font-semibold",children:["Total: ₱",Ne.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Notes"}),e.jsx(m,{value:n.notes,onChange:s=>x(a=>({...a,notes:s.target.value})),placeholder:"Optional notes..."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>{N(!1),w()},children:"Cancel"}),e.jsx(d,{onClick:He,children:"Create Purchase Order"})]})]})]})]})]})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(bs,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Search PO ID, supplier, or items...",value:Z,onChange:s=>Ie(s.target.value),className:"pl-10"})]}),e.jsxs(E,{value:k,onValueChange:Se,children:[e.jsxs(T,{className:"w-48",children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),e.jsx(_,{placeholder:"Filter by status"})]}),e.jsxs(q,{children:[e.jsx(I,{value:"all",children:"All Statuses"}),Qs.map(s=>e.jsx(I,{value:s,children:s},s))]})]})]}),Be&&B&&e.jsx(Is,{selectionCount:he,onClearSelection:xe,actions:[{label:"Delete Selected",onClick:()=>Y(!0),variant:"destructive"}]}),J.length===0?e.jsx(Ss,{icon:Pe,title:"No purchase orders found",description:Z||k!=="all"?"Try adjusting your search or filters":"Create your first purchase order to get started",actionLabel:H?"Create PO":void 0,onAction:H?()=>N(!0):void 0}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-lg",children:e.jsxs(ks,{children:[e.jsx(Os,{children:e.jsxs(De,{children:[B&&e.jsx(j,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:$e(M.map(s=>s.id)),ref:s=>{s&&(s.indeterminate=Le(M.map(a=>a.id)))},onChange:()=>_e(M.map(s=>s.id)),className:"h-4 w-4"})}),e.jsx(j,{className:"cursor-pointer",onClick:()=>D("id"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["PO ID ",e.jsx(P,{column:"id"})]})}),e.jsx(j,{className:"cursor-pointer",onClick:()=>D("supplierName"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Supplier ",e.jsx(P,{column:"supplierName"})]})}),e.jsx(j,{children:"Items"}),e.jsx(j,{className:"cursor-pointer text-right",onClick:()=>D("totalAmount"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:["Total ",e.jsx(P,{column:"totalAmount"})]})}),e.jsx(j,{className:"cursor-pointer",onClick:()=>D("status"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Status ",e.jsx(P,{column:"status"})]})}),e.jsx(j,{className:"cursor-pointer",onClick:()=>D("createdDate"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Created ",e.jsx(P,{column:"createdDate"})]})}),e.jsx(j,{className:"cursor-pointer",onClick:()=>D("expectedDeliveryDate"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Expected ",e.jsx(P,{column:"expectedDeliveryDate"})]})}),e.jsx(j,{children:"Actions"})]})}),e.jsx(As,{children:M.map(s=>e.jsxs(De,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>ts(s),children:[B&&e.jsx(y,{onClick:a=>a.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:qe(s.id),onChange:()=>Te(s.id),className:"h-4 w-4"})}),e.jsx(y,{className:"font-medium",children:s.id}),e.jsx(y,{children:s.supplierName}),e.jsx(y,{children:e.jsxs("span",{className:"text-sm",children:[(s.items??[]).length," item",(s.items??[]).length!==1?"s":""]})}),e.jsxs(y,{className:"text-right font-medium",children:["₱",(s.totalAmount??0).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(y,{children:ve(s.status)}),e.jsx(y,{children:s.createdDate}),e.jsx(y,{children:s.expectedDeliveryDate}),e.jsx(y,{onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"flex gap-1",children:[s.status==="Draft"&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Xe(s.id),title:"Submit for Approval",children:e.jsx(Bs,{className:"h-4 w-4"})}),s.status==="Pending Approval"&&we&&e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"sm",variant:"outline",className:"text-green-600",onClick:()=>Ye(s.id),title:"Approve",children:e.jsx(ns,{className:"h-4 w-4"})}),e.jsx(d,{size:"sm",variant:"outline",className:"text-red-600",onClick:()=>Ge(s.id),title:"Reject",children:e.jsx(fe,{className:"h-4 w-4"})})]}),s.status==="Approved"&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Je(s.id),title:"Mark as Ordered",children:e.jsx(Pe,{className:"h-4 w-4"})}),(s.status==="Ordered"||s.status==="Partially Received")&&be&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>es(s),title:"Receive Items",children:e.jsx(Ce,{className:"h-4 w-4"})}),!["Received","Cancelled"].includes(s.status)&&e.jsx(d,{size:"sm",variant:"ghost",className:"text-destructive",onClick:()=>Ke(s.id),title:"Cancel",children:e.jsx(fe,{className:"h-4 w-4"})})]})})]},s.id))})]})}),e.jsx(Rs,{currentPage:Ve,totalPages:Ue,itemsPerPage:ze,onPageChange:Me,totalItems:Qe})]}),f&&e.jsx(K,{open:!!f,onOpenChange:s=>{s||(A(null),w())},children:e.jsxs(se,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ae,{children:[e.jsxs(te,{children:["Edit Purchase Order - ",f]}),e.jsx(re,{children:"Update purchase order details"})]}),e.jsx("div",{className:"space-y-4 py-4",children:(()=>{const s=F.find(t=>t.id===f),a=s?.status==="Draft";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),s&&ve(s.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Supplier"}),e.jsxs(E,{value:n.supplierId,onValueChange:ge,disabled:!a,children:[e.jsx(T,{children:e.jsx(_,{placeholder:"Select supplier"})}),e.jsx(q,{children:O.map(t=>e.jsx(I,{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Expected Delivery Date"}),e.jsx(m,{type:"date",value:n.expectedDeliveryDate,onChange:t=>x(r=>({...r,expectedDeliveryDate:t.target.value})),disabled:!a})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{children:"Line Items"}),a&&e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:je,children:[e.jsx(ee,{className:"h-4 w-4 mr-1"})," Add Item"]})]}),e.jsxs("div",{className:"space-y-2",children:[n.items.map((t,r)=>e.jsxs("div",{className:"flex gap-2 items-end p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Item"}),e.jsxs(E,{value:t.inventoryItemId,onValueChange:i=>b(r,"inventoryItemId",i),disabled:!a,children:[e.jsx(T,{children:e.jsx(_,{placeholder:"Select item"})}),e.jsx(q,{children:W.map(i=>e.jsxs(I,{value:i.id,children:[i.name," (",i.id,")"]},i.id))})]})]}),e.jsxs("div",{className:"w-24 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Quantity"}),e.jsx(m,{type:"number",min:"1",value:t.quantity,onChange:i=>b(r,"quantity",i.target.value),disabled:!a})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Unit Price"}),e.jsx(m,{type:"number",min:"0",step:"0.01",value:t.unitPrice,onChange:i=>b(r,"unitPrice",i.target.value),disabled:!a})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Total"}),e.jsx(m,{value:`₱${t.totalPrice.toFixed(2)}`,disabled:!0})]}),a&&e.jsx(d,{type:"button",variant:"ghost",size:"icon",onClick:()=>ye(r),children:e.jsx(ie,{className:"h-4 w-4 text-destructive"})})]},r)),e.jsxs("div",{className:"text-right font-semibold",children:["Total: ₱",Ne.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Notes"}),e.jsx(m,{value:n.notes,onChange:t=>x(r=>({...r,notes:t.target.value})),placeholder:"Optional notes...",disabled:!a})]}),e.jsxs("div",{className:"flex justify-between",children:[B&&["Draft","Cancelled","Rejected"].includes(s?.status??"")&&e.jsxs(d,{variant:"destructive",onClick:()=>We(f),children:[e.jsx(ie,{className:"h-4 w-4 mr-2"})," Delete"]}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsx(d,{variant:"outline",onClick:()=>{A(null),w()},children:"Close"}),a&&e.jsx(d,{onClick:()=>Ze(f),children:"Save Changes"})]})]})]})})()})]})}),R&&e.jsx(K,{open:!!R,onOpenChange:s=>{s||V(null)},children:e.jsxs(se,{className:"max-w-2xl",children:[e.jsxs(ae,{children:[e.jsxs(te,{children:["Receive Items - ",R]}),e.jsx(re,{children:"Enter quantities received for each item"})]}),e.jsx("div",{className:"space-y-4 py-4",children:(()=>{const s=F.find(a=>a.id===R);return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:(s.items??[]).map(a=>{const t=a.quantity-(a.quantityReceived??0);return e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:a.itemName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Ordered: ",a.quantity," | Received: ",a.quantityReceived??0," | Remaining: ",t]})]}),e.jsxs("div",{className:"w-32",children:[e.jsx(o,{className:"text-xs",children:"Receive Qty"}),e.jsx(m,{type:"number",min:"0",max:t,value:de[a.inventoryItemId]??0,onChange:r=>oe(i=>({...i,[a.inventoryItemId]:Math.min(Number(r.target.value)||0,t)}))})]})]},a.inventoryItemId)})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Actual Cost (optional)"}),e.jsx(m,{type:"number",min:"0",step:"0.01",value:ue??"",onChange:a=>me(a.target.value?Number(a.target.value):void 0),placeholder:`Expected: ₱${s.totalAmount.toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>V(null),children:"Cancel"}),e.jsxs(d,{onClick:()=>ss(R),children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"})," Receive Items"]})]})]}):null})()})]})}),e.jsx(Fs,{open:Ee,onOpenChange:Y,itemCount:he,itemType:"purchase orders",onConfirm:as})]})}export{Xs as PurchaseOrdersView};
