import{c as F,i as pe,r as a,G as ye,j as e,C,m as D,aD as M,n as U,s as B,t as x,aE as A,o as _,B as r,a7 as q,X as V,U as ve,Q as fe,I as Ne,D as X,v as $,w as G,x as J,y as Q,L as Y,z as W,J as i}from"./index-DI4_T8_2.js";import{S as L,a as T,b as I,c as E,d as n,e as we,f as ke,g as K,i as g,h as Se,j as be,k as d,T as Ce}from"./sortable-table-head-GUmt4Lm5.js";import{u as De}from"./useTableSort-BQNjhCx3.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],Ae=F("user-check",Ue);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]],Z=F("user-cog",Le);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Ie=F("user-x",Te);function Pe(){const{user:y,getAllUsers:O,getPendingUsers:Ee,approveUser:ee,rejectUser:se,updateUserRole:te,updateUserStatus:ae,deleteUser:re}=pe(),[h,le]=a.useState([]),[P,ne]=a.useState(""),[v,ce]=a.useState("all"),[l,f]=a.useState(null),[ie,N]=a.useState(!1),[de,w]=a.useState(!1),[c,S]=a.useState({role:"Operator",status:"Active"}),b=ye(P,300);a.useEffect(()=>{const s=()=>{const p=O();le(p.map(o=>({id:o.id,email:o.email,name:o.name,role:o.role,status:o.status,createdAt:o.createdAt,lastLogin:o.lastLogin})))};s();const t=setInterval(s,2e3);return()=>clearInterval(t)},[O]);const oe=a.useMemo(()=>{let s=h;if(b){const t=b.toLowerCase();s=s.filter(p=>p.name.toLowerCase().includes(t)||p.email.toLowerCase().includes(t)||p.id.toLowerCase().includes(t))}return v!=="all"&&(s=s.filter(t=>t.status===v)),s},[h,b,v]),{sortedData:R,sortConfig:m,requestSort:j,getSortDirection:u}=De(oe),k=a.useMemo(()=>h.filter(s=>s.status==="Pending").length,[h]),xe=s=>{f(s),S({role:s.role,status:s.status}),N(!0)},he=s=>{f(s),w(!0)},z=s=>{try{ee(s),i.success("User approved successfully")}catch(t){i.error(t?.message||"Failed to approve user")}},H=s=>{try{se(s),i.success("User rejected and removed")}catch(t){i.error(t?.message||"Failed to reject user")}},me=()=>{if(l)try{c.role!==l.role&&te(l.id,c.role),c.status!==l.status&&ae(l.id,c.status),i.success("User updated successfully"),N(!1),f(null)}catch(s){i.error(s?.message||"Failed to update user")}},je=()=>{if(l)try{re(l.id),i.success("User deleted successfully"),w(!1),f(null)}catch(s){i.error(s?.message||"Failed to delete user")}},ue=s=>{switch(s){case"Active":return e.jsxs(x,{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(Ae,{className:"h-3 w-3 mr-1"}),"Active"]});case"Pending":return e.jsxs(x,{className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),"Pending"]});case"Inactive":return e.jsxs(x,{className:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200",children:[e.jsx(Ie,{className:"h-3 w-3 mr-1"}),"Inactive"]})}},ge=s=>{switch(s){case"Admin":return e.jsxs(x,{variant:"default",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),"Admin"]});case"Operator":return e.jsxs(x,{variant:"secondary",children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),"Operator"]})}};return!y||y.role!=="Admin"?e.jsx("div",{className:"flex items-center justify-center h-full min-h-[400px]",children:e.jsx(C,{className:"max-w-md w-full mx-4",children:e.jsxs(D,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-12 w-12 rounded-full bg-destructive/10 flex items-center justify-center",children:e.jsx(M,{className:"h-6 w-6 text-destructive"})}),e.jsx(U,{className:"text-destructive",children:"Access Denied"}),e.jsx(B,{children:"You do not have permission to access user management."})]})})}):e.jsxs("div",{className:"space-y-6 px-4 sm:px-0",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"User Management"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Manage user accounts, roles, and permissions"})]}),k>0&&e.jsxs(x,{variant:"destructive",className:"text-sm px-3 py-1.5 gap-1.5 self-start md:self-auto animate-pulse",children:[e.jsx(A,{className:"h-3.5 w-3.5"}),k," pending approval",k!==1?"s":""]})]}),k>0&&e.jsxs(C,{className:"border-yellow-200 bg-yellow-50 dark:border-yellow-800 dark:bg-yellow-950/30",children:[e.jsxs(D,{className:"pb-3",children:[e.jsxs(U,{className:"text-lg flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5 text-yellow-600"}),"Pending Approvals"]}),e.jsx(B,{children:"New user registrations awaiting your approval"})]}),e.jsx(_,{children:e.jsx("div",{className:"space-y-3",children:h.filter(s=>s.status==="Pending").map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-gray-900 rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Registered: ",new Date(s.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{size:"sm",variant:"outline",className:"text-green-600 hover:bg-green-50",onClick:()=>z(s.id),children:[e.jsx(q,{className:"h-4 w-4 mr-1"})," Approve"]}),e.jsxs(r,{size:"sm",variant:"outline",className:"text-red-600 hover:bg-red-50",onClick:()=>H(s.id),children:[e.jsx(V,{className:"h-4 w-4 mr-1"})," Reject"]})]})]},s.id))})})]}),e.jsxs(C,{children:[e.jsx(D,{children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5"}),e.jsx(U,{children:"All Users"}),e.jsx(x,{variant:"secondary",children:h.length})]}),e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(Ne,{placeholder:"Search users...",value:P,onChange:s=>ne(s.target.value),className:"pl-9 w-full md:w-64"})]}),e.jsxs(L,{value:v,onValueChange:s=>ce(s),children:[e.jsx(T,{className:"w-full md:w-40",children:e.jsx(I,{placeholder:"Filter by status"})}),e.jsxs(E,{children:[e.jsx(n,{value:"all",children:"All Status"}),e.jsx(n,{value:"Active",children:"Active"}),e.jsx(n,{value:"Pending",children:"Pending"}),e.jsx(n,{value:"Inactive",children:"Inactive"})]})]})]})]})}),e.jsx(_,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(we,{children:[e.jsx(ke,{children:e.jsxs(K,{children:[e.jsx(g,{sortKey:"name",currentSortKey:m.key,sortDirection:u("name"),onSort:s=>j(s),children:"Name"}),e.jsx(g,{sortKey:"email",currentSortKey:m.key,sortDirection:u("email"),onSort:s=>j(s),children:"Email"}),e.jsx(g,{sortKey:"role",currentSortKey:m.key,sortDirection:u("role"),onSort:s=>j(s),children:"Role"}),e.jsx(g,{sortKey:"status",currentSortKey:m.key,sortDirection:u("status"),onSort:s=>j(s),children:"Status"}),e.jsx(g,{sortKey:"createdAt",currentSortKey:m.key,sortDirection:u("createdAt"),onSort:s=>j(s),children:"Created"}),e.jsx(g,{sortKey:"lastLogin",currentSortKey:m.key,sortDirection:u("lastLogin"),onSort:s=>j(s),children:"Last Login"}),e.jsx(Se,{children:"Actions"})]})}),e.jsx(be,{children:R.length===0?e.jsx(K,{children:e.jsx(d,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No users found"})}):R.map(s=>e.jsxs(K,{children:[e.jsx(d,{className:"font-medium",children:s.name}),e.jsx(d,{children:s.email}),e.jsx(d,{children:ge(s.role)}),e.jsx(d,{children:ue(s.status)}),e.jsx(d,{children:new Date(s.createdAt).toLocaleDateString()}),e.jsx(d,{children:s.lastLogin?new Date(s.lastLogin).toLocaleDateString():"Never"}),e.jsx(d,{children:e.jsxs("div",{className:"flex gap-1",children:[s.status==="Pending"&&e.jsxs(e.Fragment,{children:[e.jsx(r,{size:"sm",variant:"ghost",className:"text-green-600",onClick:()=>z(s.id),title:"Approve",children:e.jsx(q,{className:"h-4 w-4"})}),e.jsx(r,{size:"sm",variant:"ghost",className:"text-red-600",onClick:()=>H(s.id),title:"Reject",children:e.jsx(V,{className:"h-4 w-4"})})]}),e.jsx(r,{size:"sm",variant:"ghost",onClick:()=>xe(s),title:"Edit",disabled:s.id===y?.id,children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(r,{size:"sm",variant:"ghost",className:"text-red-600",onClick:()=>he(s),title:"Delete",disabled:s.id===y?.id,children:e.jsx(Ce,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]}),e.jsx(X,{open:ie,onOpenChange:N,children:e.jsxs($,{children:[e.jsxs(G,{children:[e.jsx(J,{children:"Edit User"}),e.jsxs(Q,{children:["Update role and status for ",l?.name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{children:"Role"}),e.jsxs(L,{value:c.role,onValueChange:s=>S({...c,role:s}),children:[e.jsx(T,{children:e.jsx(I,{})}),e.jsxs(E,{children:[e.jsx(n,{value:"Admin",children:"Admin - Full access"}),e.jsx(n,{value:"Operator",children:"Operator - Read-only"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{children:"Status"}),e.jsxs(L,{value:c.status,onValueChange:s=>S({...c,status:s}),children:[e.jsx(T,{children:e.jsx(I,{})}),e.jsxs(E,{children:[e.jsx(n,{value:"Active",children:"Active"}),e.jsx(n,{value:"Pending",children:"Pending"}),e.jsx(n,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsxs(W,{children:[e.jsx(r,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(r,{onClick:me,children:"Save Changes"})]})]})}),e.jsx(X,{open:de,onOpenChange:w,children:e.jsxs($,{children:[e.jsxs(G,{children:[e.jsx(J,{children:"Delete User"}),e.jsxs(Q,{children:["Are you sure you want to delete ",l?.name,"? This action cannot be undone."]})]}),e.jsxs(W,{children:[e.jsx(r,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(r,{variant:"destructive",onClick:je,children:"Delete User"})]})]})})]})}export{Pe as UserManagementView};
