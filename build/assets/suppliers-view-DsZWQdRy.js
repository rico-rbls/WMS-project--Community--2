import{c as Ae,x as Fe,f as Ee,r as l,Y as Be,ae as Pe,t as n,af as Ie,j as e,C as k,l as D,m as T,n as A,B as j,L as o,I as c,ag as Le,A as Ke,d as ee,s as se,k as Me,U as Oe,D as ae,ah as Ue,ai as $e,aj as qe}from"./index-CwXupAWR.js";import{u as He,D as te,j as re,a as le,b as ne,c as ie,d as ce,k as ze,T as Re,l as Ye,m as Ge,n as oe,o as de,p as N,q as _e,r as h}from"./sortable-table-head-BurvSh9r.js";import{u as Ve,a as We,P as Je,B as Qe,b as Xe,T as Ze,E as es,c as ss}from"./bulk-delete-dialog-mm292chh.js";import{S as as,F as ts}from"./save-search-dialog-hYr4Egik.js";import{u as rs}from"./useTableSort-D6ePOIZE.js";import{c as ls}from"./permissions-B6nl0Ept.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],is=Ae("phone",ns);function ps({initialOpenDialog:M,onDialogOpened:O}){const{isFavorite:U,getFavoritesByType:$}=Fe(),{user:q}=Ee(),y=q?ls(q.role):!1,[p,H]=l.useState(""),[m,z]=l.useState(!1),[R,x]=l.useState(null),[ue,Y]=l.useState(!0),[f,b]=l.useState(!1),[F,E]=l.useState(null),[a,i]=l.useState({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active"}),B=He(p,300);l.useEffect(()=>{(async()=>{Y(!0);const s=await Be();x(s),Y(!1)})()},[]),l.useEffect(()=>{M&&!f&&(b(!0),O?.())},[M,O,f]);const G=l.useMemo(()=>R??[],[R]),P=l.useMemo(()=>G.filter(s=>{if(m&&!U("suppliers",s.id))return!1;if(B){const r=B.toLowerCase();if(!(s.name.toLowerCase().includes(r)||s.id.toLowerCase().includes(r)||s.category.toLowerCase().includes(r)))return!1}return!0}),[G,B,m,U]),me=l.useCallback(s=>{s.searchTerm&&H(s.searchTerm),s.filters.favoritesOnly==="true"&&z(!0)},[]),he=l.useMemo(()=>{const s={};return m&&(s.favoritesOnly="true"),s},[m]),{sortedData:pe,sortConfig:v,requestSort:S,getSortDirection:C}=rs(P),{currentPage:_,totalPages:xe,paginatedData:V,goToPage:ge,totalItems:je,itemsPerPage:ye}=Ve(pe,25),{selectedIds:w,selectedItems:W,selectionCount:J,isAllSelected:fe,isPartiallySelected:ve,hasSelection:I,toggleItem:Se,toggleAll:L,deselectAll:d,isSelected:Ce}=We(V),[Q,X]=l.useState(!1),[Ne,Z]=l.useState(!1),[be,K]=l.useState(!1);l.useEffect(()=>{d()},[_,d]),l.useEffect(()=>{const s=r=>{(r.metaKey||r.ctrlKey)&&r.key==="a"&&!f&&!F&&(r.preventDefault(),L()),r.key==="Escape"&&I&&d()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[L,d,I,f,F]);const we=s=>s==="Active"?"bg-green-500/10 text-green-700":"bg-gray-500/10 text-gray-700",ke=l.useCallback(async()=>{X(!0);try{const s=Array.from(w),r=await Pe(s);x(t=>t?.filter(u=>!s.includes(u.id))??[]),r.failedCount>0?n.warning(`Deleted ${r.successCount} suppliers. ${r.failedCount} failed.`):n.success(`Successfully deleted ${r.successCount} supplier${r.successCount!==1?"s":""}`),d()}catch(s){n.error(s?.message||"Failed to delete suppliers")}finally{X(!1),K(!1)}},[w,d]),De=l.useCallback(async s=>{Z(!0);try{const r=Array.from(w),t=await Ie(r,s);x(u=>u&&u.map(g=>r.includes(g.id)?{...g,status:s}:g)),t.failedCount>0?n.warning(`Updated ${t.successCount} suppliers. ${t.failedCount} failed.`):n.success(`Successfully updated ${t.successCount} supplier${t.successCount!==1?"s":""}`),d()}catch(r){n.error(r?.message||"Failed to update suppliers")}finally{Z(!1)}},[w,d]),Te=l.useMemo(()=>W.map(s=>s.name),[W]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(k,{children:[e.jsx(D,{className:"pb-2",children:e.jsx(T,{className:"text-sm text-muted-foreground",children:"Total Suppliers"})}),e.jsx(A,{children:e.jsx("div",{className:"text-2xl",children:"48"})})]}),e.jsxs(k,{children:[e.jsx(D,{className:"pb-2",children:e.jsx(T,{className:"text-sm text-muted-foreground",children:"Active"})}),e.jsx(A,{children:e.jsx("div",{className:"text-2xl",children:"42"})})]}),e.jsxs(k,{children:[e.jsx(D,{className:"pb-2",children:e.jsx(T,{className:"text-sm text-muted-foreground",children:"Categories"})}),e.jsx(A,{children:e.jsx("div",{className:"text-2xl",children:"8"})})]})]}),e.jsxs(k,{children:[e.jsx(D,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(T,{children:"Supplier Management"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(te,{open:f,onOpenChange:s=>{b(s),s||i({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active"})},children:[e.jsx(re,{asChild:!0,children:e.jsxs(j,{onClick:()=>i({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active"}),disabled:!y,title:y?void 0:"You don't have permission to add suppliers",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Add Supplier"]})}),e.jsxs(le,{children:[e.jsxs(ne,{children:[e.jsx(ie,{children:"Add New Supplier"}),e.jsx(ce,{children:"Enter the details for the new supplier."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"supplier-name",children:"Company Name"}),e.jsx(c,{id:"supplier-name",placeholder:"Enter company name",value:a.name,onChange:s=>i({...a,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"contact-name",children:"Contact Person"}),e.jsx(c,{id:"contact-name",placeholder:"Enter contact name",value:a.contact,onChange:s=>i({...a,contact:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"email",children:"Email"}),e.jsx(c,{id:"email",type:"email",placeholder:"email@example.com",value:a.email,onChange:s=>i({...a,email:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"phone",children:"Phone"}),e.jsx(c,{id:"phone",placeholder:"+1 (555) 000-0000",value:a.phone,onChange:s=>i({...a,phone:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"category",children:"Category"}),e.jsx(c,{id:"category",placeholder:"e.g., Electronics",value:a.category,onChange:s=>i({...a,category:s.target.value})})]}),e.jsx(j,{className:"w-full",onClick:async()=>{if(!a.name.trim()||!a.contact.trim()||!a.email.trim()||!a.phone.trim()||!a.category.trim()){n.error("Please fill all required fields");return}try{const s=await Le({name:a.name,contact:a.contact,email:a.email,phone:a.phone,category:a.category,status:a.status});x(r=>[s,...r??[]]),b(!1),n.success("Supplier added successfully"),i({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active"})}catch(s){n.error(s?.message||"Failed to add supplier")}},children:"Add Supplier"})]})]})]})})]})}),e.jsxs(A,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(c,{placeholder:"Search suppliers...",value:p,onChange:s=>H(s.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(j,{variant:m?"default":"outline",size:"sm",onClick:()=>z(!m),className:"gap-1",children:[e.jsx(Ke,{className:ee("h-4 w-4",m&&"fill-current")}),"Favorites",$("suppliers").length>0&&e.jsx(se,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:$("suppliers").length})]}),e.jsx(as,{entityType:"suppliers",currentSearchTerm:p,currentFilters:he,onApplySearch:me})]})]}),I&&y&&e.jsx(Qe,{selectionCount:J,onClearSelection:d,isLoading:Q||Ne,actions:[{id:"delete",label:"Delete",icon:e.jsx(Re,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>K(!0)}],actionGroups:[{id:"status-update",label:"Update Status",icon:e.jsx(Me,{className:"h-4 w-4 mr-1"}),options:[{value:"Active",label:"Active"},{value:"Inactive",label:"Inactive"}],onSelect:s=>De(s)}],className:"mb-4"}),e.jsx(Xe,{open:be,onOpenChange:K,itemCount:J,itemType:"supplier",itemNames:Te,onConfirm:ke,isLoading:Q}),ue?e.jsx(Ze,{rows:8}):P.length===0?e.jsx(es,{icon:Oe,title:"No suppliers found",description:p?"Try adjusting your search criteria":"Get started by adding your first supplier",actionLabel:p?void 0:"Add Supplier",onAction:p?void 0:()=>b(!0)}):e.jsxs("div",{className:"rounded-md border",children:[e.jsxs(Ye,{children:[e.jsx(Ge,{children:e.jsxs(oe,{children:[e.jsx(de,{className:"w-12",children:e.jsx(ae,{checked:fe,ref:s=>{s&&(s.indeterminate=ve)},onCheckedChange:L,"aria-label":"Select all suppliers"})}),e.jsx(N,{sortKey:"id",currentSortKey:v.key,sortDirection:C("id"),onSort:s=>S(s),children:"Supplier ID"}),e.jsx(N,{sortKey:"name",currentSortKey:v.key,sortDirection:C("name"),onSort:s=>S(s),children:"Company Name"}),e.jsx(N,{sortKey:"contact",currentSortKey:v.key,sortDirection:C("contact"),onSort:s=>S(s),children:"Contact"}),e.jsx(N,{sortKey:"category",currentSortKey:v.key,sortDirection:C("category"),onSort:s=>S(s),children:"Category"}),e.jsx(N,{sortKey:"status",currentSortKey:v.key,sortDirection:C("status"),onSort:s=>S(s),children:"Status"}),e.jsx(de,{children:"Actions"})]})}),e.jsx(_e,{children:V.map(s=>{const r=Ce(s.id);return e.jsxs(oe,{className:ee(r&&"bg-muted/50"),children:[e.jsx(h,{children:e.jsx(ae,{checked:r,onCheckedChange:()=>Se(s.id),"aria-label":`Select supplier ${s.name}`})}),e.jsx(h,{children:s.id}),e.jsx(h,{children:s.name}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Ue,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.email})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(is,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.phone})]})]})}),e.jsx(h,{children:s.category}),e.jsx(h,{children:e.jsx(se,{variant:"secondary",className:we(s.status),children:s.status})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ts,{entityType:"suppliers",entityId:s.id,entityName:s.name}),e.jsxs(te,{open:F===s.id,onOpenChange:t=>{E(t?s.id:null),t&&i({...s})},children:[e.jsx(re,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"sm",disabled:!y,title:y?void 0:"You don't have permission to edit suppliers",children:"Edit"})}),e.jsxs(le,{children:[e.jsxs(ne,{children:[e.jsx(ie,{children:"Edit Supplier"}),e.jsx(ce,{children:"Update fields and save your changes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"edit-name",children:"Company Name"}),e.jsx(c,{id:"edit-name",value:a.name,onChange:t=>i({...a,name:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"edit-contact",children:"Contact Person"}),e.jsx(c,{id:"edit-contact",value:a.contact,onChange:t=>i({...a,contact:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"edit-email",children:"Email"}),e.jsx(c,{id:"edit-email",value:a.email,onChange:t=>i({...a,email:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"edit-phone",children:"Phone"}),e.jsx(c,{id:"edit-phone",value:a.phone,onChange:t=>i({...a,phone:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"edit-category",children:"Category"}),e.jsx(c,{id:"edit-category",value:a.category,onChange:t=>i({...a,category:t.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{className:"flex-1",onClick:async()=>{if(!a.id){n.error("Missing supplier id");return}if(!a.name.trim()||!a.contact.trim()||!a.email.trim()||!a.phone.trim()||!a.category.trim()){n.error("Please fill all required fields");return}try{const t=await $e({id:a.id,name:a.name,contact:a.contact,email:a.email,phone:a.phone,category:a.category,status:a.status});x(u=>(u??[]).map(g=>g.id===t.id?t:g)),E(null),n.success("Supplier updated")}catch(t){n.error(t?.message||"Failed to update supplier")}},children:"Save Changes"}),e.jsx(j,{variant:"destructive",onClick:async()=>{try{await qe(s.id),x(t=>(t??[]).filter(u=>u.id!==s.id)),E(null),n.success("Supplier deleted")}catch(t){n.error(t?.message||"Failed to delete supplier")}},children:"Delete"})]})]})]})]})]})})]},s.id)})})]}),P.length>0&&e.jsx(ss,{currentPage:_,totalPages:xe,onPageChange:ge,itemsPerPage:ye,totalItems:je})]})]})]})]})}export{ps as SuppliersView};
