import{J as ys,i as Ns,r as n,M as Cs,aC as bs,aZ as Ve,x as i,a_ as ws,a$ as Ss,b0 as ks,b1 as Fs,b2 as As,j as e,C as N,o as G,p as _,U as fe,q as C,S as Ds,P as Ps,d as T,w as $,v as Ts,D as re,$ as Es,B as o,y as le,z as ne,A as ie,E as ce,L as d,I as m,F as ye,b3 as Is,a1 as Ls,a0 as Bs,n as $s,a8 as qe,aV as He,a9 as Us,b4 as Ks,b5 as Ms,b6 as Os}from"./index-DtIy5di3.js";import{S as J,a as W,b as X,c as Y,d as R,T as de,e as Rs,f as zs,g as Ge,h as _e,i as D,j as Vs,k as v}from"./sortable-table-head-BvBFsdoe.js";import{u as qs,a as Hs,P as Gs,F as _s,B as Js,T as Ws,E as Xs,S as Ys,b as Zs}from"./select-all-banner-DsI779xj.js";import{S as Qs,F as Je}from"./favorite-button-C4ura5Pt.js";import{u as et}from"./useTableSort-rImfouWx.js";import{c as st}from"./permissions-DeuZZz56.js";import{E as Ne}from"./editable-cell-aIeBH0_h.js";import{C as tt}from"./circle-check-big-CQM8BH5w.js";import{A as z,a as We,D as at}from"./dollar-sign-1PnZGXlb.js";import{C as rt}from"./circle-alert-BXYfXObw.js";import{P as Xe}from"./phone-C8azbvOW.js";import{S as Ye}from"./square-pen-C6hM5krl.js";import{M as lt}from"./map-pin-MIwNkvjO.js";import"./skeleton-Fg1UUbVG.js";const Ce=["Active","Inactive"],be=["Technology","Startup","Enterprise","Retail","Healthcare","Finance","Other"];function yt({initialOpenDialog:we,onDialogOpened:Se,initialCustomerId:Z,onCustomerDialogOpened:ke}){const{isFavorite:Fe,getFavoritesByType:Ae}=ys(),{user:Q}=Ns(),f=Q?st(Q.role):!1,oe=Q?.role==="Admin"||Q?.role==="Owner",[U,De]=n.useState(""),[b,ee]=n.useState("all"),[K,Pe]=n.useState(!1),[u,Te]=n.useState(!1),[V,j]=n.useState(null),[Ze,Ee]=n.useState(!0),[q,H]=n.useState(!1),[M,E]=n.useState(null),[me,O]=n.useState(null),[t,c]=n.useState({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0}),ue=Cs(U,300);n.useEffect(()=>{(async()=>{Ee(!0);const s=await bs();j(s),Ee(!1)})()},[]),n.useEffect(()=>{we&&!q&&(H(!0),Se?.())},[we,Se,q]),n.useEffect(()=>{Z&&V&&V.find(a=>a.id===Z)&&(O(Z),ke?.())},[Z,V,ke]);const p=n.useMemo(()=>V??[],[V]),g=n.useMemo(()=>{const s=p.length,a=p.filter(x=>x.status==="Active").length,r=p.filter(x=>x.status==="Inactive").length,l=new Set(p.map(x=>x.category)).size,L=p.reduce((x,B)=>x+B.purchases,0),ve=p.reduce((x,B)=>x+B.payments,0),ae=p.reduce((x,B)=>x+B.balance,0);let ze=null;if(p.length>0){const x=[...p].sort((B,fs)=>fs.purchases-B.purchases);x[0].purchases>0&&(ze={id:x[0].id,name:x[0].name,value:x[0].purchases})}return{totalCustomers:s,activeCustomers:a,inactiveCustomers:r,uniqueCategories:l,totalPurchases:L,totalPayments:ve,totalBalance:ae,topCustomerByPurchases:ze}},[p]),he=n.useMemo(()=>p.filter(s=>{if(s.archived===!0!==u||K&&!Fe("customers",s.id)||b!=="all"&&s.status!==b)return!1;if(ue){const r=ue.toLowerCase();if(!(s.name.toLowerCase().includes(r)||s.id.toLowerCase().includes(r)||s.category.toLowerCase().includes(r)||s.contact.toLowerCase().includes(r)||s.email.toLowerCase().includes(r)))return!1}return!0}),[p,ue,b,K,Fe,u]);function Qe(){De(""),ee("all"),Pe(!1),Te(!1)}async function es(s){try{const a=await Os(s);j(r=>(r??[]).map(l=>l.id===s?a:l)),E(null),i.success("Customer archived successfully")}catch(a){i.error(a?.message||"Failed to archive customer")}}async function ss(s){try{const a=await Ks(s);j(r=>(r??[]).map(l=>l.id===s?a:l)),E(null),i.success("Customer restored successfully")}catch(a){i.error(a?.message||"Failed to restore customer")}}async function ts(s){try{await Ms(s),j(a=>(a??[]).filter(r=>r.id!==s)),E(null),i.success("Customer permanently deleted")}catch(a){i.error(a?.message||"Failed to permanently delete customer")}}const I=s=>{switch(s){case"Active":return"✓";case"Inactive":return"○";default:return"○"}},se=s=>{switch(s){case"Active":return"bg-emerald-500/15 text-emerald-700 dark:text-emerald-400 border-emerald-200";case"Inactive":return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200";default:return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200"}},{sortedData:Ie,sortConfig:w,requestSort:S,getSortDirection:k}=et(he),{currentPage:Le,totalPages:as,paginatedData:Be,goToPage:rs,totalItems:ls,itemsPerPage:ns}=qs(Ie,25),{selectedIds:y,selectedItems:$e,selectionCount:xe,isAllSelected:is,isAllPageSelected:cs,isAllPagesSelected:ds,isPartiallySelected:os,hasSelection:ge,toggleItem:ms,toggleAll:je,selectAllPages:us,deselectAll:h,isSelected:hs,totalItemCount:Ue,pageItemCount:Ke}=Hs(Be,Ie),[F,P]=n.useState(!1),[xs,Me]=n.useState(!1),[gs,A]=n.useState(!1);n.useEffect(()=>{h()},[Le,h]),n.useEffect(()=>{const s=a=>{(a.metaKey||a.ctrlKey)&&a.key==="a"&&!q&&!M&&(a.preventDefault(),je()),a.key==="Escape"&&ge&&h()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[je,h,ge,q,M]);const pe=n.useCallback(async(s,a,r)=>{try{const l={[a]:r},L=await Ve({id:s,...l});j(ve=>(ve??[]).map(ae=>ae.id===s?L:ae)),i.success(`${a.charAt(0).toUpperCase()+a.slice(1)} updated`)}catch(l){throw i.error(l?.message||"Failed to update"),l}},[j]);n.useCallback(async()=>{P(!0);try{const s=Array.from(y),a=await ws(s);j(r=>r?.filter(l=>!s.includes(l.id))??[]),a.failedCount>0?i.warning(`Deleted ${a.successCount} customers. ${a.failedCount} failed.`):i.success(`Successfully deleted ${a.successCount} customer${a.successCount!==1?"s":""}`),h()}catch(s){i.error(s?.message||"Failed to delete customers")}finally{P(!1),A(!1)}},[y,h]);const js=n.useCallback(async()=>{P(!0);try{const s=Array.from(y),a=await Ss(s);j(r=>r&&r.map(l=>s.includes(l.id)?{...l,archived:!0,archivedAt:new Date().toISOString()}:l)),a.failedCount>0?i.warning(`Archived ${a.successCount} customers. ${a.failedCount} failed.`):i.success(`Successfully archived ${a.successCount} customer${a.successCount!==1?"s":""}`),h()}catch(s){i.error(s?.message||"Failed to archive customers")}finally{P(!1),A(!1)}},[y,h]),ps=n.useCallback(async()=>{P(!0);try{const s=Array.from(y),a=await ks(s);j(r=>r&&r.map(l=>s.includes(l.id)?{...l,archived:!1,archivedAt:void 0}:l)),a.failedCount>0?i.warning(`Restored ${a.successCount} customers. ${a.failedCount} failed.`):i.success(`Successfully restored ${a.successCount} customer${a.successCount!==1?"s":""}`),h()}catch(s){i.error(s?.message||"Failed to restore customers")}finally{P(!1),A(!1)}},[y,h]),Oe=n.useCallback(async()=>{P(!0);try{const s=Array.from(y),a=await Fs(s);j(r=>r?.filter(l=>!s.includes(l.id))??[]),a.failedCount>0?i.warning(`Permanently deleted ${a.successCount} customers. ${a.failedCount} failed.`):i.success(`Permanently deleted ${a.successCount} customer${a.successCount!==1?"s":""}`),h()}catch(s){i.error(s?.message||"Failed to permanently delete customers")}finally{P(!1),A(!1)}},[y,h]),vs=n.useCallback(async s=>{Me(!0);try{const a=Array.from(y),r=await As(a,s);j(l=>l&&l.map(L=>a.includes(L.id)?{...L,status:s}:L)),r.failedCount>0?i.warning(`Updated ${r.successCount} customers. ${r.failedCount} failed.`):i.success(`Successfully updated ${r.successCount} customer${r.successCount!==1?"s":""}`),h()}catch(a){i.error(a?.message||"Failed to update customers")}finally{Me(!1)}},[y,h]),Re=n.useCallback(s=>{c({id:s.id,name:s.name,contact:s.contact,email:s.email,phone:s.phone,category:s.category,status:s.status,country:s.country||"",city:s.city||"",address:s.address||"",purchases:s.purchases||0,payments:s.payments||0}),E(s.id)},[]),te=n.useMemo(()=>$e.map(s=>s.name),[$e]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Customers"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage customer profiles, contact details, and sales relationships"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(N,{className:"relative overflow-hidden",children:[e.jsxs(G,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"Total Customers"}),e.jsx(fe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g.totalCustomers}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[g.activeCustomers," active, ",g.inactiveCustomers," inactive"]})]})]}),e.jsxs(N,{className:"relative overflow-hidden",children:[e.jsxs(G,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"Active Customers"}),e.jsx(tt,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:g.activeCustomers}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:g.totalCustomers>0?`${Math.round(g.activeCustomers/g.totalCustomers*100)}% of total`:"No customers yet"})]})]}),e.jsxs(N,{className:"relative overflow-hidden",children:[e.jsxs(G,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"Total Purchases"}),e.jsx(Ds,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["₱",g.totalPurchases.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:g.topCustomerByPurchases?`Top: ${g.topCustomerByPurchases.name}`:"No purchases yet"})]})]}),e.jsxs(N,{className:"relative overflow-hidden",children:[e.jsxs(G,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"Categories"}),e.jsx(Ps,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:g.uniqueCategories}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Outstanding balance: ₱",g.totalBalance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]}),e.jsxs("div",{className:"grid gap-3 grid-cols-1 sm:grid-cols-2",children:[e.jsx(N,{className:T("cursor-pointer transition-all hover:shadow-md border-l-4",b==="Active"?"ring-2 ring-primary":"","border-l-emerald-400"),onClick:()=>ee(b==="Active"?"all":"Active"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Active"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:g.activeCustomers})]}),e.jsx($,{variant:"outline",className:se("Active"),children:I("Active")})]})})}),e.jsx(N,{className:T("cursor-pointer transition-all hover:shadow-md border-l-4",b==="Inactive"?"ring-2 ring-primary":"","border-l-slate-400"),onClick:()=>ee(b==="Inactive"?"all":"Inactive"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Inactive"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:g.inactiveCustomers})]}),e.jsx($,{variant:"outline",className:se("Inactive"),children:I("Inactive")})]})})})]}),e.jsxs(N,{children:[e.jsx(G,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{className:"text-xl",children:"Customer Management"}),e.jsx(Ts,{className:"mt-1",children:"Manage your customer relationships and contacts"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(re,{open:q,onOpenChange:s=>{H(s),s||c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0})},children:[e.jsx(Es,{asChild:!0,children:e.jsxs(o,{onClick:()=>c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0}),disabled:!f,title:f?void 0:"You don't have permission to add customers",children:[e.jsx(Gs,{className:"h-4 w-4 mr-2"}),"Add Customer"]})}),e.jsxs(le,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ne,{children:[e.jsx(ie,{children:"Create New Customer"}),e.jsx(ce,{children:"Enter the details for the new customer."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"customer-name",children:"Customer Name *"}),e.jsx(m,{id:"customer-name",placeholder:"Enter customer name",value:t.name,onChange:s=>c({...t,name:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"customer-status",children:"Status"}),e.jsxs(J,{value:t.status,onValueChange:s=>c({...t,status:s}),children:[e.jsx(W,{children:e.jsx(X,{placeholder:"Select status"})}),e.jsx(Y,{children:Ce.map(s=>e.jsx(R,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:I(s)}),s]})},s))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"contact-name",children:"Contact Person *"}),e.jsx(m,{id:"contact-name",placeholder:"Enter contact name",value:t.contact,onChange:s=>c({...t,contact:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"email",children:"Email *"}),e.jsx(m,{id:"email",type:"email",placeholder:"email@example.com",value:t.email,onChange:s=>c({...t,email:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"phone",children:"Phone *"}),e.jsx(m,{id:"phone",placeholder:"+1 (555) 000-0000",value:t.phone,onChange:s=>c({...t,phone:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"category",children:"Category *"}),e.jsxs(J,{value:t.category,onValueChange:s=>c({...t,category:s}),children:[e.jsx(W,{children:e.jsx(X,{placeholder:"Select category"})}),e.jsx(Y,{children:be.map(s=>e.jsx(R,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Location Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"country",children:"Country"}),e.jsx(m,{id:"country",placeholder:"e.g., United States",value:t.country,onChange:s=>c({...t,country:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"city",children:"City"}),e.jsx(m,{id:"city",placeholder:"e.g., San Francisco",value:t.city,onChange:s=>c({...t,city:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2 mt-4",children:[e.jsx(d,{htmlFor:"address",children:"Address"}),e.jsx(m,{id:"address",placeholder:"Full street address",value:t.address,onChange:s=>c({...t,address:s.target.value})})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Financial Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"purchases",children:"Total Purchases (₱)"}),e.jsx(m,{id:"purchases",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.purchases,onChange:s=>c({...t,purchases:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"payments",children:"Total Payments (₱)"}),e.jsx(m,{id:"payments",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.payments,onChange:s=>c({...t,payments:parseFloat(s.target.value)||0})})]})]})]})]}),e.jsxs(ye,{children:[e.jsx(o,{variant:"outline",onClick:()=>H(!1),children:"Cancel"}),e.jsx(o,{onClick:async()=>{if(!t.name.trim()||!t.contact.trim()||!t.email.trim()||!t.phone.trim()||!t.category.trim()){i.error("Please fill all required fields");return}try{const s=await Is({name:t.name,contact:t.contact,email:t.email,phone:t.phone,category:t.category,status:t.status,country:t.country,city:t.city,address:t.address,purchases:t.purchases,payments:t.payments});j(a=>[s,...a??[]]),H(!1),i.success("Customer added successfully"),c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0})}catch(s){i.error(s?.message||"Failed to add customer")}},children:"Create Customer"})]})]})]})})]})}),e.jsxs(C,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ls,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(m,{placeholder:"Search customers by name, contact, email...",value:U,onChange:s=>De(s.target.value),className:"pl-9"})]}),e.jsxs(J,{value:b,onValueChange:ee,children:[e.jsxs(W,{className:"w-full sm:w-[180px]",children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),e.jsx(X,{placeholder:"Filter by status"})]}),e.jsxs(Y,{children:[e.jsx(R,{value:"all",children:"All Statuses"}),Ce.map(s=>e.jsx(R,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:I(s)}),s]})},s))]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(o,{variant:K?"default":"outline",size:"sm",onClick:()=>Pe(!K),className:"gap-1",children:[e.jsx(Qs,{className:T("h-4 w-4",K&&"fill-current")}),"Favorites",Ae("customers").length>0&&e.jsx($,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:Ae("customers").length})]}),e.jsxs(o,{variant:u?"default":"outline",size:"sm",onClick:()=>Te(!u),className:u?"bg-orange-500 hover:bg-orange-600 text-white":"",children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),u?"Viewing Archived":"View Archived"]}),(U||b!=="all"||K||u)&&e.jsxs(o,{variant:"ghost",size:"sm",onClick:Qe,className:"gap-1 text-muted-foreground hover:text-foreground",children:[e.jsx(Bs,{className:"h-4 w-4"}),"Clear All Filters"]})]})]}),ge&&f&&e.jsx(Js,{selectionCount:xe,onClearSelection:h,isLoading:F||xs,actions:u?[{id:"restore",label:"Restore",icon:e.jsx(We,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:ps},...oe?[{id:"permanent-delete",label:"Permanently Delete",icon:e.jsx(de,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>A(!0)}]:[]]:[{id:"archive",label:"Archive",icon:e.jsx(z,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:()=>A(!0)}],actionGroups:u?[]:[{id:"status-update",label:"Update Status",icon:e.jsx($s,{className:"h-4 w-4 mr-1"}),options:[{value:"Active",label:"Active"},{value:"Inactive",label:"Inactive"}],onSelect:s=>vs(s)}],className:"mb-4"}),e.jsx(re,{open:gs,onOpenChange:A,children:e.jsxs(le,{className:"max-w-md",children:[e.jsxs(ne,{children:[e.jsxs(ie,{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"h-5 w-5 text-destructive"}),"Delete ",xe," Customer",xe!==1?"s":""]}),e.jsx(ce,{children:u?"These customers are already archived. This action will permanently remove them from the system.":"Choose how you want to delete the selected customers:"})]}),te.length>0&&e.jsx("div",{className:"max-h-32 overflow-y-auto border rounded-md p-2 bg-muted/50",children:e.jsxs("ul",{className:"text-sm space-y-1",children:[te.slice(0,10).map((s,a)=>e.jsxs("li",{className:"truncate",children:["• ",s]},a)),te.length>10&&e.jsxs("li",{className:"text-muted-foreground",children:["...and ",te.length-10," more"]})]})}),u?e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("div",{className:"p-3 border border-destructive/50 rounded-md bg-destructive/10",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(de,{className:"h-4 w-4 mt-0.5 text-destructive"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-destructive",children:"Permanent Deletion"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This cannot be undone. All data will be permanently removed."})]})]})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(o,{variant:"outline",onClick:()=>A(!1),disabled:F,children:"Cancel"}),e.jsx(o,{variant:"destructive",onClick:Oe,disabled:F,children:F?"Deleting...":"Permanently Delete All"})]})]}):e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("div",{className:"p-3 border rounded-md hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"h-4 w-4 mt-0.5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Archive"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Move to archive. Customers can be restored later."})]}),e.jsx(o,{variant:"secondary",size:"sm",onClick:js,disabled:F,children:F?"...":"Archive"})]})}),oe&&e.jsx("div",{className:"p-3 border border-destructive/50 rounded-md bg-destructive/10",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(de,{className:"h-4 w-4 mt-0.5 text-destructive"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-destructive",children:"Delete Permanently"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cannot be undone. Data will be permanently removed."})]}),e.jsx(o,{variant:"destructive",size:"sm",onClick:Oe,disabled:F,children:F?"...":"Delete"})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(o,{variant:"outline",onClick:()=>A(!1),disabled:F,children:"Cancel"})})]})]})}),Ze?e.jsx(Ws,{rows:8}):he.length===0?e.jsx(Xs,{icon:u?z:fe,title:u?"No archived customers":"No customers found",description:u?"Archived customers will appear here":U?"Try adjusting your search criteria":"Get started by adding your first customer",actionLabel:!u&&!U?"Add Customer":void 0,onAction:!u&&!U?()=>H(!0):void 0}):e.jsxs("div",{className:"rounded-md border overflow-hidden",children:[e.jsx(Ys,{pageItemCount:Ke,totalItemCount:Ue,isAllPagesSelected:ds,show:cs&&Ue>Ke,onSelectAllPages:us,onClearSelection:h,itemLabel:"customers"}),e.jsxs(Rs,{children:[e.jsx(zs,{children:e.jsxs(Ge,{children:[e.jsx(_e,{className:"w-12",children:e.jsx(qe,{checked:is,ref:s=>{s&&(s.indeterminate=os)},onCheckedChange:je,"aria-label":"Select all customers"})}),e.jsx(D,{sortKey:"id",currentSortKey:w.key,sortDirection:k("id"),onSort:s=>S(s),children:"Customer ID"}),e.jsx(D,{sortKey:"name",currentSortKey:w.key,sortDirection:k("name"),onSort:s=>S(s),children:"Customer Name"}),e.jsx(D,{sortKey:"contact",currentSortKey:w.key,sortDirection:k("contact"),onSort:s=>S(s),children:"Contact"}),e.jsx(D,{sortKey:"category",currentSortKey:w.key,sortDirection:k("category"),onSort:s=>S(s),children:"Category"}),e.jsx(D,{sortKey:"status",currentSortKey:w.key,sortDirection:k("status"),onSort:s=>S(s),children:"Status"}),e.jsx(D,{sortKey:"country",currentSortKey:w.key,sortDirection:k("country"),onSort:s=>S(s),children:"Location"}),e.jsx(D,{sortKey:"purchases",currentSortKey:w.key,sortDirection:k("purchases"),onSort:s=>S(s),children:"Purchases"}),e.jsx(D,{sortKey:"payments",currentSortKey:w.key,sortDirection:k("payments"),onSort:s=>S(s),children:"Payments"}),e.jsx(D,{sortKey:"balance",currentSortKey:w.key,sortDirection:k("balance"),onSort:s=>S(s),children:"Balance"}),e.jsx(_e,{children:"Actions"})]})}),e.jsx(Vs,{children:Be.map(s=>{const a=hs(s.id);return e.jsxs(Ge,{className:T("hover:bg-muted/50 transition-colors",a&&"bg-muted/50"),children:[e.jsx(v,{children:e.jsx(qe,{checked:a,onCheckedChange:()=>ms(s.id),"aria-label":`Select customer ${s.name}`})}),e.jsx(v,{className:"font-mono text-sm",children:s.id}),e.jsx(v,{children:e.jsx("button",{className:"text-left font-medium text-primary hover:underline cursor-pointer bg-transparent border-none p-0",onClick:()=>O(s.id),children:s.name})}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(He,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(Ne,{value:s.email,type:"text",onSave:r=>pe(s.id,"email",r),disabled:!f,className:"text-xs text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Xe,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(Ne,{value:s.phone,type:"text",onSave:r=>pe(s.id,"phone",r),disabled:!f,className:"text-xs text-muted-foreground"})]})]})}),e.jsx(v,{children:e.jsx(Ne,{value:s.category,type:"select",options:be.map(r=>({value:r,label:r})),onSave:r=>pe(s.id,"category",r),disabled:!f})}),e.jsx(v,{children:e.jsxs($,{variant:"outline",className:T("gap-1",se(s.status)),children:[e.jsx("span",{children:I(s.status)}),s.status]})}),e.jsx(v,{children:e.jsx("div",{className:"text-sm",children:s.city&&s.country?e.jsxs("span",{children:[s.city,", ",s.country]}):s.city||s.country?e.jsx("span",{children:s.city||s.country}):e.jsx("span",{className:"text-muted-foreground",children:"—"})})}),e.jsxs(v,{className:"text-right font-medium",children:["₱",s.purchases.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(v,{className:"text-right font-medium",children:["₱",s.payments.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(v,{className:T("text-right font-medium",s.balance>0?"text-amber-600":s.balance<0?"text-emerald-600":""),children:["₱",s.balance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx(v,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Je,{entityType:"customers",entityId:s.id,entityName:s.name}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>O(s.id),children:e.jsx(Us,{className:"h-4 w-4"})}),u?e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>ss(s.id),disabled:!f,title:"Restore customer",children:e.jsx(We,{className:"h-4 w-4"})}),oe&&e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>ts(s.id),title:"Permanently delete",children:e.jsx(de,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Re(s),disabled:!f,title:"Edit customer",children:e.jsx(Ye,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>es(s.id),disabled:!f,title:"Archive customer",children:e.jsx(z,{className:"h-4 w-4"})})]})]})})]},s.id)})})]})]}),he.length>0&&e.jsx(Zs,{currentPage:Le,totalPages:as,totalItems:ls,itemsPerPage:ns,onPageChange:rs,className:"mt-4"})]})]}),M&&e.jsx(re,{open:!!M,onOpenChange:s=>{s||E(null)},children:e.jsxs(le,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ne,{children:[e.jsx(ie,{children:"Edit Customer"}),e.jsx(ce,{children:"Update the customer details."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-customer-name",children:"Customer Name *"}),e.jsx(m,{id:"edit-customer-name",placeholder:"Enter customer name",value:t.name,onChange:s=>c({...t,name:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-customer-status",children:"Status"}),e.jsxs(J,{value:t.status,onValueChange:s=>c({...t,status:s}),children:[e.jsx(W,{children:e.jsx(X,{placeholder:"Select status"})}),e.jsx(Y,{children:Ce.map(s=>e.jsx(R,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:I(s)}),s]})},s))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-contact-name",children:"Contact Person *"}),e.jsx(m,{id:"edit-contact-name",placeholder:"Enter contact name",value:t.contact,onChange:s=>c({...t,contact:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-email",children:"Email *"}),e.jsx(m,{id:"edit-email",type:"email",placeholder:"email@example.com",value:t.email,onChange:s=>c({...t,email:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-phone",children:"Phone *"}),e.jsx(m,{id:"edit-phone",placeholder:"+1 (555) 000-0000",value:t.phone,onChange:s=>c({...t,phone:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-category",children:"Category *"}),e.jsxs(J,{value:t.category,onValueChange:s=>c({...t,category:s}),children:[e.jsx(W,{children:e.jsx(X,{placeholder:"Select category"})}),e.jsx(Y,{children:be.map(s=>e.jsx(R,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Location Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-country",children:"Country"}),e.jsx(m,{id:"edit-country",placeholder:"e.g., United States",value:t.country,onChange:s=>c({...t,country:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-city",children:"City"}),e.jsx(m,{id:"edit-city",placeholder:"e.g., San Francisco",value:t.city,onChange:s=>c({...t,city:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2 mt-4",children:[e.jsx(d,{htmlFor:"edit-address",children:"Address"}),e.jsx(m,{id:"edit-address",placeholder:"Full street address",value:t.address,onChange:s=>c({...t,address:s.target.value})})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Financial Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-purchases",children:"Total Purchases (₱)"}),e.jsx(m,{id:"edit-purchases",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.purchases,onChange:s=>c({...t,purchases:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-payments",children:"Total Payments (₱)"}),e.jsx(m,{id:"edit-payments",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.payments,onChange:s=>c({...t,payments:parseFloat(s.target.value)||0})})]})]})]})]}),e.jsxs(ye,{children:[e.jsx(o,{variant:"outline",onClick:()=>E(null),children:"Cancel"}),e.jsx(o,{onClick:async()=>{if(!t.name.trim()||!t.contact.trim()||!t.email.trim()||!t.phone.trim()||!t.category.trim()){i.error("Please fill all required fields");return}try{const s=await Ve({id:M,name:t.name,contact:t.contact,email:t.email,phone:t.phone,category:t.category,status:t.status,country:t.country,city:t.city,address:t.address,purchases:t.purchases,payments:t.payments});j(a=>(a??[]).map(r=>r.id===M?s:r)),E(null),i.success("Customer updated successfully")}catch(s){i.error(s?.message||"Failed to update customer")}},children:"Save Changes"})]})]})}),me&&(()=>{const s=p.find(a=>a.id===me);return s?e.jsx(re,{open:!!me,onOpenChange:a=>{a||O(null)},children:e.jsxs(le,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsx(ne,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ie,{className:"text-xl",children:s.name}),e.jsxs(ce,{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"font-mono",children:s.id}),e.jsxs($,{variant:"outline",className:T("gap-1",se(s.status)),children:[e.jsx("span",{children:I(s.status)}),s.status]}),s.archived&&e.jsxs($,{variant:"outline",className:"bg-orange-500/15 text-orange-700 dark:text-orange-400 border-orange-200",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"Archived"]})]})]}),e.jsx(Je,{entityType:"customers",entityId:s.id,entityName:s.name})]})}),e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"Contact Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Contact Person"}),e.jsx("p",{className:"font-medium",children:s.contact})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Category"}),e.jsx($,{variant:"secondary",children:s.category})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(He,{className:"h-3 w-3 text-muted-foreground"}),s.email]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Phone"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(Xe,{className:"h-3 w-3 text-muted-foreground"}),s.phone]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(lt,{className:"h-4 w-4"}),"Location"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"City / Country"}),e.jsx("p",{className:"font-medium",children:s.city&&s.country?`${s.city}, ${s.country}`:s.city||s.country||"—"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Address"}),e.jsx("p",{className:"font-medium",children:s.address||"—"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(at,{className:"h-4 w-4"}),"Financial Summary"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(N,{children:e.jsxs(C,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Purchases"}),e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:["₱",s.purchases.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})}),e.jsx(N,{children:e.jsxs(C,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Payments"}),e.jsxs("p",{className:"text-lg font-bold text-emerald-600",children:["₱",s.payments.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})}),e.jsx(N,{children:e.jsxs(C,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Balance"}),e.jsxs("p",{className:T("text-lg font-bold",s.balance>0?"text-amber-600":s.balance<0?"text-emerald-600":""),children:["₱",s.balance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})})]})]})]}),e.jsxs(ye,{children:[e.jsx(o,{variant:"outline",onClick:()=>O(null),children:"Close"}),!s.archived&&f&&e.jsxs(o,{onClick:()=>{O(null),Re(s)},children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Edit Customer"]})]})]})}):null})()]})}export{yt as CustomersView};
