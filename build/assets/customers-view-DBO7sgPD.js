import{J as Ns,i as Cs,r as n,M as bs,aO as ws,aY as fe,x as i,bf as qe,bg as Ss,bh as Fs,j as e,C as N,o as Y,p as _,U as ye,q as C,S as ks,P as As,d as I,w as U,v as Ds,D as le,$ as Ps,B as o,y as ne,z as ie,A as ce,E as de,L as d,I as m,F as Ne,bi as Ts,a2 as Is,a1 as Es,n as Ls,a9 as He,aV as Ge,aa as Bs,bj as $s,bk as Us,bl as Ks}from"./index-C13KiIkd.js";import{S as J,a as W,b as X,c as Q,d as z,T as Os,e as Ms,f as Ye,g as _e,h as P,i as Rs,j as v}from"./sortable-table-head-Cg7gUyo0.js";import{u as zs,a as Vs,F as qs,B as Hs,T as Gs,E as Ys,S as _s,P as Js}from"./select-all-banner-DXXfaocE.js";import{S as Ws,F as Je}from"./favorite-button-HRNozHyb.js";import{u as Xs}from"./useTableSort-CJlN2q6M.js";import{c as Qs}from"./permissions-DeuZZz56.js";import{E as Ce}from"./editable-cell-Bf8tM54n.js";import{C as Zs}from"./circle-check-big-cyrJffae.js";import{P as et}from"./plus-6MR5U2yz.js";import{A as V,a as We,D as st}from"./dollar-sign-Cc4X1bBK.js";import{T as oe}from"./trash-2-DHtJUb0p.js";import{C as tt}from"./circle-alert-N9QOBYVw.js";import{P as Xe}from"./phone-Ci7K27Ya.js";import{S as Qe}from"./square-pen-CdJH7KEv.js";import{M as at}from"./map-pin-beMewgj3.js";import"./skeleton-Cu_ELY2G.js";import"./circle-check-DCQVH_py.js";const be=["Active","Inactive"],we=["Technology","Startup","Enterprise","Retail","Healthcare","Finance","Other"];function Nt({initialOpenDialog:Se,onDialogOpened:Fe,initialCustomerId:Z,onCustomerDialogOpened:ke}){const{isFavorite:Ae,getFavoritesByType:De}=Ns(),{user:ee}=Cs(),f=ee?Qs(ee.role):!1,me=ee?.role==="Admin"||ee?.role==="Owner",[K,Pe]=n.useState(""),[b,se]=n.useState("all"),[O,Te]=n.useState(!1),[u,Ie]=n.useState(!1),[q,j]=n.useState(null),[Ze,Ee]=n.useState(!0),[H,G]=n.useState(!1),[M,E]=n.useState(null),[ue,R]=n.useState(null),[t,c]=n.useState({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0}),he=bs(K,300);n.useEffect(()=>{(async()=>{Ee(!0);const s=await ws();j(s),Ee(!1)})()},[]),n.useEffect(()=>{Se&&!H&&(G(!0),Fe?.())},[Se,Fe,H]),n.useEffect(()=>{Z&&q&&q.find(a=>a.id===Z)&&(R(Z),ke?.())},[Z,q,ke]);const p=n.useMemo(()=>q??[],[q]),g=n.useMemo(()=>{const s=p.length,a=p.filter(x=>x.status==="Active").length,r=p.filter(x=>x.status==="Inactive").length,l=new Set(p.map(x=>x.category)).size,D=p.reduce((x,$)=>x+$.purchases,0),B=p.reduce((x,$)=>x+$.payments,0),re=p.reduce((x,$)=>x+$.balance,0);let Ve=null;if(p.length>0){const x=[...p].sort(($,ys)=>ys.purchases-$.purchases);x[0].purchases>0&&(Ve={id:x[0].id,name:x[0].name,value:x[0].purchases})}return{totalCustomers:s,activeCustomers:a,inactiveCustomers:r,uniqueCategories:l,totalPurchases:D,totalPayments:B,totalBalance:re,topCustomerByPurchases:Ve}},[p]),xe=n.useMemo(()=>p.filter(s=>{if(s.archived===!0!==u||O&&!Ae("customers",s.id)||b!=="all"&&s.status!==b)return!1;if(he){const r=he.toLowerCase();if(!(s.name.toLowerCase().includes(r)||s.id.toLowerCase().includes(r)||s.category.toLowerCase().includes(r)||s.contact.toLowerCase().includes(r)||s.email.toLowerCase().includes(r)))return!1}return!0}),[p,he,b,O,Ae,u]);function es(){Pe(""),se("all"),Te(!1),Ie(!1)}async function ss(s){try{const a=await Ks(s);j(r=>(r??[]).map(l=>l.id===s?a:l)),E(null),i.success("Customer archived successfully")}catch(a){i.error(a?.message||"Failed to archive customer")}}async function ts(s){try{const a=await $s(s);j(r=>(r??[]).map(l=>l.id===s?a:l)),E(null),i.success("Customer restored successfully")}catch(a){i.error(a?.message||"Failed to restore customer")}}async function as(s){try{await Us(s),j(a=>(a??[]).filter(r=>r.id!==s)),E(null),i.success("Customer permanently deleted")}catch(a){i.error(a?.message||"Failed to permanently delete customer")}}const L=s=>{switch(s){case"Active":return"✓";case"Inactive":return"○";default:return"○"}},te=s=>{switch(s){case"Active":return"bg-emerald-500/15 text-emerald-700 dark:text-emerald-400 border-emerald-200";case"Inactive":return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200";default:return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200"}},{sortedData:Le,sortConfig:w,requestSort:S,getSortDirection:F}=Xs(xe),{currentPage:Be,totalPages:rs,paginatedData:$e,goToPage:ls,totalItems:ns,itemsPerPage:is}=zs(Le,25),{selectedIds:y,selectedItems:Ue,selectionCount:ge,isAllSelected:cs,isAllPageSelected:ds,isAllPagesSelected:os,isPartiallySelected:ms,hasSelection:je,toggleItem:us,toggleAll:pe,selectAllPages:hs,deselectAll:h,isSelected:xs,totalItemCount:Ke,pageItemCount:Oe}=Vs($e,Le),[k,T]=n.useState(!1),[gs,Me]=n.useState(!1),[js,A]=n.useState(!1);n.useEffect(()=>{h()},[Be,h]),n.useEffect(()=>{const s=a=>{(a.metaKey||a.ctrlKey)&&a.key==="a"&&!H&&!M&&(a.preventDefault(),pe()),a.key==="Escape"&&je&&h()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[pe,h,je,H,M]);const ve=n.useCallback(async(s,a,r)=>{try{const l={[a]:r},D=await fe({id:s,...l});j(B=>(B??[]).map(re=>re.id===s?D:re)),i.success(`${a.charAt(0).toUpperCase()+a.slice(1)} updated`)}catch(l){throw i.error(l?.message||"Failed to update"),l}},[j]);n.useCallback(async()=>{T(!0);try{const s=Array.from(y),a=await qe(s);j(r=>r&&r.map(l=>s.includes(l.id)?{...l,archived:!0,archivedAt:new Date().toISOString()}:l)),a.failedCount>0?i.warning(`Deleted ${a.successCount} customers. ${a.failedCount} failed.`):i.success(`Successfully deleted ${a.successCount} customer${a.successCount!==1?"s":""}`),h()}catch(s){i.error(s?.message||"Failed to delete customers")}finally{T(!1),A(!1)}},[y,h]);const ps=n.useCallback(async()=>{T(!0);try{const s=Array.from(y),a=await qe(s);j(r=>r&&r.map(l=>s.includes(l.id)?{...l,archived:!0,archivedAt:new Date().toISOString()}:l)),a.failedCount>0?i.warning(`Archived ${a.successCount} customers. ${a.failedCount} failed.`):i.success(`Successfully archived ${a.successCount} customer${a.successCount!==1?"s":""}`),h()}catch(s){i.error(s?.message||"Failed to archive customers")}finally{T(!1),A(!1)}},[y,h]),vs=n.useCallback(async()=>{T(!0);try{const s=Array.from(y),a=await Ss(s);j(r=>r&&r.map(l=>s.includes(l.id)?{...l,archived:!1,archivedAt:void 0}:l)),a.failedCount>0?i.warning(`Restored ${a.successCount} customers. ${a.failedCount} failed.`):i.success(`Successfully restored ${a.successCount} customer${a.successCount!==1?"s":""}`),h()}catch(s){i.error(s?.message||"Failed to restore customers")}finally{T(!1),A(!1)}},[y,h]),Re=n.useCallback(async()=>{T(!0);try{const s=Array.from(y),a=await Fs(s);j(r=>r?.filter(l=>!s.includes(l.id))??[]),a.failedCount>0?i.warning(`Permanently deleted ${a.successCount} customers. ${a.failedCount} failed.`):i.success(`Permanently deleted ${a.successCount} customer${a.successCount!==1?"s":""}`),h()}catch(s){i.error(s?.message||"Failed to permanently delete customers")}finally{T(!1),A(!1)}},[y,h]),fs=n.useCallback(async s=>{Me(!0);try{const a=Array.from(y);let r=0,l=0;for(const D of a)try{await fe({id:D,status:s}),r++}catch{l++}j(D=>D&&D.map(B=>a.includes(B.id)?{...B,status:s}:B)),l>0?i.warning(`Updated ${r} customers. ${l} failed.`):i.success(`Successfully updated ${r} customer${r!==1?"s":""}`),h()}catch(a){i.error(a?.message||"Failed to update customers")}finally{Me(!1)}},[y,h]),ze=n.useCallback(s=>{c({id:s.id,name:s.name,contact:s.contact,email:s.email,phone:s.phone,category:s.category,status:s.status,country:s.country||"",city:s.city||"",address:s.address||"",purchases:s.purchases||0,payments:s.payments||0}),E(s.id)},[]),ae=n.useMemo(()=>Ue.map(s=>s.name),[Ue]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Customers"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage customer profiles, contact details, and sales relationships"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(N,{className:"relative overflow-hidden",children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"Total Customers"}),e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g.totalCustomers}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[g.activeCustomers," active, ",g.inactiveCustomers," inactive"]})]})]}),e.jsxs(N,{className:"relative overflow-hidden",children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"Active Customers"}),e.jsx(Zs,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:g.activeCustomers}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:g.totalCustomers>0?`${Math.round(g.activeCustomers/g.totalCustomers*100)}% of total`:"No customers yet"})]})]}),e.jsxs(N,{className:"relative overflow-hidden",children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"Total Purchases"}),e.jsx(ks,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["₱",g.totalPurchases.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:g.topCustomerByPurchases?`Top: ${g.topCustomerByPurchases.name}`:"No purchases yet"})]})]}),e.jsxs(N,{className:"relative overflow-hidden",children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"Categories"}),e.jsx(As,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:g.uniqueCategories}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Outstanding balance: ₱",g.totalBalance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]}),e.jsxs("div",{className:"grid gap-3 grid-cols-1 sm:grid-cols-2",children:[e.jsx(N,{className:I("cursor-pointer transition-all hover:shadow-md border-l-4",b==="Active"?"ring-2 ring-primary":"","border-l-emerald-400"),onClick:()=>se(b==="Active"?"all":"Active"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Active"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:g.activeCustomers})]}),e.jsx(U,{variant:"outline",className:te("Active"),children:L("Active")})]})})}),e.jsx(N,{className:I("cursor-pointer transition-all hover:shadow-md border-l-4",b==="Inactive"?"ring-2 ring-primary":"","border-l-slate-400"),onClick:()=>se(b==="Inactive"?"all":"Inactive"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Inactive"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:g.inactiveCustomers})]}),e.jsx(U,{variant:"outline",className:te("Inactive"),children:L("Inactive")})]})})})]}),e.jsxs(N,{children:[e.jsx(Y,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{className:"text-xl",children:"Customer Management"}),e.jsx(Ds,{className:"mt-1",children:"Manage your customer relationships and contacts"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(le,{open:H,onOpenChange:s=>{G(s),s||c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0})},children:[e.jsx(Ps,{asChild:!0,children:e.jsxs(o,{onClick:()=>c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0}),disabled:!f,title:f?void 0:"You don't have permission to add customers",children:[e.jsx(et,{className:"h-4 w-4 mr-2"}),"Add Customer"]})}),e.jsxs(ne,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ie,{children:[e.jsx(ce,{children:"Create New Customer"}),e.jsx(de,{children:"Enter the details for the new customer."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"customer-name",children:"Customer Name *"}),e.jsx(m,{id:"customer-name",placeholder:"Enter customer name",value:t.name,onChange:s=>c({...t,name:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"customer-status",children:"Status"}),e.jsxs(J,{value:t.status,onValueChange:s=>c({...t,status:s}),children:[e.jsx(W,{children:e.jsx(X,{placeholder:"Select status"})}),e.jsx(Q,{children:be.map(s=>e.jsx(z,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:L(s)}),s]})},s))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"contact-name",children:"Contact Person *"}),e.jsx(m,{id:"contact-name",placeholder:"Enter contact name",value:t.contact,onChange:s=>c({...t,contact:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"email",children:"Email *"}),e.jsx(m,{id:"email",type:"email",placeholder:"email@example.com",value:t.email,onChange:s=>c({...t,email:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"phone",children:"Phone *"}),e.jsx(m,{id:"phone",placeholder:"+1 (555) 000-0000",value:t.phone,onChange:s=>c({...t,phone:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"category",children:"Category *"}),e.jsxs(J,{value:t.category,onValueChange:s=>c({...t,category:s}),children:[e.jsx(W,{children:e.jsx(X,{placeholder:"Select category"})}),e.jsx(Q,{children:we.map(s=>e.jsx(z,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Location Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"country",children:"Country"}),e.jsx(m,{id:"country",placeholder:"e.g., United States",value:t.country,onChange:s=>c({...t,country:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"city",children:"City"}),e.jsx(m,{id:"city",placeholder:"e.g., San Francisco",value:t.city,onChange:s=>c({...t,city:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2 mt-4",children:[e.jsx(d,{htmlFor:"address",children:"Address"}),e.jsx(m,{id:"address",placeholder:"Full street address",value:t.address,onChange:s=>c({...t,address:s.target.value})})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Financial Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"purchases",children:"Total Purchases (₱)"}),e.jsx(m,{id:"purchases",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.purchases,onChange:s=>c({...t,purchases:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"payments",children:"Total Payments (₱)"}),e.jsx(m,{id:"payments",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.payments,onChange:s=>c({...t,payments:parseFloat(s.target.value)||0})})]})]})]})]}),e.jsxs(Ne,{children:[e.jsx(o,{variant:"outline",onClick:()=>G(!1),children:"Cancel"}),e.jsx(o,{onClick:async()=>{if(!t.name.trim()||!t.contact.trim()||!t.email.trim()||!t.phone.trim()||!t.category.trim()){i.error("Please fill all required fields");return}try{const s=await Ts({name:t.name,contact:t.contact,email:t.email,phone:t.phone,category:t.category,status:t.status,country:t.country,city:t.city,address:t.address,purchases:t.purchases,payments:t.payments});j(a=>[s,...a??[]]),G(!1),i.success("Customer added successfully"),c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0})}catch(s){i.error(s?.message||"Failed to add customer")}},children:"Create Customer"})]})]})]})})]})}),e.jsxs(C,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(m,{placeholder:"Search customers by name, contact, email...",value:K,onChange:s=>Pe(s.target.value),className:"pl-9"})]}),e.jsxs(J,{value:b,onValueChange:se,children:[e.jsxs(W,{className:"w-full sm:w-[180px]",children:[e.jsx(qs,{className:"h-4 w-4 mr-2"}),e.jsx(X,{placeholder:"Filter by status"})]}),e.jsxs(Q,{children:[e.jsx(z,{value:"all",children:"All Statuses"}),be.map(s=>e.jsx(z,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:L(s)}),s]})},s))]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(o,{variant:O?"default":"outline",size:"sm",onClick:()=>Te(!O),className:"gap-1",children:[e.jsx(Ws,{className:I("h-4 w-4",O&&"fill-current")}),"Favorites",De("customers").length>0&&e.jsx(U,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:De("customers").length})]}),e.jsxs(o,{variant:u?"default":"outline",size:"sm",onClick:()=>Ie(!u),className:u?"bg-orange-500 hover:bg-orange-600 text-white":"",children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),u?"Viewing Archived":"View Archived"]}),(K||b!=="all"||O||u)&&e.jsxs(o,{variant:"ghost",size:"sm",onClick:es,className:"gap-1 text-muted-foreground hover:text-foreground",children:[e.jsx(Es,{className:"h-4 w-4"}),"Clear All Filters"]})]})]}),je&&f&&e.jsx(Hs,{selectionCount:ge,onClearSelection:h,isLoading:k||gs,actions:u?[{id:"restore",label:"Restore",icon:e.jsx(We,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:vs},...me?[{id:"permanent-delete",label:"Permanently Delete",icon:e.jsx(oe,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>A(!0)}]:[]]:[{id:"archive",label:"Archive",icon:e.jsx(V,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:()=>A(!0)}],actionGroups:u?[]:[{id:"status-update",label:"Update Status",icon:e.jsx(Ls,{className:"h-4 w-4 mr-1"}),options:[{value:"Active",label:"Active"},{value:"Inactive",label:"Inactive"}],onSelect:s=>fs(s)}],className:"mb-4"}),e.jsx(le,{open:js,onOpenChange:A,children:e.jsxs(ne,{className:"max-w-md",children:[e.jsxs(ie,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"h-5 w-5 text-destructive"}),"Delete ",ge," Customer",ge!==1?"s":""]}),e.jsx(de,{children:u?"These customers are already archived. This action will permanently remove them from the system.":"Choose how you want to delete the selected customers:"})]}),ae.length>0&&e.jsx("div",{className:"max-h-32 overflow-y-auto border rounded-md p-2 bg-muted/50",children:e.jsxs("ul",{className:"text-sm space-y-1",children:[ae.slice(0,10).map((s,a)=>e.jsxs("li",{className:"truncate",children:["• ",s]},a)),ae.length>10&&e.jsxs("li",{className:"text-muted-foreground",children:["...and ",ae.length-10," more"]})]})}),u?e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("div",{className:"p-3 border border-destructive/50 rounded-md bg-destructive/10",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(oe,{className:"h-4 w-4 mt-0.5 text-destructive"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-destructive",children:"Permanent Deletion"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This cannot be undone. All data will be permanently removed."})]})]})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(o,{variant:"outline",onClick:()=>A(!1),disabled:k,children:"Cancel"}),e.jsx(o,{variant:"destructive",onClick:Re,disabled:k,children:k?"Deleting...":"Permanently Delete All"})]})]}):e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("div",{className:"p-3 border rounded-md hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(V,{className:"h-4 w-4 mt-0.5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Archive"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Move to archive. Customers can be restored later."})]}),e.jsx(o,{variant:"secondary",size:"sm",onClick:ps,disabled:k,children:k?"...":"Archive"})]})}),me&&e.jsx("div",{className:"p-3 border border-destructive/50 rounded-md bg-destructive/10",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(oe,{className:"h-4 w-4 mt-0.5 text-destructive"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-destructive",children:"Delete Permanently"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cannot be undone. Data will be permanently removed."})]}),e.jsx(o,{variant:"destructive",size:"sm",onClick:Re,disabled:k,children:k?"...":"Delete"})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(o,{variant:"outline",onClick:()=>A(!1),disabled:k,children:"Cancel"})})]})]})}),Ze?e.jsx(Gs,{rows:8}):xe.length===0?e.jsx(Ys,{icon:u?V:ye,title:u?"No archived customers":"No customers found",description:u?"Archived customers will appear here":K?"Try adjusting your search criteria":"Get started by adding your first customer",actionLabel:!u&&!K?"Add Customer":void 0,onAction:!u&&!K?()=>G(!0):void 0}):e.jsxs("div",{className:"rounded-md border overflow-hidden",children:[e.jsx(_s,{pageItemCount:Oe,totalItemCount:Ke,isAllPagesSelected:os,show:ds&&Ke>Oe,onSelectAllPages:hs,onClearSelection:h,itemLabel:"customers"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Os,{children:[e.jsx(Ms,{children:e.jsxs(Ye,{children:[e.jsx(_e,{className:"w-12",children:e.jsx(He,{checked:cs,ref:s=>{s&&(s.indeterminate=ms)},onCheckedChange:pe,"aria-label":"Select all customers"})}),e.jsx(P,{sortKey:"id",currentSortKey:w.key,sortDirection:F("id"),onSort:s=>S(s),children:"Customer ID"}),e.jsx(P,{sortKey:"name",currentSortKey:w.key,sortDirection:F("name"),onSort:s=>S(s),children:"Customer Name"}),e.jsx(P,{sortKey:"contact",currentSortKey:w.key,sortDirection:F("contact"),onSort:s=>S(s),children:"Contact"}),e.jsx(P,{sortKey:"category",currentSortKey:w.key,sortDirection:F("category"),onSort:s=>S(s),children:"Category"}),e.jsx(P,{sortKey:"status",currentSortKey:w.key,sortDirection:F("status"),onSort:s=>S(s),children:"Status"}),e.jsx(P,{sortKey:"country",currentSortKey:w.key,sortDirection:F("country"),onSort:s=>S(s),children:"Location"}),e.jsx(P,{sortKey:"purchases",currentSortKey:w.key,sortDirection:F("purchases"),onSort:s=>S(s),children:"Purchases"}),e.jsx(P,{sortKey:"payments",currentSortKey:w.key,sortDirection:F("payments"),onSort:s=>S(s),children:"Payments"}),e.jsx(P,{sortKey:"balance",currentSortKey:w.key,sortDirection:F("balance"),onSort:s=>S(s),children:"Balance"}),e.jsx(_e,{children:"Actions"})]})}),e.jsx(Rs,{children:$e.map(s=>{const a=xs(s.id);return e.jsxs(Ye,{className:I("hover:bg-muted/50 transition-colors",a&&"bg-muted/50"),children:[e.jsx(v,{children:e.jsx(He,{checked:a,onCheckedChange:()=>us(s.id),"aria-label":`Select customer ${s.name}`})}),e.jsx(v,{className:"font-mono text-sm",children:s.id}),e.jsx(v,{children:e.jsx("button",{className:"text-left font-medium text-primary hover:underline cursor-pointer bg-transparent border-none p-0",onClick:()=>R(s.id),children:s.name})}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Ge,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(Ce,{value:s.email,type:"text",onSave:r=>ve(s.id,"email",r),disabled:!f,className:"text-xs text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Xe,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(Ce,{value:s.phone,type:"text",onSave:r=>ve(s.id,"phone",r),disabled:!f,className:"text-xs text-muted-foreground"})]})]})}),e.jsx(v,{children:e.jsx(Ce,{value:s.category,type:"select",options:we.map(r=>({value:r,label:r})),onSave:r=>ve(s.id,"category",r),disabled:!f})}),e.jsx(v,{children:e.jsxs(U,{variant:"outline",className:I("gap-1",te(s.status)),children:[e.jsx("span",{children:L(s.status)}),s.status]})}),e.jsx(v,{children:e.jsx("div",{className:"text-sm",children:s.city&&s.country?e.jsxs("span",{children:[s.city,", ",s.country]}):s.city||s.country?e.jsx("span",{children:s.city||s.country}):e.jsx("span",{className:"text-muted-foreground",children:"—"})})}),e.jsxs(v,{className:"text-right font-medium",children:["₱",s.purchases.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(v,{className:"text-right font-medium",children:["₱",s.payments.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(v,{className:I("text-right font-medium",s.balance>0?"text-amber-600":s.balance<0?"text-emerald-600":""),children:["₱",s.balance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx(v,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Je,{entityType:"customers",entityId:s.id,entityName:s.name}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>R(s.id),children:e.jsx(Bs,{className:"h-4 w-4"})}),u?e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>ts(s.id),disabled:!f,title:"Restore customer",children:e.jsx(We,{className:"h-4 w-4"})}),me&&e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>as(s.id),title:"Permanently delete",children:e.jsx(oe,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>ze(s),disabled:!f,title:"Edit customer",children:e.jsx(Qe,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>ss(s.id),disabled:!f,title:"Archive customer",children:e.jsx(V,{className:"h-4 w-4"})})]})]})})]},s.id)})})]})})]}),xe.length>0&&e.jsx(Js,{currentPage:Be,totalPages:rs,totalItems:ns,itemsPerPage:is,onPageChange:ls,className:"mt-4"})]})]}),M&&e.jsx(le,{open:!!M,onOpenChange:s=>{s||E(null)},children:e.jsxs(ne,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ie,{children:[e.jsx(ce,{children:"Edit Customer"}),e.jsx(de,{children:"Update the customer details."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-customer-name",children:"Customer Name *"}),e.jsx(m,{id:"edit-customer-name",placeholder:"Enter customer name",value:t.name,onChange:s=>c({...t,name:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-customer-status",children:"Status"}),e.jsxs(J,{value:t.status,onValueChange:s=>c({...t,status:s}),children:[e.jsx(W,{children:e.jsx(X,{placeholder:"Select status"})}),e.jsx(Q,{children:be.map(s=>e.jsx(z,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:L(s)}),s]})},s))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-contact-name",children:"Contact Person *"}),e.jsx(m,{id:"edit-contact-name",placeholder:"Enter contact name",value:t.contact,onChange:s=>c({...t,contact:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-email",children:"Email *"}),e.jsx(m,{id:"edit-email",type:"email",placeholder:"email@example.com",value:t.email,onChange:s=>c({...t,email:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-phone",children:"Phone *"}),e.jsx(m,{id:"edit-phone",placeholder:"+1 (555) 000-0000",value:t.phone,onChange:s=>c({...t,phone:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-category",children:"Category *"}),e.jsxs(J,{value:t.category,onValueChange:s=>c({...t,category:s}),children:[e.jsx(W,{children:e.jsx(X,{placeholder:"Select category"})}),e.jsx(Q,{children:we.map(s=>e.jsx(z,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Location Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-country",children:"Country"}),e.jsx(m,{id:"edit-country",placeholder:"e.g., United States",value:t.country,onChange:s=>c({...t,country:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-city",children:"City"}),e.jsx(m,{id:"edit-city",placeholder:"e.g., San Francisco",value:t.city,onChange:s=>c({...t,city:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2 mt-4",children:[e.jsx(d,{htmlFor:"edit-address",children:"Address"}),e.jsx(m,{id:"edit-address",placeholder:"Full street address",value:t.address,onChange:s=>c({...t,address:s.target.value})})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Financial Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-purchases",children:"Total Purchases (₱)"}),e.jsx(m,{id:"edit-purchases",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.purchases,onChange:s=>c({...t,purchases:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-payments",children:"Total Payments (₱)"}),e.jsx(m,{id:"edit-payments",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.payments,onChange:s=>c({...t,payments:parseFloat(s.target.value)||0})})]})]})]})]}),e.jsxs(Ne,{children:[e.jsx(o,{variant:"outline",onClick:()=>E(null),children:"Cancel"}),e.jsx(o,{onClick:async()=>{if(!t.name.trim()||!t.contact.trim()||!t.email.trim()||!t.phone.trim()||!t.category.trim()){i.error("Please fill all required fields");return}try{const s=await fe({id:M,name:t.name,contact:t.contact,email:t.email,phone:t.phone,category:t.category,status:t.status,country:t.country,city:t.city,address:t.address,purchases:t.purchases,payments:t.payments});j(a=>(a??[]).map(r=>r.id===M?s:r)),E(null),i.success("Customer updated successfully")}catch(s){i.error(s?.message||"Failed to update customer")}},children:"Save Changes"})]})]})}),ue&&(()=>{const s=p.find(a=>a.id===ue);return s?e.jsx(le,{open:!!ue,onOpenChange:a=>{a||R(null)},children:e.jsxs(ne,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsx(ie,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ce,{className:"text-xl",children:s.name}),e.jsxs(de,{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"font-mono",children:s.id}),e.jsxs(U,{variant:"outline",className:I("gap-1",te(s.status)),children:[e.jsx("span",{children:L(s.status)}),s.status]}),s.archived&&e.jsxs(U,{variant:"outline",className:"bg-orange-500/15 text-orange-700 dark:text-orange-400 border-orange-200",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),"Archived"]})]})]}),e.jsx(Je,{entityType:"customers",entityId:s.id,entityName:s.name})]})}),e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"Contact Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Contact Person"}),e.jsx("p",{className:"font-medium",children:s.contact})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Category"}),e.jsx(U,{variant:"secondary",children:s.category})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(Ge,{className:"h-3 w-3 text-muted-foreground"}),s.email]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Phone"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(Xe,{className:"h-3 w-3 text-muted-foreground"}),s.phone]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(at,{className:"h-4 w-4"}),"Location"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"City / Country"}),e.jsx("p",{className:"font-medium",children:s.city&&s.country?`${s.city}, ${s.country}`:s.city||s.country||"—"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Address"}),e.jsx("p",{className:"font-medium",children:s.address||"—"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(st,{className:"h-4 w-4"}),"Financial Summary"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(N,{children:e.jsxs(C,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Purchases"}),e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:["₱",s.purchases.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})}),e.jsx(N,{children:e.jsxs(C,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Payments"}),e.jsxs("p",{className:"text-lg font-bold text-emerald-600",children:["₱",s.payments.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})}),e.jsx(N,{children:e.jsxs(C,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Balance"}),e.jsxs("p",{className:I("text-lg font-bold",s.balance>0?"text-amber-600":s.balance<0?"text-emerald-600":""),children:["₱",s.balance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})})]})]})]}),e.jsxs(Ne,{children:[e.jsx(o,{variant:"outline",onClick:()=>R(null),children:"Close"}),!s.archived&&f&&e.jsxs(o,{onClick:()=>{R(null),ze(s)},children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),"Edit Customer"]})]})]})}):null})()]})}export{Nt as CustomersView};
