import{c as E,i as ve,r,H as fe,j as e,C as D,m as A,bd as V,n as U,s as q,t as c,X as L,o as _,B as l,al as B,Z as X,U as we,_ as Ne,I as ke,D as $,v as Y,w as Z,x as G,y as J,L as Q,z as W,K as d,a6 as be}from"./index-GdM7wS9P.js";import{S as O,a as T,b as I,c as R,d as o,e as Se,f as Ce,g as K,i as p,h as De,j as Ae,k as x,T as Ue}from"./sortable-table-head-BSMiX9Sz.js";import{a as Le,i as Oe,b as v}from"./permissions-BqDqHH54.js";import{u as Te}from"./useTableSort-ph7jL57c.js";import{C as Ie}from"./crown-DIsO_F2Y.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],Ke=E("user-check",Re);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]],ee=E("user-cog",Ee);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Pe=E("user-x",Fe);function Be(){const{user:t,getAllUsers:F,getPendingUsers:ze,approveUser:se,rejectUser:te,updateUserRole:ae,updateUserStatus:re,deleteUser:le}=ve(),[m,ne]=r.useState([]),[P,ce]=r.useState(""),[f,ie]=r.useState("all"),[n,w]=r.useState(null),[de,N]=r.useState(!1),[oe,k]=r.useState(!1),[i,S]=r.useState({role:"Operator",status:"Active"}),C=fe(P,300);r.useEffect(()=>{const s=()=>{const y=F();ne(y.map(h=>({id:h.id,email:h.email,name:h.name,role:h.role,status:h.status,createdAt:h.createdAt,lastLogin:h.lastLogin})))};s();const a=setInterval(s,2e3);return()=>clearInterval(a)},[F]);const xe=r.useMemo(()=>{let s=m;if(C){const a=C.toLowerCase();s=s.filter(y=>y.name.toLowerCase().includes(a)||y.email.toLowerCase().includes(a)||y.id.toLowerCase().includes(a))}return f!=="all"&&(s=s.filter(a=>a.status===f)),s},[m,C,f]),{sortedData:z,sortConfig:j,requestSort:u,getSortDirection:g}=Te(xe),b=r.useMemo(()=>m.filter(s=>s.status==="Pending").length,[m]),he=s=>{w(s),S({role:s.role,status:s.status}),N(!0)},me=s=>{w(s),k(!0)},H=s=>{try{se(s),d.success("User approved successfully")}catch(a){d.error(a?.message||"Failed to approve user")}},M=s=>{try{te(s),d.success("User rejected and removed")}catch(a){d.error(a?.message||"Failed to reject user")}},je=()=>{if(n)try{i.role!==n.role&&ae(n.id,i.role),i.status!==n.status&&re(n.id,i.status),d.success("User updated successfully"),N(!1),w(null)}catch(s){d.error(s?.message||"Failed to update user")}},ue=()=>{if(n)try{le(n.id),d.success("User deleted successfully"),k(!1),w(null)}catch(s){d.error(s?.message||"Failed to delete user")}},ge=s=>{switch(s){case"Active":return e.jsxs(c,{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(Ke,{className:"h-3 w-3 mr-1"}),"Active"]});case"Pending":return e.jsxs(c,{className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),"Pending"]});case"Inactive":return e.jsxs(c,{className:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200",children:[e.jsx(Pe,{className:"h-3 w-3 mr-1"}),"Inactive"]})}},pe=s=>{switch(s){case"Owner":return e.jsxs(c,{className:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",children:[e.jsx(Ie,{className:"h-3 w-3 mr-1"}),"Owner"]});case"Admin":return e.jsxs(c,{variant:"default",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),"Admin"]});case"Operator":return e.jsxs(c,{variant:"secondary",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),"Operator"]});case"Viewer":return e.jsxs(c,{variant:"outline",children:[e.jsx(be,{className:"h-3 w-3 mr-1"}),"Viewer"]})}},ye=t?Le(t.role):[];return!t||!Oe(t.role)?e.jsx("div",{className:"flex items-center justify-center h-full min-h-[400px]",children:e.jsx(D,{className:"max-w-md w-full mx-4",children:e.jsxs(A,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-12 w-12 rounded-full bg-destructive/10 flex items-center justify-center",children:e.jsx(V,{className:"h-6 w-6 text-destructive"})}),e.jsx(U,{className:"text-destructive",children:"Access Denied"}),e.jsx(q,{children:"You do not have permission to access user management."})]})})}):e.jsxs("div",{className:"space-y-6 px-4 sm:px-0",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"User Management"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Manage user accounts, roles, and permissions"})]}),b>0&&e.jsxs(c,{variant:"destructive",className:"text-sm px-3 py-1.5 gap-1.5 self-start md:self-auto animate-pulse",children:[e.jsx(L,{className:"h-3.5 w-3.5"}),b," pending approval",b!==1?"s":""]})]}),b>0&&e.jsxs(D,{className:"border-yellow-200 bg-yellow-50 dark:border-yellow-800 dark:bg-yellow-950/30",children:[e.jsxs(A,{className:"pb-3",children:[e.jsxs(U,{className:"text-lg flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5 text-yellow-600"}),"Pending Approvals"]}),e.jsx(q,{children:"New user registrations awaiting your approval"})]}),e.jsx(_,{children:e.jsx("div",{className:"space-y-3",children:m.filter(s=>s.status==="Pending").map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-gray-900 rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Registered: ",new Date(s.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{size:"sm",variant:"outline",className:"text-green-600 hover:bg-green-50",onClick:()=>H(s.id),children:[e.jsx(B,{className:"h-4 w-4 mr-1"})," Approve"]}),e.jsxs(l,{size:"sm",variant:"outline",className:"text-red-600 hover:bg-red-50",onClick:()=>M(s.id),children:[e.jsx(X,{className:"h-4 w-4 mr-1"})," Reject"]})]})]},s.id))})})]}),e.jsxs(D,{children:[e.jsx(A,{children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5"}),e.jsx(U,{children:"All Users"}),e.jsx(c,{variant:"secondary",children:m.length})]}),e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(ke,{placeholder:"Search users...",value:P,onChange:s=>ce(s.target.value),className:"pl-9 w-full md:w-64"})]}),e.jsxs(O,{value:f,onValueChange:s=>ie(s),children:[e.jsx(T,{className:"w-full md:w-40",children:e.jsx(I,{placeholder:"Filter by status"})}),e.jsxs(R,{children:[e.jsx(o,{value:"all",children:"All Status"}),e.jsx(o,{value:"Active",children:"Active"}),e.jsx(o,{value:"Pending",children:"Pending"}),e.jsx(o,{value:"Inactive",children:"Inactive"})]})]})]})]})}),e.jsx(_,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(Se,{children:[e.jsx(Ce,{children:e.jsxs(K,{children:[e.jsx(p,{sortKey:"name",currentSortKey:j.key,sortDirection:g("name"),onSort:s=>u(s),children:"Name"}),e.jsx(p,{sortKey:"email",currentSortKey:j.key,sortDirection:g("email"),onSort:s=>u(s),children:"Email"}),e.jsx(p,{sortKey:"role",currentSortKey:j.key,sortDirection:g("role"),onSort:s=>u(s),children:"Role"}),e.jsx(p,{sortKey:"status",currentSortKey:j.key,sortDirection:g("status"),onSort:s=>u(s),children:"Status"}),e.jsx(p,{sortKey:"createdAt",currentSortKey:j.key,sortDirection:g("createdAt"),onSort:s=>u(s),children:"Created"}),e.jsx(p,{sortKey:"lastLogin",currentSortKey:j.key,sortDirection:g("lastLogin"),onSort:s=>u(s),children:"Last Login"}),e.jsx(De,{children:"Actions"})]})}),e.jsx(Ae,{children:z.length===0?e.jsx(K,{children:e.jsx(x,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No users found"})}):z.map(s=>e.jsxs(K,{children:[e.jsx(x,{className:"font-medium",children:s.name}),e.jsx(x,{children:s.email}),e.jsx(x,{children:pe(s.role)}),e.jsx(x,{children:ge(s.status)}),e.jsx(x,{children:new Date(s.createdAt).toLocaleDateString()}),e.jsx(x,{children:s.lastLogin?new Date(s.lastLogin).toLocaleDateString():"Never"}),e.jsx(x,{children:e.jsxs("div",{className:"flex gap-1",children:[s.status==="Pending"&&v(t.role,s.role)&&e.jsxs(e.Fragment,{children:[e.jsx(l,{size:"sm",variant:"ghost",className:"text-green-600",onClick:()=>H(s.id),title:"Approve",children:e.jsx(B,{className:"h-4 w-4"})}),e.jsx(l,{size:"sm",variant:"ghost",className:"text-red-600",onClick:()=>M(s.id),title:"Reject",children:e.jsx(X,{className:"h-4 w-4"})})]}),e.jsx(l,{size:"sm",variant:"ghost",onClick:()=>he(s),title:v(t.role,s.role)?"Edit":"Cannot edit users with equal or higher role",disabled:s.id===t?.id||!v(t.role,s.role),children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx(l,{size:"sm",variant:"ghost",className:"text-red-600",onClick:()=>me(s),title:v(t.role,s.role)?"Delete":"Cannot delete users with equal or higher role",disabled:s.id===t?.id||!v(t.role,s.role),children:e.jsx(Ue,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]}),e.jsx($,{open:de,onOpenChange:N,children:e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsx(G,{children:"Edit User"}),e.jsxs(J,{children:["Update role and status for ",n?.name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Role"}),e.jsxs(O,{value:i.role,onValueChange:s=>S({...i,role:s}),children:[e.jsx(T,{children:e.jsx(I,{})}),e.jsx(R,{children:ye.map(s=>e.jsxs(o,{value:s,children:[s==="Owner"&&"Owner - Full system access",s==="Admin"&&"Admin - Full access (except admin management)",s==="Operator"&&"Operator - Read-only access",s==="Viewer"&&"Viewer - Read-only access"]},s))})]}),t.role==="Admin"&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Note: Only the Owner can assign Admin or Owner roles."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Status"}),e.jsxs(O,{value:i.status,onValueChange:s=>S({...i,status:s}),children:[e.jsx(T,{children:e.jsx(I,{})}),e.jsxs(R,{children:[e.jsx(o,{value:"Active",children:"Active"}),e.jsx(o,{value:"Pending",children:"Pending"}),e.jsx(o,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsxs(W,{children:[e.jsx(l,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(l,{onClick:je,children:"Save Changes"})]})]})}),e.jsx($,{open:oe,onOpenChange:k,children:e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsx(G,{children:"Delete User"}),e.jsxs(J,{children:["Are you sure you want to delete ",n?.name,"? This action cannot be undone."]})]}),e.jsxs(W,{children:[e.jsx(l,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsx(l,{variant:"destructive",onClick:ue,children:"Delete User"})]})]})})]})}export{Be as UserManagementView};
