import{c as He,F as Me,i as Ue,r as i,G as qe,aj as Re,ak as ze,H as n,al as Ge,j as e,C as k,m as T,n as I,o as F,P as Ye,D as de,N as ce,B as S,v as oe,w as ue,x as he,y as me,L as u,I as o,O as _e,d as xe,t as q,X as Qe,a1 as Ve,p as We,Q as fe,am as Xe,an as Je,ao as Ze}from"./index-EEaLzckF.js";import{T as es,e as ss,f as ts,g as ge,h as je,i as C,j as as,k as x}from"./sortable-table-head-mkeNVhjR.js";import{u as rs,a as is,P as ns,B as ls,b as ds,T as cs,E as os,c as us}from"./bulk-delete-dialog-CdlBWRxS.js";import{D as hs}from"./date-range-filter-CDZObYSt.js";import{S as ms,F as xs}from"./save-search-dialog-IYAfNbGp.js";import{u as fs}from"./useTableSort-w_Pq1uE_.js";import{c as gs}from"./permissions-DQj5XdsG.js";import{S as js}from"./star-CX957Px9.js";import"./calendar-B6Hi1kNL.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],ys=He("map-pin",ps);function Is({initialOpenDialog:R,onDialogOpened:z}){const{isFavorite:G,getFavoritesByType:Y}=Me(),{user:_}=Ue(),D=_?gs(_.role):!1,[g,Q]=i.useState(""),[l,A]=i.useState(""),[d,P]=i.useState(""),[f,V]=i.useState(!1),[W,j]=i.useState(null),[pe,X]=i.useState(!0),[N,b]=i.useState(!1),[E,B]=i.useState(null),[a,c]=i.useState({id:"",orderId:"",destination:"",carrier:"",status:"Pending",eta:""}),L=qe(g,300);i.useEffect(()=>{(async()=>{X(!0);const s=await Re();j(s),X(!1)})()},[]),i.useEffect(()=>{R&&!N&&(b(!0),z?.())},[R,z,N]);const J=i.useMemo(()=>W??[],[W]),O=i.useMemo(()=>J.filter(s=>{if(f&&!G("shipments",s.id))return!1;if(L){const t=L.toLowerCase();if(!(s.id.toLowerCase().includes(t)||s.orderId.toLowerCase().includes(t)||s.destination.toLowerCase().includes(t)))return!1}if(l||d)try{const t=new Date(s.eta);if(l){const r=new Date(l);if(t<r)return!1}if(d){const r=new Date(d);if(r.setHours(23,59,59,999),t>r)return!1}}catch{return!1}return!0}),[J,L,l,d,f,G]),ye=i.useCallback(s=>{s.searchTerm&&Q(s.searchTerm),s.filters.fromDate&&typeof s.filters.fromDate=="string"&&A(s.filters.fromDate),s.filters.toDate&&typeof s.filters.toDate=="string"&&P(s.filters.toDate),s.filters.favoritesOnly==="true"&&V(!0)},[]),ve=i.useMemo(()=>{const s={};return l&&(s.fromDate=l),d&&(s.toDate=d),f&&(s.favoritesOnly="true"),s},[l,d,f]),{sortedData:Se,sortConfig:p,requestSort:y,getSortDirection:v}=fs(O),{currentPage:Z,totalPages:Ce,paginatedData:ee,goToPage:De,totalItems:Ne,itemsPerPage:be}=rs(Se,25),{selectedIds:w,selectedItems:se,selectionCount:te,isAllSelected:we,isPartiallySelected:ke,hasSelection:K,toggleItem:Te,toggleAll:$,deselectAll:h,isSelected:Ie}=is(ee),[ae,re]=i.useState(!1),[Fe,ie]=i.useState(!1),[Ae,H]=i.useState(!1);i.useEffect(()=>{h()},[Z,h]),i.useEffect(()=>{const s=t=>{(t.metaKey||t.ctrlKey)&&t.key==="a"&&!N&&!E&&(t.preventDefault(),$()),t.key==="Escape"&&K&&h()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[$,h,K,N,E]);function M(){c({id:"",orderId:"",destination:"",carrier:"",status:"Pending",eta:""})}function ne(){A(""),P("")}function le(){return a.orderId.trim()?a.destination.trim()?a.carrier.trim()?a.eta.trim()?null:"ETA is required":"Carrier is required":"Destination is required":"Order ID is required"}async function Pe(){const s=le();if(s){n.error(s);return}try{const t=await Xe({orderId:a.orderId,destination:a.destination,carrier:a.carrier,status:a.status,eta:a.eta});j(r=>[t,...r??[]]),b(!1),M(),n.success("Shipment created successfully")}catch(t){n.error(t?.message||"Failed to create shipment")}}async function Ee(){const s=le();if(s){n.error(s);return}if(!a.id){n.error("Missing shipment id");return}try{const t=await Je({id:a.id,orderId:a.orderId,destination:a.destination,carrier:a.carrier,status:a.status,eta:a.eta});j(r=>(r??[]).map(m=>m.id===t.id?t:m)),B(null),n.success("Shipment updated successfully")}catch(t){n.error(t?.message||"Failed to update shipment")}}async function Be(s){try{await Ze(s),j(t=>(t??[]).filter(r=>r.id!==s)),B(null),n.success("Shipment deleted successfully")}catch(t){n.error(t?.message||"Failed to delete shipment")}}const Le=s=>{switch(s){case"Delivered":return"bg-green-500/10 text-green-700";case"In Transit":return"bg-blue-500/10 text-blue-700";case"Processing":return"bg-orange-500/10 text-orange-700";case"Pending":return"bg-gray-500/10 text-gray-700";default:return"bg-gray-500/10 text-gray-700"}},Oe=i.useCallback(async()=>{re(!0);try{const s=Array.from(w),t=await ze(s);j(r=>r?.filter(m=>!s.includes(m.id))??[]),t.failedCount>0?n.warning(`Deleted ${t.successCount} shipments. ${t.failedCount} failed.`):n.success(`Successfully deleted ${t.successCount} shipment${t.successCount!==1?"s":""}`),h()}catch(s){n.error(s?.message||"Failed to delete shipments")}finally{re(!1),H(!1)}},[w,h]),Ke=i.useCallback(async s=>{ie(!0);try{const t=Array.from(w),r=await Ge(t,s);j(m=>m&&m.map(U=>t.includes(U.id)?{...U,status:s}:U)),r.failedCount>0?n.warning(`Updated ${r.successCount} shipments. ${r.failedCount} failed.`):n.success(`Successfully updated ${r.successCount} shipment${r.successCount!==1?"s":""}`),h()}catch(t){n.error(t?.message||"Failed to update shipments")}finally{ie(!1)}},[w,h]),$e=i.useMemo(()=>se.map(s=>`${s.id} â†’ ${s.destination}`),[se]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(k,{children:[e.jsx(T,{className:"pb-2",children:e.jsx(I,{className:"text-sm text-muted-foreground",children:"Active Shipments"})}),e.jsx(F,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-5 w-5 text-blue-600"}),e.jsx("div",{className:"text-2xl",children:"89"})]})})]}),e.jsxs(k,{children:[e.jsx(T,{className:"pb-2",children:e.jsx(I,{className:"text-sm text-muted-foreground",children:"In Transit"})}),e.jsx(F,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-5 w-5 text-orange-600"}),e.jsx("div",{className:"text-2xl",children:"67"})]})})]}),e.jsxs(k,{children:[e.jsx(T,{className:"pb-2",children:e.jsx(I,{className:"text-sm text-muted-foreground",children:"On-Time Rate"})}),e.jsx(F,{children:e.jsx("div",{className:"text-2xl",children:"94%"})})]})]}),e.jsxs(k,{children:[e.jsx(T,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(I,{children:"Shipment Tracking"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(de,{open:N,onOpenChange:s=>{b(s),s||M()},children:[e.jsx(ce,{asChild:!0,children:e.jsxs(S,{onClick:()=>M(),disabled:!D,title:D?void 0:"You don't have permission to add shipments",children:[e.jsx(ns,{className:"h-4 w-4 mr-2"}),"Add Shipment"]})}),e.jsxs(oe,{children:[e.jsxs(ue,{children:[e.jsx(he,{children:"Add New Shipment"}),e.jsx(me,{children:"Enter the details for the new shipment."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"orderId",children:"Order ID"}),e.jsx(o,{id:"orderId",placeholder:"ORD-0001",value:a.orderId,onChange:s=>c({...a,orderId:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"destination",children:"Destination"}),e.jsx(o,{id:"destination",placeholder:"City, ST",value:a.destination,onChange:s=>c({...a,destination:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"carrier",children:"Carrier"}),e.jsx(o,{id:"carrier",placeholder:"FedEx/UPS/DHL",value:a.carrier,onChange:s=>c({...a,carrier:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"status",children:"Status"}),e.jsx(o,{id:"status",placeholder:"Pending",value:a.status,onChange:s=>c({...a,status:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"eta",children:"ETA"}),e.jsx(o,{id:"eta",placeholder:"Oct 20, 2025",value:a.eta,onChange:s=>c({...a,eta:s.target.value})})]}),e.jsx(S,{className:"w-full",onClick:Pe,children:"Add Shipment"})]})]})]})})]})}),e.jsxs(F,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(o,{placeholder:"Search shipments...",value:g,onChange:s=>Q(s.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx(hs,{fromDate:l,toDate:d,onFromDateChange:A,onToDateChange:P,onClear:ne,label:"Filter by ETA Date"}),e.jsxs(S,{variant:f?"default":"outline",size:"sm",onClick:()=>V(!f),className:"gap-1",children:[e.jsx(js,{className:xe("h-4 w-4",f&&"fill-current")}),"Favorites",Y("shipments").length>0&&e.jsx(q,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:Y("shipments").length})]}),e.jsx(ms,{entityType:"shipments",currentSearchTerm:g,currentFilters:ve,onApplySearch:ye})]}),(l||d)&&e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(q,{variant:"secondary",className:"gap-1",children:["ETA: ",l||"..."," to ",d||"...",e.jsx("button",{onClick:ne,className:"ml-1 hover:bg-secondary-foreground/20 rounded-full p-0.5",children:e.jsx(Qe,{className:"h-3 w-3"})})]})})]}),K&&D&&e.jsx(ls,{selectionCount:te,onClearSelection:h,isLoading:ae||Fe,actions:[{id:"delete",label:"Delete",icon:e.jsx(es,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>H(!0)}],actionGroups:[{id:"status-update",label:"Update Status",icon:e.jsx(Ve,{className:"h-4 w-4 mr-1"}),options:[{value:"Pending",label:"Pending"},{value:"Processing",label:"Processing"},{value:"In Transit",label:"In Transit"},{value:"Delivered",label:"Delivered"}],onSelect:s=>Ke(s)}],className:"mb-4"}),e.jsx(ds,{open:Ae,onOpenChange:H,itemCount:te,itemType:"shipment",itemNames:$e,onConfirm:Oe,isLoading:ae}),pe?e.jsx(cs,{rows:8}):O.length===0?e.jsx(os,{icon:We,title:"No shipments found",description:g||l||d?"Try adjusting your search or date filters":"Get started by creating your first shipment",actionLabel:g||l||d?void 0:"Create Shipment",onAction:g||l||d?void 0:()=>b(!0)}):e.jsxs("div",{className:"rounded-md border",children:[e.jsxs(ss,{children:[e.jsx(ts,{children:e.jsxs(ge,{children:[e.jsx(je,{className:"w-12",children:e.jsx(fe,{checked:we,ref:s=>{s&&(s.indeterminate=ke)},onCheckedChange:$,"aria-label":"Select all shipments"})}),e.jsx(C,{sortKey:"id",currentSortKey:p.key,sortDirection:v("id"),onSort:s=>y(s),children:"Shipment ID"}),e.jsx(C,{sortKey:"orderId",currentSortKey:p.key,sortDirection:v("orderId"),onSort:s=>y(s),children:"Order ID"}),e.jsx(C,{sortKey:"destination",currentSortKey:p.key,sortDirection:v("destination"),onSort:s=>y(s),children:"Destination"}),e.jsx(C,{sortKey:"carrier",currentSortKey:p.key,sortDirection:v("carrier"),onSort:s=>y(s),children:"Carrier"}),e.jsx(C,{sortKey:"status",currentSortKey:p.key,sortDirection:v("status"),onSort:s=>y(s),children:"Status"}),e.jsx(C,{sortKey:"eta",currentSortKey:p.key,sortDirection:v("eta"),onSort:s=>y(s),children:"ETA"}),e.jsx(je,{children:"Actions"})]})}),e.jsx(as,{children:ee.map(s=>{const t=Ie(s.id);return e.jsxs(ge,{className:xe(t&&"bg-muted/50"),children:[e.jsx(x,{children:e.jsx(fe,{checked:t,onCheckedChange:()=>Te(s.id),"aria-label":`Select shipment ${s.id}`})}),e.jsx(x,{children:s.id}),e.jsx(x,{children:s.orderId}),e.jsx(x,{children:s.destination}),e.jsx(x,{children:s.carrier}),e.jsx(x,{children:e.jsx(q,{variant:"secondary",className:Le(s.status),children:s.status})}),e.jsx(x,{children:s.eta}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xs,{entityType:"shipments",entityId:s.id,entityName:`${s.id} - ${s.destination}`}),e.jsxs(de,{open:E===s.id,onOpenChange:r=>{B(r?s.id:null),r&&c({...s})},children:[e.jsx(ce,{asChild:!0,children:e.jsx(S,{variant:"ghost",size:"sm",disabled:!D,title:D?void 0:"You don't have permission to edit shipments",children:"Track"})}),e.jsxs(oe,{children:[e.jsxs(ue,{children:[e.jsxs(he,{children:["Edit Shipment - ",s.id]}),e.jsx(me,{children:"Update fields and save your changes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-orderId",children:"Order ID"}),e.jsx(o,{id:"edit-orderId",value:a.orderId,onChange:r=>c({...a,orderId:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-destination",children:"Destination"}),e.jsx(o,{id:"edit-destination",value:a.destination,onChange:r=>c({...a,destination:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-carrier",children:"Carrier"}),e.jsx(o,{id:"edit-carrier",value:a.carrier,onChange:r=>c({...a,carrier:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-status",children:"Status"}),e.jsx(o,{id:"edit-status",value:a.status,onChange:r=>c({...a,status:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-eta",children:"ETA"}),e.jsx(o,{id:"edit-eta",value:a.eta,onChange:r=>c({...a,eta:r.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{className:"flex-1",onClick:Ee,children:"Save Changes"}),e.jsx(S,{variant:"destructive",onClick:()=>Be(s.id),children:"Delete"})]})]})]})]})]})})]},s.id)})})]}),O.length>0&&e.jsx(us,{currentPage:Z,totalPages:Ce,onPageChange:De,itemsPerPage:be,totalItems:Ne})]})]})]})]})}export{Is as ShipmentsView};
