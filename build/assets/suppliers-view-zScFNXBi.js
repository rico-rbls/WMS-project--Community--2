import{c as Ie,F as Le,i as Be,r,G as Ue,a7 as Ke,ap as te,J as i,aq as Oe,ar as $e,j as e,C as T,m as A,n as F,o as E,D as le,O as re,B as y,v as ie,w as ne,x as ce,y as oe,L as u,I as o,as as Me,Q as Re,d as de,t as qe,a2 as He,U as Ge,V as ue,at as _e,au as ze}from"./index-DaOLpSQU.js";import{T as Ve,e as Ye,f as Je,g as me,h as he,i as b,j as Qe,k as g}from"./sortable-table-head-DW9R2R8W.js";import{u as We,a as Xe,P as Ze,B as es,b as ss,T as as,E as ts,c as w,d as ls}from"./editable-cell-BTK218cE.js";import{S as rs,F as is}from"./save-search-dialog-D7DMD-hI.js";import{u as ns}from"./useTableSort-9gSA3ZcS.js";import{c as cs}from"./permissions-BrwoMe7D.js";import{S as os}from"./star-D3lFqWrS.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],us=Ie("phone",ds),ms=["Active","Inactive"],hs=["Electronics","Furniture","Clothing","Food","Other"];function Ss({initialOpenDialog:$,onDialogOpened:M}){const{isFavorite:R,getFavoritesByType:q}=Le(),{user:H}=Be(),d=H?cs(H.role):!1,[j,G]=r.useState(""),[x,_]=r.useState(!1),[z,h]=r.useState(null),[pe,V]=r.useState(!0),[v,k]=r.useState(!1),[P,I]=r.useState(null),[t,n]=r.useState({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active"}),L=Ue(j,300);r.useEffect(()=>{(async()=>{V(!0);const s=await Ke();h(s),V(!1)})()},[]),r.useEffect(()=>{$&&!v&&(k(!0),M?.())},[$,M,v]);const Y=r.useMemo(()=>z??[],[z]),B=r.useMemo(()=>Y.filter(s=>{if(x&&!R("suppliers",s.id))return!1;if(L){const l=L.toLowerCase();if(!(s.name.toLowerCase().includes(l)||s.id.toLowerCase().includes(l)||s.category.toLowerCase().includes(l)))return!1}return!0}),[Y,L,x,R]),xe=r.useCallback(s=>{s.searchTerm&&G(s.searchTerm),s.filters.favoritesOnly==="true"&&_(!0)},[]),ge=r.useMemo(()=>{const s={};return x&&(s.favoritesOnly="true"),s},[x]),{sortedData:je,sortConfig:f,requestSort:S,getSortDirection:C}=ns(B),{currentPage:J,totalPages:ye,paginatedData:Q,goToPage:ve,totalItems:fe,itemsPerPage:Se}=We(je,25),{selectedIds:D,selectedItems:W,selectionCount:X,isAllSelected:Ce,isPartiallySelected:Ne,hasSelection:U,toggleItem:be,toggleAll:K,deselectAll:m,isSelected:we}=Xe(Q),[Z,ee]=r.useState(!1),[ke,se]=r.useState(!1),[De,O]=r.useState(!1);r.useEffect(()=>{m()},[J,m]),r.useEffect(()=>{const s=l=>{(l.metaKey||l.ctrlKey)&&l.key==="a"&&!v&&!P&&(l.preventDefault(),K()),l.key==="Escape"&&U&&m()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[K,m,U,v,P]);const Te=s=>s==="Active"?"bg-green-500/10 text-green-700":"bg-gray-500/10 text-gray-700",N=r.useCallback(async(s,l,a)=>{try{const c={[l]:a},p=await te({id:s,...c});h(Pe=>(Pe??[]).map(ae=>ae.id===s?p:ae)),i.success(`${l.charAt(0).toUpperCase()+l.slice(1)} updated`)}catch(c){throw i.error(c?.message||"Failed to update"),c}},[h]),Ae=r.useCallback(async()=>{ee(!0);try{const s=Array.from(D),l=await Oe(s);h(a=>a?.filter(c=>!s.includes(c.id))??[]),l.failedCount>0?i.warning(`Deleted ${l.successCount} suppliers. ${l.failedCount} failed.`):i.success(`Successfully deleted ${l.successCount} supplier${l.successCount!==1?"s":""}`),m()}catch(s){i.error(s?.message||"Failed to delete suppliers")}finally{ee(!1),O(!1)}},[D,m]),Fe=r.useCallback(async s=>{se(!0);try{const l=Array.from(D),a=await $e(l,s);h(c=>c&&c.map(p=>l.includes(p.id)?{...p,status:s}:p)),a.failedCount>0?i.warning(`Updated ${a.successCount} suppliers. ${a.failedCount} failed.`):i.success(`Successfully updated ${a.successCount} supplier${a.successCount!==1?"s":""}`),m()}catch(l){i.error(l?.message||"Failed to update suppliers")}finally{se(!1)}},[D,m]),Ee=r.useMemo(()=>W.map(s=>s.name),[W]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(T,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(F,{className:"text-sm text-muted-foreground",children:"Total Suppliers"})}),e.jsx(E,{children:e.jsx("div",{className:"text-2xl",children:"48"})})]}),e.jsxs(T,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(F,{className:"text-sm text-muted-foreground",children:"Active"})}),e.jsx(E,{children:e.jsx("div",{className:"text-2xl",children:"42"})})]}),e.jsxs(T,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(F,{className:"text-sm text-muted-foreground",children:"Categories"})}),e.jsx(E,{children:e.jsx("div",{className:"text-2xl",children:"8"})})]})]}),e.jsxs(T,{children:[e.jsx(A,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(F,{children:"Supplier Management"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(le,{open:v,onOpenChange:s=>{k(s),s||n({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active"})},children:[e.jsx(re,{asChild:!0,children:e.jsxs(y,{onClick:()=>n({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active"}),disabled:!d,title:d?void 0:"You don't have permission to add suppliers",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Add Supplier"]})}),e.jsxs(ie,{children:[e.jsxs(ne,{children:[e.jsx(ce,{children:"Add New Supplier"}),e.jsx(oe,{children:"Enter the details for the new supplier."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"supplier-name",children:"Company Name"}),e.jsx(o,{id:"supplier-name",placeholder:"Enter company name",value:t.name,onChange:s=>n({...t,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"contact-name",children:"Contact Person"}),e.jsx(o,{id:"contact-name",placeholder:"Enter contact name",value:t.contact,onChange:s=>n({...t,contact:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"email",children:"Email"}),e.jsx(o,{id:"email",type:"email",placeholder:"email@example.com",value:t.email,onChange:s=>n({...t,email:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"phone",children:"Phone"}),e.jsx(o,{id:"phone",placeholder:"+1 (555) 000-0000",value:t.phone,onChange:s=>n({...t,phone:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"category",children:"Category"}),e.jsx(o,{id:"category",placeholder:"e.g., Electronics",value:t.category,onChange:s=>n({...t,category:s.target.value})})]}),e.jsx(y,{className:"w-full",onClick:async()=>{if(!t.name.trim()||!t.contact.trim()||!t.email.trim()||!t.phone.trim()||!t.category.trim()){i.error("Please fill all required fields");return}try{const s=await Me({name:t.name,contact:t.contact,email:t.email,phone:t.phone,category:t.category,status:t.status});h(l=>[s,...l??[]]),k(!1),i.success("Supplier added successfully"),n({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active"})}catch(s){i.error(s?.message||"Failed to add supplier")}},children:"Add Supplier"})]})]})]})})]})}),e.jsxs(E,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(o,{placeholder:"Search suppliers...",value:j,onChange:s=>G(s.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(y,{variant:x?"default":"outline",size:"sm",onClick:()=>_(!x),className:"gap-1",children:[e.jsx(os,{className:de("h-4 w-4",x&&"fill-current")}),"Favorites",q("suppliers").length>0&&e.jsx(qe,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:q("suppliers").length})]}),e.jsx(rs,{entityType:"suppliers",currentSearchTerm:j,currentFilters:ge,onApplySearch:xe})]})]}),U&&d&&e.jsx(es,{selectionCount:X,onClearSelection:m,isLoading:Z||ke,actions:[{id:"delete",label:"Delete",icon:e.jsx(Ve,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>O(!0)}],actionGroups:[{id:"status-update",label:"Update Status",icon:e.jsx(He,{className:"h-4 w-4 mr-1"}),options:[{value:"Active",label:"Active"},{value:"Inactive",label:"Inactive"}],onSelect:s=>Fe(s)}],className:"mb-4"}),e.jsx(ss,{open:De,onOpenChange:O,itemCount:X,itemType:"supplier",itemNames:Ee,onConfirm:Ae,isLoading:Z}),pe?e.jsx(as,{rows:8}):B.length===0?e.jsx(ts,{icon:Ge,title:"No suppliers found",description:j?"Try adjusting your search criteria":"Get started by adding your first supplier",actionLabel:j?void 0:"Add Supplier",onAction:j?void 0:()=>k(!0)}):e.jsxs("div",{className:"rounded-md border",children:[e.jsxs(Ye,{children:[e.jsx(Je,{children:e.jsxs(me,{children:[e.jsx(he,{className:"w-12",children:e.jsx(ue,{checked:Ce,ref:s=>{s&&(s.indeterminate=Ne)},onCheckedChange:K,"aria-label":"Select all suppliers"})}),e.jsx(b,{sortKey:"id",currentSortKey:f.key,sortDirection:C("id"),onSort:s=>S(s),children:"Supplier ID"}),e.jsx(b,{sortKey:"name",currentSortKey:f.key,sortDirection:C("name"),onSort:s=>S(s),children:"Company Name"}),e.jsx(b,{sortKey:"contact",currentSortKey:f.key,sortDirection:C("contact"),onSort:s=>S(s),children:"Contact"}),e.jsx(b,{sortKey:"category",currentSortKey:f.key,sortDirection:C("category"),onSort:s=>S(s),children:"Category"}),e.jsx(b,{sortKey:"status",currentSortKey:f.key,sortDirection:C("status"),onSort:s=>S(s),children:"Status"}),e.jsx(he,{children:"Actions"})]})}),e.jsx(Qe,{children:Q.map(s=>{const l=we(s.id);return e.jsxs(me,{className:de(l&&"bg-muted/50"),children:[e.jsx(g,{children:e.jsx(ue,{checked:l,onCheckedChange:()=>be(s.id),"aria-label":`Select supplier ${s.name}`})}),e.jsx(g,{children:s.id}),e.jsx(g,{children:e.jsx(w,{value:s.name,type:"text",onSave:a=>N(s.id,"name",a),disabled:!d})}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(_e,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(w,{value:s.email,type:"text",onSave:a=>N(s.id,"email",a),disabled:!d,className:"text-xs text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(us,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(w,{value:s.phone,type:"text",onSave:a=>N(s.id,"phone",a),disabled:!d,className:"text-xs text-muted-foreground"})]})]})}),e.jsx(g,{children:e.jsx(w,{value:s.category,type:"select",options:hs.map(a=>({value:a,label:a})),onSave:a=>N(s.id,"category",a),disabled:!d})}),e.jsx(g,{children:e.jsx(w,{value:s.status,type:"badge",options:ms.map(a=>({value:a,label:a})),badgeClassName:Te(s.status),onSave:a=>N(s.id,"status",a),disabled:!d})}),e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(is,{entityType:"suppliers",entityId:s.id,entityName:s.name}),e.jsxs(le,{open:P===s.id,onOpenChange:a=>{I(a?s.id:null),a&&n({...s})},children:[e.jsx(re,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",disabled:!d,title:d?void 0:"You don't have permission to edit suppliers",children:"Edit"})}),e.jsxs(ie,{children:[e.jsxs(ne,{children:[e.jsx(ce,{children:"Edit Supplier"}),e.jsx(oe,{children:"Update fields and save your changes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-name",children:"Company Name"}),e.jsx(o,{id:"edit-name",value:t.name,onChange:a=>n({...t,name:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-contact",children:"Contact Person"}),e.jsx(o,{id:"edit-contact",value:t.contact,onChange:a=>n({...t,contact:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-email",children:"Email"}),e.jsx(o,{id:"edit-email",value:t.email,onChange:a=>n({...t,email:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-phone",children:"Phone"}),e.jsx(o,{id:"edit-phone",value:t.phone,onChange:a=>n({...t,phone:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-category",children:"Category"}),e.jsx(o,{id:"edit-category",value:t.category,onChange:a=>n({...t,category:a.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{className:"flex-1",onClick:async()=>{if(!t.id){i.error("Missing supplier id");return}if(!t.name.trim()||!t.contact.trim()||!t.email.trim()||!t.phone.trim()||!t.category.trim()){i.error("Please fill all required fields");return}try{const a=await te({id:t.id,name:t.name,contact:t.contact,email:t.email,phone:t.phone,category:t.category,status:t.status});h(c=>(c??[]).map(p=>p.id===a.id?a:p)),I(null),i.success("Supplier updated")}catch(a){i.error(a?.message||"Failed to update supplier")}},children:"Save Changes"}),e.jsx(y,{variant:"destructive",onClick:async()=>{try{await ze(s.id),h(a=>(a??[]).filter(c=>c.id!==s.id)),I(null),i.success("Supplier deleted")}catch(a){i.error(a?.message||"Failed to delete supplier")}},children:"Delete"})]})]})]})]})]})})]},s.id)})})]}),B.length>0&&e.jsx(ls,{currentPage:J,totalPages:ye,onPageChange:ve,itemsPerPage:Se,totalItems:fe})]})]})]})]})}export{Ss as SuppliersView};
