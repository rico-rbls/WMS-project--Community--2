import{c as se,i as zs,r as i,G as Us,j as e,C as b,m as K,n as Q,o as C,O as Hs,d as Y,t as W,s as Ks,B as d,D as je,Q as Qs,v as ge,w as ye,x as fe,y as Ne,L as h,I as g,z as Ys,V as Ws,X as be,a8 as Gs,P as Ye,l as Ce,a9 as Js,aa as Xs,J as l,ab as Zs,ac as et,ad as We,ae as st,af as tt,ag as at,ah as rt,ai as nt,aj as lt,ak as ct,al as it,am as dt,an as ot,ao as ut}from"./index-CGl2ob7z.js";import{S as G,a as J,b as X,c as Z,d as q,T as ie,e as mt,f as ht,g as Ge,h as we,i as M,j as xt,k as w}from"./sortable-table-head-CHD_sWxK.js";import{a as pt,u as vt,T as jt,P as Pe,F as gt,B as yt,E as ft,d as Je,c as Nt,b as bt}from"./editable-cell-Xt9hZIa0.js";import{g as Ct,h as ee}from"./permissions-CZmL9BOw.js";import{D as wt}from"./dollar-sign-DfowmQ33.js";import{T as Pt}from"./trending-up-C1U-uSgW.js";import{S as Xe}from"./shopping-bag-CoZf1DST.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h2",key:"tvwodi"}],["path",{d:"M20 8v11a2 2 0 0 1-2 2h-2",key:"1gkqxj"}],["path",{d:"m9 15 3-3 3 3",key:"1pd0qc"}],["path",{d:"M12 12v9",key:"192myk"}]],Ze=se("archive-restore",Dt);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],de=se("archive",kt);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],Ot=se("download",St);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],It=se("file-text",At);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Ft=se("send",Rt),Tt=["Draft","Pending Approval","Approved","Rejected","Ordered","Partially Received","Received","Cancelled"];function Bt({initialOpenDialog:De,onDialogOpened:ke,prefilledItem:N}){const{user:V}=zs(),L=V?Ct(V.id):"user",_=ee(L,"purchase_orders:create"),es=ee(L,"purchase_orders:approve"),ss=ee(L,"purchase_orders:receive"),te=ee(L,"purchase_orders:delete"),Se=ee(L,"purchase_orders:permanent_delete"),[x,Oe]=i.useState(!1),[ae,Ae]=i.useState(""),[v,A]=i.useState("all"),[Ie,p]=i.useState(null),[D,ts]=i.useState([]),[oe,as]=i.useState([]),[rs,ns]=i.useState(!0),[ue,I]=i.useState(!1),[P,k]=i.useState(null),[B,re]=i.useState(null),[y,Re]=i.useState(null),[z,me]=i.useState("asc"),[c,f]=i.useState({supplierId:"",supplierName:"",items:[],expectedDeliveryDate:"",notes:""}),[Fe,Te]=i.useState({}),[$e,Ee]=i.useState(void 0),[ls,U]=i.useState(!1),he=Us(ae,300),S=i.useMemo(()=>Ie??[],[Ie]),{selectedIds:ne,toggleItem:cs,toggleAll:is,isSelected:ds,isAllSelected:os,isPartiallySelected:us,selectionCount:R,hasSelection:ms,deselectAll:le}=pt(S);i.useEffect(()=>{async function s(){try{const[t,a,r]=await Promise.all([Ce(),Js(),Xs()]);p(t),ts(a.filter(n=>n.status==="Active")),as(r)}catch{l.error("Failed to load data")}finally{ns(!1)}}s()},[]),i.useEffect(()=>{N&&D.length>0&&(f({supplierId:N.supplierId,supplierName:N.supplierName,items:[{inventoryItemId:N.inventoryItemId,itemName:N.itemName,quantity:N.quantity,unitPrice:N.unitPrice,totalPrice:N.quantity*N.unitPrice}],expectedDeliveryDate:new Date(Date.now()+10080*60*1e3).toISOString().split("T")[0],notes:""}),I(!0))},[N,D]),i.useEffect(()=>{De&&!ue&&(I(!0),ke?.())},[De,ke,ue]);const xe=i.useMemo(()=>{let s=S;if(s=s.filter(t=>t.archived===x),he){const t=he.toLowerCase();s=s.filter(a=>a.id.toLowerCase().includes(t)||a.supplierName.toLowerCase().includes(t)||(a.items??[]).some(r=>r.itemName.toLowerCase().includes(t)))}return v!=="all"&&(s=s.filter(t=>t.status===v)),y&&(s=[...s].sort((t,a)=>{const r=t[y],n=a[y];return r==null?1:n==null?-1:typeof r=="string"&&typeof n=="string"?z==="asc"?r.localeCompare(n):n.localeCompare(r):typeof r=="number"&&typeof n=="number"?z==="asc"?r-n:n-r:0})),s},[S,he,v,y,z,x]),{paginatedData:hs,currentPage:xs,totalPages:ps,goToPage:vs,itemsPerPage:js,totalItems:gs}=vt(xe,10),j=i.useMemo(()=>{const s=S.filter(o=>!o.archived),t=new Date,a=new Date(t.getTime()-10080*60*1e3),r=s.length,n=s.reduce((o,Qe)=>o+(Qe.totalAmount??0),0),u=r>0?n/r:0,m=s.filter(o=>o.status==="Draft").length,O=s.filter(o=>o.status==="Pending Approval").length,Ue=s.filter(o=>o.status==="Approved").length,pe=s.filter(o=>o.status==="Ordered").length,ve=s.filter(o=>o.status==="Partially Received").length,He=s.filter(o=>o.status==="Received").length,qs=s.filter(o=>o.status==="Rejected").length,Ms=s.filter(o=>o.status==="Cancelled").length,Vs=m+O+Ue+pe+ve,Ke=He,Ls=r>0?Math.round(Ke/r*100):0,_s=s.filter(o=>new Date(o.createdDate)>=a).length,Bs=pe+ve;return{totalPOs:r,totalValue:n,avgOrderValue:u,draftCount:m,pendingApprovalCount:O,approvedCount:Ue,orderedCount:pe,partiallyReceivedCount:ve,receivedCount:He,rejectedCount:qs,cancelledCount:Ms,activePOs:Vs,completionRate:Ls,newThisWeek:_s,pendingDelivery:Bs,completedPOs:Ke}},[S]),qe=s=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),ys=()=>{Ae(""),A("all"),Oe(!1)},H=s=>{switch(s){case"Draft":return"ðŸ“";case"Pending Approval":return"â³";case"Approved":return"âœ“";case"Rejected":return"âœ—";case"Ordered":return"ðŸ“¦";case"Partially Received":return"ðŸ“¥";case"Received":return"âœ“";case"Cancelled":return"â—‹";default:return"â—‹"}},ce=s=>{switch(s){case"Draft":return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200";case"Pending Approval":return"bg-amber-500/15 text-amber-700 dark:text-amber-400 border-amber-200";case"Approved":return"bg-blue-500/15 text-blue-700 dark:text-blue-400 border-blue-200";case"Rejected":return"bg-red-500/15 text-red-700 dark:text-red-400 border-red-200";case"Ordered":return"bg-purple-500/15 text-purple-700 dark:text-purple-400 border-purple-200";case"Partially Received":return"bg-orange-500/15 text-orange-700 dark:text-orange-400 border-orange-200";case"Received":return"bg-emerald-500/15 text-emerald-700 dark:text-emerald-400 border-emerald-200";case"Cancelled":return"bg-gray-500/15 text-gray-700 dark:text-gray-400 border-gray-200";default:return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200"}},F=s=>{const t=s;y===t?z==="asc"?me("desc"):(Re(null),me("asc")):(Re(t),me("asc"))},T=s=>y===s?z:null,Me=s=>{const t={Draft:{variant:"secondary"},"Pending Approval":{variant:"outline",className:"border-yellow-500 text-yellow-600"},Approved:{variant:"outline",className:"border-blue-500 text-blue-600"},Rejected:{variant:"destructive"},Ordered:{variant:"outline",className:"border-purple-500 text-purple-600"},"Partially Received":{variant:"outline",className:"border-orange-500 text-orange-600"},Received:{variant:"default",className:"bg-green-500"},Cancelled:{variant:"secondary",className:"text-gray-500"}},{variant:a,className:r}=t[s];return e.jsxs(W,{variant:a,className:Y("gap-1",r),children:[e.jsx("span",{children:H(s)}),s]})},$=()=>{f({supplierId:"",supplierName:"",items:[],expectedDeliveryDate:"",notes:""})},Ve=()=>{f(s=>({...s,items:[...s.items,{inventoryItemId:"",itemName:"",quantity:1,unitPrice:0,totalPrice:0}]}))},Le=s=>{f(t=>({...t,items:t.items.filter((a,r)=>r!==s)}))},E=(s,t,a)=>{f(r=>{const n=[...r.items];if(t==="inventoryItemId"){const u=oe.find(m=>m.id===a);u&&(n[s]={...n[s],inventoryItemId:u.id,itemName:u.name,unitPrice:u.pricePerPiece,totalPrice:n[s].quantity*u.pricePerPiece})}else if(t==="quantity"){const u=Number(a)||0;n[s]={...n[s],quantity:u,totalPrice:u*n[s].unitPrice}}else if(t==="unitPrice"){const u=Number(a)||0;n[s]={...n[s],unitPrice:u,totalPrice:n[s].quantity*u}}return{...r,items:n}})},_e=s=>{const t=D.find(a=>a.id===s);f(a=>({...a,supplierId:s,supplierName:t?.name??""}))},fs=async()=>{if(!c.supplierId||c.items.length===0||!c.expectedDeliveryDate){l.error("Please fill in all required fields");return}try{const s=await Zs({supplierId:c.supplierId,supplierName:c.supplierName,items:c.items,expectedDeliveryDate:c.expectedDeliveryDate,notes:c.notes,createdBy:V?.id??"1"});p(t=>[s,...t??[]]),l.success(`Purchase Order ${s.id} created successfully`),I(!1),$()}catch(s){l.error(s instanceof Error?s.message:"Failed to create purchase order")}},Ns=async s=>{if(!c.supplierId||c.items.length===0||!c.expectedDeliveryDate){l.error("Please fill in all required fields");return}try{const t=await We({id:s,supplierId:c.supplierId,supplierName:c.supplierName,items:c.items,expectedDeliveryDate:c.expectedDeliveryDate,notes:c.notes});p(a=>a?.map(r=>r.id===s?t:r)??[]),l.success(`Purchase Order ${s} updated successfully`),k(null),$()}catch(t){l.error(t instanceof Error?t.message:"Failed to update purchase order")}},Be=async(s,t,a)=>{try{const r={[t]:a},n=await We({id:s,...r});p(u=>u?.map(m=>m.id===s?n:m)??[]),l.success(`${t.charAt(0).toUpperCase()+t.slice(1)} updated`)}catch(r){throw l.error(r?.message||"Failed to update"),r}},bs=async s=>{try{const t=await st(s);p(a=>a?.map(r=>r.id===s?t:r)??[]),l.success(`Purchase Order ${s} submitted for approval`)}catch(t){l.error(t instanceof Error?t.message:"Failed to submit for approval")}},Cs=async s=>{try{const t=await tt(s,V?.id??"1");p(a=>a?.map(r=>r.id===s?t:r)??[]),l.success(`Purchase Order ${s} approved`)}catch(t){l.error(t instanceof Error?t.message:"Failed to approve")}},ws=async s=>{try{const t=await at(s,V?.id??"1");p(a=>a?.map(r=>r.id===s?t:r)??[]),l.success(`Purchase Order ${s} rejected`)}catch(t){l.error(t instanceof Error?t.message:"Failed to reject")}},Ps=async s=>{try{const t=await rt(s);p(a=>a?.map(r=>r.id===s?t:r)??[]),l.success(`Purchase Order ${s} marked as ordered`)}catch(t){l.error(t instanceof Error?t.message:"Failed to mark as ordered")}},Ds=async s=>{try{const t=await nt(s);p(a=>a?.map(r=>r.id===s?t:r)??[]),l.success(`Purchase Order ${s} cancelled`)}catch(t){l.error(t instanceof Error?t.message:"Failed to cancel")}},ks=s=>{const t={};(s.items??[]).forEach(a=>{const r=a.quantity-(a.quantityReceived??0);t[a.inventoryItemId]=r}),Te(t),Ee(s.totalAmount),re(s.id)},Ss=async s=>{try{const t=Object.entries(Fe).filter(([r,n])=>n>0).map(([r,n])=>({inventoryItemId:r,quantityReceived:n}));if(t.length===0){l.error("Please enter quantities to receive");return}const a=await dt(s,t,$e);if(p(r=>r?.map(n=>n.id===s?a.purchaseOrder:n)??[]),a.inventoryUpdates.length>0){const r=a.inventoryUpdates.map(n=>`${n.itemName}: ${n.previousQty} â†’ ${n.newQty}`).join(", ");l.success(`Items received. Inventory updated: ${r}`)}else l.success("Items received successfully");re(null)}catch(t){l.error(t instanceof Error?t.message:"Failed to receive items")}},Os=async s=>{try{const t=await it(s);p(a=>(a??[]).map(r=>r.id===s?t:r)),k(null),l.success("Purchase order archived")}catch(t){l.error(t instanceof Error?t.message:"Failed to archive purchase order")}},As=async s=>{try{const t=await lt(s);p(a=>(a??[]).map(r=>r.id===s?t:r)),k(null),l.success("Purchase order restored")}catch(t){l.error(t instanceof Error?t.message:"Failed to restore purchase order")}},Is=async s=>{try{await ct(s),p(t=>(t??[]).filter(a=>a.id!==s)),k(null),l.success("Purchase order permanently deleted")}catch(t){l.error(t instanceof Error?t.message:"Failed to permanently delete purchase order")}},Rs=async()=>{try{const s=await ut(Array.from(ne));s.success?l.success(`${s.successCount} purchase orders archived`):l.warning(`${s.successCount} archived, ${s.failedCount} failed`);const t=await Ce();p(t),le(),U(!1)}catch{l.error("Failed to archive purchase orders")}},Fs=async()=>{try{const s=await et(Array.from(ne));s.success?l.success(`${s.successCount} purchase orders restored`):l.warning(`${s.successCount} restored, ${s.failedCount} failed`);const t=await Ce();p(t),le()}catch{l.error("Failed to restore purchase orders")}},Ts=async()=>{try{const s=await ot(Array.from(ne));s.success?l.success(`${s.successCount} purchase orders permanently deleted`):l.warning(`${s.successCount} deleted, ${s.failedCount} failed`),p(t=>t?.filter(a=>!ne.has(a.id))??[]),le(),U(!1)}catch{l.error("Failed to permanently delete purchase orders")}},$s=s=>{f({supplierId:s.supplierId,supplierName:s.supplierName,items:(s.items??[]).map(t=>({inventoryItemId:t.inventoryItemId,itemName:t.itemName,quantity:t.quantity,unitPrice:t.unitPrice,totalPrice:t.totalPrice})),expectedDeliveryDate:s.expectedDeliveryDate,notes:s.notes}),k(s.id)},Es=()=>{const s=["PO ID","Supplier","Items","Total Amount","Status","Created Date","Expected Delivery","Notes"],t=xe.map(m=>[m.id,m.supplierName,(m.items??[]).map(O=>`${O.itemName} (${O.quantity})`).join("; "),(m.totalAmount??0).toFixed(2),m.status,m.createdDate,m.expectedDeliveryDate,m.notes]),a=[s,...t].map(m=>m.map(O=>`"${O}"`).join(",")).join(`
`),r=new Blob([a],{type:"text/csv"}),n=URL.createObjectURL(r),u=document.createElement("a");u.href=n,u.download=`purchase-orders-${new Date().toISOString().split("T")[0]}.csv`,u.click(),URL.revokeObjectURL(n),l.success("Purchase orders exported to CSV")},ze=i.useMemo(()=>c.items.reduce((s,t)=>s+t.totalPrice,0),[c.items]);return rs?e.jsx("div",{className:"p-6",children:e.jsx(jt,{rows:8})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(b,{className:"relative overflow-hidden",children:[e.jsxs(K,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(Q,{className:"text-sm font-medium text-muted-foreground",children:"Total POs"}),e.jsx(It,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.totalPOs}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[j.newThisWeek," new this week"]})]})]}),e.jsxs(b,{className:"relative overflow-hidden",children:[e.jsxs(K,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(Q,{className:"text-sm font-medium text-muted-foreground",children:"Total Value"}),e.jsx(wt,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:qe(j.totalValue)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Avg: ",qe(j.avgOrderValue)," per PO"]})]})]}),e.jsxs(b,{className:"relative overflow-hidden",children:[e.jsxs(K,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(Q,{className:"text-sm font-medium text-muted-foreground",children:"Active POs"}),e.jsx(Hs,{className:"h-4 w-4 text-amber-600"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:j.activePOs}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[j.orderedCount," ordered, ",j.pendingApprovalCount," pending approval"]})]})]}),e.jsxs(b,{className:"relative overflow-hidden",children:[e.jsxs(K,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(Q,{className:"text-sm font-medium text-muted-foreground",children:"Completion Rate"}),e.jsx(Pt,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[j.completionRate,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[j.completedPOs," received of ",j.totalPOs," total"]})]})]})]}),e.jsxs("div",{className:"grid gap-3 grid-cols-2 md:grid-cols-4",children:[e.jsx(b,{className:Y("cursor-pointer transition-all hover:shadow-md border-l-4",v==="Draft"?"ring-2 ring-primary":"","border-l-slate-400"),onClick:()=>A(v==="Draft"?"all":"Draft"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Draft"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:j.draftCount})]}),e.jsx(W,{variant:"outline",className:ce("Draft"),children:H("Draft")})]})})}),e.jsx(b,{className:Y("cursor-pointer transition-all hover:shadow-md border-l-4",v==="Pending Approval"?"ring-2 ring-primary":"","border-l-amber-400"),onClick:()=>A(v==="Pending Approval"?"all":"Pending Approval"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Pending Approval"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:j.pendingApprovalCount})]}),e.jsx(W,{variant:"outline",className:ce("Pending Approval"),children:H("Pending Approval")})]})})}),e.jsx(b,{className:Y("cursor-pointer transition-all hover:shadow-md border-l-4",v==="Ordered"?"ring-2 ring-primary":"","border-l-blue-400"),onClick:()=>A(v==="Ordered"?"all":"Ordered"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Ordered"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:j.orderedCount})]}),e.jsx(W,{variant:"outline",className:ce("Ordered"),children:H("Ordered")})]})})}),e.jsx(b,{className:Y("cursor-pointer transition-all hover:shadow-md border-l-4",v==="Received"?"ring-2 ring-primary":"","border-l-emerald-400"),onClick:()=>A(v==="Received"?"all":"Received"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Received"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:j.receivedCount})]}),e.jsx(W,{variant:"outline",className:ce("Received"),children:H("Received")})]})})})]}),e.jsxs(b,{children:[e.jsxs(K,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Q,{children:"Purchase Order Management"}),e.jsx(Ks,{children:"Create and manage supplier purchase orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{variant:"outline",onClick:Es,children:[e.jsx(Ot,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),_&&e.jsxs(je,{open:ue,onOpenChange:s=>{I(s),s||$()},children:[e.jsx(Qs,{asChild:!0,children:e.jsxs(d,{children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Create PO"]})}),e.jsxs(ge,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ye,{children:[e.jsx(fe,{children:"Create Purchase Order"}),e.jsx(Ne,{children:"Create a new purchase order for supplier items"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Supplier *"}),e.jsxs(G,{value:c.supplierId,onValueChange:_e,children:[e.jsx(J,{children:e.jsx(X,{placeholder:"Select supplier"})}),e.jsx(Z,{children:D.map(s=>e.jsx(q,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Expected Delivery Date *"}),e.jsx(g,{type:"date",value:c.expectedDeliveryDate,onChange:s=>f(t=>({...t,expectedDeliveryDate:s.target.value}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(h,{children:"Line Items *"}),e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:Ve,children:[e.jsx(Pe,{className:"h-4 w-4 mr-1"})," Add Item"]})]}),c.items.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:'No items added. Click "Add Item" to add items.'}):e.jsxs("div",{className:"space-y-2",children:[c.items.map((s,t)=>e.jsxs("div",{className:"flex gap-2 items-end p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Item"}),e.jsxs(G,{value:s.inventoryItemId,onValueChange:a=>E(t,"inventoryItemId",a),children:[e.jsx(J,{children:e.jsx(X,{placeholder:"Select item"})}),e.jsx(Z,{children:oe.map(a=>e.jsxs(q,{value:a.id,children:[a.name," (",a.id,")"]},a.id))})]})]}),e.jsxs("div",{className:"w-24 space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Quantity"}),e.jsx(g,{type:"number",min:"1",value:s.quantity,onChange:a=>E(t,"quantity",a.target.value)})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Unit Price"}),e.jsx(g,{type:"number",min:"0",step:"0.01",value:s.unitPrice,onChange:a=>E(t,"unitPrice",a.target.value)})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Total"}),e.jsx(g,{value:`â‚±${s.totalPrice.toFixed(2)}`,disabled:!0})]}),e.jsx(d,{type:"button",variant:"ghost",size:"icon",onClick:()=>Le(t),children:e.jsx(ie,{className:"h-4 w-4 text-destructive"})})]},t)),e.jsxs("div",{className:"text-right font-semibold",children:["Total: â‚±",ze.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Notes"}),e.jsx(g,{value:c.notes,onChange:s=>f(t=>({...t,notes:s.target.value})),placeholder:"Optional notes..."})]}),e.jsxs(Ys,{children:[e.jsx(d,{variant:"outline",onClick:()=>{I(!1),$()},children:"Cancel"}),e.jsx(d,{onClick:fs,children:"Create Purchase Order"})]})]})]})]})]})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(Ws,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(g,{placeholder:"Search PO ID, supplier, or items...",value:ae,onChange:s=>Ae(s.target.value),className:"pl-10"})]}),e.jsxs(G,{value:v,onValueChange:A,children:[e.jsxs(J,{className:"w-48",children:[e.jsx(gt,{className:"h-4 w-4 mr-2"}),e.jsx(X,{placeholder:"Filter by status"})]}),e.jsxs(Z,{children:[e.jsx(q,{value:"all",children:"All Statuses"}),Tt.map(s=>e.jsx(q,{value:s,children:s},s))]})]}),e.jsxs(d,{variant:x?"default":"outline",size:"sm",onClick:()=>Oe(!x),className:x?"bg-orange-500 hover:bg-orange-600 text-white":"",children:[e.jsx(de,{className:"h-4 w-4 mr-1"}),x?"Viewing Archived":"View Archived"]}),(ae||v!=="all"||x)&&e.jsxs(d,{variant:"ghost",size:"sm",onClick:ys,className:"text-muted-foreground",children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Clear Filters"]})]}),ms&&te&&e.jsx(yt,{selectionCount:R,onClearSelection:le,actions:x?[{id:"restore",label:"Restore",icon:e.jsx(Ze,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:Fs},...Se?[{id:"permanent-delete",label:"Permanently Delete",icon:e.jsx(ie,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>U(!0)}]:[]]:[{id:"archive",label:"Archive",icon:e.jsx(de,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:()=>U(!0)}]}),xe.length===0?e.jsx(ft,{icon:x?de:Xe,title:x?"No archived purchase orders":"No purchase orders found",description:x?"Archived purchase orders will appear here":ae||v!=="all"?"Try adjusting your search or filters":"Create your first purchase order to get started",actionLabel:!x&&_?"Create PO":void 0,onAction:!x&&_?()=>I(!0):void 0}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-lg",children:e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(Ge,{children:[te&&e.jsx(we,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:os,ref:s=>{s&&(s.indeterminate=us)},onChange:()=>is(),className:"h-4 w-4"})}),e.jsx(M,{sortKey:"id",currentSortKey:y,sortDirection:T("id"),onSort:F,children:"PO ID"}),e.jsx(M,{sortKey:"supplierName",currentSortKey:y,sortDirection:T("supplierName"),onSort:F,children:"Supplier"}),e.jsx(we,{children:"Items"}),e.jsx(M,{sortKey:"totalAmount",currentSortKey:y,sortDirection:T("totalAmount"),onSort:F,className:"text-right",children:"Total"}),e.jsx(M,{sortKey:"status",currentSortKey:y,sortDirection:T("status"),onSort:F,children:"Status"}),e.jsx(M,{sortKey:"createdDate",currentSortKey:y,sortDirection:T("createdDate"),onSort:F,children:"Created"}),e.jsx(M,{sortKey:"expectedDeliveryDate",currentSortKey:y,sortDirection:T("expectedDeliveryDate"),onSort:F,children:"Expected"}),e.jsx(we,{children:"Actions"})]})}),e.jsx(xt,{children:hs.map(s=>e.jsxs(Ge,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>$s(s),children:[te&&e.jsx(w,{onClick:t=>t.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:ds(s.id),onChange:()=>cs(s.id),className:"h-4 w-4"})}),e.jsx(w,{className:"font-medium",children:s.id}),e.jsx(w,{onClick:t=>t.stopPropagation(),children:e.jsx(Je,{value:s.supplierId,displayValue:s.supplierName,type:"select",options:D.filter(t=>t.status==="Active").map(t=>({value:t.id,label:t.name})),onSave:t=>{const a=D.find(r=>r.id===t);return Be(s.id,"supplierName",a?.name??"")},disabled:s.status!=="Draft"||!_})}),e.jsx(w,{children:e.jsxs("span",{className:"text-sm",children:[(s.items??[]).length," item",(s.items??[]).length!==1?"s":""]})}),e.jsxs(w,{className:"text-right font-medium",children:["â‚±",(s.totalAmount??0).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(w,{children:Me(s.status)}),e.jsx(w,{children:s.createdDate}),e.jsx(w,{onClick:t=>t.stopPropagation(),children:e.jsx(Je,{value:s.expectedDeliveryDate,type:"text",placeholder:"YYYY-MM-DD",onSave:t=>Be(s.id,"expectedDeliveryDate",t),disabled:s.status!=="Draft"||!_})}),e.jsx(w,{onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"flex gap-1",children:[s.status==="Draft"&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>bs(s.id),title:"Submit for Approval",children:e.jsx(Ft,{className:"h-4 w-4"})}),s.status==="Pending Approval"&&es&&e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"sm",variant:"outline",className:"text-green-600",onClick:()=>Cs(s.id),title:"Approve",children:e.jsx(Gs,{className:"h-4 w-4"})}),e.jsx(d,{size:"sm",variant:"outline",className:"text-red-600",onClick:()=>ws(s.id),title:"Reject",children:e.jsx(be,{className:"h-4 w-4"})})]}),s.status==="Approved"&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Ps(s.id),title:"Mark as Ordered",children:e.jsx(Xe,{className:"h-4 w-4"})}),(s.status==="Ordered"||s.status==="Partially Received")&&ss&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>ks(s),title:"Receive Items",children:e.jsx(Ye,{className:"h-4 w-4"})}),!["Received","Cancelled"].includes(s.status)&&e.jsx(d,{size:"sm",variant:"ghost",className:"text-destructive",onClick:()=>Ds(s.id),title:"Cancel",children:e.jsx(be,{className:"h-4 w-4"})})]})})]},s.id))})]})}),e.jsx(Nt,{currentPage:xs,totalPages:ps,itemsPerPage:js,onPageChange:vs,totalItems:gs})]}),P&&e.jsx(je,{open:!!P,onOpenChange:s=>{s||(k(null),$())},children:e.jsxs(ge,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ye,{children:[e.jsxs(fe,{children:["Edit Purchase Order - ",P]}),e.jsx(Ne,{children:"Update purchase order details"})]}),e.jsx("div",{className:"space-y-4 py-4",children:(()=>{const s=S.find(a=>a.id===P),t=s?.status==="Draft";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),s&&Me(s.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Supplier"}),e.jsxs(G,{value:c.supplierId,onValueChange:_e,disabled:!t,children:[e.jsx(J,{children:e.jsx(X,{placeholder:"Select supplier"})}),e.jsx(Z,{children:D.map(a=>e.jsx(q,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Expected Delivery Date"}),e.jsx(g,{type:"date",value:c.expectedDeliveryDate,onChange:a=>f(r=>({...r,expectedDeliveryDate:a.target.value})),disabled:!t})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(h,{children:"Line Items"}),t&&e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:Ve,children:[e.jsx(Pe,{className:"h-4 w-4 mr-1"})," Add Item"]})]}),e.jsxs("div",{className:"space-y-2",children:[c.items.map((a,r)=>e.jsxs("div",{className:"flex gap-2 items-end p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Item"}),e.jsxs(G,{value:a.inventoryItemId,onValueChange:n=>E(r,"inventoryItemId",n),disabled:!t,children:[e.jsx(J,{children:e.jsx(X,{placeholder:"Select item"})}),e.jsx(Z,{children:oe.map(n=>e.jsxs(q,{value:n.id,children:[n.name," (",n.id,")"]},n.id))})]})]}),e.jsxs("div",{className:"w-24 space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Quantity"}),e.jsx(g,{type:"number",min:"1",value:a.quantity,onChange:n=>E(r,"quantity",n.target.value),disabled:!t})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Unit Price"}),e.jsx(g,{type:"number",min:"0",step:"0.01",value:a.unitPrice,onChange:n=>E(r,"unitPrice",n.target.value),disabled:!t})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Total"}),e.jsx(g,{value:`â‚±${a.totalPrice.toFixed(2)}`,disabled:!0})]}),t&&e.jsx(d,{type:"button",variant:"ghost",size:"icon",onClick:()=>Le(r),children:e.jsx(ie,{className:"h-4 w-4 text-destructive"})})]},r)),e.jsxs("div",{className:"text-right font-semibold",children:["Total: â‚±",ze.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Notes"}),e.jsx(g,{value:c.notes,onChange:a=>f(r=>({...r,notes:a.target.value})),placeholder:"Optional notes...",disabled:!t})]}),e.jsxs("div",{className:"flex justify-between",children:[s?.archived?e.jsxs(e.Fragment,{children:[e.jsxs(d,{variant:"outline",onClick:()=>As(P),children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Restore"]}),Se&&e.jsxs(d,{variant:"destructive",onClick:()=>Is(P),children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Permanently Delete"]})]}):te&&["Draft","Cancelled","Rejected"].includes(s?.status??"")&&e.jsxs(d,{variant:"outline",onClick:()=>Os(P),className:"text-orange-600 border-orange-300 hover:bg-orange-50",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Archive"]}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsx(d,{variant:"outline",onClick:()=>{k(null),$()},children:"Close"}),t&&!s?.archived&&e.jsx(d,{onClick:()=>Ns(P),children:"Save Changes"})]})]})]})})()})]})}),B&&e.jsx(je,{open:!!B,onOpenChange:s=>{s||re(null)},children:e.jsxs(ge,{className:"max-w-2xl",children:[e.jsxs(ye,{children:[e.jsxs(fe,{children:["Receive Items - ",B]}),e.jsx(Ne,{children:"Enter quantities received for each item"})]}),e.jsx("div",{className:"space-y-4 py-4",children:(()=>{const s=S.find(t=>t.id===B);return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:(s.items??[]).map(t=>{const a=t.quantity-(t.quantityReceived??0);return e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:t.itemName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Ordered: ",t.quantity," | Received: ",t.quantityReceived??0," | Remaining: ",a]})]}),e.jsxs("div",{className:"w-32",children:[e.jsx(h,{className:"text-xs",children:"Receive Qty"}),e.jsx(g,{type:"number",min:"0",max:a,value:Fe[t.inventoryItemId]??0,onChange:r=>Te(n=>({...n,[t.inventoryItemId]:Math.min(Number(r.target.value)||0,a)}))})]})]},t.inventoryItemId)})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Actual Cost (optional)"}),e.jsx(g,{type:"number",min:"0",step:"0.01",value:$e??"",onChange:t=>Ee(t.target.value?Number(t.target.value):void 0),placeholder:`Expected: â‚±${s.totalAmount.toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>re(null),children:"Cancel"}),e.jsxs(d,{onClick:()=>Ss(B),children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"})," Receive Items"]})]})]}):null})()})]})}),e.jsx(bt,{open:ls,onOpenChange:U,itemCount:R,itemType:"purchase orders",onConfirm:x?Ts:Rs,title:x?"Permanently Delete Purchase Orders":"Archive Purchase Orders",description:x?`Are you sure you want to permanently delete ${R} purchase order${R!==1?"s":""}? This action cannot be undone.`:`Are you sure you want to archive ${R} purchase order${R!==1?"s":""}? Archived purchase orders can be restored later.`,confirmLabel:x?"Permanently Delete":"Archive"})]})]})]})}export{Bt as PurchaseOrdersView};
