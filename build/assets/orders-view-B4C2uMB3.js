import{F as Me,i as Ue,r as l,G as qe,_ as Re,$ as Ge,H as i,a0 as ze,j as e,C as b,m as w,n as k,o as T,D as oe,N as ce,B as S,v as de,w as ue,x as me,y as he,L as u,I as d,O as Ye,d as xe,t as q,X as Qe,a1 as Ve,S as We,Q as fe,a2 as Xe,a3 as _e,a4 as Je,a5 as Ze}from"./index-EEaLzckF.js";import{T as es,e as ss,f as ts,g as ge,h as je,i as C,j as as,k as x}from"./sortable-table-head-mkeNVhjR.js";import{u as rs,a as ls,P as is,B as ns,b as os,T as cs,E as ds,c as us}from"./bulk-delete-dialog-CdlBWRxS.js";import{D as ms}from"./date-range-filter-CDZObYSt.js";import{S as hs,F as xs}from"./save-search-dialog-IYAfNbGp.js";import{u as fs}from"./useTableSort-w_Pq1uE_.js";import{c as gs}from"./permissions-DQj5XdsG.js";import{S as js}from"./star-CX957Px9.js";import"./calendar-B6Hi1kNL.js";function Ts({initialOpenDialog:R,onDialogOpened:G}){const{isFavorite:z,getFavoritesByType:Y}=Me(),{user:Q}=Ue(),D=Q?gs(Q.role):!1,[g,V]=l.useState(""),[n,P]=l.useState(""),[o,B]=l.useState(""),[f,W]=l.useState(!1),[X,j]=l.useState(null),[pe,_]=l.useState(!0),[N,F]=l.useState(!1),[I,A]=l.useState(null),[a,c]=l.useState({id:"",customer:"",items:0,total:"",status:"Pending",date:""}),E=qe(g,300);l.useEffect(()=>{(async()=>{_(!0);const s=await Re();j(s),_(!1)})()},[]),l.useEffect(()=>{R&&!N&&(F(!0),G?.())},[R,G,N]);const J=l.useMemo(()=>X??[],[X]),K=l.useMemo(()=>J.filter(s=>{if(f&&!z("orders",s.id))return!1;if(E){const t=E.toLowerCase();if(!(s.id.toLowerCase().includes(t)||s.customer.toLowerCase().includes(t)))return!1}if(n||o)try{const t=new Date(s.date);if(n){const r=new Date(n);if(t<r)return!1}if(o){const r=new Date(o);if(r.setHours(23,59,59,999),t>r)return!1}}catch{return!1}return!0}),[J,E,n,o,f,z]),ye=l.useCallback(s=>{s.searchTerm&&V(s.searchTerm),s.filters.fromDate&&typeof s.filters.fromDate=="string"&&P(s.filters.fromDate),s.filters.toDate&&typeof s.filters.toDate=="string"&&B(s.filters.toDate),s.filters.favoritesOnly==="true"&&W(!0)},[]),ve=l.useMemo(()=>{const s={};return n&&(s.fromDate=n),o&&(s.toDate=o),f&&(s.favoritesOnly="true"),s},[n,o,f]),{sortedData:Se,sortConfig:p,requestSort:y,getSortDirection:v}=fs(K),{currentPage:Z,totalPages:Ce,paginatedData:ee,goToPage:De,totalItems:Ne,itemsPerPage:be}=rs(Se,25),{selectedIds:O,selectedItems:se,selectionCount:te,isAllSelected:we,isPartiallySelected:ke,hasSelection:L,toggleItem:Te,toggleAll:$,deselectAll:m,isSelected:Fe}=ls(ee),[ae,re]=l.useState(!1),[Oe,le]=l.useState(!1),[Pe,H]=l.useState(!1),[ps,Be]=l.useState(!1);l.useEffect(()=>{m()},[Z,m]),l.useEffect(()=>{const s=t=>{(t.metaKey||t.ctrlKey)&&t.key==="a"&&!N&&!I&&(t.preventDefault(),$()),t.key==="Escape"&&L&&m()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[$,m,L,N,I]);function M(){c({id:"",customer:"",items:0,total:"",status:"Pending",date:""})}function ie(){P(""),B("")}function ne(){return a.customer.trim()?a.total.trim()?a.date.trim()?a.items<0?"Items cannot be negative":null:"Date is required":"Total is required":"Customer is required"}async function Ie(){const s=ne();if(s){i.error(s);return}try{const t=await _e({customer:a.customer,items:a.items,total:a.total,status:a.status,date:a.date});j(r=>[t,...r??[]]),F(!1),M(),i.success("Order created successfully")}catch(t){i.error(t?.message||"Failed to create order")}}async function Ae(){const s=ne();if(s){i.error(s);return}if(!a.id){i.error("Missing order id");return}try{const t=await Je({id:a.id,customer:a.customer,items:a.items,total:a.total,status:a.status,date:a.date});j(r=>(r??[]).map(h=>h.id===t.id?t:h)),A(null),i.success("Order updated successfully")}catch(t){i.error(t?.message||"Failed to update order")}}async function Ee(s){try{await Ze(s),j(t=>(t??[]).filter(r=>r.id!==s)),A(null),i.success("Order deleted successfully")}catch(t){i.error(t?.message||"Failed to delete order")}}const Ke=s=>{switch(s){case"Delivered":return"bg-green-500/10 text-green-700";case"Shipped":return"bg-blue-500/10 text-blue-700";case"Processing":return"bg-orange-500/10 text-orange-700";case"Pending":return"bg-gray-500/10 text-gray-700";default:return"bg-gray-500/10 text-gray-700"}},Le=l.useCallback(async()=>{re(!0);try{const s=Array.from(O),t=await Ge(s);j(r=>r?.filter(h=>!s.includes(h.id))??[]),t.failedCount>0?i.warning(`Deleted ${t.successCount} orders. ${t.failedCount} failed.`):i.success(`Successfully deleted ${t.successCount} order${t.successCount!==1?"s":""}`),m()}catch(s){i.error(s?.message||"Failed to delete orders")}finally{re(!1),H(!1)}},[O,m]),$e=l.useCallback(async s=>{le(!0);try{const t=Array.from(O),r=await ze(t,s);j(h=>h&&h.map(U=>t.includes(U.id)?{...U,status:s}:U)),r.failedCount>0?i.warning(`Updated ${r.successCount} orders. ${r.failedCount} failed.`):i.success(`Successfully updated ${r.successCount} order${r.successCount!==1?"s":""}`),m()}catch(t){i.error(t?.message||"Failed to update orders")}finally{le(!1),Be(!1)}},[O,m]),He=l.useMemo(()=>se.map(s=>`${s.id} - ${s.customer}`),[se]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(b,{children:[e.jsx(w,{className:"pb-2",children:e.jsx(k,{className:"text-sm text-muted-foreground",children:"Total Orders"})}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl",children:"256"})})]}),e.jsxs(b,{children:[e.jsx(w,{className:"pb-2",children:e.jsx(k,{className:"text-sm text-muted-foreground",children:"Pending"})}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl",children:"42"})})]}),e.jsxs(b,{children:[e.jsx(w,{className:"pb-2",children:e.jsx(k,{className:"text-sm text-muted-foreground",children:"In Progress"})}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl",children:"89"})})]}),e.jsxs(b,{children:[e.jsx(w,{className:"pb-2",children:e.jsx(k,{className:"text-sm text-muted-foreground",children:"Completed"})}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl",children:"125"})})]})]}),e.jsxs(b,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{children:"Order Management"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(oe,{open:N,onOpenChange:s=>{F(s),s||M()},children:[e.jsx(ce,{asChild:!0,children:e.jsxs(S,{onClick:()=>M(),disabled:!D,title:D?void 0:"You don't have permission to add orders",children:[e.jsx(is,{className:"h-4 w-4 mr-2"}),"Add Order"]})}),e.jsxs(de,{children:[e.jsxs(ue,{children:[e.jsx(me,{children:"Add New Order"}),e.jsx(he,{children:"Enter the details for the new order."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"customer",children:"Customer"}),e.jsx(d,{id:"customer",placeholder:"Customer name",value:a.customer,onChange:s=>c({...a,customer:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"items",children:"Items"}),e.jsx(d,{id:"items",type:"number",placeholder:"0",value:a.items,onChange:s=>c({...a,items:Number(s.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"total",children:"Total (PHP ₱)"}),e.jsx(d,{id:"total",placeholder:"₱0.00",value:a.total,onChange:s=>c({...a,total:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"status",children:"Status"}),e.jsx(d,{id:"status",placeholder:"Pending",value:a.status,onChange:s=>c({...a,status:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"date",children:"Date"}),e.jsx(d,{id:"date",placeholder:"2025-10-15",value:a.date,onChange:s=>c({...a,date:s.target.value})})]}),e.jsx(S,{className:"w-full",onClick:Ie,children:"Add Order"})]})]})]})})]})}),e.jsxs(T,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ye,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(d,{placeholder:"Search orders...",value:g,onChange:s=>V(s.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx(ms,{fromDate:n,toDate:o,onFromDateChange:P,onToDateChange:B,onClear:ie,label:"Filter by Order Date"}),e.jsxs(S,{variant:f?"default":"outline",size:"sm",onClick:()=>W(!f),className:"gap-1",children:[e.jsx(js,{className:xe("h-4 w-4",f&&"fill-current")}),"Favorites",Y("orders").length>0&&e.jsx(q,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:Y("orders").length})]}),e.jsx(hs,{entityType:"orders",currentSearchTerm:g,currentFilters:ve,onApplySearch:ye})]}),(n||o)&&e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(q,{variant:"secondary",className:"gap-1",children:["Date: ",n||"..."," to ",o||"...",e.jsx("button",{onClick:ie,className:"ml-1 hover:bg-secondary-foreground/20 rounded-full p-0.5",children:e.jsx(Qe,{className:"h-3 w-3"})})]})})]}),L&&D&&e.jsx(ns,{selectionCount:te,onClearSelection:m,isLoading:ae||Oe,actions:[{id:"delete",label:"Delete",icon:e.jsx(es,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>H(!0)}],actionGroups:[{id:"status-update",label:"Update Status",icon:e.jsx(Ve,{className:"h-4 w-4 mr-1"}),options:[{value:"Pending",label:"Pending"},{value:"Processing",label:"Processing"},{value:"Shipped",label:"Shipped"},{value:"Delivered",label:"Delivered"}],onSelect:s=>$e(s)}],className:"mb-4"}),e.jsx(os,{open:Pe,onOpenChange:H,itemCount:te,itemType:"order",itemNames:He,onConfirm:Le,isLoading:ae}),pe?e.jsx(cs,{rows:8}):K.length===0?e.jsx(ds,{icon:We,title:"No orders found",description:g||n||o?"Try adjusting your search or date filters":"Get started by creating your first order",actionLabel:g||n||o?void 0:"Create Order",onAction:g||n||o?void 0:()=>F(!0)}):e.jsxs("div",{className:"rounded-md border",children:[e.jsxs(ss,{children:[e.jsx(ts,{children:e.jsxs(ge,{children:[e.jsx(je,{className:"w-12",children:e.jsx(fe,{checked:we,ref:s=>{s&&(s.indeterminate=ke)},onCheckedChange:$,"aria-label":"Select all orders"})}),e.jsx(C,{sortKey:"id",currentSortKey:p.key,sortDirection:v("id"),onSort:s=>y(s),children:"Order ID"}),e.jsx(C,{sortKey:"customer",currentSortKey:p.key,sortDirection:v("customer"),onSort:s=>y(s),children:"Customer"}),e.jsx(C,{sortKey:"items",currentSortKey:p.key,sortDirection:v("items"),onSort:s=>y(s),children:"Items"}),e.jsx(C,{sortKey:"total",currentSortKey:p.key,sortDirection:v("total"),onSort:s=>y(s),children:"Total"}),e.jsx(C,{sortKey:"status",currentSortKey:p.key,sortDirection:v("status"),onSort:s=>y(s),children:"Status"}),e.jsx(C,{sortKey:"date",currentSortKey:p.key,sortDirection:v("date"),onSort:s=>y(s),children:"Date"}),e.jsx(je,{children:"Actions"})]})}),e.jsx(as,{children:ee.map(s=>{const t=Fe(s.id);return e.jsxs(ge,{className:xe(t&&"bg-muted/50"),children:[e.jsx(x,{children:e.jsx(fe,{checked:t,onCheckedChange:()=>Te(s.id),"aria-label":`Select order ${s.id}`})}),e.jsx(x,{children:s.id}),e.jsx(x,{children:s.customer}),e.jsx(x,{children:s.items}),e.jsx(x,{children:s.total}),e.jsx(x,{children:e.jsx(q,{variant:"secondary",className:Ke(s.status),children:s.status})}),e.jsx(x,{children:s.date}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xs,{entityType:"orders",entityId:s.id,entityName:`${s.id} - ${s.customer}`}),e.jsxs(oe,{open:I===s.id,onOpenChange:r=>{A(r?s.id:null),r&&c({...s})},children:[e.jsx(ce,{asChild:!0,children:e.jsx(S,{variant:"ghost",size:"sm",disabled:!D,title:D?void 0:"You don't have permission to edit orders",children:e.jsx(Xe,{className:"h-4 w-4"})})}),e.jsxs(de,{children:[e.jsxs(ue,{children:[e.jsxs(me,{children:["Edit Order - ",s.id]}),e.jsx(he,{children:"Update fields and save your changes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-customer",children:"Customer"}),e.jsx(d,{id:"edit-customer",value:a.customer,onChange:r=>c({...a,customer:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-items",children:"Items"}),e.jsx(d,{id:"edit-items",type:"number",value:a.items,onChange:r=>c({...a,items:Number(r.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-total",children:"Total (PHP ₱)"}),e.jsx(d,{id:"edit-total",value:a.total,onChange:r=>c({...a,total:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-status",children:"Status"}),e.jsx(d,{id:"edit-status",value:a.status,onChange:r=>c({...a,status:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-date",children:"Date"}),e.jsx(d,{id:"edit-date",value:a.date,onChange:r=>c({...a,date:r.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{className:"flex-1",onClick:Ae,children:"Save Changes"}),e.jsx(S,{variant:"destructive",onClick:()=>Ee(s.id),children:"Delete"})]})]})]})]})]})})]},s.id)})})]}),K.length>0&&e.jsx(us,{currentPage:Z,totalPages:Ce,onPageChange:De,itemsPerPage:be,totalItems:Ne})]})]})]})]})}export{Ts as OrdersView};
