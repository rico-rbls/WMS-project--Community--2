import{j as e,L as b,B as D,a1 as pe,I as A,b4 as ie,b5 as Us,b6 as Rs,b7 as Qe,b8 as Ae,b9 as Z,ba as qs,bb as Ks,bc as Ge,bd as Ye,be as Je,J as Vs,i as Hs,r as c,M as zs,aO as Ws,aL as _s,aN as Qs,N as Gs,x as u,aW as Xe,bf as be,bg as Ys,C as $,o as ee,p as se,P as Js,q as L,s as Ze,d as _,w as q,v as Xs,D as Ie,$ as es,y as Ce,z as Te,A as ke,E as Oe,F as ss,a2 as Zs,n as et,a9 as ts,aY as st,bh as tt}from"./index-CXcmQwDa.js";import{D as at,S as te,a as ae,b as re,c as ne,d as Q,T as rt,e as nt,f as as,g as rs,h as G,i as it,j as B}from"./sortable-table-head-BYpTA2Uv.js";import{u as lt,a as dt,F as ct,B as ot,T as ut,E as mt,S as ht,P as xt}from"./select-all-banner-Do52wc_Y.js";import{C as is}from"./calendar-CzUOh8sw.js";import{S as pt,F as gt}from"./favorite-button-CSOFmXlj.js";import{u as ft}from"./useTableSort-ChwkZPJ_.js";import{c as jt}from"./permissions-DeuZZz56.js";import{E as Fe}from"./editable-cell-DhDuCPJV.js";import{C as St}from"./circle-check-big-161liPvE.js";import{T as vt}from"./trending-up-biyVUBxp.js";import{P as yt}from"./plus-BkSvXOlT.js";import{T as Me}from"./trash-2-BNgqQF0p.js";import{C as Nt}from"./circle-alert-De-C_JTS.js";import{M as wt}from"./map-pin-DsXiFMVZ.js";import"./skeleton-BRAjniIE.js";import"./circle-check-Syz8_Dxx.js";function Dt({fromDate:i,toDate:y,onFromDateChange:N,onToDateChange:I,onClear:x,label:j="Date Range",className:k=""}){const m=i||y;return e.jsxs("div",{className:`space-y-2 ${k}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(is,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(b,{className:"text-sm font-medium",children:j}),m&&e.jsxs(D,{variant:"ghost",size:"sm",onClick:x,className:"h-6 px-2 text-xs",children:[e.jsx(pe,{className:"h-3 w-3 mr-1"}),"Clear"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(b,{htmlFor:"from-date",className:"text-xs text-muted-foreground",children:"From"}),e.jsx(A,{id:"from-date",type:"date",value:i,onChange:p=>N(p.target.value),className:"w-full"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(b,{htmlFor:"to-date",className:"text-xs text-muted-foreground",children:"To"}),e.jsx(A,{id:"to-date",type:"date",value:y,onChange:p=>I(p.target.value),className:"w-full"})]})]})]})}function ls(i,y){return i<=0?"out-of-stock":i<=y?"low-stock":"in-stock"}function ds(i){return`WMS-${i.replace("INV-","")}`}function bt(i,y,N,I){const x=i.reorderLevel||10,j=ls(y,x);return{brand:i.brand||"",category:i.category||"Uncategorized",description:i.description||"",images:i.photoUrl?[i.photoUrl]:[],minQuantity:x,name:i.name,price:i.pricePerPiece||0,quantity:y,sku:ds(i.id),sold:0,status:j,supplier:N,wmsInventoryId:i.id,wmsSalesOrderId:I}}async function It(i){const y=Ks(Ae,ie.IMS_PRODUCTS),N=Ge(y,Ye("wmsInventoryId","==",i)),I=await Je(N);if(I.empty){const j=ds(i),k=Ge(y,Ye("sku","==",j)),m=await Je(k);if(m.empty)return null;const p=m.docs[0];return{docId:p.id,data:p.data()}}const x=I.docs[0];return{docId:x.id,data:x.data()}}async function Ct(i,y){const N=[];let I=0;console.log("[IMS Sync] ========== STARTING IMS SYNC =========="),console.log("[IMS Sync] Sales Order ID:",i.id),console.log("[IMS Sync] Sales Order Items:",i.items.length),console.log("[IMS Sync] Available Inventory Items:",y.length),console.log("[IMS Sync] Target Collection:",ie.IMS_PRODUCTS);try{const x=await Us();console.log("[IMS Sync] Loaded suppliers:",x.length);const j=new Map;x.forEach(m=>j.set(m.id,m.name));const k=new Map;y.forEach(m=>k.set(m.id,m));for(const m of i.items)try{const p=k.get(m.inventoryItemId);if(!p){N.push(`Inventory item ${m.inventoryItemId} not found`);continue}const h=j.get(p.supplierId)||"Unknown Supplier",O=m.quantity,S=await It(p.id);if(S){const F=(S.data.quantity||0)+O,v=ls(F,S.data.minQuantity||10);await Rs(Qe(Ae,ie.IMS_PRODUCTS,S.docId),{quantity:F,status:v,updatedAt:Z(),lastSyncedFromWMS:Z(),wmsSalesOrderId:i.id}),console.log(`[IMS Sync] Updated product ${p.name}: +${O} (total: ${F})`)}else{const F=bt(p,O,h,i.id),v=`wms-${p.id.toLowerCase().replace(/[^a-z0-9]/g,"-")}-${Date.now()}`;console.log(`[IMS Sync] Creating new product in collection '${ie.IMS_PRODUCTS}' with docId: ${v}`),console.log("[IMS Sync] Product data:",JSON.stringify(F,null,2)),await qs(Qe(Ae,ie.IMS_PRODUCTS,v),{...F,createdAt:Z(),updatedAt:Z(),lastSyncedFromWMS:Z()}),console.log(`[IMS Sync] âœ… Created new product ${p.name} with qty ${O}`)}I++}catch(p){const h=`Failed to sync item ${m.itemName}: ${p.message}`;N.push(h),console.error(`[IMS Sync] ${h}`)}return{success:N.length===0,syncedItems:I,errors:N}}catch(x){return console.error("[IMS Sync] Fatal error:",x),{success:!1,syncedItems:0,errors:[x.message]}}}const Pe=["Pending","In Transit","Delivered"],ns=["FedEx","UPS","DHL","USPS","LBC Express","J&T Express","Ninja Van","Grab Express"];function zt({initialOpenDialog:i,onDialogOpened:y}){const{isFavorite:N,getFavoritesByType:I}=Vs(),{user:x}=Hs(),j=x?jt(x.role):!1,k=x?.role==="Customer",[m,p]=c.useState(""),[h,O]=c.useState("all"),[S,F]=c.useState(""),[v,ge]=c.useState(""),[K,Ee]=c.useState(!1),[U,E]=c.useState(null),[le,cs]=c.useState([]),[os,$e]=c.useState(!0),[Y,J]=c.useState(!1),[fe,de]=c.useState(null),[r,C]=c.useState({id:"",salesOrderId:"",destination:"",carrier:"",status:"Pending",eta:""}),je=zs(m,300),Le=c.useMemo(()=>!k||!x?.email?new Set:new Set(le.filter(s=>s.createdBy===x.email).map(s=>s.id)),[k,x?.email,le]);c.useEffect(()=>{(async()=>{$e(!0);const[s,t]=await Promise.all([Ws(),_s()]);E(s),cs(t),$e(!1)})()},[]),c.useEffect(()=>{i&&!Y&&(J(!0),y?.())},[i,y,Y]);const T=c.useMemo(()=>U??[],[U]),w=c.useMemo(()=>{const s=T.length,t=T.filter(l=>l.status==="Pending").length,a=T.filter(l=>l.status==="In Transit").length,n=T.filter(l=>l.status==="Delivered").length,g=t+a,d=new Date,o=new Date(d.getTime()-10080*60*1e3);new Date(d.getTime()-720*60*60*1e3);const P=new Date(d.getTime()+10080*60*1e3),W=T.filter(l=>{if(l.status!=="Delivered")return!1;try{const f=new Date(l.eta);return f>=o&&f<=d}catch{return!1}}).length,Fs=T.filter(l=>{if(l.status==="Delivered")return!1;try{const f=new Date(l.eta);return f>=d&&f<=P}catch{return!1}}).length,De=T.filter(l=>l.status==="Delivered"),Ms=De.length,Ps=De.length>0?Math.round(Ms/De.length*100):0,As=s>0?Math.round(n/s*100):0,Es=T.reduce((l,f)=>(l[f.carrier]=(l[f.carrier]||0)+1,l),{}),$s=Object.entries(Es).sort((l,f)=>f[1]-l[1]).slice(0,5).map(([l,f])=>({name:l,count:f})),Ls=T.reduce((l,f)=>(l[f.destination]=(l[f.destination]||0)+1,l),{}),Bs=Object.entries(Ls).sort((l,f)=>f[1]-l[1]).slice(0,5).map(([l,f])=>({name:l,count:f}));return{totalShipments:s,pendingShipments:t,inTransitShipments:a,deliveredShipments:n,activeShipments:g,recentDeliveries7Days:W,upcomingDeliveries:Fs,onTimeRate:Ps,fulfillmentRate:As,topCarriers:$s,topDestinations:Bs,avgTransitDays:3}},[T]),ce=c.useMemo(()=>T.filter(s=>{if(k&&!Le.has(s.salesOrderId)||K&&!N("shipments",s.id)||h!=="all"&&s.status!==h)return!1;if(je){const t=je.toLowerCase();if(!(s.id.toLowerCase().includes(t)||s.salesOrderId.toLowerCase().includes(t)||s.destination.toLowerCase().includes(t)||s.carrier.toLowerCase().includes(t)))return!1}if(S||v)try{const t=new Date(s.eta);if(S){const a=new Date(S);if(t<a)return!1}if(v){const a=new Date(v);if(a.setHours(23,59,59,999),t>a)return!1}}catch{return!1}return!0}),[T,je,h,S,v,K,N,k,Le]),{sortedData:Be,sortConfig:V,requestSort:H,getSortDirection:z}=ft(ce),{currentPage:Ue,totalPages:us,paginatedData:Re,goToPage:ms,totalItems:hs,itemsPerPage:xs}=lt(Be,25),{selectedIds:oe,selectedItems:qe,selectionCount:Se,isAllSelected:ps,isAllPageSelected:gs,isAllPagesSelected:fs,isPartiallySelected:js,hasSelection:ve,toggleItem:Ss,toggleAll:ye,selectAllPages:vs,deselectAll:M,isSelected:ys,totalItemCount:Ke,pageItemCount:Ve}=dt(Re,Be),[ue,He]=c.useState(!1),[Ns,ze]=c.useState(!1),[ws,me]=c.useState(!1),Ds=()=>{const s=["Shipment ID","Sales Order ID","Carrier","Tracking #","Status","Origin","Destination","Ship Date","ETA","Delivered Date","Notes"],t=ce.map(o=>[o.id,o.salesOrderId,o.carrier,o.trackingNumber||"",o.status,o.origin||"",o.destination||"",o.shipDate||"",o.eta||"",o.deliveredDate||"",o.notes||""]),a=[s,...t].map(o=>o.map(P=>`"${P}"`).join(",")).join(`
`),n=new Blob([a],{type:"text/csv"}),g=URL.createObjectURL(n),d=document.createElement("a");d.href=g,d.download=`shipments-${new Date().toISOString().split("T")[0]}.csv`,d.click(),URL.revokeObjectURL(g),u.success("Shipments exported to CSV")};c.useEffect(()=>{M()},[Ue,M]),c.useEffect(()=>{const s=t=>{(t.metaKey||t.ctrlKey)&&t.key==="a"&&!Y&&!fe&&(t.preventDefault(),ye()),t.key==="Escape"&&ve&&M()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[ye,M,ve,Y,fe]);function Ne(){C({id:"",salesOrderId:"",destination:"",carrier:"",status:"Pending",eta:new Date(Date.now()+10080*60*1e3).toISOString().split("T")[0]})}function We(){F(""),ge("")}function bs(){p(""),O("all"),F(""),ge(""),Ee(!1)}function _e(){return r.salesOrderId.trim()?r.destination.trim()?r.carrier.trim()?r.eta.trim()?null:"ETA is required":"Carrier is required":"Destination is required":"Sales Order ID is required"}async function Is(){const s=_e();if(s){u.error(s);return}try{const t=await st({salesOrderId:r.salesOrderId,destination:r.destination,carrier:r.carrier,status:r.status,eta:r.eta});E(a=>[t,...a??[]]),J(!1),Ne(),u.success("Shipment created successfully")}catch(t){u.error(t?.message||"Failed to create shipment")}}async function Cs(){const s=_e();if(s){u.error(s);return}if(!r.id){u.error("Missing shipment id");return}try{const t=U?.find(g=>g.id===r.id),a=r.status==="Delivered"&&t?.status!=="Delivered",n=await be({id:r.id,salesOrderId:r.salesOrderId,destination:r.destination,carrier:r.carrier,status:r.status,eta:r.eta});E(g=>(g??[]).map(d=>d.id===n.id?n:d)),de(null),u.success("Shipment updated successfully"),a&&await X(n)}catch(t){u.error(t?.message||"Failed to update shipment")}}async function Ts(s){try{await tt(s),E(t=>(t??[]).filter(a=>a.id!==s)),de(null),u.success("Shipment deleted successfully")}catch(t){u.error(t?.message||"Failed to delete shipment")}}const X=c.useCallback(async s=>{try{const t=le.find(n=>n.id===s.salesOrderId);if(!t){console.warn("[Shipment] No sales order found for shipment:",s.id);return}t.inventorySyncedToIMS&&console.log("[Shipment] Order already synced to IMS, skipping sync:",t.id);const a=await Qs();for(const n of t.items){const g=a.find(d=>d.id===n.inventoryItemId);if(g){const d=Math.max(0,g.quantity-n.quantity);await Gs({id:g.id,quantity:d,quantitySold:(g.quantitySold||0)+n.quantity}),console.log(`[Inventory] Deducted ${n.quantity} from ${g.name}. New qty: ${d}`)}}if(t.inventorySyncedToIMS)await Xe({id:t.id,shippingStatus:"Delivered"});else{console.log("[IMS Sync] Starting sync for order:",t.id);const n=await Ct(t,a);n.success?(console.log(`[IMS Sync] Successfully synced ${n.syncedItems} items to IMS`),u.success(`Synced ${n.syncedItems} items to IMS`)):(console.warn("[IMS Sync] Partial sync:",n.errors),n.syncedItems>0?u.warning(`Synced ${n.syncedItems} items to IMS (some errors occurred)`):u.error("Failed to sync inventory to IMS")),await Xe({id:t.id,shippingStatus:"Delivered",inventorySyncedToIMS:!0,inventorySyncedAt:new Date().toISOString()})}u.success("Inventory updated for delivered order")}catch(t){console.error("[Shipment] Failed to deduct inventory:",t),u.error("Shipment marked as delivered but inventory update failed")}},[le]),we=c.useCallback(async(s,t,a)=>{try{const n=U?.find(P=>P.id===s),g=t==="status"&&a==="Delivered"&&n?.status!=="Delivered",d={[t]:a},o=await be({id:s,...d});E(P=>(P??[]).map(W=>W.id===s?o:W)),u.success(`${t.charAt(0).toUpperCase()+t.slice(1)} updated`),g&&await X(o)}catch(n){throw u.error(n?.message||"Failed to update"),n}},[U,E,X]),he=s=>{switch(s){case"Delivered":return"bg-emerald-500/15 text-emerald-700 dark:text-emerald-400 border-emerald-200";case"In Transit":return"bg-blue-500/15 text-blue-700 dark:text-blue-400 border-blue-200";case"Pending":return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200";default:return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200"}},R=s=>{switch(s){case"Delivered":return"âœ“";case"In Transit":return"ðŸšš";case"Pending":return"â—‹";default:return"â—‹"}},ks=c.useCallback(async()=>{He(!0);try{const s=Array.from(oe),t=await Ys(s);E(a=>a?.filter(n=>!s.includes(n.id))??[]),t.failedCount>0?u.warning(`Deleted ${t.successCount} shipments. ${t.failedCount} failed.`):u.success(`Successfully deleted ${t.successCount} shipment${t.successCount!==1?"s":""}`),M()}catch(s){u.error(s?.message||"Failed to delete shipments")}finally{He(!1),me(!1)}},[oe,M]),Os=c.useCallback(async s=>{ze(!0);try{const t=Array.from(oe);let a=0,n=0;const g=[];for(const d of t)try{const o=U?.find(W=>W.id===d),P=s==="Delivered"&&o?.status!=="Delivered";await be({id:d,status:s}),a++,P&&o&&g.push({...o,status:"Delivered"})}catch{n++}E(d=>d&&d.map(o=>t.includes(o.id)?{...o,status:s}:o)),n>0?u.warning(`Updated ${a} shipments. ${n} failed.`):u.success(`Successfully updated ${a} shipment${a!==1?"s":""}`);for(const d of g)await X(d);M()}catch(t){u.error(t?.message||"Failed to update shipments")}finally{ze(!1)}},[oe,U,M,X]),xe=c.useMemo(()=>qe.map(s=>`${s.id} â†’ ${s.destination}`),[qe]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Shipments"}),e.jsx("p",{className:"text-muted-foreground",children:"Track shipment status, carrier information, and delivery timelines"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs($,{className:"relative overflow-hidden",children:[e.jsxs(ee,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(se,{className:"text-sm font-medium text-muted-foreground",children:"Total Shipments"}),e.jsx(Js,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold",children:w.totalShipments}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[w.upcomingDeliveries," arriving this week"]})]})]}),e.jsxs($,{className:"relative overflow-hidden",children:[e.jsxs(ee,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(se,{className:"text-sm font-medium text-muted-foreground",children:"Active Shipments"}),e.jsx(Ze,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:w.activeShipments}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[w.pendingShipments," pending, ",w.inTransitShipments," in transit"]})]})]}),e.jsxs($,{className:"relative overflow-hidden",children:[e.jsxs(ee,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(se,{className:"text-sm font-medium text-muted-foreground",children:"Delivered"}),e.jsx(St,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:w.deliveredShipments}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[w.recentDeliveries7Days," in last 7 days"]})]})]}),e.jsxs($,{className:"relative overflow-hidden",children:[e.jsxs(ee,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(se,{className:"text-sm font-medium text-muted-foreground",children:"Fulfillment Rate"}),e.jsx(vt,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(L,{children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[w.fulfillmentRate,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[w.deliveredShipments," of ",w.totalShipments," fulfilled"]})]})]})]}),e.jsxs("div",{className:"grid gap-3 grid-cols-1 sm:grid-cols-3",children:[e.jsx($,{className:_("cursor-pointer transition-all hover:shadow-md border-l-4",h==="Pending"?"ring-2 ring-primary":"","border-l-slate-400"),onClick:()=>O(h==="Pending"?"all":"Pending"),children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Pending"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:w.pendingShipments})]}),e.jsx(q,{variant:"outline",className:he("Pending"),children:R("Pending")})]})})}),e.jsx($,{className:_("cursor-pointer transition-all hover:shadow-md border-l-4",h==="In Transit"?"ring-2 ring-primary":"","border-l-blue-400"),onClick:()=>O(h==="In Transit"?"all":"In Transit"),children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"In Transit"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:w.inTransitShipments})]}),e.jsx(q,{variant:"outline",className:he("In Transit"),children:R("In Transit")})]})})}),e.jsx($,{className:_("cursor-pointer transition-all hover:shadow-md border-l-4",h==="Delivered"?"ring-2 ring-primary":"","border-l-emerald-400"),onClick:()=>O(h==="Delivered"?"all":"Delivered"),children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Delivered"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:w.deliveredShipments})]}),e.jsx(q,{variant:"outline",className:he("Delivered"),children:R("Delivered")})]})})})]}),e.jsxs($,{children:[e.jsx(ee,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(se,{className:"text-xl",children:"Shipment Tracking"}),e.jsx(Xs,{className:"mt-1",children:"Track and manage all shipments and deliveries"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{variant:"outline",onClick:Ds,children:[e.jsx(at,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),e.jsxs(Ie,{open:Y,onOpenChange:s=>{J(s),s||Ne()},children:[e.jsx(es,{asChild:!0,children:e.jsxs(D,{onClick:()=>Ne(),disabled:!j,title:j?void 0:"You don't have permission to add shipments",children:[e.jsx(yt,{className:"h-4 w-4 mr-2"}),"Add Shipment"]})}),e.jsxs(Ce,{className:"sm:max-w-[500px]",children:[e.jsxs(Te,{children:[e.jsx(ke,{children:"Create New Shipment"}),e.jsx(Oe,{children:"Enter the details for the new shipment."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"salesOrderId",children:"Sales Order ID *"}),e.jsx(A,{id:"salesOrderId",placeholder:"SO-001",value:r.salesOrderId,onChange:s=>C({...r,salesOrderId:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"status",children:"Status"}),e.jsxs(te,{value:r.status,onValueChange:s=>C({...r,status:s}),children:[e.jsx(ae,{children:e.jsx(re,{placeholder:"Select status"})}),e.jsx(ne,{children:Pe.map(s=>e.jsx(Q,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:R(s)}),s]})},s))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"destination",children:"Destination *"}),e.jsx(A,{id:"destination",placeholder:"City, Province/State",value:r.destination,onChange:s=>C({...r,destination:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"carrier",children:"Carrier *"}),e.jsxs(te,{value:r.carrier,onValueChange:s=>C({...r,carrier:s}),children:[e.jsx(ae,{children:e.jsx(re,{placeholder:"Select carrier"})}),e.jsx(ne,{children:ns.map(s=>e.jsx(Q,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"eta",children:"ETA *"}),e.jsx(A,{id:"eta",type:"date",value:r.eta,onChange:s=>C({...r,eta:s.target.value})})]})]})]}),e.jsxs(ss,{children:[e.jsx(D,{variant:"outline",onClick:()=>J(!1),children:"Cancel"}),e.jsx(D,{onClick:Is,children:"Create Shipment"})]})]})]})]})]})}),e.jsxs(L,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Zs,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(A,{placeholder:"Search by ID, order ID, destination, or carrier...",value:m,onChange:s=>p(s.target.value),className:"pl-9"})]}),e.jsxs(te,{value:h,onValueChange:O,children:[e.jsxs(ae,{className:"w-full sm:w-[180px]",children:[e.jsx(ct,{className:"h-4 w-4 mr-2"}),e.jsx(re,{placeholder:"Filter by status"})]}),e.jsxs(ne,{children:[e.jsx(Q,{value:"all",children:"All Statuses"}),Pe.map(s=>e.jsx(Q,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:R(s)}),s]})},s))]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx(Dt,{fromDate:S,toDate:v,onFromDateChange:F,onToDateChange:ge,onClear:We,label:"Filter by ETA Date"}),e.jsxs(D,{variant:K?"default":"outline",size:"sm",onClick:()=>Ee(!K),className:"gap-1",children:[e.jsx(pt,{className:_("h-4 w-4",K&&"fill-current")}),"Favorites",I("shipments").length>0&&e.jsx(q,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:I("shipments").length})]}),(m||h!=="all"||S||v||K)&&e.jsxs(D,{variant:"ghost",size:"sm",onClick:bs,className:"text-muted-foreground hover:text-foreground",children:[e.jsx(pe,{className:"h-4 w-4 mr-1"}),"Clear All"]})]}),(h!=="all"||S||v)&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[h!=="all"&&e.jsxs(q,{variant:"secondary",className:"gap-1",children:["Status: ",h,e.jsx("button",{onClick:()=>O("all"),className:"ml-1 hover:bg-secondary-foreground/20 rounded-full p-0.5",children:e.jsx(pe,{className:"h-3 w-3"})})]}),(S||v)&&e.jsxs(q,{variant:"secondary",className:"gap-1",children:["ETA: ",S||"..."," to ",v||"...",e.jsx("button",{onClick:We,className:"ml-1 hover:bg-secondary-foreground/20 rounded-full p-0.5",children:e.jsx(pe,{className:"h-3 w-3"})})]})]})]}),ve&&j&&e.jsx(ot,{selectionCount:Se,onClearSelection:M,isLoading:ue||Ns,actions:[{id:"delete",label:"Delete",icon:e.jsx(Me,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>me(!0)}],actionGroups:[{id:"status-update",label:"Update Status",icon:e.jsx(et,{className:"h-4 w-4 mr-1"}),options:[{value:"Pending",label:"Pending"},{value:"Processing",label:"Processing"},{value:"In Transit",label:"In Transit"},{value:"Delivered",label:"Delivered"}],onSelect:s=>Os(s)}],className:"mb-4"}),e.jsx(Ie,{open:ws,onOpenChange:me,children:e.jsxs(Ce,{className:"max-w-md",children:[e.jsxs(Te,{children:[e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(Nt,{className:"h-5 w-5 text-destructive"}),"Delete ",Se," Shipment",Se!==1?"s":""]}),e.jsx(Oe,{children:"Are you sure you want to delete the selected shipments?"})]}),xe.length>0&&e.jsx("div",{className:"max-h-32 overflow-y-auto border rounded-md p-2 bg-muted/50",children:e.jsxs("ul",{className:"text-sm space-y-1",children:[xe.slice(0,10).map((s,t)=>e.jsxs("li",{className:"truncate",children:["â€¢ ",s]},t)),xe.length>10&&e.jsxs("li",{className:"text-muted-foreground",children:["...and ",xe.length-10," more"]})]})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("div",{className:"p-3 border border-destructive/50 rounded-md bg-destructive/10",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Me,{className:"h-4 w-4 mt-0.5 text-destructive"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-destructive",children:"Delete Shipments"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This action cannot be undone. Selected shipments will be permanently removed."})]})]})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(D,{variant:"outline",onClick:()=>me(!1),disabled:ue,children:"Cancel"}),e.jsx(D,{variant:"destructive",onClick:ks,disabled:ue,children:ue?"Deleting...":"Delete All"})]})]})]})}),os?e.jsx(ut,{rows:8}):ce.length===0?e.jsx(mt,{icon:Ze,title:"No shipments found",description:m||h!=="all"||S||v?"Try adjusting your search or filters":"Get started by creating your first shipment",actionLabel:m||h!=="all"||S||v?void 0:"Create Shipment",onAction:m||h!=="all"||S||v?void 0:()=>J(!0)}):e.jsxs("div",{className:"rounded-md border overflow-hidden",children:[e.jsx(ht,{pageItemCount:Ve,totalItemCount:Ke,isAllPagesSelected:fs,show:gs&&Ke>Ve,onSelectAllPages:vs,onClearSelection:M,itemLabel:"shipments"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(rt,{children:[e.jsx(nt,{children:e.jsxs(as,{children:[e.jsx(rs,{className:"w-12",children:e.jsx(ts,{checked:ps,ref:s=>{s&&(s.indeterminate=js)},onCheckedChange:ye,"aria-label":"Select all shipments"})}),e.jsx(G,{sortKey:"id",currentSortKey:V.key,sortDirection:z("id"),onSort:s=>H(s),children:"Shipment ID"}),e.jsx(G,{sortKey:"salesOrderId",currentSortKey:V.key,sortDirection:z("salesOrderId"),onSort:s=>H(s),children:"Sales Order ID"}),e.jsx(G,{sortKey:"destination",currentSortKey:V.key,sortDirection:z("destination"),onSort:s=>H(s),children:"Destination"}),e.jsx(G,{sortKey:"carrier",currentSortKey:V.key,sortDirection:z("carrier"),onSort:s=>H(s),children:"Carrier"}),e.jsx(G,{sortKey:"status",currentSortKey:V.key,sortDirection:z("status"),onSort:s=>H(s),children:"Status"}),e.jsx(G,{sortKey:"eta",currentSortKey:V.key,sortDirection:z("eta"),onSort:s=>H(s),children:"ETA"}),e.jsx(rs,{children:"Actions"})]})}),e.jsx(it,{children:Re.map(s=>{const t=ys(s.id);return e.jsxs(as,{className:_("transition-colors hover:bg-muted/50",t&&"bg-primary/5 hover:bg-primary/10"),children:[e.jsx(B,{children:e.jsx(ts,{checked:t,onCheckedChange:()=>Ss(s.id),"aria-label":`Select shipment ${s.id}`})}),e.jsx(B,{children:e.jsx("span",{className:"font-mono text-sm font-medium",children:s.id})}),e.jsx(B,{children:e.jsx(Fe,{value:s.salesOrderId,type:"text",onSave:a=>we(s.id,"salesOrderId",a),disabled:!j})}),e.jsx(B,{children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(wt,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx(Fe,{value:s.destination,type:"text",onSave:a=>we(s.id,"destination",a),disabled:!j})]})}),e.jsx(B,{children:e.jsx(Fe,{value:s.carrier,type:"text",onSave:a=>we(s.id,"carrier",a),disabled:!j})}),e.jsx(B,{children:e.jsxs(q,{variant:"outline",className:_("font-medium",he(s.status)),children:[e.jsx("span",{className:"mr-1",children:R(s.status)}),s.status]})}),e.jsx(B,{children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(is,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:new Date(s.eta).toLocaleDateString()})]})}),e.jsx(B,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(gt,{entityType:"shipments",entityId:s.id,entityName:`${s.id} - ${s.destination}`}),e.jsxs(Ie,{open:fe===s.id,onOpenChange:a=>{de(a?s.id:null),a&&C({...s})},children:[e.jsx(es,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"sm",disabled:!j,title:j?void 0:"You don't have permission to edit shipments",children:"View / Edit"})}),e.jsxs(Ce,{className:"sm:max-w-[500px]",children:[e.jsxs(Te,{children:[e.jsx(ke,{children:"Edit Shipment"}),e.jsxs(Oe,{children:["Shipment ID: ",s.id]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"edit-salesOrderId",children:"Sales Order ID *"}),e.jsx(A,{id:"edit-salesOrderId",value:r.salesOrderId,onChange:a=>C({...r,salesOrderId:a.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"edit-status",children:"Status"}),e.jsxs(te,{value:r.status,onValueChange:a=>C({...r,status:a}),children:[e.jsx(ae,{children:e.jsx(re,{placeholder:"Select status"})}),e.jsx(ne,{children:Pe.map(a=>e.jsx(Q,{value:a,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:R(a)}),a]})},a))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"edit-destination",children:"Destination *"}),e.jsx(A,{id:"edit-destination",value:r.destination,onChange:a=>C({...r,destination:a.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"edit-carrier",children:"Carrier *"}),e.jsxs(te,{value:r.carrier,onValueChange:a=>C({...r,carrier:a}),children:[e.jsx(ae,{children:e.jsx(re,{placeholder:"Select carrier"})}),e.jsx(ne,{children:ns.map(a=>e.jsx(Q,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"edit-eta",children:"ETA *"}),e.jsx(A,{id:"edit-eta",type:"date",value:r.eta,onChange:a=>C({...r,eta:a.target.value})})]})]})]}),e.jsxs(ss,{className:"flex-col sm:flex-row gap-2",children:[e.jsxs(D,{variant:"destructive",onClick:()=>Ts(s.id),className:"sm:mr-auto",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Delete"]}),e.jsx(D,{variant:"outline",onClick:()=>de(null),children:"Cancel"}),e.jsx(D,{onClick:Cs,children:"Save Changes"})]})]})]})]})})]},s.id)})})]})}),ce.length>0&&e.jsx(xt,{currentPage:Ue,totalPages:us,onPageChange:ms,itemsPerPage:xs,totalItems:hs})]})]})]})]})}export{zt as ShipmentsView};
