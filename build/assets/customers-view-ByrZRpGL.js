import{J as Cs,i as bs,r as i,M as ws,aM as Ss,aX as ye,x as n,bf as qe,bg as Fs,bh as ks,j as e,C as w,o as _,p as J,U as Ne,q as S,S as As,P as Ds,d as L,w as K,v as Ps,B as o,D as ie,$ as Ts,y as ce,z as de,A as oe,E as me,L as d,I as u,F as Ce,bi as Es,a2 as Is,a1 as Ls,n as Bs,a9 as He,aT as Ge,aU as Xe,aa as $s,bj as Us,bk as Ks,bl as Os}from"./index-DgWTvQdt.js";import{D as Rs,S as W,a as Y,b as Q,c as Z,d as V,T as Ms,e as zs,f as _e,g as Je,h as E,i as Vs,j as N}from"./sortable-table-head-DDkBZ-it.js";import{u as qs,a as Hs,F as Gs,B as Xs,T as _s,E as Js,S as Ws,P as Ys}from"./select-all-banner-BS7jqRl1.js";import{S as Qs,F as We}from"./favorite-button-UqzhTJBs.js";import{u as Zs}from"./useTableSort-BWQsE1_O.js";import{c as et}from"./permissions-DeuZZz56.js";import{E as be}from"./editable-cell-CgsoPUCh.js";import{C as st}from"./circle-check-big-B60wfX7n.js";import{P as tt}from"./plus-CSAckPT2.js";import{A as q,a as Ye,D as at}from"./dollar-sign-BdQ7DNNs.js";import{T as ue}from"./trash-2-Dump8JUL.js";import{C as rt}from"./circle-alert-B0WMrk03.js";import{S as Qe}from"./square-pen-CcY6XLXj.js";import{M as lt}from"./map-pin-DGeNxal7.js";import"./skeleton-D6qudQFR.js";import"./circle-check-4DAYp0Ac.js";const we=["Active","Inactive"],Se=["Technology","Startup","Enterprise","Retail","Healthcare","Finance","Other"];function Ct({initialOpenDialog:Fe,onDialogOpened:ke,initialCustomerId:ee,onCustomerDialogOpened:Ae}){const{isFavorite:De,getFavoritesByType:Pe}=Cs(),{user:se}=bs(),C=se?et(se.role):!1,he=se?.role==="Admin"||se?.role==="Owner",[O,Te]=i.useState(""),[F,te]=i.useState("all"),[R,Ee]=i.useState(!1),[h,Ie]=i.useState(!1),[H,j]=i.useState(null),[Ze,Le]=i.useState(!0),[G,X]=i.useState(!1),[M,B]=i.useState(null),[xe,z]=i.useState(null),[t,c]=i.useState({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0}),ge=ws(O,300);i.useEffect(()=>{(async()=>{Le(!0);const s=await Ss();j(s),Le(!1)})()},[]),i.useEffect(()=>{Fe&&!G&&(X(!0),ke?.())},[Fe,ke,G]),i.useEffect(()=>{ee&&H&&H.find(a=>a.id===ee)&&(z(ee),Ae?.())},[ee,H,Ae]);const v=i.useMemo(()=>H??[],[H]),p=i.useMemo(()=>{const s=v.length,a=v.filter(g=>g.status==="Active").length,r=v.filter(g=>g.status==="Inactive").length,l=new Set(v.map(g=>g.category)).size,f=v.reduce((g,U)=>g+U.purchases,0),y=v.reduce((g,U)=>g+U.payments,0),m=v.reduce((g,U)=>g+U.balance,0);let ne=null;if(v.length>0){const g=[...v].sort((U,Ns)=>Ns.purchases-U.purchases);g[0].purchases>0&&(ne={id:g[0].id,name:g[0].name,value:g[0].purchases})}return{totalCustomers:s,activeCustomers:a,inactiveCustomers:r,uniqueCategories:l,totalPurchases:f,totalPayments:y,totalBalance:m,topCustomerByPurchases:ne}},[v]),ae=i.useMemo(()=>v.filter(s=>{if(s.archived===!0!==h||R&&!De("customers",s.id)||F!=="all"&&s.status!==F)return!1;if(ge){const r=ge.toLowerCase();if(!(s.name.toLowerCase().includes(r)||s.id.toLowerCase().includes(r)||s.category.toLowerCase().includes(r)||s.contact.toLowerCase().includes(r)||s.email.toLowerCase().includes(r)))return!1}return!0}),[v,ge,F,R,De,h]);function es(){Te(""),te("all"),Ee(!1),Ie(!1)}async function ss(s){try{const a=await Os(s);j(r=>(r??[]).map(l=>l.id===s?a:l)),B(null),n.success("Customer archived successfully")}catch(a){n.error(a?.message||"Failed to archive customer")}}async function ts(s){try{const a=await Us(s);j(r=>(r??[]).map(l=>l.id===s?a:l)),B(null),n.success("Customer restored successfully")}catch(a){n.error(a?.message||"Failed to restore customer")}}async function as(s){try{await Ks(s),j(a=>(a??[]).filter(r=>r.id!==s)),B(null),n.success("Customer permanently deleted")}catch(a){n.error(a?.message||"Failed to permanently delete customer")}}const $=s=>{switch(s){case"Active":return"✓";case"Inactive":return"○";default:return"○"}},re=s=>{switch(s){case"Active":return"bg-emerald-500/15 text-emerald-700 dark:text-emerald-400 border-emerald-200";case"Inactive":return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200";default:return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200"}},{sortedData:Be,sortConfig:k,requestSort:A,getSortDirection:D}=Zs(ae),{currentPage:$e,totalPages:rs,paginatedData:Ue,goToPage:ls,totalItems:ns,itemsPerPage:is}=qs(Be,25),{selectedIds:b,selectedItems:Ke,selectionCount:pe,isAllSelected:cs,isAllPageSelected:ds,isAllPagesSelected:os,isPartiallySelected:ms,hasSelection:je,toggleItem:us,toggleAll:ve,selectAllPages:hs,deselectAll:x,isSelected:xs,totalItemCount:Oe,pageItemCount:Re}=Hs(Ue,Be),[P,I]=i.useState(!1),[gs,Me]=i.useState(!1),[ps,T]=i.useState(!1),js=()=>{const s=["Customer ID","Name","Contact Person","Email","Phone","Status","Country","City","Address","Sales Total","Receipts","Balance","Created Date"],a=ae.map(m=>[m.id,m.name,m.contact||"",m.email||"",m.phone||"",m.status,m.country||"",m.city||"",m.address||"",(m.sales||0).toFixed(2),(m.receipts||0).toFixed(2),(m.balance||0).toFixed(2),m.createdDate||""]),r=[s,...a].map(m=>m.map(ne=>`"${ne}"`).join(",")).join(`
`),l=new Blob([r],{type:"text/csv"}),f=URL.createObjectURL(l),y=document.createElement("a");y.href=f,y.download=`customers-${new Date().toISOString().split("T")[0]}.csv`,y.click(),URL.revokeObjectURL(f),n.success("Customers exported to CSV")};i.useEffect(()=>{x()},[$e,x]),i.useEffect(()=>{const s=a=>{(a.metaKey||a.ctrlKey)&&a.key==="a"&&!G&&!M&&(a.preventDefault(),ve()),a.key==="Escape"&&je&&x()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[ve,x,je,G,M]);const fe=i.useCallback(async(s,a,r)=>{try{const l={[a]:r},f=await ye({id:s,...l});j(y=>(y??[]).map(m=>m.id===s?f:m)),n.success(`${a.charAt(0).toUpperCase()+a.slice(1)} updated`)}catch(l){throw n.error(l?.message||"Failed to update"),l}},[j]);i.useCallback(async()=>{I(!0);try{const s=Array.from(b),a=await qe(s);j(r=>r&&r.map(l=>s.includes(l.id)?{...l,archived:!0,archivedAt:new Date().toISOString()}:l)),a.failedCount>0?n.warning(`Deleted ${a.successCount} customers. ${a.failedCount} failed.`):n.success(`Successfully deleted ${a.successCount} customer${a.successCount!==1?"s":""}`),x()}catch(s){n.error(s?.message||"Failed to delete customers")}finally{I(!1),T(!1)}},[b,x]);const vs=i.useCallback(async()=>{I(!0);try{const s=Array.from(b),a=await qe(s);j(r=>r&&r.map(l=>s.includes(l.id)?{...l,archived:!0,archivedAt:new Date().toISOString()}:l)),a.failedCount>0?n.warning(`Archived ${a.successCount} customers. ${a.failedCount} failed.`):n.success(`Successfully archived ${a.successCount} customer${a.successCount!==1?"s":""}`),x()}catch(s){n.error(s?.message||"Failed to archive customers")}finally{I(!1),T(!1)}},[b,x]),fs=i.useCallback(async()=>{I(!0);try{const s=Array.from(b),a=await Fs(s);j(r=>r&&r.map(l=>s.includes(l.id)?{...l,archived:!1,archivedAt:void 0}:l)),a.failedCount>0?n.warning(`Restored ${a.successCount} customers. ${a.failedCount} failed.`):n.success(`Successfully restored ${a.successCount} customer${a.successCount!==1?"s":""}`),x()}catch(s){n.error(s?.message||"Failed to restore customers")}finally{I(!1),T(!1)}},[b,x]),ze=i.useCallback(async()=>{I(!0);try{const s=Array.from(b),a=await ks(s);j(r=>r?.filter(l=>!s.includes(l.id))??[]),a.failedCount>0?n.warning(`Permanently deleted ${a.successCount} customers. ${a.failedCount} failed.`):n.success(`Permanently deleted ${a.successCount} customer${a.successCount!==1?"s":""}`),x()}catch(s){n.error(s?.message||"Failed to permanently delete customers")}finally{I(!1),T(!1)}},[b,x]),ys=i.useCallback(async s=>{Me(!0);try{const a=Array.from(b);let r=0,l=0;for(const f of a)try{await ye({id:f,status:s}),r++}catch{l++}j(f=>f&&f.map(y=>a.includes(y.id)?{...y,status:s}:y)),l>0?n.warning(`Updated ${r} customers. ${l} failed.`):n.success(`Successfully updated ${r} customer${r!==1?"s":""}`),x()}catch(a){n.error(a?.message||"Failed to update customers")}finally{Me(!1)}},[b,x]),Ve=i.useCallback(s=>{c({id:s.id,name:s.name,contact:s.contact,email:s.email,phone:s.phone,category:s.category,status:s.status,country:s.country||"",city:s.city||"",address:s.address||"",purchases:s.purchases||0,payments:s.payments||0}),B(s.id)},[]),le=i.useMemo(()=>Ke.map(s=>s.name),[Ke]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Customers"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage customer profiles, contact details, and sales relationships"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(w,{className:"relative overflow-hidden",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(J,{className:"text-sm font-medium text-muted-foreground",children:"Total Customers"}),e.jsx(Ne,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold",children:p.totalCustomers}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[p.activeCustomers," active, ",p.inactiveCustomers," inactive"]})]})]}),e.jsxs(w,{className:"relative overflow-hidden",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(J,{className:"text-sm font-medium text-muted-foreground",children:"Active Customers"}),e.jsx(st,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:p.activeCustomers}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:p.totalCustomers>0?`${Math.round(p.activeCustomers/p.totalCustomers*100)}% of total`:"No customers yet"})]})]}),e.jsxs(w,{className:"relative overflow-hidden",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(J,{className:"text-sm font-medium text-muted-foreground",children:"Total Purchases"}),e.jsx(As,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(S,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["₱",p.totalPurchases.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:p.topCustomerByPurchases?`Top: ${p.topCustomerByPurchases.name}`:"No purchases yet"})]})]}),e.jsxs(w,{className:"relative overflow-hidden",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(J,{className:"text-sm font-medium text-muted-foreground",children:"Categories"}),e.jsx(Ds,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:p.uniqueCategories}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Outstanding balance: ₱",p.totalBalance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]}),e.jsxs("div",{className:"grid gap-3 grid-cols-1 sm:grid-cols-2",children:[e.jsx(w,{className:L("cursor-pointer transition-all hover:shadow-md border-l-4",F==="Active"?"ring-2 ring-primary":"","border-l-emerald-400"),onClick:()=>te(F==="Active"?"all":"Active"),children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Active"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:p.activeCustomers})]}),e.jsx(K,{variant:"outline",className:re("Active"),children:$("Active")})]})})}),e.jsx(w,{className:L("cursor-pointer transition-all hover:shadow-md border-l-4",F==="Inactive"?"ring-2 ring-primary":"","border-l-slate-400"),onClick:()=>te(F==="Inactive"?"all":"Inactive"),children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Inactive"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:p.inactiveCustomers})]}),e.jsx(K,{variant:"outline",className:re("Inactive"),children:$("Inactive")})]})})})]}),e.jsxs(w,{children:[e.jsx(_,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(J,{className:"text-xl",children:"Customer Management"}),e.jsx(Ps,{className:"mt-1",children:"Manage your customer relationships and contacts"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",onClick:js,children:[e.jsx(Rs,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),e.jsxs(ie,{open:G,onOpenChange:s=>{X(s),s||c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0})},children:[e.jsx(Ts,{asChild:!0,children:e.jsxs(o,{onClick:()=>c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0}),disabled:!C,title:C?void 0:"You don't have permission to add customers",children:[e.jsx(tt,{className:"h-4 w-4 mr-2"}),"Add Customer"]})}),e.jsxs(ce,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(de,{children:[e.jsx(oe,{children:"Create New Customer"}),e.jsx(me,{children:"Enter the details for the new customer."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"customer-name",children:"Customer Name *"}),e.jsx(u,{id:"customer-name",placeholder:"Enter customer name",value:t.name,onChange:s=>c({...t,name:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"customer-status",children:"Status"}),e.jsxs(W,{value:t.status,onValueChange:s=>c({...t,status:s}),children:[e.jsx(Y,{children:e.jsx(Q,{placeholder:"Select status"})}),e.jsx(Z,{children:we.map(s=>e.jsx(V,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:$(s)}),s]})},s))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"contact-name",children:"Contact Person *"}),e.jsx(u,{id:"contact-name",placeholder:"Enter contact name",value:t.contact,onChange:s=>c({...t,contact:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"email",children:"Email *"}),e.jsx(u,{id:"email",type:"email",placeholder:"email@example.com",value:t.email,onChange:s=>c({...t,email:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"phone",children:"Phone *"}),e.jsx(u,{id:"phone",placeholder:"+1 (555) 000-0000",value:t.phone,onChange:s=>c({...t,phone:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"category",children:"Category *"}),e.jsxs(W,{value:t.category,onValueChange:s=>c({...t,category:s}),children:[e.jsx(Y,{children:e.jsx(Q,{placeholder:"Select category"})}),e.jsx(Z,{children:Se.map(s=>e.jsx(V,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Location Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"country",children:"Country"}),e.jsx(u,{id:"country",placeholder:"e.g., United States",value:t.country,onChange:s=>c({...t,country:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"city",children:"City"}),e.jsx(u,{id:"city",placeholder:"e.g., San Francisco",value:t.city,onChange:s=>c({...t,city:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2 mt-4",children:[e.jsx(d,{htmlFor:"address",children:"Address"}),e.jsx(u,{id:"address",placeholder:"Full street address",value:t.address,onChange:s=>c({...t,address:s.target.value})})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Financial Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"purchases",children:"Total Purchases (₱)"}),e.jsx(u,{id:"purchases",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.purchases,onChange:s=>c({...t,purchases:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"payments",children:"Total Payments (₱)"}),e.jsx(u,{id:"payments",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.payments,onChange:s=>c({...t,payments:parseFloat(s.target.value)||0})})]})]})]})]}),e.jsxs(Ce,{children:[e.jsx(o,{variant:"outline",onClick:()=>X(!1),children:"Cancel"}),e.jsx(o,{onClick:async()=>{if(!t.name.trim()||!t.contact.trim()||!t.email.trim()||!t.phone.trim()||!t.category.trim()){n.error("Please fill all required fields");return}try{const s=await Es({name:t.name,contact:t.contact,email:t.email,phone:t.phone,category:t.category,status:t.status,country:t.country,city:t.city,address:t.address,purchases:t.purchases,payments:t.payments});j(a=>[s,...a??[]]),X(!1),n.success("Customer added successfully"),c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0})}catch(s){n.error(s?.message||"Failed to add customer")}},children:"Create Customer"})]})]})]})]})]})}),e.jsxs(S,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Is,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(u,{placeholder:"Search customers by name, contact, email...",value:O,onChange:s=>Te(s.target.value),className:"pl-9"})]}),e.jsxs(W,{value:F,onValueChange:te,children:[e.jsxs(Y,{className:"w-full sm:w-[180px]",children:[e.jsx(Gs,{className:"h-4 w-4 mr-2"}),e.jsx(Q,{placeholder:"Filter by status"})]}),e.jsxs(Z,{children:[e.jsx(V,{value:"all",children:"All Statuses"}),we.map(s=>e.jsx(V,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:$(s)}),s]})},s))]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(o,{variant:R?"default":"outline",size:"sm",onClick:()=>Ee(!R),className:"gap-1",children:[e.jsx(Qs,{className:L("h-4 w-4",R&&"fill-current")}),"Favorites",Pe("customers").length>0&&e.jsx(K,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:Pe("customers").length})]}),e.jsxs(o,{variant:h?"default":"outline",size:"sm",onClick:()=>Ie(!h),className:h?"bg-orange-500 hover:bg-orange-600 text-white":"",children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),h?"Viewing Archived":"View Archived"]}),(O||F!=="all"||R||h)&&e.jsxs(o,{variant:"ghost",size:"sm",onClick:es,className:"gap-1 text-muted-foreground hover:text-foreground",children:[e.jsx(Ls,{className:"h-4 w-4"}),"Clear All Filters"]})]})]}),je&&C&&e.jsx(Xs,{selectionCount:pe,onClearSelection:x,isLoading:P||gs,actions:h?[{id:"restore",label:"Restore",icon:e.jsx(Ye,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:fs},...he?[{id:"permanent-delete",label:"Permanently Delete",icon:e.jsx(ue,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>T(!0)}]:[]]:[{id:"archive",label:"Archive",icon:e.jsx(q,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:()=>T(!0)}],actionGroups:h?[]:[{id:"status-update",label:"Update Status",icon:e.jsx(Bs,{className:"h-4 w-4 mr-1"}),options:[{value:"Active",label:"Active"},{value:"Inactive",label:"Inactive"}],onSelect:s=>ys(s)}],className:"mb-4"}),e.jsx(ie,{open:ps,onOpenChange:T,children:e.jsxs(ce,{className:"max-w-md",children:[e.jsxs(de,{children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"h-5 w-5 text-destructive"}),"Delete ",pe," Customer",pe!==1?"s":""]}),e.jsx(me,{children:h?"These customers are already archived. This action will permanently remove them from the system.":"Choose how you want to delete the selected customers:"})]}),le.length>0&&e.jsx("div",{className:"max-h-32 overflow-y-auto border rounded-md p-2 bg-muted/50",children:e.jsxs("ul",{className:"text-sm space-y-1",children:[le.slice(0,10).map((s,a)=>e.jsxs("li",{className:"truncate",children:["• ",s]},a)),le.length>10&&e.jsxs("li",{className:"text-muted-foreground",children:["...and ",le.length-10," more"]})]})}),h?e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("div",{className:"p-3 border border-destructive/50 rounded-md bg-destructive/10",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ue,{className:"h-4 w-4 mt-0.5 text-destructive"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-destructive",children:"Permanent Deletion"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This cannot be undone. All data will be permanently removed."})]})]})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(o,{variant:"outline",onClick:()=>T(!1),disabled:P,children:"Cancel"}),e.jsx(o,{variant:"destructive",onClick:ze,disabled:P,children:P?"Deleting...":"Permanently Delete All"})]})]}):e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("div",{className:"p-3 border rounded-md hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(q,{className:"h-4 w-4 mt-0.5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Archive"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Move to archive. Customers can be restored later."})]}),e.jsx(o,{variant:"secondary",size:"sm",onClick:vs,disabled:P,children:P?"...":"Archive"})]})}),he&&e.jsx("div",{className:"p-3 border border-destructive/50 rounded-md bg-destructive/10",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ue,{className:"h-4 w-4 mt-0.5 text-destructive"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-destructive",children:"Delete Permanently"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cannot be undone. Data will be permanently removed."})]}),e.jsx(o,{variant:"destructive",size:"sm",onClick:ze,disabled:P,children:P?"...":"Delete"})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(o,{variant:"outline",onClick:()=>T(!1),disabled:P,children:"Cancel"})})]})]})}),Ze?e.jsx(_s,{rows:8}):ae.length===0?e.jsx(Js,{icon:h?q:Ne,title:h?"No archived customers":"No customers found",description:h?"Archived customers will appear here":O?"Try adjusting your search criteria":"Get started by adding your first customer",actionLabel:!h&&!O?"Add Customer":void 0,onAction:!h&&!O?()=>X(!0):void 0}):e.jsxs("div",{className:"rounded-md border overflow-hidden",children:[e.jsx(Ws,{pageItemCount:Re,totalItemCount:Oe,isAllPagesSelected:os,show:ds&&Oe>Re,onSelectAllPages:hs,onClearSelection:x,itemLabel:"customers"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ms,{children:[e.jsx(zs,{children:e.jsxs(_e,{children:[e.jsx(Je,{className:"w-12",children:e.jsx(He,{checked:cs,ref:s=>{s&&(s.indeterminate=ms)},onCheckedChange:ve,"aria-label":"Select all customers"})}),e.jsx(E,{sortKey:"id",currentSortKey:k.key,sortDirection:D("id"),onSort:s=>A(s),children:"Customer ID"}),e.jsx(E,{sortKey:"name",currentSortKey:k.key,sortDirection:D("name"),onSort:s=>A(s),children:"Customer Name"}),e.jsx(E,{sortKey:"contact",currentSortKey:k.key,sortDirection:D("contact"),onSort:s=>A(s),children:"Contact"}),e.jsx(E,{sortKey:"category",currentSortKey:k.key,sortDirection:D("category"),onSort:s=>A(s),children:"Category"}),e.jsx(E,{sortKey:"status",currentSortKey:k.key,sortDirection:D("status"),onSort:s=>A(s),children:"Status"}),e.jsx(E,{sortKey:"country",currentSortKey:k.key,sortDirection:D("country"),onSort:s=>A(s),children:"Location"}),e.jsx(E,{sortKey:"purchases",currentSortKey:k.key,sortDirection:D("purchases"),onSort:s=>A(s),children:"Purchases"}),e.jsx(E,{sortKey:"payments",currentSortKey:k.key,sortDirection:D("payments"),onSort:s=>A(s),children:"Payments"}),e.jsx(E,{sortKey:"balance",currentSortKey:k.key,sortDirection:D("balance"),onSort:s=>A(s),children:"Balance"}),e.jsx(Je,{children:"Actions"})]})}),e.jsx(Vs,{children:Ue.map(s=>{const a=xs(s.id);return e.jsxs(_e,{className:L("hover:bg-muted/50 transition-colors",a&&"bg-muted/50"),children:[e.jsx(N,{children:e.jsx(He,{checked:a,onCheckedChange:()=>us(s.id),"aria-label":`Select customer ${s.name}`})}),e.jsx(N,{className:"font-mono text-sm",children:s.id}),e.jsx(N,{children:e.jsx("button",{className:"text-left font-medium text-primary hover:underline cursor-pointer bg-transparent border-none p-0",onClick:()=>z(s.id),children:s.name})}),e.jsx(N,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Ge,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(be,{value:s.email,type:"text",onSave:r=>fe(s.id,"email",r),disabled:!C,className:"text-xs text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Xe,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(be,{value:s.phone,type:"text",onSave:r=>fe(s.id,"phone",r),disabled:!C,className:"text-xs text-muted-foreground"})]})]})}),e.jsx(N,{children:e.jsx(be,{value:s.category,type:"select",options:Se.map(r=>({value:r,label:r})),onSave:r=>fe(s.id,"category",r),disabled:!C})}),e.jsx(N,{children:e.jsxs(K,{variant:"outline",className:L("gap-1",re(s.status)),children:[e.jsx("span",{children:$(s.status)}),s.status]})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm",children:s.city&&s.country?e.jsxs("span",{children:[s.city,", ",s.country]}):s.city||s.country?e.jsx("span",{children:s.city||s.country}):e.jsx("span",{className:"text-muted-foreground",children:"—"})})}),e.jsxs(N,{className:"text-right font-medium",children:["₱",s.purchases.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(N,{className:"text-right font-medium",children:["₱",s.payments.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(N,{className:L("text-right font-medium",s.balance>0?"text-amber-600":s.balance<0?"text-emerald-600":""),children:["₱",s.balance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx(N,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{entityType:"customers",entityId:s.id,entityName:s.name}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>z(s.id),children:e.jsx($s,{className:"h-4 w-4"})}),h?e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>ts(s.id),disabled:!C,title:"Restore customer",children:e.jsx(Ye,{className:"h-4 w-4"})}),he&&e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>as(s.id),title:"Permanently delete",children:e.jsx(ue,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Ve(s),disabled:!C,title:"Edit customer",children:e.jsx(Qe,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>ss(s.id),disabled:!C,title:"Archive customer",children:e.jsx(q,{className:"h-4 w-4"})})]})]})})]},s.id)})})]})})]}),ae.length>0&&e.jsx(Ys,{currentPage:$e,totalPages:rs,totalItems:ns,itemsPerPage:is,onPageChange:ls,className:"mt-4"})]})]}),M&&e.jsx(ie,{open:!!M,onOpenChange:s=>{s||B(null)},children:e.jsxs(ce,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(de,{children:[e.jsx(oe,{children:"Edit Customer"}),e.jsx(me,{children:"Update the customer details."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-customer-name",children:"Customer Name *"}),e.jsx(u,{id:"edit-customer-name",placeholder:"Enter customer name",value:t.name,onChange:s=>c({...t,name:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-customer-status",children:"Status"}),e.jsxs(W,{value:t.status,onValueChange:s=>c({...t,status:s}),children:[e.jsx(Y,{children:e.jsx(Q,{placeholder:"Select status"})}),e.jsx(Z,{children:we.map(s=>e.jsx(V,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:$(s)}),s]})},s))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-contact-name",children:"Contact Person *"}),e.jsx(u,{id:"edit-contact-name",placeholder:"Enter contact name",value:t.contact,onChange:s=>c({...t,contact:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-email",children:"Email *"}),e.jsx(u,{id:"edit-email",type:"email",placeholder:"email@example.com",value:t.email,onChange:s=>c({...t,email:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-phone",children:"Phone *"}),e.jsx(u,{id:"edit-phone",placeholder:"+1 (555) 000-0000",value:t.phone,onChange:s=>c({...t,phone:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-category",children:"Category *"}),e.jsxs(W,{value:t.category,onValueChange:s=>c({...t,category:s}),children:[e.jsx(Y,{children:e.jsx(Q,{placeholder:"Select category"})}),e.jsx(Z,{children:Se.map(s=>e.jsx(V,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Location Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-country",children:"Country"}),e.jsx(u,{id:"edit-country",placeholder:"e.g., United States",value:t.country,onChange:s=>c({...t,country:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-city",children:"City"}),e.jsx(u,{id:"edit-city",placeholder:"e.g., San Francisco",value:t.city,onChange:s=>c({...t,city:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2 mt-4",children:[e.jsx(d,{htmlFor:"edit-address",children:"Address"}),e.jsx(u,{id:"edit-address",placeholder:"Full street address",value:t.address,onChange:s=>c({...t,address:s.target.value})})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Financial Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-purchases",children:"Total Purchases (₱)"}),e.jsx(u,{id:"edit-purchases",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.purchases,onChange:s=>c({...t,purchases:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-payments",children:"Total Payments (₱)"}),e.jsx(u,{id:"edit-payments",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.payments,onChange:s=>c({...t,payments:parseFloat(s.target.value)||0})})]})]})]})]}),e.jsxs(Ce,{children:[e.jsx(o,{variant:"outline",onClick:()=>B(null),children:"Cancel"}),e.jsx(o,{onClick:async()=>{if(!t.name.trim()||!t.contact.trim()||!t.email.trim()||!t.phone.trim()||!t.category.trim()){n.error("Please fill all required fields");return}try{const s=await ye({id:M,name:t.name,contact:t.contact,email:t.email,phone:t.phone,category:t.category,status:t.status,country:t.country,city:t.city,address:t.address,purchases:t.purchases,payments:t.payments});j(a=>(a??[]).map(r=>r.id===M?s:r)),B(null),n.success("Customer updated successfully")}catch(s){n.error(s?.message||"Failed to update customer")}},children:"Save Changes"})]})]})}),xe&&(()=>{const s=v.find(a=>a.id===xe);return s?e.jsx(ie,{open:!!xe,onOpenChange:a=>{a||z(null)},children:e.jsxs(ce,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsx(de,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(oe,{className:"text-xl",children:s.name}),e.jsxs(me,{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"font-mono",children:s.id}),e.jsxs(K,{variant:"outline",className:L("gap-1",re(s.status)),children:[e.jsx("span",{children:$(s.status)}),s.status]}),s.archived&&e.jsxs(K,{variant:"outline",className:"bg-orange-500/15 text-orange-700 dark:text-orange-400 border-orange-200",children:[e.jsx(q,{className:"h-3 w-3 mr-1"}),"Archived"]})]})]}),e.jsx(We,{entityType:"customers",entityId:s.id,entityName:s.name})]})}),e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Contact Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Contact Person"}),e.jsx("p",{className:"font-medium",children:s.contact})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Category"}),e.jsx(K,{variant:"secondary",children:s.category})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(Ge,{className:"h-3 w-3 text-muted-foreground"}),s.email]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Phone"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(Xe,{className:"h-3 w-3 text-muted-foreground"}),s.phone]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(lt,{className:"h-4 w-4"}),"Location"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"City / Country"}),e.jsx("p",{className:"font-medium",children:s.city&&s.country?`${s.city}, ${s.country}`:s.city||s.country||"—"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Address"}),e.jsx("p",{className:"font-medium",children:s.address||"—"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(at,{className:"h-4 w-4"}),"Financial Summary"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(w,{children:e.jsxs(S,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Purchases"}),e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:["₱",s.purchases.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})}),e.jsx(w,{children:e.jsxs(S,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Payments"}),e.jsxs("p",{className:"text-lg font-bold text-emerald-600",children:["₱",s.payments.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})}),e.jsx(w,{children:e.jsxs(S,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Balance"}),e.jsxs("p",{className:L("text-lg font-bold",s.balance>0?"text-amber-600":s.balance<0?"text-emerald-600":""),children:["₱",s.balance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})})]})]})]}),e.jsxs(Ce,{children:[e.jsx(o,{variant:"outline",onClick:()=>z(null),children:"Close"}),!s.archived&&C&&e.jsxs(o,{onClick:()=>{z(null),Ve(s)},children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),"Edit Customer"]})]})]})}):null})()]})}export{Ct as CustomersView};
