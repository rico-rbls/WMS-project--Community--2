import{c as fs,i as Ss,r as x,Q as Cs,j as e,B as N,C as f,p as S,q as C,s as D,y as re,S as Oe,x as Ds,D as Te,a1 as bs,A as Ae,E as ke,F as Re,G as Fe,H as j,I as m,d as ie,J as Le,a3 as ws,a2 as Is,ab as Ps,aG as ge,aH as Os,ar as Ts,z as d,aI as As,aJ as ks,aK as Rs,aL as Fs,aM as Ls,aN as Bs,aO as Vs,aP as Es}from"./index-6JZfzpLY.js";import{g as $s,h as ve}from"./permissions-BqDqHH54.js";import{u as qs,a as Ks,T as Us,E as Be,P as Ne,F as zs,B as Hs,c as Ms,b as _s}from"./bulk-delete-dialog-DASlA85G.js";import{e as le,f as ne,g as O,h as n,j as ce,k as i,S as E,a as $,b as q,c as K,d as A,T as oe,i as T}from"./sortable-table-head-DhfKlRfv.js";import{F as Gs}from"./file-text-CuyNmEy3.js";import{D as Qs}from"./dollar-sign-DUxysRub.js";import{T as Ws}from"./trending-up-Bxsj8OzM.js";import{D as Js}from"./download-CESh6A8n.js";import{A as de,a as Ve}from"./archive-DgqsLnDY.js";import"./skeleton-CBqSKy8m.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Xs=fs("arrow-left",Ys),Zs=["Unpaid","Partially Paid","Paid","Overdue"],et=["Pending","Processing","Shipped","In Transit","Out for Delivery","Delivered","Failed","Returned"],k=U=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(U);function mt(){const{user:U}=Ss(),z=U?$s(U.id):"Viewer",me=ve(z,"purchase_orders:create");ve(z,"purchase_orders:update");const Y=ve(z,"purchase_orders:delete"),Ee=z==="Owner"||z==="Admin",[$e,w]=x.useState(null),[ue,qe]=x.useState([]),[X,Ke]=x.useState([]),[Ue,ze]=x.useState(!0),[Z,ye]=x.useState(""),H=Cs(Z,300),[R,fe]=x.useState("all"),[p,Se]=x.useState(!1),[He,ee]=x.useState(!1),[F,M]=x.useState(null),[Me,_]=x.useState(!1),[y,Ce]=x.useState(null),[G,he]=x.useState("asc"),[c,De]=x.useState(null),[r,g]=x.useState({soDate:new Date().toISOString().split("T")[0],customerId:"",customerName:"",customerCountry:"",customerCity:"",invoiceNumber:"",items:[],expectedDeliveryDate:"",notes:"",totalReceived:0,shippingStatus:"Pending"});x.useEffect(()=>{(async()=>{try{const[t,a,l]=await Promise.all([ge(),Os(),Ts()]);w(t),qe(a),Ke(l)}catch{d.error("Failed to load data")}finally{ze(!1)}})()},[]);const Q=$e??[],W=x.useMemo(()=>Q.filter(s=>{const t=s.archived===!0;if(p!==t)return!1;const a=!H||s.id.toLowerCase().includes(H.toLowerCase())||s.customerName.toLowerCase().includes(H.toLowerCase())||s.items.some(u=>u.itemName.toLowerCase().includes(H.toLowerCase())),l=R==="all"||s.receiptStatus===R;return a&&l}),[Q,H,R,p]),_e=x.useMemo(()=>y?[...W].sort((s,t)=>{const a=s[y],l=t[y];if(a==null&&l==null)return 0;if(a==null)return 1;if(l==null)return-1;if(typeof a=="number"&&typeof l=="number")return G==="asc"?a-l:l-a;const u=String(a).toLowerCase(),h=String(l).toLowerCase();return G==="asc"?u.localeCompare(h):h.localeCompare(u)}):W,[W,y,G]),{currentPage:Ge,totalPages:Qe,paginatedData:be,goToPage:We,itemsPerPage:Je,totalItems:Ye}=qs(_e,10),{selectedIds:se,isSelected:Xe,toggleItem:Ze,toggleAll:es,deselectAll:te,isAllSelected:ss,isPartiallySelected:ts,selectionCount:ae,hasSelection:as}=Ks(be.map(s=>s.id)),b=x.useMemo(()=>{const s=Q.filter(v=>!v.archived),t=s.length,a=s.reduce((v,pe)=>v+pe.totalAmount,0),l=s.reduce((v,pe)=>v+pe.totalReceived,0),u=s.filter(v=>v.receiptStatus==="Paid").length,h=s.filter(v=>v.receiptStatus==="Unpaid").length,o=s.filter(v=>v.receiptStatus==="Partially Paid").length,V=s.filter(v=>v.receiptStatus==="Overdue").length,Ns=s.filter(v=>v.shippingStatus==="Delivered").length,je=new Date;je.setDate(je.getDate()-7);const ys=s.filter(v=>new Date(v.createdDate)>=je).length;return{totalSOs:t,totalValue:a,totalReceived:l,outstandingBalance:a-l,paidCount:u,unpaidCount:h,partiallyPaidCount:o,overdueCount:V,deliveredCount:Ns,newThisWeek:ys,avgOrderValue:t>0?a/t:0,collectionRate:a>0?Math.round(l/a*100):0}},[Q]),I=s=>{const t=s;y===t?G==="asc"?he("desc"):(Ce(null),he("asc")):(Ce(t),he("asc"))},P=s=>y===s?G:null,rs=(s,t)=>`${s}-D${String(t+1).padStart(3,"0")}`,is=s=>{const t=X.find(a=>a.id===s);return{itemId:t?.id??s,itemType:t?.brand??"-",itemCategory:t?.category??"-",itemSubcategory:t?.subcategory??"-"}},ls=s=>{De(s)},ns=()=>{De(null)},xe=s=>{const t={Unpaid:{variant:"outline",className:"border-gray-500 text-gray-600"},"Partially Paid":{variant:"outline",className:"border-yellow-500 text-yellow-600"},Paid:{variant:"default",className:"bg-green-500"},Overdue:{variant:"destructive"}},{variant:a,className:l}=t[s];return e.jsx(re,{variant:a,className:ie("gap-1",l),children:s})},J=()=>{g({soDate:new Date().toISOString().split("T")[0],customerId:"",customerName:"",customerCountry:"",customerCity:"",invoiceNumber:"",items:[],expectedDeliveryDate:"",notes:"",totalReceived:0,shippingStatus:"Pending"})},we=()=>{g(s=>({...s,items:[...s.items,{inventoryItemId:"",itemName:"",quantity:1,unitPrice:0,totalPrice:0}]}))},Ie=s=>{g(t=>({...t,items:t.items.filter((a,l)=>l!==s)}))},L=(s,t,a)=>{g(l=>{const u=[...l.items];if(t==="inventoryItemId"){const h=X.find(o=>o.id===a);h&&(u[s]={...u[s],inventoryItemId:h.id,itemName:h.name,unitPrice:h.pricePerPiece,totalPrice:u[s].quantity*h.pricePerPiece})}else if(t==="quantity"){const h=Number(a)||0;u[s]={...u[s],quantity:h,totalPrice:h*u[s].unitPrice}}else if(t==="unitPrice"){const h=Number(a)||0;u[s]={...u[s],unitPrice:h,totalPrice:u[s].quantity*h}}return{...l,items:u}})},Pe=s=>{const t=ue.find(a=>a.id===s);g(a=>({...a,customerId:s,customerName:t?.name??"",customerCountry:t?.country??"",customerCity:t?.city??""}))},cs=async()=>{if(!r.customerId||r.items.length===0||!r.expectedDeliveryDate){d.error("Please fill in all required fields");return}try{const s=await As({soDate:r.soDate,customerId:r.customerId,customerName:r.customerName,customerCountry:r.customerCountry,customerCity:r.customerCity,invoiceNumber:r.invoiceNumber,items:r.items.map(t=>({...t,quantityShipped:0})),expectedDeliveryDate:r.expectedDeliveryDate,notes:r.notes,createdBy:U?.id??"1",totalReceived:r.totalReceived});w(t=>[s,...t??[]]),d.success(`Sales Order ${s.id} created successfully`),ee(!1),J()}catch(s){d.error(s instanceof Error?s.message:"Failed to create sales order")}},os=async s=>{if(!r.customerId||r.items.length===0||!r.expectedDeliveryDate){d.error("Please fill in all required fields");return}try{const t=await Bs({id:s,soDate:r.soDate,customerId:r.customerId,customerName:r.customerName,customerCountry:r.customerCountry,customerCity:r.customerCity,invoiceNumber:r.invoiceNumber,items:r.items.map(a=>({...a,quantityShipped:0})),expectedDeliveryDate:r.expectedDeliveryDate,notes:r.notes,totalReceived:r.totalReceived,shippingStatus:r.shippingStatus});w(a=>a?.map(l=>l.id===s?t:l)??[]),d.success(`Sales Order ${s} updated successfully`),M(null),J()}catch(t){d.error(t instanceof Error?t.message:"Failed to update sales order")}},ds=async s=>{try{await Ls(s),w(t=>t?.filter(a=>a.id!==s)??[]),d.success(`Sales Order ${s} deleted`),M(null)}catch(t){d.error(t instanceof Error?t.message:"Failed to delete sales order")}},ms=async s=>{try{await Fs(s),w(t=>t?.map(a=>a.id===s?{...a,archived:!0}:a)??[]),d.success(`Sales Order ${s} archived`)}catch(t){d.error(t instanceof Error?t.message:"Failed to archive sales order")}},us=async s=>{try{await Rs(s),w(t=>t?.map(a=>a.id===s?{...a,archived:!1}:a)??[]),d.success(`Sales Order ${s} restored`)}catch(t){d.error(t instanceof Error?t.message:"Failed to restore sales order")}},hs=async()=>{try{const s=await Es(Array.from(se));s.success?d.success(`${s.successCount} sales orders archived`):d.warning(`${s.successCount} archived, ${s.failedCount} failed`);const t=await ge();w(t),te(),_(!1)}catch{d.error("Failed to archive sales orders")}},xs=async()=>{try{const s=await ks(Array.from(se));s.success?d.success(`${s.successCount} sales orders restored`):d.warning(`${s.successCount} restored, ${s.failedCount} failed`);const t=await ge();w(t),te()}catch{d.error("Failed to restore sales orders")}},js=async()=>{try{const s=await Vs(Array.from(se));s.success?d.success(`${s.successCount} sales orders permanently deleted`):d.warning(`${s.successCount} deleted, ${s.failedCount} failed`),w(t=>t?.filter(a=>!se.has(a.id))??[]),te(),_(!1)}catch{d.error("Failed to permanently delete sales orders")}},ps=s=>{g({soDate:s.soDate??s.createdDate,customerId:s.customerId,customerName:s.customerName,customerCountry:s.customerCountry??"",customerCity:s.customerCity??"",invoiceNumber:s.invoiceNumber??"",items:(s.items??[]).map(t=>({inventoryItemId:t.inventoryItemId,itemName:t.itemName,quantity:t.quantity,unitPrice:t.unitPrice,totalPrice:t.totalPrice})),expectedDeliveryDate:s.expectedDeliveryDate??"",notes:s.notes??"",totalReceived:s.totalReceived??0,shippingStatus:s.shippingStatus??"Pending"}),M(s.id)},gs=()=>{const s=["Date","SO ID","Customer ID","Customer Name","Invoice #","Country","City","Items","Total Amount","Total Received","SO Balance","Receipt Status","Shipping Status","Expected Delivery","Notes"],t=W.map(o=>[o.soDate??o.createdDate,o.id,o.customerId,o.customerName,o.invoiceNumber??"",o.customerCountry??"",o.customerCity??"",(o.items??[]).map(V=>`${V.itemName} (${V.quantity})`).join("; "),(o.totalAmount??0).toFixed(2),(o.totalReceived??0).toFixed(2),(o.soBalance??o.totalAmount??0).toFixed(2),o.receiptStatus,o.shippingStatus??"Pending",o.expectedDeliveryDate??"",o.notes??""]),a=[s,...t].map(o=>o.map(V=>`"${V}"`).join(",")).join(`
`),l=new Blob([a],{type:"text/csv"}),u=URL.createObjectURL(l),h=document.createElement("a");h.href=u,h.download=`sales-orders-${new Date().toISOString().split("T")[0]}.csv`,h.click(),URL.revokeObjectURL(u),d.success("Sales orders exported to CSV")},vs=()=>{ye(""),fe("all"),Se(!1)},B=x.useMemo(()=>r.items.reduce((s,t)=>s+t.totalPrice,0),[r.items]);return Ue?e.jsx("div",{className:"p-6",children:e.jsx(Us,{rows:8})}):c?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:ns,children:[e.jsx(Xs,{className:"h-4 w-4 mr-1"}),"Back to List"]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Sales Order Details - ",c.id]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c.customerName," • ",c.soDate??c.createdDate]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(f,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Customer"})}),e.jsxs(D,{children:[e.jsx("div",{className:"font-medium",children:c.customerName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:c.customerId})]})]}),e.jsxs(f,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Location"})}),e.jsxs(D,{children:[e.jsx("div",{className:"font-medium",children:c.customerCity||"-"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:c.customerCountry||"-"})]})]}),e.jsxs(f,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Total Amount"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-lg font-bold text-emerald-600",children:k(c.totalAmount??0)}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[c.items?.length??0," line items"]})]})]}),e.jsxs(f,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Status"})}),e.jsx(D,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[xe(c.receiptStatus),e.jsx(re,{variant:c.shippingStatus==="Delivered"?"default":"outline",className:"w-fit mt-1",children:c.shippingStatus??"Pending"})]})})]})]}),e.jsxs(f,{children:[e.jsxs(S,{children:[e.jsx(C,{children:"Line Items"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Detailed breakdown of all items in this sales order"})]}),e.jsxs(D,{children:[!c.items||c.items.length===0?e.jsx(Be,{icon:Oe,title:"No line items",description:"This sales order has no line items"}):e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs(le,{children:[e.jsx(ne,{children:e.jsxs(O,{children:[e.jsx(n,{children:"SO Date"}),e.jsx(n,{children:"SO ID"}),e.jsx(n,{children:"Detail ID"}),e.jsx(n,{children:"Customer ID"}),e.jsx(n,{children:"Customer Name"}),e.jsx(n,{children:"Country"}),e.jsx(n,{children:"City"}),e.jsx(n,{children:"Invoice Num"}),e.jsx(n,{children:"Item ID"}),e.jsx(n,{children:"Item Type"}),e.jsx(n,{children:"Item Category"}),e.jsx(n,{children:"Item Subcategory"}),e.jsx(n,{children:"Item Name"}),e.jsx(n,{className:"text-right",children:"QTY Sold"}),e.jsx(n,{className:"text-right",children:"Unit Price"}),e.jsx(n,{className:"text-right",children:"Total Sales Price"})]})}),e.jsx(ce,{children:c.items.map((s,t)=>{const a=is(s.inventoryItemId);return e.jsxs(O,{children:[e.jsx(i,{className:"whitespace-nowrap",children:c.soDate??c.createdDate}),e.jsx(i,{className:"font-medium",children:c.id}),e.jsx(i,{className:"font-mono text-sm",children:rs(c.id,t)}),e.jsx(i,{className:"text-muted-foreground",children:c.customerId}),e.jsx(i,{children:c.customerName}),e.jsx(i,{children:c.customerCountry||"-"}),e.jsx(i,{children:c.customerCity||"-"}),e.jsx(i,{children:c.invoiceNumber||"-"}),e.jsx(i,{className:"font-mono text-sm",children:a.itemId}),e.jsx(i,{children:a.itemType}),e.jsx(i,{children:a.itemCategory}),e.jsx(i,{children:a.itemSubcategory}),e.jsx(i,{children:s.itemName}),e.jsx(i,{className:"text-right",children:s.quantity}),e.jsx(i,{className:"text-right",children:k(s.unitPrice)}),e.jsx(i,{className:"text-right font-medium",children:k(s.totalPrice)})]},t)})})]})}),c.items&&c.items.length>0&&e.jsx("div",{className:"mt-4 pt-4 border-t flex justify-end",children:e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Grand Total"}),e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:k(c.totalAmount??0)})]})})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Sales Orders"}),e.jsx("p",{className:"text-muted-foreground",children:"Create and manage customer orders, track payments, and monitor delivery status"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(f,{className:"relative overflow-hidden",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Total SOs"}),e.jsx(Gs,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:b.totalSOs}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[b.newThisWeek," new this week"]})]})]}),e.jsxs(f,{className:"relative overflow-hidden",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Total Value"}),e.jsx(Qs,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:k(b.totalValue)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Avg: ",k(b.avgOrderValue)," per SO"]})]})]}),e.jsxs(f,{className:"relative overflow-hidden",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Outstanding"}),e.jsx(Ds,{className:"h-4 w-4 text-amber-600"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:k(b.outstandingBalance)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[b.unpaidCount," unpaid, ",b.overdueCount," overdue"]})]})]}),e.jsxs(f,{className:"relative overflow-hidden",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Collection Rate"}),e.jsx(Ws,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(D,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[b.collectionRate,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[b.paidCount," paid of ",b.totalSOs," total"]})]})]})]}),e.jsxs(f,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Sales Orders"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage customer sales orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{variant:"outline",size:"sm",onClick:gs,children:[e.jsx(Js,{className:"h-4 w-4 mr-1"}),"Export CSV"]}),me&&e.jsxs(Te,{open:He,onOpenChange:ee,children:[e.jsx(bs,{asChild:!0,children:e.jsxs(N,{size:"sm",children:[e.jsx(Ne,{className:"h-4 w-4 mr-1"}),"Create SO"]})}),e.jsxs(Ae,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ke,{children:[e.jsx(Re,{children:"Create Sales Order"}),e.jsx(Fe,{children:"Create a new sales order for a customer"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs(f,{children:[e.jsx(S,{className:"pb-3",children:e.jsx(C,{className:"text-base",children:"Sales Order Information"})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"SO Date *"}),e.jsx(m,{type:"date",value:r.soDate,onChange:s=>g(t=>({...t,soDate:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Customer *"}),e.jsxs(E,{value:r.customerId,onValueChange:Pe,children:[e.jsx($,{children:e.jsx(q,{placeholder:"Select customer"})}),e.jsx(K,{children:ue.filter(s=>s.status==="Active").map(s=>e.jsx(A,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Customer ID"}),e.jsx(m,{value:r.customerId,disabled:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Country"}),e.jsx(m,{value:r.customerCountry,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"City"}),e.jsx(m,{value:r.customerCity,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Invoice #"}),e.jsx(m,{value:r.invoiceNumber,onChange:s=>g(t=>({...t,invoiceNumber:s.target.value})),placeholder:"INV-2025-0001"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Expected Delivery Date *"}),e.jsx(m,{type:"date",value:r.expectedDeliveryDate,onChange:s=>g(t=>({...t,expectedDeliveryDate:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Total Received (₱)"}),e.jsx(m,{type:"number",min:"0",step:"0.01",value:r.totalReceived,onChange:s=>g(t=>({...t,totalReceived:parseFloat(s.target.value)||0}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Notes"}),e.jsx(m,{value:r.notes,onChange:s=>g(t=>({...t,notes:s.target.value})),placeholder:"Additional notes..."})]})]})]}),e.jsxs(f,{children:[e.jsxs(S,{className:"pb-3 flex flex-row items-center justify-between",children:[e.jsx(C,{className:"text-base",children:"Line Items"}),e.jsxs(N,{size:"sm",variant:"outline",onClick:we,children:[e.jsx(Ne,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),e.jsxs(D,{children:[r.items.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:'No items added. Click "Add Item" to add line items.'}):e.jsxs(le,{children:[e.jsx(ne,{children:e.jsxs(O,{children:[e.jsx(n,{children:"Item"}),e.jsx(n,{className:"w-24",children:"Qty"}),e.jsx(n,{className:"w-32",children:"Unit Price"}),e.jsx(n,{className:"w-32 text-right",children:"Total"}),e.jsx(n,{className:"w-12"})]})}),e.jsx(ce,{children:r.items.map((s,t)=>e.jsxs(O,{children:[e.jsx(i,{children:e.jsxs(E,{value:s.inventoryItemId,onValueChange:a=>L(t,"inventoryItemId",a),children:[e.jsx($,{children:e.jsx(q,{placeholder:"Select item"})}),e.jsx(K,{children:X.map(a=>e.jsx(A,{value:a.id,children:a.name},a.id))})]})}),e.jsx(i,{children:e.jsx(m,{type:"number",min:"1",value:s.quantity,onChange:a=>L(t,"quantity",a.target.value)})}),e.jsx(i,{children:e.jsx(m,{type:"number",min:"0",step:"0.01",value:s.unitPrice,onChange:a=>L(t,"unitPrice",a.target.value)})}),e.jsxs(i,{className:"text-right font-medium",children:["₱",s.totalPrice.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(i,{children:e.jsx(N,{size:"sm",variant:"ghost",onClick:()=>Ie(t),children:e.jsx(oe,{className:"h-4 w-4 text-destructive"})})})]},t))})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grand Total:"}),e.jsxs("span",{className:"ml-2 text-xl font-bold",children:["₱",B.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"SO Balance:"}),e.jsxs("span",{className:ie("ml-2 text-xl font-bold",B-r.totalReceived>0?"text-orange-600":"text-green-600"),children:["₱",(B-r.totalReceived).toLocaleString(void 0,{minimumFractionDigits:2})]})]})]})]})]}),e.jsxs(Le,{children:[e.jsx(N,{variant:"outline",onClick:()=>{ee(!1),J()},children:"Cancel"}),e.jsx(N,{onClick:cs,children:"Create Sales Order"})]})]})]})]})]})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(ws,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Search SO ID, customer, or items...",value:Z,onChange:s=>ye(s.target.value),className:"pl-10"})]}),e.jsxs(E,{value:R,onValueChange:fe,children:[e.jsxs($,{className:"w-48",children:[e.jsx(zs,{className:"h-4 w-4 mr-2"}),e.jsx(q,{placeholder:"Filter by status"})]}),e.jsxs(K,{children:[e.jsx(A,{value:"all",children:"All Statuses"}),Zs.map(s=>e.jsx(A,{value:s,children:s},s))]})]}),e.jsxs(N,{variant:p?"default":"outline",size:"sm",onClick:()=>Se(!p),className:p?"bg-orange-500 hover:bg-orange-600 text-white":"",children:[e.jsx(de,{className:"h-4 w-4 mr-1"}),p?"Viewing Archived":"View Archived"]}),(Z||R!=="all"||p)&&e.jsxs(N,{variant:"ghost",size:"sm",onClick:vs,className:"text-muted-foreground",children:[e.jsx(Is,{className:"h-4 w-4 mr-1"}),"Clear Filters"]})]}),as&&Y&&e.jsx(Hs,{selectionCount:ae,onClearSelection:te,actions:p?[{id:"restore",label:"Restore",icon:e.jsx(Ve,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:xs},...Ee?[{id:"permanent-delete",label:"Permanently Delete",icon:e.jsx(oe,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>_(!0)}]:[]]:[{id:"archive",label:"Archive",icon:e.jsx(de,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:()=>_(!0)}]}),W.length===0?e.jsx(Be,{icon:p?de:Oe,title:p?"No archived sales orders":"No sales orders found",description:p?"Archived sales orders will appear here":Z||R!=="all"?"Try adjusting your search or filters":"Create your first sales order to get started",actionLabel:!p&&me?"Create SO":void 0,onAction:!p&&me?()=>ee(!0):void 0}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs(le,{children:[e.jsx(ne,{children:e.jsxs(O,{children:[Y&&e.jsx(n,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:ss,ref:s=>{s&&(s.indeterminate=ts)},onChange:()=>es(),className:"h-4 w-4"})}),e.jsx(T,{sortKey:"soDate",currentSortKey:y,sortDirection:P("soDate"),onSort:I,children:"Date"}),e.jsx(T,{sortKey:"id",currentSortKey:y,sortDirection:P("id"),onSort:I,children:"SO ID"}),e.jsx(n,{children:"Customer ID"}),e.jsx(T,{sortKey:"customerName",currentSortKey:y,sortDirection:P("customerName"),onSort:I,children:"Customer Name"}),e.jsx(n,{children:"Invoice #"}),e.jsx(n,{children:"Country"}),e.jsx(n,{children:"City"}),e.jsx(T,{sortKey:"totalAmount",currentSortKey:y,sortDirection:P("totalAmount"),onSort:I,className:"text-right",children:"Total Amount"}),e.jsx(T,{sortKey:"totalReceived",currentSortKey:y,sortDirection:P("totalReceived"),onSort:I,className:"text-right",children:"Total Received"}),e.jsx(T,{sortKey:"soBalance",currentSortKey:y,sortDirection:P("soBalance"),onSort:I,className:"text-right",children:"SO Balance"}),e.jsx(T,{sortKey:"receiptStatus",currentSortKey:y,sortDirection:P("receiptStatus"),onSort:I,children:"Receipt Status"}),e.jsx(T,{sortKey:"shippingStatus",currentSortKey:y,sortDirection:P("shippingStatus"),onSort:I,children:"Shipping"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(ce,{children:be.map(s=>e.jsxs(O,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>ps(s),children:[Y&&e.jsx(i,{onClick:t=>t.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:Xe(s.id),onChange:()=>Ze(s.id),className:"h-4 w-4"})}),e.jsx(i,{className:"whitespace-nowrap",children:s.soDate??s.createdDate}),e.jsx(i,{className:"font-medium",children:s.id}),e.jsx(i,{className:"text-muted-foreground",children:s.customerId}),e.jsx(i,{children:s.customerName}),e.jsx(i,{className:"text-muted-foreground",children:s.invoiceNumber||"-"}),e.jsx(i,{children:s.customerCountry||"-"}),e.jsx(i,{children:s.customerCity||"-"}),e.jsxs(i,{className:"text-right font-medium",children:["₱",(s.totalAmount??0).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs(i,{className:"text-right",children:["₱",(s.totalReceived??0).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(i,{className:"text-right font-medium",children:e.jsxs("span",{className:ie((s.soBalance??s.totalAmount??0)>0?"text-orange-600":"text-green-600"),children:["₱",(s.soBalance??s.totalAmount??0).toLocaleString(void 0,{minimumFractionDigits:2})]})}),e.jsx(i,{children:xe(s.receiptStatus)}),e.jsx(i,{children:e.jsx(re,{variant:s.shippingStatus==="Delivered"?"default":s.shippingStatus==="In Transit"||s.shippingStatus==="Shipped"?"secondary":s.shippingStatus==="Failed"||s.shippingStatus==="Returned"?"destructive":"outline",children:s.shippingStatus??"Pending"})}),e.jsx(i,{onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(N,{size:"sm",variant:"outline",onClick:()=>ls(s),title:"View Details",children:e.jsx(Ps,{className:"h-4 w-4"})}),p?e.jsx(N,{size:"sm",variant:"outline",onClick:()=>us(s.id),title:"Restore",children:e.jsx(Ve,{className:"h-4 w-4"})}):e.jsx(N,{size:"sm",variant:"ghost",className:"text-destructive",onClick:()=>ms(s.id),title:"Archive",children:e.jsx(de,{className:"h-4 w-4"})})]})})]},s.id))})]})}),e.jsx(Ms,{currentPage:Ge,totalPages:Qe,itemsPerPage:Je,onPageChange:We,totalItems:Ye})]}),F&&e.jsx(Te,{open:!!F,onOpenChange:s=>{s||(M(null),J())},children:e.jsxs(Ae,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ke,{children:[e.jsxs(Re,{children:["Edit Sales Order - ",F]}),e.jsx(Fe,{children:"Update sales order details"})]}),e.jsx("div",{className:"space-y-6 py-4",children:(()=>{const s=Q.find(t=>t.id===F);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Receipt Status:"}),s&&xe(s.receiptStatus),e.jsx("span",{className:"text-sm text-muted-foreground ml-4",children:"Shipping:"}),e.jsx(re,{variant:s?.shippingStatus==="Delivered"?"default":s?.shippingStatus==="In Transit"||s?.shippingStatus==="Shipped"?"secondary":s?.shippingStatus==="Failed"||s?.shippingStatus==="Returned"?"destructive":"outline",children:s?.shippingStatus??"Pending"})]}),e.jsxs(f,{children:[e.jsx(S,{className:"pb-3",children:e.jsx(C,{className:"text-base",children:"Sales Order Information"})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"SO Date"}),e.jsx(m,{type:"date",value:r.soDate,onChange:t=>g(a=>({...a,soDate:t.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Customer"}),e.jsxs(E,{value:r.customerId,onValueChange:Pe,children:[e.jsx($,{children:e.jsx(q,{placeholder:"Select customer"})}),e.jsx(K,{children:ue.map(t=>e.jsx(A,{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Customer ID"}),e.jsx(m,{value:r.customerId,disabled:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Country"}),e.jsx(m,{value:r.customerCountry,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"City"}),e.jsx(m,{value:r.customerCity,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Invoice #"}),e.jsx(m,{value:r.invoiceNumber,onChange:t=>g(a=>({...a,invoiceNumber:t.target.value}))})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Expected Delivery Date"}),e.jsx(m,{type:"date",value:r.expectedDeliveryDate,onChange:t=>g(a=>({...a,expectedDeliveryDate:t.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Total Received (₱)"}),e.jsx(m,{type:"number",min:"0",step:"0.01",value:r.totalReceived,onChange:t=>g(a=>({...a,totalReceived:parseFloat(t.target.value)||0}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Shipping Status"}),e.jsxs(E,{value:r.shippingStatus,onValueChange:t=>g(a=>({...a,shippingStatus:t})),children:[e.jsx($,{children:e.jsx(q,{})}),e.jsx(K,{children:et.map(t=>e.jsx(A,{value:t,children:t},t))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Notes"}),e.jsx(m,{value:r.notes,onChange:t=>g(a=>({...a,notes:t.target.value})),placeholder:"Optional notes..."})]})]})]}),e.jsxs(f,{children:[e.jsxs(S,{className:"pb-3 flex flex-row items-center justify-between",children:[e.jsx(C,{className:"text-base",children:"Line Items"}),e.jsxs(N,{size:"sm",variant:"outline",onClick:we,children:[e.jsx(Ne,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),e.jsxs(D,{children:[r.items.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No items added."}):e.jsxs(le,{children:[e.jsx(ne,{children:e.jsxs(O,{children:[e.jsx(n,{children:"Item"}),e.jsx(n,{className:"w-24",children:"Qty"}),e.jsx(n,{className:"w-32",children:"Unit Price"}),e.jsx(n,{className:"w-32 text-right",children:"Total"}),e.jsx(n,{className:"w-12"})]})}),e.jsx(ce,{children:r.items.map((t,a)=>e.jsxs(O,{children:[e.jsx(i,{children:e.jsxs(E,{value:t.inventoryItemId,onValueChange:l=>L(a,"inventoryItemId",l),children:[e.jsx($,{children:e.jsx(q,{placeholder:"Select item"})}),e.jsx(K,{children:X.map(l=>e.jsx(A,{value:l.id,children:l.name},l.id))})]})}),e.jsx(i,{children:e.jsx(m,{type:"number",min:"1",value:t.quantity,onChange:l=>L(a,"quantity",l.target.value)})}),e.jsx(i,{children:e.jsx(m,{type:"number",min:"0",step:"0.01",value:t.unitPrice,onChange:l=>L(a,"unitPrice",l.target.value)})}),e.jsxs(i,{className:"text-right font-medium",children:["₱",t.totalPrice.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(i,{children:e.jsx(N,{size:"sm",variant:"ghost",onClick:()=>Ie(a),children:e.jsx(oe,{className:"h-4 w-4 text-destructive"})})})]},a))})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grand Total:"}),e.jsxs("span",{className:"ml-2 text-xl font-bold",children:["₱",B.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"SO Balance:"}),e.jsxs("span",{className:ie("ml-2 text-xl font-bold",B-r.totalReceived>0?"text-orange-600":"text-green-600"),children:["₱",(B-r.totalReceived).toLocaleString(void 0,{minimumFractionDigits:2})]})]})]})]})]}),e.jsxs(Le,{className:"gap-2",children:[Y&&e.jsxs(N,{variant:"destructive",onClick:()=>ds(F),children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),"Delete"]}),e.jsx(N,{variant:"outline",onClick:()=>{M(null),J()},children:"Cancel"}),e.jsx(N,{onClick:()=>os(F),children:"Save Changes"})]})]})})()})]})})]})]}),e.jsx(_s,{open:Me,onOpenChange:_,itemCount:ae,itemType:"sales order",onConfirm:p?js:hs,title:p?"Permanently Delete Sales Orders?":"Archive Sales Orders?",description:p?`This will permanently delete ${ae} sales order(s). This action cannot be undone.`:`This will archive ${ae} sales order(s). You can restore them later from the archived view.`,confirmLabel:p?"Permanently Delete":"Archive"})]})}export{mt as SalesOrdersView};
