import{c as ne,i as le,c6 as de,aM as ce,r as c,aO as me,j as e,C as b,q as v,o as U,aS as oe,p as H,B as n,aT as A,s as Y,w as k,_ as xe,aK as m,P as _,aL as G,L as D,aW as $,c7 as ue,c8 as he,x as g,bj as pe,aZ as je,a$ as fe,a_ as ge,aY as Ne}from"./index-DLs3A49i.js";import{C as J}from"./circle-check-CVLsivAR.js";import{P as be}from"./printer-C1n9sK3C.js";import{H as ve}from"./hash-Bex0RjCQ.js";import{C as ye}from"./calendar-WRlqOw5V.js";import{M as W}from"./map-pin-CzgKiABR.js";import{B as C}from"./banknote-DkPW3JAd.js";import{A as K}from"./arrow-left-C8-rsih4.js";import{S as Q}from"./shopping-bag-DoK8RnCO.js";import{I as we}from"./image-FhKcAiX0.js";import{M as X}from"./minus-MaSGV92k.js";import{P as Z}from"./plus-cECexnV2.js";import{T as V}from"./trash-2-DfEM3STI.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]],Ce=ne("pen-line",ke);function r(o){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(o)}function Te({navigateToView:o}){const{user:l}=le(),{cart:j,updateQuantity:y,removeFromCart:O,clearCart:ee,cartTotal:x,itemCount:F}=de(),{sendNotification:se}=ce(),[M,ae]=c.useState(""),[N,te]=c.useState(!0),[u,q]=c.useState(""),[E,L]=c.useState(!1),[a,B]=c.useState(null),[z,P]=c.useState([]);c.useEffect(()=>{me().then(P).catch(()=>{})},[]);const i=c.useMemo(()=>l?.email?z.find(s=>s.email===l.email):null,[l?.email,z]),d=c.useMemo(()=>!N&&u.trim()?u.trim():N&&i?.address?[i.address,i.city,i.country].filter(Boolean).join(", "):u.trim()?u.trim():"",[N,u,i]),re=async()=>{if(j.length===0){g.error("Your cart is empty");return}if(!l?.email){g.error("Please log in to place an order.");return}if(!d){g.error("Please provide a delivery address");return}L(!0);try{let s=i;const h=l.displayName||l.email.split("@")[0];if(s){const t={id:s.id,purchases:(s.purchases||0)+x};if(!s.address&&d){const p=d.split(",").map(f=>f.trim());t.address=p[0]||d,p.length>1&&(t.city=p[1])}s=await je(t),P(p=>p.map(f=>f.id===s.id?s:f))}else{const t=d.split(",").map(I=>I.trim()),p=t.length>1?t[1]:"",f=t[0]||d;s=await pe({name:h,contact:h,email:l.email,phone:"",address:f,city:p,country:"Philippines",status:"Active",purchases:x,payments:0}),P(I=>[...I,s]),g.info("Customer profile created automatically.")}const S=j.map(t=>({inventoryItemId:t.inventoryItemId,itemName:t.itemName,quantity:t.quantity,unitPrice:t.unitPrice,totalPrice:t.totalPrice})),w=await fe({customerId:s.id,customerName:s.name,customerCountry:s.country||"Philippines",customerCity:s.city||"",deliveryAddress:d,soDate:new Date().toISOString().split("T")[0],items:S,totalAmount:x,receiptStatus:"Unpaid",notes:M||void 0,amountPaid:0,createdBy:l.email,shippingStatus:"Processing"}),T=["J&T Express","LBC","JRS Express","Grab Express","Lalamove","Ninja Van","Flash Express","GoGo Xpress"],R=T[Math.floor(Math.random()*T.length)];try{await ge({salesOrderId:w.id,destination:d,carrier:R,status:"Pending",eta:void 0}),console.log("[Checkout] Shipment auto-created for order:",w.id,"with carrier:",R)}catch(t){console.warn("[Checkout] Failed to auto-create shipment:",t);try{await Ne({id:w.id,shippingStatus:"Pending"})}catch{}}B(w),ee(),g.success("Order placed successfully!");try{await se({title:"New Customer Order",message:`${s.name} placed an order for ${r(x)}`,type:"info",recipientRoles:["Admin","Owner"]})}catch(t){console.warn("[Checkout] Failed to send notification:",t)}}catch(s){console.error("Order error:",s),g.error("Failed to place order. Please try again.")}finally{L(!1)}},ie=()=>{window.print()};if(a){const s=new Date(a.soDate);return e.jsxs("div",{className:"max-w-2xl mx-auto py-4 sm:py-8 px-2 sm:px-0",children:[e.jsx(b,{className:"border-green-200 bg-green-50/50 dark:bg-green-950/20 mb-6",children:e.jsxs(v,{className:"pt-6 pb-4 text-center",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx("div",{className:"rounded-full bg-green-100 dark:bg-green-900/50 p-3",children:e.jsx(J,{className:"h-10 w-10 text-green-600"})})}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-1",children:"Order Placed Successfully!"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Thank you for your order. We'll process it shortly."})]})}),e.jsxs(b,{className:"print:shadow-none print:border-none",id:"order-receipt",children:[e.jsx(U,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-primary"}),e.jsx(H,{className:"text-lg",children:"Order Receipt"})]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:ie,className:"print:hidden gap-1",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Print"})]})]})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Order ID"}),e.jsx("p",{className:"font-mono font-medium text-xs sm:text-sm",children:a.id})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Date & Time"}),e.jsxs("p",{className:"font-medium text-xs sm:text-sm",children:[s.toLocaleDateString()," ",s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Customer"}),e.jsx("p",{className:"font-medium text-xs sm:text-sm",children:a.customerName})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Shipping Status"}),e.jsxs(k,{variant:"outline",className:"text-xs mt-0.5",children:[e.jsx(xe,{className:"h-3 w-3 mr-1"}),a.shippingStatus||"Pending"]})]})]})]}),a.deliveryAddress&&e.jsxs("div",{className:"flex items-start gap-2 bg-muted/50 rounded-lg p-3",children:[e.jsx(W,{className:"h-4 w-4 text-muted-foreground mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Delivery Address"}),e.jsx("p",{className:"text-sm",children:a.deliveryAddress})]})]}),e.jsx(m,{}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"Items Ordered (",a.items.length,")"]}),e.jsx("div",{className:"space-y-2 bg-muted/30 rounded-lg p-3",children:a.items.map((h,S)=>e.jsxs("div",{className:"flex justify-between items-start text-sm",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-2",children:[e.jsx("p",{className:"font-medium line-clamp-1",children:h.itemName}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r(h.unitPrice)," Ã— ",h.quantity]})]}),e.jsx("p",{className:"font-medium shrink-0",children:r(h.totalPrice)})]},S))})]}),e.jsx(m,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsx("span",{children:r(a.totalAmount)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipping"}),e.jsx("span",{className:"text-green-600",children:"Free"})]}),e.jsx(m,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-primary",children:r(a.totalAmount)})]})]}),e.jsx(m,{}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{className:"h-4 w-4 text-amber-600"}),e.jsx("span",{className:"font-medium text-sm",children:"Payment Method"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(k,{variant:"secondary",className:"gap-1",children:[e.jsx(C,{className:"h-3 w-3"}),"Cash on Delivery"]}),e.jsx(k,{variant:a.receiptStatus==="Paid"?"default":"outline",className:a.receiptStatus==="Paid"?"bg-green-600":"text-amber-600 border-amber-300",children:a.receiptStatus==="Paid"?"Paid":"Unpaid - Pay on Delivery"})]}),a.amountPaid>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Amount paid: ",r(a.amountPaid)," â€¢ Balance due: ",r(a.totalAmount-a.amountPaid)]})]}),a.notes&&e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Order Notes:"}),e.jsx("p",{className:"italic",children:a.notes})]})]}),e.jsxs(G,{className:"flex flex-col sm:flex-row gap-3 print:hidden",children:[e.jsx(n,{variant:"outline",onClick:()=>o("sales-orders"),className:"w-full sm:w-auto",children:"View My Orders"}),e.jsx(n,{onClick:()=>{B(null),o("products")},className:"w-full sm:w-auto",children:"Continue Shopping"})]})]})]})}return j.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>o("products"),children:e.jsx(K,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Shopping Cart"}),e.jsx("p",{className:"text-muted-foreground",children:"Your cart is empty"})]})]}),e.jsx(b,{children:e.jsx(v,{className:"py-12",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx(Q,{className:"h-16 w-16 text-muted-foreground/50 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Your cart is empty"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Looks like you haven't added any items to your cart yet."}),e.jsxs(n,{onClick:()=>o("products"),children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Browse Products"]})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx(n,{variant:"ghost",size:"icon",onClick:()=>o("products"),children:e.jsx(K,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"Shopping Cart"}),e.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground",children:[F," item(s) in your cart"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:j.map(s=>e.jsx(b,{children:e.jsx(v,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-16 h-16 sm:w-24 sm:h-24 bg-muted rounded-lg flex items-center justify-center overflow-hidden shrink-0",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.itemName,className:"w-full h-full object-cover"}):e.jsx(we,{className:"h-6 w-6 sm:h-8 sm:w-8 text-muted-foreground/50"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm sm:text-base line-clamp-2",children:s.itemName}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:s.brand}),e.jsx("p",{className:"text-primary font-medium mt-1 text-sm sm:text-base",children:r(s.unitPrice)}),e.jsxs("div",{className:"flex items-center justify-between mt-2 sm:hidden",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-accent rounded-lg p-0.5",children:[e.jsx(n,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>y(s.inventoryItemId,s.quantity-1),children:e.jsx(X,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-6 text-center font-semibold text-sm",children:s.quantity}),e.jsx(n,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>y(s.inventoryItemId,s.quantity+1),disabled:s.quantity>=s.availableStock,children:e.jsx(Z,{className:"h-3 w-3"})})]}),e.jsx("p",{className:"font-semibold text-sm",children:r(s.totalPrice)})]})]}),e.jsxs("div",{className:"hidden sm:flex flex-col items-end gap-2",children:[e.jsx(n,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>O(s.inventoryItemId),children:e.jsx(V,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2 bg-accent rounded-lg p-1",children:[e.jsx(n,{size:"icon",variant:"ghost",className:"h-7 w-7",onClick:()=>y(s.inventoryItemId,s.quantity-1),children:e.jsx(X,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-8 text-center font-semibold",children:s.quantity}),e.jsx(n,{size:"icon",variant:"ghost",className:"h-7 w-7",onClick:()=>y(s.inventoryItemId,s.quantity+1),disabled:s.quantity>=s.availableStock,children:e.jsx(Z,{className:"h-3 w-3"})})]}),e.jsx("p",{className:"font-semibold",children:r(s.totalPrice)})]}),e.jsx(n,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive shrink-0 sm:hidden",onClick:()=>O(s.inventoryItemId),children:e.jsx(V,{className:"h-4 w-4"})})]})})},s.inventoryItemId))}),e.jsx("div",{children:e.jsxs(b,{className:"sticky top-6",children:[e.jsx(U,{children:e.jsx(H,{children:"Order Summary"})}),e.jsxs(v,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:j.map(s=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground truncate mr-2",children:[s.itemName," Ã— ",s.quantity]}),e.jsx("span",{children:r(s.totalPrice)})]},s.inventoryItemId))}),e.jsx(m,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Subtotal (",F," items)"]}),e.jsx("span",{children:r(x)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipping"}),e.jsx("span",{className:"text-green-600",children:"Free"})]}),e.jsx(m,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-primary",children:r(x)})]})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 text-amber-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Payment Method"})]}),e.jsxs(k,{variant:"secondary",className:"gap-1",children:[e.jsx(C,{className:"h-3 w-3"}),"Cash on Delivery"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Pay when your order arrives at your doorstep"})]}),e.jsx(m,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(D,{className:"flex items-center gap-1",children:[e.jsx(A,{className:"h-3 w-3"}),"Customer Information"]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:i?.name||l?.displayName||l?.email?.split("@")[0]||"Customer"})]}),i?.phone?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:i.phone})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"text-sm text-amber-600 dark:text-amber-400",children:"No phone number saved - update your profile"})]})]})]}),e.jsx(m,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(D,{className:"flex items-center gap-1",children:[e.jsx(W,{className:"h-3 w-3"}),"Delivery Address"]}),i?.address?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Use saved address"})]}),e.jsx(he,{checked:N,onCheckedChange:te})]}),N?e.jsx("div",{className:"p-3 bg-green-50 dark:bg-green-950/30 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-green-600 mt-0.5 shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-green-800 dark:text-green-200",children:"Saved Address"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300 mt-1",children:[i.address,i.city,i.country].filter(Boolean).join(", ")})]})]})}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[e.jsx(Ce,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Enter a different address"})]}),e.jsx("textarea",{id:"customDeliveryAddress",placeholder:"Enter your delivery address...",value:u,onChange:s=>q(s.target.value),className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"})]})]}):e.jsxs("div",{children:[e.jsx("div",{className:"p-3 mb-3 bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 rounded-lg",children:e.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:"ðŸ’¡ Enter your delivery address. It will be saved for future orders."})}),e.jsx("textarea",{id:"deliveryAddress",placeholder:"Enter your full delivery address (e.g., 123 Main St, Calamba, Laguna)...",value:u,onChange:s=>q(s.target.value),className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"})]}),d&&e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(Y,{className:"h-3 w-3"}),"Delivering to: ",d]})]}),e.jsx(m,{}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"notes",children:"Order Notes (Optional)"}),e.jsx("textarea",{id:"notes",placeholder:"Any special instructions...",value:M,onChange:s=>ae(s.target.value),className:"mt-1.5 flex min-h-[60px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"})]})]}),e.jsx(G,{children:e.jsx(n,{className:"w-full",size:"lg",onClick:re,disabled:E||j.length===0,children:E?"Placing Order...":e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Place Order - ",r(x)]})})})]})})]})]})}export{Te as CustomerCartView};
