import{c as Ct,i as Dt,r as x,V as bt,j as e,B as g,C as f,q as S,s as C,t as D,z as ne,S as Te,y as wt,D as Ae,a3 as It,E as Re,F as ke,G as Fe,H as Le,I as j,J as h,d as le,K as Be,a5 as Pt,a4 as Ot,ad as Tt,m as ye,aB as At,am as Rt,A as u,aC as kt,aD as Ft,aE as Lt,aF as Bt,aG as Vt,aH as Et,aI as $t,aJ as qt}from"./index-DPbL7ctT.js";import{g as Kt,h as Ne}from"./permissions-DJnvoGTW.js";import{u as Ut,a as zt,T as Ht,E as Ve,P as fe,F as Mt,B as _t,c as Gt,b as Jt}from"./bulk-delete-dialog-CGSqOf-Y.js";import{e as ce,f as oe,g as O,h as c,j as de,k as i,S as $,a as q,b as K,c as U,d as A,T as me,i as T}from"./sortable-table-head-Dl6QJ9an.js";import{u as Qt,P as Wt,D as Yt}from"./printable-receipt-BC2-qhlM.js";import{F as Xt}from"./file-text-BXjG5Tyl.js";import{D as Zt}from"./dollar-sign-BH1It1ed.js";import{T as es}from"./trending-up-2xRyQ3B8.js";import{A as ue,a as Ee}from"./archive-DLtaChP6.js";import"./skeleton-BvvEmxYF.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ss=Ct("arrow-left",ts),as=["Unpaid","Partially Paid","Paid","Overdue"],rs=["Pending","Processing","Shipped","In Transit","Out for Delivery","Delivered","Failed","Returned"],R=z=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(z);function js(){const{user:z}=Dt(),H=z?Kt(z.id):"Viewer",he=Ne(H,"purchase_orders:create");Ne(H,"purchase_orders:update");const Y=Ne(H,"purchase_orders:delete"),$e=H==="Owner"||H==="Admin",{printReceipt:qe}=Qt(),[X,w]=x.useState(null),[xe,Ke]=x.useState([]),[Z,Ue]=x.useState([]),[ze,He]=x.useState(!0),[ee,Se]=x.useState(""),M=bt(ee,300),[k,Ce]=x.useState("all"),[p,De]=x.useState(!1),[Me,te]=x.useState(!1),[F,_]=x.useState(null),[_e,G]=x.useState(!1),[N,be]=x.useState(null),[J,je]=x.useState("asc"),[l,se]=x.useState(null),[r,v]=x.useState({soDate:new Date().toISOString().split("T")[0],customerId:"",customerName:"",customerCountry:"",customerCity:"",invoiceNumber:"",items:[],expectedDeliveryDate:"",notes:"",totalReceived:0,shippingStatus:"Pending"});x.useEffect(()=>{(async()=>{try{const[s,a,n]=await Promise.all([ye(),At(),Rt()]);w(s),Ke(a),Ue(n)}catch{u.error("Failed to load data")}finally{He(!1)}})()},[]);const L=X??[],Q=x.useMemo(()=>L.filter(t=>{const s=t.archived===!0;if(p!==s)return!1;const a=!M||t.id.toLowerCase().includes(M.toLowerCase())||t.customerName.toLowerCase().includes(M.toLowerCase())||t.items.some(o=>o.itemName.toLowerCase().includes(M.toLowerCase())),n=k==="all"||t.receiptStatus===k;return a&&n}),[L,M,k,p]),Ge=x.useMemo(()=>N?[...Q].sort((t,s)=>{const a=t[N],n=s[N];if(a==null&&n==null)return 0;if(a==null)return 1;if(n==null)return-1;if(typeof a=="number"&&typeof n=="number")return J==="asc"?a-n:n-a;const o=String(a).toLowerCase(),d=String(n).toLowerCase();return J==="asc"?o.localeCompare(d):d.localeCompare(o)}):Q,[Q,N,J]),{currentPage:Je,totalPages:Qe,paginatedData:we,goToPage:We,itemsPerPage:Ye,totalItems:Xe}=Ut(Ge,10),{selectedIds:ae,isSelected:Ze,toggleItem:et,toggleAll:tt,deselectAll:re,isAllSelected:st,isPartiallySelected:at,selectionCount:ie,hasSelection:rt}=zt(we),b=x.useMemo(()=>{const t=L.filter(y=>!y.archived),s=t.length,a=t.reduce((y,ve)=>y+ve.totalAmount,0),n=t.reduce((y,ve)=>y+ve.totalReceived,0),o=t.filter(y=>y.receiptStatus==="Paid").length,d=t.filter(y=>y.receiptStatus==="Unpaid").length,m=t.filter(y=>y.receiptStatus==="Partially Paid").length,E=t.filter(y=>y.receiptStatus==="Overdue").length,ft=t.filter(y=>y.shippingStatus==="Delivered").length,ge=new Date;ge.setDate(ge.getDate()-7);const St=t.filter(y=>new Date(y.createdDate)>=ge).length;return{totalSOs:s,totalValue:a,totalReceived:n,outstandingBalance:a-n,paidCount:o,unpaidCount:d,partiallyPaidCount:m,overdueCount:E,deliveredCount:ft,newThisWeek:St,avgOrderValue:s>0?a/s:0,collectionRate:a>0?Math.round(n/a*100):0}},[L]),I=t=>{const s=t;N===s?J==="asc"?je("desc"):(be(null),je("asc")):(be(s),je("asc"))},P=t=>N===t?J:null,it=(t,s)=>`${t}-D${String(s+1).padStart(3,"0")}`,nt=t=>{const s=Z.find(a=>a.id===t);return{itemId:s?.id??t,itemType:s?.brand??"-",itemCategory:s?.category??"-",itemSubcategory:s?.subcategory??"-"}},lt=t=>{se(t)},ct=()=>{se(null)};x.useEffect(()=>{if(l&&X){const t=X.find(s=>s.id===l.id);t&&JSON.stringify(t)!==JSON.stringify(l)?se(t):t||se(null)}},[X,l]);const pe=t=>{const s={Unpaid:{variant:"outline",className:"border-gray-500 text-gray-600"},"Partially Paid":{variant:"outline",className:"border-yellow-500 text-yellow-600"},Paid:{variant:"default",className:"bg-green-500"},Overdue:{variant:"destructive"}},{variant:a,className:n}=s[t];return e.jsx(ne,{variant:a,className:le("gap-1",n),children:t})},W=()=>{v({soDate:new Date().toISOString().split("T")[0],customerId:"",customerName:"",customerCountry:"",customerCity:"",invoiceNumber:"",items:[],expectedDeliveryDate:"",notes:"",totalReceived:0,shippingStatus:"Pending"})},Ie=()=>{v(t=>({...t,items:[...t.items,{inventoryItemId:"",itemName:"",quantity:1,unitPrice:0,totalPrice:0}]}))},Pe=t=>{v(s=>({...s,items:s.items.filter((a,n)=>n!==t)}))},B=(t,s,a)=>{v(n=>{const o=[...n.items];if(s==="inventoryItemId"){const d=Z.find(m=>m.id===a);d&&(o[t]={...o[t],inventoryItemId:d.id,itemName:d.name,unitPrice:d.pricePerPiece,totalPrice:o[t].quantity*d.pricePerPiece})}else if(s==="quantity"){const d=Number(a)||0;o[t]={...o[t],quantity:d,totalPrice:d*o[t].unitPrice}}else if(s==="unitPrice"){const d=Number(a)||0;o[t]={...o[t],unitPrice:d,totalPrice:o[t].quantity*d}}return{...n,items:o}})},Oe=t=>{const s=xe.find(a=>a.id===t);v(a=>({...a,customerId:t,customerName:s?.name??"",customerCountry:s?.country??"",customerCity:s?.city??""}))},ot=async()=>{if(!r.customerId||r.items.length===0||!r.expectedDeliveryDate){u.error("Please fill in all required fields");return}try{const t=await kt({soDate:r.soDate,customerId:r.customerId,customerName:r.customerName,customerCountry:r.customerCountry,customerCity:r.customerCity,invoiceNumber:r.invoiceNumber,items:r.items.map(s=>({...s,quantityShipped:0})),expectedDeliveryDate:r.expectedDeliveryDate,notes:r.notes,createdBy:z?.id??"1",totalReceived:r.totalReceived});w(s=>[t,...s??[]]),u.success(`Sales Order ${t.id} created successfully`),te(!1),W()}catch(t){u.error(t instanceof Error?t.message:"Failed to create sales order")}},dt=async t=>{if(!r.customerId||r.items.length===0||!r.expectedDeliveryDate){u.error("Please fill in all required fields");return}try{const s=L.find(o=>o.id===t),a=new Map(s?.items?.map(o=>[o.inventoryItemId,o.quantityShipped??0])??[]),n=await Et({id:t,soDate:r.soDate,customerId:r.customerId,customerName:r.customerName,customerCountry:r.customerCountry,customerCity:r.customerCity,invoiceNumber:r.invoiceNumber,items:r.items.map(o=>({...o,quantityShipped:a.get(o.inventoryItemId)??0})),expectedDeliveryDate:r.expectedDeliveryDate,notes:r.notes,totalReceived:r.totalReceived,shippingStatus:r.shippingStatus});w(o=>o?.map(d=>d.id===t?n:d)??[]),u.success(`Sales Order ${t} updated successfully`),_(null),W()}catch(s){u.error(s instanceof Error?s.message:"Failed to update sales order")}},mt=async t=>{try{await Vt(t),w(s=>s?.filter(a=>a.id!==t)??[]),u.success(`Sales Order ${t} deleted`),_(null)}catch(s){u.error(s instanceof Error?s.message:"Failed to delete sales order")}},ut=async t=>{try{await Bt(t),w(s=>s?.map(a=>a.id===t?{...a,archived:!0}:a)??[]),u.success(`Sales Order ${t} archived`)}catch(s){u.error(s instanceof Error?s.message:"Failed to archive sales order")}},ht=async t=>{try{await Lt(t),w(s=>s?.map(a=>a.id===t?{...a,archived:!1}:a)??[]),u.success(`Sales Order ${t} restored`)}catch(s){u.error(s instanceof Error?s.message:"Failed to restore sales order")}},xt=async()=>{try{const t=await qt(Array.from(ae));t.success?u.success(`${t.successCount} sales orders archived`):u.warning(`${t.successCount} archived, ${t.failedCount} failed`);const s=await ye();w(s),re(),G(!1)}catch{u.error("Failed to archive sales orders")}},jt=async()=>{try{const t=await Ft(Array.from(ae));t.success?u.success(`${t.successCount} sales orders restored`):u.warning(`${t.successCount} restored, ${t.failedCount} failed`);const s=await ye();w(s),re()}catch{u.error("Failed to restore sales orders")}},pt=async()=>{try{const t=await $t(Array.from(ae));t.success?u.success(`${t.successCount} sales orders permanently deleted`):u.warning(`${t.successCount} deleted, ${t.failedCount} failed`),w(s=>s?.filter(a=>!ae.has(a.id))??[]),re(),G(!1)}catch{u.error("Failed to permanently delete sales orders")}},gt=t=>{v({soDate:t.soDate??t.createdDate,customerId:t.customerId,customerName:t.customerName,customerCountry:t.customerCountry??"",customerCity:t.customerCity??"",invoiceNumber:t.invoiceNumber??"",items:(t.items??[]).map(s=>({inventoryItemId:s.inventoryItemId,itemName:s.itemName,quantity:s.quantity,unitPrice:s.unitPrice,totalPrice:s.totalPrice})),expectedDeliveryDate:t.expectedDeliveryDate??"",notes:t.notes??"",totalReceived:t.totalReceived??0,shippingStatus:t.shippingStatus??"Pending"}),_(t.id)},vt=()=>{const t=["Date","SO ID","Customer ID","Customer Name","Invoice #","Country","City","Items","Total Amount","Total Received","SO Balance","Receipt Status","Shipping Status","Expected Delivery","Notes"],s=Q.map(m=>[m.soDate??m.createdDate,m.id,m.customerId,m.customerName,m.invoiceNumber??"",m.customerCountry??"",m.customerCity??"",(m.items??[]).map(E=>`${E.itemName} (${E.quantity})`).join("; "),(m.totalAmount??0).toFixed(2),(m.totalReceived??0).toFixed(2),(m.soBalance??m.totalAmount??0).toFixed(2),m.receiptStatus,m.shippingStatus??"Pending",m.expectedDeliveryDate??"",m.notes??""]),a=[t,...s].map(m=>m.map(E=>`"${E}"`).join(",")).join(`
`),n=new Blob([a],{type:"text/csv"}),o=URL.createObjectURL(n),d=document.createElement("a");d.href=o,d.download=`sales-orders-${new Date().toISOString().split("T")[0]}.csv`,d.click(),URL.revokeObjectURL(o),u.success("Sales orders exported to CSV")},yt=()=>{Se(""),Ce("all"),De(!1)},V=x.useMemo(()=>r.items.reduce((t,s)=>t+s.totalPrice,0),[r.items]),Nt=t=>{const s={type:"sales-order",documentNumber:t.id,documentDate:t.soDate??t.createdDate,partyType:"Customer",partyName:t.customerName,partyCity:t.customerCity,partyCountry:t.customerCountry,referenceNumber:t.invoiceNumber,referenceLabel:"Invoice No.",items:t.items?.map(a=>({description:a.itemName,quantity:a.quantity,unitPrice:a.unitPrice,total:a.totalPrice}))||[],totalAmount:t.totalAmount??0,amountPaid:t.totalReceived??0,balance:t.soBalance??t.totalAmount-t.totalReceived??0,status:`${t.receiptStatus} / ${t.shippingStatus}`,expectedDeliveryDate:t.expectedDeliveryDate,notes:t.notes,createdBy:t.createdBy};qe(s)};return ze?e.jsx("div",{className:"p-6",children:e.jsx(Ht,{rows:8})}):l?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:ct,children:[e.jsx(ss,{className:"h-4 w-4 mr-1"}),"Back to List"]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Sales Order Details - ",l.id]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[l.customerName," • ",l.soDate??l.createdDate]})]})]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>Nt(l),children:[e.jsx(Wt,{className:"h-4 w-4 mr-2"}),"Print Invoice"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(f,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Customer"})}),e.jsxs(D,{children:[e.jsx("div",{className:"font-medium",children:l.customerName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:l.customerId})]})]}),e.jsxs(f,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Location"})}),e.jsxs(D,{children:[e.jsx("div",{className:"font-medium",children:l.customerCity||"-"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:l.customerCountry||"-"})]})]}),e.jsxs(f,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Total Amount"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-lg font-bold text-emerald-600",children:R(l.totalAmount??0)}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[l.items?.length??0," line items"]})]})]}),e.jsxs(f,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Status"})}),e.jsx(D,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[pe(l.receiptStatus),e.jsx(ne,{variant:l.shippingStatus==="Delivered"?"default":"outline",className:"w-fit mt-1",children:l.shippingStatus??"Pending"})]})})]})]}),e.jsxs(f,{children:[e.jsxs(S,{children:[e.jsx(C,{children:"Line Items"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Detailed breakdown of all items in this sales order"})]}),e.jsxs(D,{children:[!l.items||l.items.length===0?e.jsx(Ve,{icon:Te,title:"No line items",description:"This sales order has no line items"}):e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs(ce,{children:[e.jsx(oe,{children:e.jsxs(O,{children:[e.jsx(c,{children:"SO Date"}),e.jsx(c,{children:"SO ID"}),e.jsx(c,{children:"Detail ID"}),e.jsx(c,{children:"Customer ID"}),e.jsx(c,{children:"Customer Name"}),e.jsx(c,{children:"Country"}),e.jsx(c,{children:"City"}),e.jsx(c,{children:"Invoice Num"}),e.jsx(c,{children:"Item ID"}),e.jsx(c,{children:"Item Type"}),e.jsx(c,{children:"Item Category"}),e.jsx(c,{children:"Item Subcategory"}),e.jsx(c,{children:"Item Name"}),e.jsx(c,{className:"text-right",children:"QTY Sold"}),e.jsx(c,{className:"text-right",children:"Unit Price"}),e.jsx(c,{className:"text-right",children:"Total Sales Price"})]})}),e.jsx(de,{children:l.items.map((t,s)=>{const a=nt(t.inventoryItemId);return e.jsxs(O,{children:[e.jsx(i,{className:"whitespace-nowrap",children:l.soDate??l.createdDate}),e.jsx(i,{className:"font-medium",children:l.id}),e.jsx(i,{className:"font-mono text-sm",children:it(l.id,s)}),e.jsx(i,{className:"text-muted-foreground",children:l.customerId}),e.jsx(i,{children:l.customerName}),e.jsx(i,{children:l.customerCountry||"-"}),e.jsx(i,{children:l.customerCity||"-"}),e.jsx(i,{children:l.invoiceNumber||"-"}),e.jsx(i,{className:"font-mono text-sm",children:a.itemId}),e.jsx(i,{children:a.itemType}),e.jsx(i,{children:a.itemCategory}),e.jsx(i,{children:a.itemSubcategory}),e.jsx(i,{children:t.itemName}),e.jsx(i,{className:"text-right",children:t.quantity}),e.jsx(i,{className:"text-right",children:R(t.unitPrice)}),e.jsx(i,{className:"text-right font-medium",children:R(t.totalPrice)})]},s)})})]})}),l.items&&l.items.length>0&&e.jsx("div",{className:"mt-4 pt-4 border-t flex justify-end",children:e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Grand Total"}),e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:R(l.totalAmount??0)})]})})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Sales Orders"}),e.jsx("p",{className:"text-muted-foreground",children:"Create and manage customer orders, track payments, and monitor delivery status"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(f,{className:"relative overflow-hidden",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Total SOs"}),e.jsx(Xt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:b.totalSOs}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[b.newThisWeek," new this week"]})]})]}),e.jsxs(f,{className:"relative overflow-hidden",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Total Value"}),e.jsx(Zt,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:R(b.totalValue)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Avg: ",R(b.avgOrderValue)," per SO"]})]})]}),e.jsxs(f,{className:"relative overflow-hidden",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Outstanding"}),e.jsx(wt,{className:"h-4 w-4 text-amber-600"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:R(b.outstandingBalance)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[b.unpaidCount," unpaid, ",b.overdueCount," overdue"]})]})]}),e.jsxs(f,{className:"relative overflow-hidden",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Collection Rate"}),e.jsx(es,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(D,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[b.collectionRate,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[b.paidCount," paid of ",b.totalSOs," total"]})]})]})]}),e.jsxs(f,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Sales Orders"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage customer sales orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:vt,children:[e.jsx(Yt,{className:"h-4 w-4 mr-1"}),"Export CSV"]}),he&&e.jsxs(Ae,{open:Me,onOpenChange:te,children:[e.jsx(It,{asChild:!0,children:e.jsxs(g,{size:"sm",children:[e.jsx(fe,{className:"h-4 w-4 mr-1"}),"Create SO"]})}),e.jsxs(Re,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ke,{children:[e.jsx(Fe,{children:"Create Sales Order"}),e.jsx(Le,{children:"Create a new sales order for a customer"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs(f,{children:[e.jsx(S,{className:"pb-3",children:e.jsx(C,{className:"text-base",children:"Sales Order Information"})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"SO Date *"}),e.jsx(h,{type:"date",value:r.soDate,onChange:t=>v(s=>({...s,soDate:t.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Customer *"}),e.jsxs($,{value:r.customerId,onValueChange:Oe,children:[e.jsx(q,{children:e.jsx(K,{placeholder:"Select customer"})}),e.jsx(U,{children:xe.filter(t=>t.status==="Active").map(t=>e.jsx(A,{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Customer ID"}),e.jsx(h,{value:r.customerId,disabled:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Country"}),e.jsx(h,{value:r.customerCountry,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"City"}),e.jsx(h,{value:r.customerCity,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Invoice #"}),e.jsx(h,{value:r.invoiceNumber,onChange:t=>v(s=>({...s,invoiceNumber:t.target.value})),placeholder:"INV-2025-0001"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Expected Delivery Date *"}),e.jsx(h,{type:"date",value:r.expectedDeliveryDate,onChange:t=>v(s=>({...s,expectedDeliveryDate:t.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Total Received (₱)"}),e.jsx(h,{type:"number",min:"0",step:"0.01",value:r.totalReceived,onChange:t=>v(s=>({...s,totalReceived:parseFloat(t.target.value)||0}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Notes"}),e.jsx(h,{value:r.notes,onChange:t=>v(s=>({...s,notes:t.target.value})),placeholder:"Additional notes..."})]})]})]}),e.jsxs(f,{children:[e.jsxs(S,{className:"pb-3 flex flex-row items-center justify-between",children:[e.jsx(C,{className:"text-base",children:"Line Items"}),e.jsxs(g,{size:"sm",variant:"outline",onClick:Ie,children:[e.jsx(fe,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),e.jsxs(D,{children:[r.items.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:'No items added. Click "Add Item" to add line items.'}):e.jsxs(ce,{children:[e.jsx(oe,{children:e.jsxs(O,{children:[e.jsx(c,{children:"Item"}),e.jsx(c,{className:"w-24",children:"Qty"}),e.jsx(c,{className:"w-32",children:"Unit Price"}),e.jsx(c,{className:"w-32 text-right",children:"Total"}),e.jsx(c,{className:"w-12"})]})}),e.jsx(de,{children:r.items.map((t,s)=>e.jsxs(O,{children:[e.jsx(i,{children:e.jsxs($,{value:t.inventoryItemId,onValueChange:a=>B(s,"inventoryItemId",a),children:[e.jsx(q,{children:e.jsx(K,{placeholder:"Select item"})}),e.jsx(U,{children:Z.map(a=>e.jsx(A,{value:a.id,children:a.name},a.id))})]})}),e.jsx(i,{children:e.jsx(h,{type:"number",min:"1",value:t.quantity,onChange:a=>B(s,"quantity",a.target.value)})}),e.jsx(i,{children:e.jsx(h,{type:"number",min:"0",step:"0.01",value:t.unitPrice,onChange:a=>B(s,"unitPrice",a.target.value)})}),e.jsxs(i,{className:"text-right font-medium",children:["₱",t.totalPrice.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(i,{children:e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>Pe(s),children:e.jsx(me,{className:"h-4 w-4 text-destructive"})})})]},s))})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grand Total:"}),e.jsxs("span",{className:"ml-2 text-xl font-bold",children:["₱",V.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"SO Balance:"}),e.jsxs("span",{className:le("ml-2 text-xl font-bold",V-r.totalReceived>0?"text-orange-600":"text-green-600"),children:["₱",(V-r.totalReceived).toLocaleString(void 0,{minimumFractionDigits:2})]})]})]})]})]}),e.jsxs(Be,{children:[e.jsx(g,{variant:"outline",onClick:()=>{te(!1),W()},children:"Cancel"}),e.jsx(g,{onClick:ot,children:"Create Sales Order"})]})]})]})]})]})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(Pt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(h,{placeholder:"Search SO ID, customer, or items...",value:ee,onChange:t=>Se(t.target.value),className:"pl-10"})]}),e.jsxs($,{value:k,onValueChange:Ce,children:[e.jsxs(q,{className:"w-48",children:[e.jsx(Mt,{className:"h-4 w-4 mr-2"}),e.jsx(K,{placeholder:"Filter by status"})]}),e.jsxs(U,{children:[e.jsx(A,{value:"all",children:"All Statuses"}),as.map(t=>e.jsx(A,{value:t,children:t},t))]})]}),e.jsxs(g,{variant:p?"default":"outline",size:"sm",onClick:()=>De(!p),className:p?"bg-orange-500 hover:bg-orange-600 text-white":"",children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),p?"Viewing Archived":"View Archived"]}),(ee||k!=="all"||p)&&e.jsxs(g,{variant:"ghost",size:"sm",onClick:yt,className:"text-muted-foreground",children:[e.jsx(Ot,{className:"h-4 w-4 mr-1"}),"Clear Filters"]})]}),rt&&Y&&e.jsx(_t,{selectionCount:ie,onClearSelection:re,actions:p?[{id:"restore",label:"Restore",icon:e.jsx(Ee,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:jt},...$e?[{id:"permanent-delete",label:"Permanently Delete",icon:e.jsx(me,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>G(!0)}]:[]]:[{id:"archive",label:"Archive",icon:e.jsx(ue,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:()=>G(!0)}]}),Q.length===0?e.jsx(Ve,{icon:p?ue:Te,title:p?"No archived sales orders":"No sales orders found",description:p?"Archived sales orders will appear here":ee||k!=="all"?"Try adjusting your search or filters":"Create your first sales order to get started",actionLabel:!p&&he?"Create SO":void 0,onAction:!p&&he?()=>te(!0):void 0}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs(ce,{children:[e.jsx(oe,{children:e.jsxs(O,{children:[Y&&e.jsx(c,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:st,ref:t=>{t&&(t.indeterminate=at)},onChange:()=>tt(),className:"h-4 w-4"})}),e.jsx(T,{sortKey:"soDate",currentSortKey:N,sortDirection:P("soDate"),onSort:I,children:"Date"}),e.jsx(T,{sortKey:"id",currentSortKey:N,sortDirection:P("id"),onSort:I,children:"SO ID"}),e.jsx(c,{children:"Customer ID"}),e.jsx(T,{sortKey:"customerName",currentSortKey:N,sortDirection:P("customerName"),onSort:I,children:"Customer Name"}),e.jsx(c,{children:"Invoice #"}),e.jsx(c,{children:"Country"}),e.jsx(c,{children:"City"}),e.jsx(T,{sortKey:"totalAmount",currentSortKey:N,sortDirection:P("totalAmount"),onSort:I,className:"text-right",children:"Total Amount"}),e.jsx(T,{sortKey:"totalReceived",currentSortKey:N,sortDirection:P("totalReceived"),onSort:I,className:"text-right",children:"Total Received"}),e.jsx(T,{sortKey:"soBalance",currentSortKey:N,sortDirection:P("soBalance"),onSort:I,className:"text-right",children:"SO Balance"}),e.jsx(T,{sortKey:"receiptStatus",currentSortKey:N,sortDirection:P("receiptStatus"),onSort:I,children:"Receipt Status"}),e.jsx(T,{sortKey:"shippingStatus",currentSortKey:N,sortDirection:P("shippingStatus"),onSort:I,children:"Shipping"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(de,{children:we.map(t=>e.jsxs(O,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>gt(t),children:[Y&&e.jsx(i,{onClick:s=>s.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:Ze(t.id),onChange:()=>et(t.id),className:"h-4 w-4"})}),e.jsx(i,{className:"whitespace-nowrap",children:t.soDate??t.createdDate}),e.jsx(i,{className:"font-medium",children:t.id}),e.jsx(i,{className:"text-muted-foreground",children:t.customerId}),e.jsx(i,{children:t.customerName}),e.jsx(i,{className:"text-muted-foreground",children:t.invoiceNumber||"-"}),e.jsx(i,{children:t.customerCountry||"-"}),e.jsx(i,{children:t.customerCity||"-"}),e.jsxs(i,{className:"text-right font-medium",children:["₱",(t.totalAmount??0).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs(i,{className:"text-right",children:["₱",(t.totalReceived??0).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(i,{className:"text-right font-medium",children:e.jsxs("span",{className:le((t.soBalance??t.totalAmount??0)>0?"text-orange-600":"text-green-600"),children:["₱",(t.soBalance??t.totalAmount??0).toLocaleString(void 0,{minimumFractionDigits:2})]})}),e.jsx(i,{children:pe(t.receiptStatus)}),e.jsx(i,{children:e.jsx(ne,{variant:t.shippingStatus==="Delivered"?"default":t.shippingStatus==="In Transit"||t.shippingStatus==="Shipped"?"secondary":t.shippingStatus==="Failed"||t.shippingStatus==="Returned"?"destructive":"outline",children:t.shippingStatus??"Pending"})}),e.jsx(i,{onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(g,{size:"sm",variant:"outline",onClick:()=>lt(t),title:"View Details",children:e.jsx(Tt,{className:"h-4 w-4"})}),p?e.jsx(g,{size:"sm",variant:"outline",onClick:()=>ht(t.id),title:"Restore",children:e.jsx(Ee,{className:"h-4 w-4"})}):e.jsx(g,{size:"sm",variant:"ghost",className:"text-destructive",onClick:()=>ut(t.id),title:"Archive",children:e.jsx(ue,{className:"h-4 w-4"})})]})})]},t.id))})]})}),e.jsx(Gt,{currentPage:Je,totalPages:Qe,itemsPerPage:Ye,onPageChange:We,totalItems:Xe})]}),F&&e.jsx(Ae,{open:!!F,onOpenChange:t=>{t||(_(null),W())},children:e.jsxs(Re,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ke,{children:[e.jsxs(Fe,{children:["Edit Sales Order - ",F]}),e.jsx(Le,{children:"Update sales order details"})]}),e.jsx("div",{className:"space-y-6 py-4",children:(()=>{const t=L.find(s=>s.id===F);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Receipt Status:"}),t&&pe(t.receiptStatus),e.jsx("span",{className:"text-sm text-muted-foreground ml-4",children:"Shipping:"}),e.jsx(ne,{variant:t?.shippingStatus==="Delivered"?"default":t?.shippingStatus==="In Transit"||t?.shippingStatus==="Shipped"?"secondary":t?.shippingStatus==="Failed"||t?.shippingStatus==="Returned"?"destructive":"outline",children:t?.shippingStatus??"Pending"})]}),e.jsxs(f,{children:[e.jsx(S,{className:"pb-3",children:e.jsx(C,{className:"text-base",children:"Sales Order Information"})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"SO Date"}),e.jsx(h,{type:"date",value:r.soDate,onChange:s=>v(a=>({...a,soDate:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Customer"}),e.jsxs($,{value:r.customerId,onValueChange:Oe,children:[e.jsx(q,{children:e.jsx(K,{placeholder:"Select customer"})}),e.jsx(U,{children:xe.map(s=>e.jsx(A,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Customer ID"}),e.jsx(h,{value:r.customerId,disabled:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Country"}),e.jsx(h,{value:r.customerCountry,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"City"}),e.jsx(h,{value:r.customerCity,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Invoice #"}),e.jsx(h,{value:r.invoiceNumber,onChange:s=>v(a=>({...a,invoiceNumber:s.target.value}))})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Expected Delivery Date"}),e.jsx(h,{type:"date",value:r.expectedDeliveryDate,onChange:s=>v(a=>({...a,expectedDeliveryDate:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Total Received (₱)"}),e.jsx(h,{type:"number",min:"0",step:"0.01",value:r.totalReceived,onChange:s=>v(a=>({...a,totalReceived:parseFloat(s.target.value)||0}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Shipping Status"}),e.jsxs($,{value:r.shippingStatus,onValueChange:s=>v(a=>({...a,shippingStatus:s})),children:[e.jsx(q,{children:e.jsx(K,{})}),e.jsx(U,{children:rs.map(s=>e.jsx(A,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Notes"}),e.jsx(h,{value:r.notes,onChange:s=>v(a=>({...a,notes:s.target.value})),placeholder:"Optional notes..."})]})]})]}),e.jsxs(f,{children:[e.jsxs(S,{className:"pb-3 flex flex-row items-center justify-between",children:[e.jsx(C,{className:"text-base",children:"Line Items"}),e.jsxs(g,{size:"sm",variant:"outline",onClick:Ie,children:[e.jsx(fe,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),e.jsxs(D,{children:[r.items.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No items added."}):e.jsxs(ce,{children:[e.jsx(oe,{children:e.jsxs(O,{children:[e.jsx(c,{children:"Item"}),e.jsx(c,{className:"w-24",children:"Qty"}),e.jsx(c,{className:"w-32",children:"Unit Price"}),e.jsx(c,{className:"w-32 text-right",children:"Total"}),e.jsx(c,{className:"w-12"})]})}),e.jsx(de,{children:r.items.map((s,a)=>e.jsxs(O,{children:[e.jsx(i,{children:e.jsxs($,{value:s.inventoryItemId,onValueChange:n=>B(a,"inventoryItemId",n),children:[e.jsx(q,{children:e.jsx(K,{placeholder:"Select item"})}),e.jsx(U,{children:Z.map(n=>e.jsx(A,{value:n.id,children:n.name},n.id))})]})}),e.jsx(i,{children:e.jsx(h,{type:"number",min:"1",value:s.quantity,onChange:n=>B(a,"quantity",n.target.value)})}),e.jsx(i,{children:e.jsx(h,{type:"number",min:"0",step:"0.01",value:s.unitPrice,onChange:n=>B(a,"unitPrice",n.target.value)})}),e.jsxs(i,{className:"text-right font-medium",children:["₱",s.totalPrice.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(i,{children:e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>Pe(a),children:e.jsx(me,{className:"h-4 w-4 text-destructive"})})})]},a))})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grand Total:"}),e.jsxs("span",{className:"ml-2 text-xl font-bold",children:["₱",V.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"SO Balance:"}),e.jsxs("span",{className:le("ml-2 text-xl font-bold",V-r.totalReceived>0?"text-orange-600":"text-green-600"),children:["₱",(V-r.totalReceived).toLocaleString(void 0,{minimumFractionDigits:2})]})]})]})]})]}),e.jsxs(Be,{className:"gap-2",children:[Y&&e.jsxs(g,{variant:"destructive",onClick:()=>mt(F),children:[e.jsx(me,{className:"h-4 w-4 mr-1"}),"Delete"]}),e.jsx(g,{variant:"outline",onClick:()=>{_(null),W()},children:"Cancel"}),e.jsx(g,{onClick:()=>dt(F),children:"Save Changes"})]})]})})()})]})})]})]}),e.jsx(Jt,{open:_e,onOpenChange:G,itemCount:ie,itemType:"sales order",onConfirm:p?pt:xt,title:p?"Permanently Delete Sales Orders?":"Archive Sales Orders?",description:p?`This will permanently delete ${ie} sales order(s). This action cannot be undone.`:`This will archive ${ie} sales order(s). You can restore them later from the archived view.`,confirmLabel:p?"Permanently Delete":"Archive"})]})}export{js as SalesOrdersView};
