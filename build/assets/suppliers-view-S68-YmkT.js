import{O as Bs,i as Es,r as i,V as $s,an as Ls,l as Os,ao as Us,aS as ze,A as n,aT as Ks,aU as Vs,aV as Ms,aW as Rs,aX as Hs,j as e,C as B,q as Y,s as _,U as xe,t as E,S as Ge,P as We,d as A,z as V,x as qs,D as pe,a3 as Ye,B as j,E as ge,F as je,G as fe,H as ye,I as d,J as m,K as ve,Y as zs,a5 as Gs,a4 as Ws,p as Ys,ac as _e,aY as Xe,aZ as _s,a_ as Xs,a$ as Js}from"./index-DDci2XN2.js";import{S as X,a as J,b as Z,c as Q,d as M,T as Je,e as Zs,f as Qs,g as Ze,h as Qe,i as F,j as et,k as y}from"./sortable-table-head-Bpyu4OSg.js";import{u as st,a as tt,P as at,F as rt,B as lt,T as it,E as nt,S as ct,b as dt}from"./select-all-banner-snGFN-6v.js";import{B as ot}from"./bulk-delete-dialog-DupwYnUY.js";import{F as mt}from"./favorite-button-C4fBmQDH.js";import{u as ut}from"./useTableSort-De0sBm6j.js";import{c as ht,i as xt}from"./permissions-DJnvoGTW.js";import{E as Ne}from"./editable-cell-DugkHHlV.js";import{C as es}from"./circle-check-big-Cqf7XqR1.js";import{S as pt}from"./star-CFGmvzW7.js";import{A as ee,a as ss}from"./archive-JzTJESXI.js";import{P as ts}from"./phone-kU3IBe-O.js";import{B as Se,H as gt,T as jt}from"./tag-CeDOLtAc.js";import{M as ft}from"./map-pin-BQQ9tX4S.js";import{T as as}from"./trending-up-Dt_QN5YH.js";import{D as rs}from"./dollar-sign-DfKtBucy.js";import{S as yt}from"./square-pen-DWwIw9p7.js";import"./skeleton-D6aD9Qan.js";const be=["Active","Inactive"],Ce=["Electronics","Furniture","Clothing","Food & Beverages","Other"];function Ut({initialOpenDialog:we,onDialogOpened:ke,initialSupplierId:se,onSupplierDialogOpened:Ae}){const{isFavorite:Fe,getFavoritesByType:De}=Bs(),{user:te}=Es(),S=te?ht(te.role):!1,Pe=te?xt(te.role):!1,[$,Ie]=i.useState(""),[b,ae]=i.useState("all"),[L,Te]=i.useState(!1),[u,Be]=i.useState(!1),[R,f]=i.useState(null),[H,ls]=i.useState([]),[re,is]=i.useState([]),[ns,Ee]=i.useState(!0),[q,z]=i.useState(!1),[le,P]=i.useState(null),[ie,G]=i.useState(null),[a,c]=i.useState({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0}),ne=$s($,300);i.useEffect(()=>{(async()=>{Ee(!0);const[s,r,t]=await Promise.all([Ls(),Os(),Us()]);f(s),ls(r),is(t),Ee(!1)})()},[]),i.useEffect(()=>{we&&!q&&(z(!0),ke?.())},[we,ke,q]),i.useEffect(()=>{se&&R&&R.find(r=>r.id===se)&&(G(se),Ae?.())},[se,R,Ae]);const v=i.useMemo(()=>R??[],[R]),g=i.useMemo(()=>{const s=v.length,r=v.filter(o=>o.status==="Active").length,t=v.filter(o=>o.status==="Inactive").length,l=new Set(v.map(o=>o.category)).size,h=H.length,K=H.reduce((o,x)=>(o[x.supplierId]=(o[x.supplierId]||0)+1,o),{});let W=null;if(Object.keys(K).length>0){const o=Object.entries(K).sort((T,he)=>he[1]-T[1])[0],x=v.find(T=>T.id===o[0]);x&&(W={id:x.id,name:x.name,count:o[1]})}const He=H.reduce((o,x)=>(o[x.supplierId]=(o[x.supplierId]||0)+x.totalAmount,o),{});let qe=null;if(Object.keys(He).length>0){const o=Object.entries(He).sort((T,he)=>he[1]-T[1])[0],x=v.find(T=>T.id===o[0]);x&&(qe={id:x.id,name:x.name,value:o[1]})}const Is=re.reduce((o,x)=>(x.supplierId&&(o[x.supplierId]=(o[x.supplierId]||0)+1),o),{}),Ts=Object.keys(Is).length;return{totalSuppliers:s,activeSuppliers:r,inactiveSuppliers:t,uniqueCategories:l,totalPurchaseOrders:h,topSupplierByPO:W,topSupplierByValue:qe,suppliersWithProducts:Ts}},[v,H,re]),ce=i.useMemo(()=>v.filter(s=>{if(s.archived===!0!==u||L&&!Fe("suppliers",s.id)||b!=="all"&&s.status!==b)return!1;if(ne){const t=ne.toLowerCase();if(!(s.name.toLowerCase().includes(t)||s.id.toLowerCase().includes(t)||s.category.toLowerCase().includes(t)||s.contact.toLowerCase().includes(t)||s.email.toLowerCase().includes(t)))return!1}return!0}),[v,ne,b,L,Fe,u]);function cs(){Ie(""),ae("all"),Te(!1),Be(!1)}async function ds(s){try{const r=await Js(s);f(t=>(t??[]).map(l=>l.id===s?r:l)),P(null),n.success("Supplier archived successfully")}catch(r){n.error(r?.message||"Failed to archive supplier")}}async function os(s){try{const r=await _s(s);f(t=>(t??[]).map(l=>l.id===s?r:l)),P(null),n.success("Supplier restored successfully")}catch(r){n.error(r?.message||"Failed to restore supplier")}}async function ms(s){try{await Xs(s),f(r=>(r??[]).filter(t=>t.id!==s)),P(null),n.success("Supplier permanently deleted")}catch(r){n.error(r?.message||"Failed to permanently delete supplier")}}const O=s=>{switch(s){case"Active":return"✓";case"Inactive":return"○";default:return"○"}},de=s=>{switch(s){case"Active":return"bg-emerald-500/15 text-emerald-700 dark:text-emerald-400 border-emerald-200";case"Inactive":return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200";default:return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200"}},{sortedData:$e,sortConfig:C,requestSort:w,getSortDirection:k}=ut(ce),{currentPage:Le,totalPages:us,paginatedData:Oe,goToPage:hs,totalItems:xs,itemsPerPage:ps}=st($e,25),{selectedIds:N,selectedItems:Ue,selectionCount:U,isAllSelected:gs,isAllPageSelected:js,isAllPagesSelected:fs,isPartiallySelected:ys,hasSelection:oe,toggleItem:vs,toggleAll:me,selectAllPages:Ns,deselectAll:p,isSelected:Ss,totalItemCount:Ke,pageItemCount:Ve}=tt(Oe,$e),[Me,D]=i.useState(!1),[bs,Re]=i.useState(!1),[Cs,I]=i.useState(!1);i.useEffect(()=>{p()},[Le,p]),i.useEffect(()=>{const s=r=>{(r.metaKey||r.ctrlKey)&&r.key==="a"&&!q&&!le&&(r.preventDefault(),me()),r.key==="Escape"&&oe&&p()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[me,p,oe,q,le]);const ue=i.useCallback(async(s,r,t)=>{try{const l={[r]:t},h=await ze({id:s,...l});f(K=>(K??[]).map(W=>W.id===s?h:W)),n.success(`${r.charAt(0).toUpperCase()+r.slice(1)} updated`)}catch(l){throw n.error(l?.message||"Failed to update"),l}},[f]);i.useCallback(async()=>{D(!0);try{const s=Array.from(N),r=await Ks(s);f(t=>t?.filter(l=>!s.includes(l.id))??[]),r.failedCount>0?n.warning(`Deleted ${r.successCount} suppliers. ${r.failedCount} failed.`):n.success(`Successfully deleted ${r.successCount} supplier${r.successCount!==1?"s":""}`),p()}catch(s){n.error(s?.message||"Failed to delete suppliers")}finally{D(!1),I(!1)}},[N,p]);const ws=i.useCallback(async()=>{D(!0);try{const s=Array.from(N),r=await Vs(s);f(t=>t&&t.map(l=>s.includes(l.id)?{...l,archived:!0,archivedAt:new Date().toISOString()}:l)),r.failedCount>0?n.warning(`Archived ${r.successCount} suppliers. ${r.failedCount} failed.`):n.success(`Successfully archived ${r.successCount} supplier${r.successCount!==1?"s":""}`),p()}catch(s){n.error(s?.message||"Failed to archive suppliers")}finally{D(!1),I(!1)}},[N,p]),ks=i.useCallback(async()=>{D(!0);try{const s=Array.from(N),r=await Ms(s);f(t=>t&&t.map(l=>s.includes(l.id)?{...l,archived:!1,archivedAt:void 0}:l)),r.failedCount>0?n.warning(`Restored ${r.successCount} suppliers. ${r.failedCount} failed.`):n.success(`Successfully restored ${r.successCount} supplier${r.successCount!==1?"s":""}`),p()}catch(s){n.error(s?.message||"Failed to restore suppliers")}finally{D(!1),I(!1)}},[N,p]),As=i.useCallback(async()=>{D(!0);try{const s=Array.from(N),r=await Rs(s);f(t=>t?.filter(l=>!s.includes(l.id))??[]),r.failedCount>0?n.warning(`Permanently deleted ${r.successCount} suppliers. ${r.failedCount} failed.`):n.success(`Permanently deleted ${r.successCount} supplier${r.successCount!==1?"s":""}`),p()}catch(s){n.error(s?.message||"Failed to permanently delete suppliers")}finally{D(!1),I(!1)}},[N,p]),Fs=i.useCallback(async s=>{Re(!0);try{const r=Array.from(N),t=await Hs(r,s);f(l=>l&&l.map(h=>r.includes(h.id)?{...h,status:s}:h)),t.failedCount>0?n.warning(`Updated ${t.successCount} suppliers. ${t.failedCount} failed.`):n.success(`Successfully updated ${t.successCount} supplier${t.successCount!==1?"s":""}`),p()}catch(r){n.error(r?.message||"Failed to update suppliers")}finally{Re(!1)}},[N,p]),Ds=i.useCallback(s=>{c({id:s.id,name:s.name,contact:s.contact,email:s.email,phone:s.phone,category:s.category,status:s.status,country:s.country||"",city:s.city||"",address:s.address||"",purchases:s.purchases||0,payments:s.payments||0}),P(s.id)},[]),Ps=i.useMemo(()=>Ue.map(s=>s.name),[Ue]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Suppliers"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage supplier profiles, contact information, and purchasing relationships"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(B,{className:"relative overflow-hidden",children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"Total Suppliers"}),e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g.totalSuppliers}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[g.activeSuppliers," active, ",g.inactiveSuppliers," inactive"]})]})]}),e.jsxs(B,{className:"relative overflow-hidden",children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"Active Suppliers"}),e.jsx(es,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:g.activeSuppliers}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:g.totalSuppliers>0?`${Math.round(g.activeSuppliers/g.totalSuppliers*100)}% of total`:"No suppliers yet"})]})]}),e.jsxs(B,{className:"relative overflow-hidden",children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"Total Purchase Orders"}),e.jsx(Ge,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g.totalPurchaseOrders}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:g.topSupplierByPO?`Top: ${g.topSupplierByPO.name} (${g.topSupplierByPO.count})`:"No orders yet"})]})]}),e.jsxs(B,{className:"relative overflow-hidden",children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"Categories"}),e.jsx(We,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:g.uniqueCategories}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[g.suppliersWithProducts," suppliers with products"]})]})]})]}),e.jsxs("div",{className:"grid gap-3 grid-cols-1 sm:grid-cols-2",children:[e.jsx(B,{className:A("cursor-pointer transition-all hover:shadow-md border-l-4",b==="Active"?"ring-2 ring-primary":"","border-l-emerald-400"),onClick:()=>ae(b==="Active"?"all":"Active"),children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Active"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:g.activeSuppliers})]}),e.jsx(V,{variant:"outline",className:de("Active"),children:O("Active")})]})})}),e.jsx(B,{className:A("cursor-pointer transition-all hover:shadow-md border-l-4",b==="Inactive"?"ring-2 ring-primary":"","border-l-slate-400"),onClick:()=>ae(b==="Inactive"?"all":"Inactive"),children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Inactive"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:g.inactiveSuppliers})]}),e.jsx(V,{variant:"outline",className:de("Inactive"),children:O("Inactive")})]})})})]}),e.jsxs(B,{children:[e.jsx(Y,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{className:"text-xl",children:"Supplier Management"}),e.jsx(qs,{className:"mt-1",children:"Manage your supplier relationships and contacts"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(pe,{open:q,onOpenChange:s=>{z(s),s||c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0})},children:[e.jsx(Ye,{asChild:!0,children:e.jsxs(j,{onClick:()=>c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0}),disabled:!S,title:S?void 0:"You don't have permission to add suppliers",children:[e.jsx(at,{className:"h-4 w-4 mr-2"}),"Add Supplier"]})}),e.jsxs(ge,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(je,{children:[e.jsx(fe,{children:"Create New Supplier"}),e.jsx(ye,{children:"Enter the details for the new supplier."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"supplier-name",children:"Company Name *"}),e.jsx(m,{id:"supplier-name",placeholder:"Enter company name",value:a.name,onChange:s=>c({...a,name:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"supplier-status",children:"Status"}),e.jsxs(X,{value:a.status,onValueChange:s=>c({...a,status:s}),children:[e.jsx(J,{children:e.jsx(Z,{placeholder:"Select status"})}),e.jsx(Q,{children:be.map(s=>e.jsx(M,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:O(s)}),s]})},s))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"contact-name",children:"Contact Person *"}),e.jsx(m,{id:"contact-name",placeholder:"Enter contact name",value:a.contact,onChange:s=>c({...a,contact:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"email",children:"Email *"}),e.jsx(m,{id:"email",type:"email",placeholder:"email@example.com",value:a.email,onChange:s=>c({...a,email:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"phone",children:"Phone *"}),e.jsx(m,{id:"phone",placeholder:"+1 (555) 000-0000",value:a.phone,onChange:s=>c({...a,phone:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"category",children:"Category *"}),e.jsxs(X,{value:a.category,onValueChange:s=>c({...a,category:s}),children:[e.jsx(J,{children:e.jsx(Z,{placeholder:"Select category"})}),e.jsx(Q,{children:Ce.map(s=>e.jsx(M,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Location Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"country",children:"Country"}),e.jsx(m,{id:"country",placeholder:"e.g., United States",value:a.country,onChange:s=>c({...a,country:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"city",children:"City"}),e.jsx(m,{id:"city",placeholder:"e.g., San Francisco",value:a.city,onChange:s=>c({...a,city:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2 mt-4",children:[e.jsx(d,{htmlFor:"address",children:"Address"}),e.jsx(m,{id:"address",placeholder:"Full street address",value:a.address,onChange:s=>c({...a,address:s.target.value})})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Financial Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"purchases",children:"Total Purchases (₱)"}),e.jsx(m,{id:"purchases",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:a.purchases,onChange:s=>c({...a,purchases:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"payments",children:"Total Payments (₱)"}),e.jsx(m,{id:"payments",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:a.payments,onChange:s=>c({...a,payments:parseFloat(s.target.value)||0})})]})]})]})]}),e.jsxs(ve,{children:[e.jsx(j,{variant:"outline",onClick:()=>z(!1),children:"Cancel"}),e.jsx(j,{onClick:async()=>{if(!a.name.trim()||!a.contact.trim()||!a.email.trim()||!a.phone.trim()||!a.category.trim()){n.error("Please fill all required fields");return}try{const s=await zs({name:a.name,contact:a.contact,email:a.email,phone:a.phone,category:a.category,status:a.status,country:a.country,city:a.city,address:a.address,purchases:a.purchases,payments:a.payments});f(r=>[s,...r??[]]),z(!1),n.success("Supplier added successfully"),c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0})}catch(s){n.error(s?.message||"Failed to add supplier")}},children:"Create Supplier"})]})]})]})})]})}),e.jsxs(E,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Gs,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(m,{placeholder:"Search suppliers by name, contact, email...",value:$,onChange:s=>Ie(s.target.value),className:"pl-9"})]}),e.jsxs(X,{value:b,onValueChange:ae,children:[e.jsxs(J,{className:"w-full sm:w-[180px]",children:[e.jsx(rt,{className:"h-4 w-4 mr-2"}),e.jsx(Z,{placeholder:"Filter by status"})]}),e.jsxs(Q,{children:[e.jsx(M,{value:"all",children:"All Statuses"}),be.map(s=>e.jsx(M,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:O(s)}),s]})},s))]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(j,{variant:L?"default":"outline",size:"sm",onClick:()=>Te(!L),className:"gap-1",children:[e.jsx(pt,{className:A("h-4 w-4",L&&"fill-current")}),"Favorites",De("suppliers").length>0&&e.jsx(V,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:De("suppliers").length})]}),e.jsxs(j,{variant:u?"default":"outline",size:"sm",onClick:()=>Be(!u),className:u?"bg-orange-500 hover:bg-orange-600 text-white":"",children:[e.jsx(ee,{className:"h-4 w-4 mr-1"}),u?"Viewing Archived":"View Archived"]}),($||b!=="all"||L||u)&&e.jsxs(j,{variant:"ghost",size:"sm",onClick:cs,className:"gap-1 text-muted-foreground hover:text-foreground",children:[e.jsx(Ws,{className:"h-4 w-4"}),"Clear All Filters"]})]})]}),oe&&S&&e.jsx(lt,{selectionCount:U,onClearSelection:p,isLoading:Me||bs,actions:u?[{id:"restore",label:"Restore",icon:e.jsx(ss,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:ks},...Pe?[{id:"permanent-delete",label:"Permanently Delete",icon:e.jsx(Je,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>I(!0)}]:[]]:[{id:"archive",label:"Archive",icon:e.jsx(ee,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:()=>I(!0)}],actionGroups:u?[]:[{id:"status-update",label:"Update Status",icon:e.jsx(Ys,{className:"h-4 w-4 mr-1"}),options:[{value:"Active",label:"Active"},{value:"Inactive",label:"Inactive"}],onSelect:s=>Fs(s)}],className:"mb-4"}),e.jsx(ot,{open:Cs,onOpenChange:I,itemCount:U,itemType:"supplier",itemNames:Ps,onConfirm:u?As:ws,isLoading:Me,title:u?"Permanently Delete Suppliers":"Archive Suppliers",description:u?`Are you sure you want to permanently delete ${U} supplier${U!==1?"s":""}? This action cannot be undone.`:`Are you sure you want to archive ${U} supplier${U!==1?"s":""}? Archived suppliers can be restored later.`,confirmLabel:u?"Permanently Delete":"Archive"}),ns?e.jsx(it,{rows:8}):ce.length===0?e.jsx(nt,{icon:u?ee:xe,title:u?"No archived suppliers":"No suppliers found",description:u?"Archived suppliers will appear here":$?"Try adjusting your search criteria":"Get started by adding your first supplier",actionLabel:!u&&!$?"Add Supplier":void 0,onAction:!u&&!$?()=>z(!0):void 0}):e.jsxs("div",{className:"rounded-md border overflow-hidden",children:[e.jsx(ct,{pageItemCount:Ve,totalItemCount:Ke,isAllPagesSelected:fs,show:js&&Ke>Ve,onSelectAllPages:Ns,onClearSelection:p,itemLabel:"suppliers"}),e.jsxs(Zs,{children:[e.jsx(Qs,{children:e.jsxs(Ze,{children:[e.jsx(Qe,{className:"w-12",children:e.jsx(_e,{checked:gs,ref:s=>{s&&(s.indeterminate=ys)},onCheckedChange:me,"aria-label":"Select all suppliers"})}),e.jsx(F,{sortKey:"id",currentSortKey:C.key,sortDirection:k("id"),onSort:s=>w(s),children:"Supplier ID"}),e.jsx(F,{sortKey:"name",currentSortKey:C.key,sortDirection:k("name"),onSort:s=>w(s),children:"Company Name"}),e.jsx(F,{sortKey:"contact",currentSortKey:C.key,sortDirection:k("contact"),onSort:s=>w(s),children:"Contact"}),e.jsx(F,{sortKey:"category",currentSortKey:C.key,sortDirection:k("category"),onSort:s=>w(s),children:"Category"}),e.jsx(F,{sortKey:"status",currentSortKey:C.key,sortDirection:k("status"),onSort:s=>w(s),children:"Status"}),e.jsx(F,{sortKey:"country",currentSortKey:C.key,sortDirection:k("country"),onSort:s=>w(s),children:"Location"}),e.jsx(F,{sortKey:"purchases",currentSortKey:C.key,sortDirection:k("purchases"),onSort:s=>w(s),children:"Purchases"}),e.jsx(F,{sortKey:"payments",currentSortKey:C.key,sortDirection:k("payments"),onSort:s=>w(s),children:"Payments"}),e.jsx(F,{sortKey:"balance",currentSortKey:C.key,sortDirection:k("balance"),onSort:s=>w(s),children:"Balance"}),e.jsx(Qe,{children:"Actions"})]})}),e.jsx(et,{children:Oe.map(s=>{const r=Ss(s.id);return e.jsxs(Ze,{className:A("hover:bg-muted/50 transition-colors",r&&"bg-muted/50"),children:[e.jsx(y,{children:e.jsx(_e,{checked:r,onCheckedChange:()=>vs(s.id),"aria-label":`Select supplier ${s.name}`})}),e.jsx(y,{className:"font-mono text-sm",children:s.id}),e.jsx(y,{children:e.jsx("button",{className:"text-left font-medium text-primary hover:underline cursor-pointer bg-transparent border-none p-0",onClick:()=>G(s.id),children:s.name})}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Xe,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(Ne,{value:s.email,type:"text",onSave:t=>ue(s.id,"email",t),disabled:!S,className:"text-xs text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(ts,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(Ne,{value:s.phone,type:"text",onSave:t=>ue(s.id,"phone",t),disabled:!S,className:"text-xs text-muted-foreground"})]})]})}),e.jsx(y,{children:e.jsx(Ne,{value:s.category,type:"select",options:Ce.map(t=>({value:t,label:t})),onSave:t=>ue(s.id,"category",t),disabled:!S})}),e.jsx(y,{children:e.jsxs(V,{variant:"outline",className:A("gap-1",de(s.status)),children:[e.jsx("span",{children:O(s.status)}),s.status]})}),e.jsx(y,{children:e.jsx("div",{className:"text-sm",children:s.city&&s.country?e.jsxs("span",{children:[s.city,", ",s.country]}):s.city||s.country?e.jsx("span",{children:s.city||s.country}):e.jsx("span",{className:"text-muted-foreground",children:"—"})})}),e.jsxs(y,{className:"text-right font-medium",children:["₱",s.purchases.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(y,{className:"text-right font-medium",children:["₱",s.payments.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(y,{className:A("text-right font-medium",s.balance>0?"text-amber-600":s.balance<0?"text-emerald-600":""),children:["₱",s.balance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx(y,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(mt,{entityType:"suppliers",entityId:s.id,entityName:s.name}),e.jsxs(pe,{open:le===s.id,onOpenChange:t=>{P(t?s.id:null),t&&c({...s,country:s.country||"",city:s.city||"",address:s.address||"",purchases:s.purchases||0,payments:s.payments||0})},children:[e.jsx(Ye,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"sm",disabled:!S,title:S?void 0:"You don't have permission to edit suppliers",children:"Edit"})}),e.jsxs(ge,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(je,{children:[e.jsx(fe,{children:"Edit Supplier"}),e.jsxs(ye,{children:["Supplier ID: ",s.id]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-name",children:"Company Name *"}),e.jsx(m,{id:"edit-name",value:a.name,onChange:t=>c({...a,name:t.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-status",children:"Status"}),e.jsxs(X,{value:a.status,onValueChange:t=>c({...a,status:t}),children:[e.jsx(J,{children:e.jsx(Z,{placeholder:"Select status"})}),e.jsx(Q,{children:be.map(t=>e.jsx(M,{value:t,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:O(t)}),t]})},t))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-contact",children:"Contact Person *"}),e.jsx(m,{id:"edit-contact",value:a.contact,onChange:t=>c({...a,contact:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-email",children:"Email *"}),e.jsx(m,{id:"edit-email",type:"email",value:a.email,onChange:t=>c({...a,email:t.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-phone",children:"Phone *"}),e.jsx(m,{id:"edit-phone",value:a.phone,onChange:t=>c({...a,phone:t.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-category",children:"Category *"}),e.jsxs(X,{value:a.category,onValueChange:t=>c({...a,category:t}),children:[e.jsx(J,{children:e.jsx(Z,{placeholder:"Select category"})}),e.jsx(Q,{children:Ce.map(t=>e.jsx(M,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Location Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-country",children:"Country"}),e.jsx(m,{id:"edit-country",placeholder:"e.g., United States",value:a.country,onChange:t=>c({...a,country:t.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-city",children:"City"}),e.jsx(m,{id:"edit-city",placeholder:"e.g., San Francisco",value:a.city,onChange:t=>c({...a,city:t.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2 mt-4",children:[e.jsx(d,{htmlFor:"edit-address",children:"Address"}),e.jsx(m,{id:"edit-address",placeholder:"Full street address",value:a.address,onChange:t=>c({...a,address:t.target.value})})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(d,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Financial Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-purchases",children:"Total Purchases (₱)"}),e.jsx(m,{id:"edit-purchases",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:a.purchases,onChange:t=>c({...a,purchases:parseFloat(t.target.value)||0})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"edit-payments",children:"Total Payments (₱)"}),e.jsx(m,{id:"edit-payments",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:a.payments,onChange:t=>c({...a,payments:parseFloat(t.target.value)||0})})]})]})]})]}),e.jsxs(ve,{className:"flex-col-reverse sm:flex-row sm:justify-between sm:space-x-2",children:[s.archived?e.jsxs(e.Fragment,{children:[e.jsxs(j,{variant:"outline",onClick:()=>os(s.id),children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Restore"]}),Pe&&e.jsxs(j,{variant:"destructive",onClick:()=>ms(s.id),children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Permanently Delete"]})]}):e.jsxs(j,{variant:"outline",onClick:()=>ds(s.id),className:"text-orange-600 border-orange-300 hover:bg-orange-50",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Archive"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"outline",onClick:()=>P(null),children:"Cancel"}),!s.archived&&e.jsx(j,{onClick:async()=>{if(!a.id){n.error("Missing supplier id");return}if(!a.name.trim()||!a.contact.trim()||!a.email.trim()||!a.phone.trim()||!a.category.trim()){n.error("Please fill all required fields");return}try{const t=await ze({id:a.id,name:a.name,contact:a.contact,email:a.email,phone:a.phone,category:a.category,status:a.status,country:a.country,city:a.city,address:a.address,purchases:a.purchases,payments:a.payments});f(l=>(l??[]).map(h=>h.id===t.id?t:h)),P(null),n.success("Supplier updated")}catch(t){n.error(t?.message||"Failed to update supplier")}},children:"Save Changes"})]})]})]})]})]})})]},s.id)})})]}),ce.length>0&&e.jsx(dt,{currentPage:Le,totalPages:us,onPageChange:hs,itemsPerPage:ps,totalItems:xs})]})]})]}),e.jsx(pe,{open:ie!==null,onOpenChange:s=>!s&&G(null),children:e.jsx(ge,{className:"sm:max-w-[600px]",children:ie&&(()=>{const s=v.find(h=>h.id===ie);if(!s)return null;const r=H.filter(h=>h.supplierId===s.id),t=r.reduce((h,K)=>h+K.totalAmount,0),l=re.filter(h=>h.supplierId===s.id);return e.jsxs(e.Fragment,{children:[e.jsxs(je,{children:[e.jsxs(fe,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5 text-primary"}),"Supplier Details"]}),e.jsx(ye,{children:"View supplier information and statistics"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(gt,{className:"h-3 w-3"}),"Supplier ID"]}),e.jsx("p",{className:"font-mono text-sm",children:s.id})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(Se,{className:"h-3 w-3"}),"Name"]}),e.jsx("p",{className:"font-medium",children:s.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(jt,{className:"h-3 w-3"}),"Category"]}),e.jsx(V,{variant:"outline",children:s.category})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(es,{className:"h-3 w-3"}),"Status"]}),e.jsx(V,{variant:s.status==="Active"?"default":"secondary",children:s.status})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Contact Information"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/30",children:[e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Contact Person"}),e.jsx("p",{className:"font-medium",children:s.contact})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/30",children:[e.jsx(Xe,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email"}),e.jsx("p",{className:"font-medium",children:s.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/30",children:[e.jsx(ts,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"font-medium",children:s.phone})]})]})]})]}),(s.country||s.city||s.address)&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Location"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[(s.city||s.country)&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/30",children:[e.jsx(ft,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"City / Country"}),e.jsx("p",{className:"font-medium",children:s.city&&s.country?`${s.city}, ${s.country}`:s.city||s.country})]})]}),s.address&&e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/30",children:[e.jsx(Se,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Address"}),e.jsx("p",{className:"font-medium",children:s.address})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Financial Summary"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-blue-50 dark:bg-blue-950/30 text-center",children:[e.jsx(as,{className:"h-4 w-4 mx-auto mb-1 text-blue-600"}),e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:["₱",s.purchases.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Purchases"})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-green-50 dark:bg-green-950/30 text-center",children:[e.jsx(rs,{className:"h-4 w-4 mx-auto mb-1 text-green-600"}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:["₱",s.payments.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Payments"})]}),e.jsxs("div",{className:A("p-3 rounded-lg text-center",s.balance>0?"bg-amber-50 dark:bg-amber-950/30":"bg-emerald-50 dark:bg-emerald-950/30"),children:[e.jsx(rs,{className:A("h-4 w-4 mx-auto mb-1",s.balance>0?"text-amber-600":"text-emerald-600")}),e.jsxs("p",{className:A("text-lg font-bold",s.balance>0?"text-amber-600":"text-emerald-600"),children:["₱",s.balance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Balance"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Statistics"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-blue-50 dark:bg-blue-950/30 text-center",children:[e.jsx(Ge,{className:"h-4 w-4 mx-auto mb-1 text-blue-600"}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:r.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Purchase Orders"})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-green-50 dark:bg-green-950/30 text-center",children:[e.jsx(as,{className:"h-4 w-4 mx-auto mb-1 text-green-600"}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:["$",t.toLocaleString()]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Value"})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-purple-50 dark:bg-purple-950/30 text-center",children:[e.jsx(We,{className:"h-4 w-4 mx-auto mb-1 text-purple-600"}),e.jsx("p",{className:"text-lg font-bold text-purple-600",children:l.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Products"})]})]})]}),s.archived&&e.jsxs("div",{className:"p-3 rounded-lg bg-orange-50 dark:bg-orange-950/30 border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-700 dark:text-orange-300",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Archived"})]}),s.archivedAt&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Archived on ",new Date(s.archivedAt).toLocaleDateString()]})]})]}),e.jsxs(ve,{children:[e.jsx(j,{variant:"outline",onClick:()=>G(null),children:"Close"}),S&&!s.archived&&e.jsxs(j,{onClick:()=>{G(null),Ds(s)},children:[e.jsx(yt,{className:"h-4 w-4 mr-2"}),"Edit Supplier"]})]})]})})()})})]})}export{Ut as SuppliersView};
