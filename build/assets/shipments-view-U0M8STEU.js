import{j as e,L as g,B as p,a1 as ue,I as w,J as ks,i as Fs,r as l,M as Os,aO as Ps,aL as As,aN as Es,N as Bs,aW as Ls,x as o,b4 as De,b5 as $s,C as T,o as _,p as Q,P as Ms,q as k,s as ze,d as q,w as A,v as Rs,D as we,$ as Ge,y as be,z as Ce,A as Ie,E as Te,F as We,a2 as Ks,n as Us,a9 as Ye,aY as qs,b6 as Vs}from"./index-DgWTvQdt.js";import{D as Hs,S as X,a as Z,b as ee,c as se,d as V,T as zs,e as Gs,f as Je,g as _e,h as H,i as Ws,j as F}from"./sortable-table-head-DDkBZ-it.js";import{u as Ys,a as Js,F as _s,B as Qs,T as Xs,E as Zs,S as et,P as st}from"./select-all-banner-BS7jqRl1.js";import{C as Xe}from"./calendar-BvuzPdir.js";import{S as tt,F as at}from"./favorite-button-UqzhTJBs.js";import{u as rt}from"./useTableSort-BWQsE1_O.js";import{c as it}from"./permissions-DeuZZz56.js";import{E as ke}from"./editable-cell-CgsoPUCh.js";import{C as nt}from"./circle-check-big-B60wfX7n.js";import{T as lt}from"./trending-up-CHCaJhKT.js";import{P as dt}from"./plus-CSAckPT2.js";import{T as Fe}from"./trash-2-Dump8JUL.js";import{C as ct}from"./circle-alert-B0WMrk03.js";import{M as ot}from"./map-pin-DGeNxal7.js";import"./skeleton-D6qudQFR.js";import"./circle-check-4DAYp0Ac.js";function mt({fromDate:z,toDate:G,onFromDateChange:te,onToDateChange:ae,onClear:b,label:N="Date Range",className:E=""}){const C=z||G;return e.jsxs("div",{className:`space-y-2 ${E}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(g,{className:"text-sm font-medium",children:N}),C&&e.jsxs(p,{variant:"ghost",size:"sm",onClick:b,className:"h-6 px-2 text-xs",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),"Clear"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(g,{htmlFor:"from-date",className:"text-xs text-muted-foreground",children:"From"}),e.jsx(w,{id:"from-date",type:"date",value:z,onChange:B=>te(B.target.value),className:"w-full"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(g,{htmlFor:"to-date",className:"text-xs text-muted-foreground",children:"To"}),e.jsx(w,{id:"to-date",type:"date",value:G,onChange:B=>ae(B.target.value),className:"w-full"})]})]})]})}const Oe=["Pending","In Transit","Delivered"],Qe=["FedEx","UPS","DHL","USPS","LBC Express","J&T Express","Ninja Van","Grab Express"];function kt({initialOpenDialog:z,onDialogOpened:G}){const{isFavorite:te,getFavoritesByType:ae}=ks(),{user:b}=Fs(),N=b?it(b.role):!1,E=b?.role==="Customer",[C,B]=l.useState(""),[h,L]=l.useState("all"),[j,he]=l.useState(""),[f,xe]=l.useState(""),[$,Pe]=l.useState(!1),[O,I]=l.useState(null),[re,Ze]=l.useState([]),[es,Ae]=l.useState(!0),[W,Y]=l.useState(!1),[pe,ie]=l.useState(null),[r,v]=l.useState({id:"",salesOrderId:"",destination:"",carrier:"",status:"Pending",eta:""}),ge=Os(C,300),Ee=l.useMemo(()=>!E||!b?.email?new Set:new Set(re.filter(s=>s.createdBy===b.email).map(s=>s.id)),[E,b?.email,re]);l.useEffect(()=>{(async()=>{Ae(!0);const[s,t]=await Promise.all([Ps(),As()]);I(s),Ze(t),Ae(!1)})()},[]),l.useEffect(()=>{z&&!W&&(Y(!0),G?.())},[z,G,W]);const S=l.useMemo(()=>O??[],[O]),x=l.useMemo(()=>{const s=S.length,t=S.filter(i=>i.status==="Pending").length,a=S.filter(i=>i.status==="In Transit").length,d=S.filter(i=>i.status==="Delivered").length,m=t+a,n=new Date,c=new Date(n.getTime()-10080*60*1e3);new Date(n.getTime()-720*60*60*1e3);const D=new Date(n.getTime()+10080*60*1e3),U=S.filter(i=>{if(i.status!=="Delivered")return!1;try{const u=new Date(i.eta);return u>=c&&u<=n}catch{return!1}}).length,Ns=S.filter(i=>{if(i.status==="Delivered")return!1;try{const u=new Date(i.eta);return u>=n&&u<=D}catch{return!1}}).length,ye=S.filter(i=>i.status==="Delivered"),ys=ye.length,Ds=ye.length>0?Math.round(ys/ye.length*100):0,ws=s>0?Math.round(d/s*100):0,bs=S.reduce((i,u)=>(i[u.carrier]=(i[u.carrier]||0)+1,i),{}),Cs=Object.entries(bs).sort((i,u)=>u[1]-i[1]).slice(0,5).map(([i,u])=>({name:i,count:u})),Is=S.reduce((i,u)=>(i[u.destination]=(i[u.destination]||0)+1,i),{}),Ts=Object.entries(Is).sort((i,u)=>u[1]-i[1]).slice(0,5).map(([i,u])=>({name:i,count:u}));return{totalShipments:s,pendingShipments:t,inTransitShipments:a,deliveredShipments:d,activeShipments:m,recentDeliveries7Days:U,upcomingDeliveries:Ns,onTimeRate:Ds,fulfillmentRate:ws,topCarriers:Cs,topDestinations:Ts,avgTransitDays:3}},[S]),ne=l.useMemo(()=>S.filter(s=>{if(E&&!Ee.has(s.salesOrderId)||$&&!te("shipments",s.id)||h!=="all"&&s.status!==h)return!1;if(ge){const t=ge.toLowerCase();if(!(s.id.toLowerCase().includes(t)||s.salesOrderId.toLowerCase().includes(t)||s.destination.toLowerCase().includes(t)||s.carrier.toLowerCase().includes(t)))return!1}if(j||f)try{const t=new Date(s.eta);if(j){const a=new Date(j);if(t<a)return!1}if(f){const a=new Date(f);if(a.setHours(23,59,59,999),t>a)return!1}}catch{return!1}return!0}),[S,ge,h,j,f,$,te,E,Ee]),{sortedData:Be,sortConfig:M,requestSort:R,getSortDirection:K}=rt(ne),{currentPage:Le,totalPages:ss,paginatedData:$e,goToPage:ts,totalItems:as,itemsPerPage:rs}=Ys(Be,25),{selectedIds:le,selectedItems:Me,selectionCount:je,isAllSelected:is,isAllPageSelected:ns,isAllPagesSelected:ls,isPartiallySelected:ds,hasSelection:fe,toggleItem:cs,toggleAll:ve,selectAllPages:os,deselectAll:y,isSelected:ms,totalItemCount:Re,pageItemCount:Ke}=Js($e,Be),[de,Ue]=l.useState(!1),[us,qe]=l.useState(!1),[hs,ce]=l.useState(!1),xs=()=>{const s=["Shipment ID","Sales Order ID","Carrier","Tracking #","Status","Origin","Destination","Ship Date","ETA","Delivered Date","Notes"],t=ne.map(c=>[c.id,c.salesOrderId,c.carrier,c.trackingNumber||"",c.status,c.origin||"",c.destination||"",c.shipDate||"",c.eta||"",c.deliveredDate||"",c.notes||""]),a=[s,...t].map(c=>c.map(D=>`"${D}"`).join(",")).join(`
`),d=new Blob([a],{type:"text/csv"}),m=URL.createObjectURL(d),n=document.createElement("a");n.href=m,n.download=`shipments-${new Date().toISOString().split("T")[0]}.csv`,n.click(),URL.revokeObjectURL(m),o.success("Shipments exported to CSV")};l.useEffect(()=>{y()},[Le,y]),l.useEffect(()=>{const s=t=>{(t.metaKey||t.ctrlKey)&&t.key==="a"&&!W&&!pe&&(t.preventDefault(),ve()),t.key==="Escape"&&fe&&y()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[ve,y,fe,W,pe]);function Se(){v({id:"",salesOrderId:"",destination:"",carrier:"",status:"Pending",eta:new Date(Date.now()+10080*60*1e3).toISOString().split("T")[0]})}function Ve(){he(""),xe("")}function ps(){B(""),L("all"),he(""),xe(""),Pe(!1)}function He(){return r.salesOrderId.trim()?r.destination.trim()?r.carrier.trim()?r.eta.trim()?null:"ETA is required":"Carrier is required":"Destination is required":"Sales Order ID is required"}async function gs(){const s=He();if(s){o.error(s);return}try{const t=await qs({salesOrderId:r.salesOrderId,destination:r.destination,carrier:r.carrier,status:r.status,eta:r.eta});I(a=>[t,...a??[]]),Y(!1),Se(),o.success("Shipment created successfully")}catch(t){o.error(t?.message||"Failed to create shipment")}}async function js(){const s=He();if(s){o.error(s);return}if(!r.id){o.error("Missing shipment id");return}try{const t=O?.find(m=>m.id===r.id),a=r.status==="Delivered"&&t?.status!=="Delivered",d=await De({id:r.id,salesOrderId:r.salesOrderId,destination:r.destination,carrier:r.carrier,status:r.status,eta:r.eta});I(m=>(m??[]).map(n=>n.id===d.id?d:n)),ie(null),o.success("Shipment updated successfully"),a&&await J(d)}catch(t){o.error(t?.message||"Failed to update shipment")}}async function fs(s){try{await Vs(s),I(t=>(t??[]).filter(a=>a.id!==s)),ie(null),o.success("Shipment deleted successfully")}catch(t){o.error(t?.message||"Failed to delete shipment")}}const J=l.useCallback(async s=>{try{const t=re.find(d=>d.id===s.salesOrderId);if(!t){console.warn("[Shipment] No sales order found for shipment:",s.id);return}const a=await Es();for(const d of t.items){const m=a.find(n=>n.id===d.inventoryItemId);if(m){const n=Math.max(0,m.quantity-d.quantity);await Bs({id:m.id,quantity:n,quantitySold:(m.quantitySold||0)+d.quantity}),console.log(`[Inventory] Deducted ${d.quantity} from ${m.name}. New qty: ${n}`)}}await Ls({id:t.id,shippingStatus:"Delivered"}),o.success("Inventory updated for delivered order")}catch(t){console.error("[Shipment] Failed to deduct inventory:",t),o.error("Shipment marked as delivered but inventory update failed")}},[re]),Ne=l.useCallback(async(s,t,a)=>{try{const d=O?.find(D=>D.id===s),m=t==="status"&&a==="Delivered"&&d?.status!=="Delivered",n={[t]:a},c=await De({id:s,...n});I(D=>(D??[]).map(U=>U.id===s?c:U)),o.success(`${t.charAt(0).toUpperCase()+t.slice(1)} updated`),m&&await J(c)}catch(d){throw o.error(d?.message||"Failed to update"),d}},[O,I,J]),oe=s=>{switch(s){case"Delivered":return"bg-emerald-500/15 text-emerald-700 dark:text-emerald-400 border-emerald-200";case"In Transit":return"bg-blue-500/15 text-blue-700 dark:text-blue-400 border-blue-200";case"Pending":return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200";default:return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200"}},P=s=>{switch(s){case"Delivered":return"âœ“";case"In Transit":return"ðŸšš";case"Pending":return"â—‹";default:return"â—‹"}},vs=l.useCallback(async()=>{Ue(!0);try{const s=Array.from(le),t=await $s(s);I(a=>a?.filter(d=>!s.includes(d.id))??[]),t.failedCount>0?o.warning(`Deleted ${t.successCount} shipments. ${t.failedCount} failed.`):o.success(`Successfully deleted ${t.successCount} shipment${t.successCount!==1?"s":""}`),y()}catch(s){o.error(s?.message||"Failed to delete shipments")}finally{Ue(!1),ce(!1)}},[le,y]),Ss=l.useCallback(async s=>{qe(!0);try{const t=Array.from(le);let a=0,d=0;const m=[];for(const n of t)try{const c=O?.find(U=>U.id===n),D=s==="Delivered"&&c?.status!=="Delivered";await De({id:n,status:s}),a++,D&&c&&m.push({...c,status:"Delivered"})}catch{d++}I(n=>n&&n.map(c=>t.includes(c.id)?{...c,status:s}:c)),d>0?o.warning(`Updated ${a} shipments. ${d} failed.`):o.success(`Successfully updated ${a} shipment${a!==1?"s":""}`);for(const n of m)await J(n);y()}catch(t){o.error(t?.message||"Failed to update shipments")}finally{qe(!1)}},[le,O,y,J]),me=l.useMemo(()=>Me.map(s=>`${s.id} â†’ ${s.destination}`),[Me]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Shipments"}),e.jsx("p",{className:"text-muted-foreground",children:"Track shipment status, carrier information, and delivery timelines"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(T,{className:"relative overflow-hidden",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(Q,{className:"text-sm font-medium text-muted-foreground",children:"Total Shipments"}),e.jsx(Ms,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.totalShipments}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[x.upcomingDeliveries," arriving this week"]})]})]}),e.jsxs(T,{className:"relative overflow-hidden",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(Q,{className:"text-sm font-medium text-muted-foreground",children:"Active Shipments"}),e.jsx(ze,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:x.activeShipments}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[x.pendingShipments," pending, ",x.inTransitShipments," in transit"]})]})]}),e.jsxs(T,{className:"relative overflow-hidden",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(Q,{className:"text-sm font-medium text-muted-foreground",children:"Delivered"}),e.jsx(nt,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:x.deliveredShipments}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[x.recentDeliveries7Days," in last 7 days"]})]})]}),e.jsxs(T,{className:"relative overflow-hidden",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(Q,{className:"text-sm font-medium text-muted-foreground",children:"Fulfillment Rate"}),e.jsx(lt,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(k,{children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[x.fulfillmentRate,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[x.deliveredShipments," of ",x.totalShipments," fulfilled"]})]})]})]}),e.jsxs("div",{className:"grid gap-3 grid-cols-1 sm:grid-cols-3",children:[e.jsx(T,{className:q("cursor-pointer transition-all hover:shadow-md border-l-4",h==="Pending"?"ring-2 ring-primary":"","border-l-slate-400"),onClick:()=>L(h==="Pending"?"all":"Pending"),children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Pending"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:x.pendingShipments})]}),e.jsx(A,{variant:"outline",className:oe("Pending"),children:P("Pending")})]})})}),e.jsx(T,{className:q("cursor-pointer transition-all hover:shadow-md border-l-4",h==="In Transit"?"ring-2 ring-primary":"","border-l-blue-400"),onClick:()=>L(h==="In Transit"?"all":"In Transit"),children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"In Transit"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:x.inTransitShipments})]}),e.jsx(A,{variant:"outline",className:oe("In Transit"),children:P("In Transit")})]})})}),e.jsx(T,{className:q("cursor-pointer transition-all hover:shadow-md border-l-4",h==="Delivered"?"ring-2 ring-primary":"","border-l-emerald-400"),onClick:()=>L(h==="Delivered"?"all":"Delivered"),children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Delivered"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:x.deliveredShipments})]}),e.jsx(A,{variant:"outline",className:oe("Delivered"),children:P("Delivered")})]})})})]}),e.jsxs(T,{children:[e.jsx(_,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(Q,{className:"text-xl",children:"Shipment Tracking"}),e.jsx(Rs,{className:"mt-1",children:"Track and manage all shipments and deliveries"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{variant:"outline",onClick:xs,children:[e.jsx(Hs,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),e.jsxs(we,{open:W,onOpenChange:s=>{Y(s),s||Se()},children:[e.jsx(Ge,{asChild:!0,children:e.jsxs(p,{onClick:()=>Se(),disabled:!N,title:N?void 0:"You don't have permission to add shipments",children:[e.jsx(dt,{className:"h-4 w-4 mr-2"}),"Add Shipment"]})}),e.jsxs(be,{className:"sm:max-w-[500px]",children:[e.jsxs(Ce,{children:[e.jsx(Ie,{children:"Create New Shipment"}),e.jsx(Te,{children:"Enter the details for the new shipment."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"salesOrderId",children:"Sales Order ID *"}),e.jsx(w,{id:"salesOrderId",placeholder:"SO-001",value:r.salesOrderId,onChange:s=>v({...r,salesOrderId:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"status",children:"Status"}),e.jsxs(X,{value:r.status,onValueChange:s=>v({...r,status:s}),children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"Select status"})}),e.jsx(se,{children:Oe.map(s=>e.jsx(V,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:P(s)}),s]})},s))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"destination",children:"Destination *"}),e.jsx(w,{id:"destination",placeholder:"City, Province/State",value:r.destination,onChange:s=>v({...r,destination:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"carrier",children:"Carrier *"}),e.jsxs(X,{value:r.carrier,onValueChange:s=>v({...r,carrier:s}),children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"Select carrier"})}),e.jsx(se,{children:Qe.map(s=>e.jsx(V,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"eta",children:"ETA *"}),e.jsx(w,{id:"eta",type:"date",value:r.eta,onChange:s=>v({...r,eta:s.target.value})})]})]})]}),e.jsxs(We,{children:[e.jsx(p,{variant:"outline",onClick:()=>Y(!1),children:"Cancel"}),e.jsx(p,{onClick:gs,children:"Create Shipment"})]})]})]})]})]})}),e.jsxs(k,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ks,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(w,{placeholder:"Search by ID, order ID, destination, or carrier...",value:C,onChange:s=>B(s.target.value),className:"pl-9"})]}),e.jsxs(X,{value:h,onValueChange:L,children:[e.jsxs(Z,{className:"w-full sm:w-[180px]",children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),e.jsx(ee,{placeholder:"Filter by status"})]}),e.jsxs(se,{children:[e.jsx(V,{value:"all",children:"All Statuses"}),Oe.map(s=>e.jsx(V,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:P(s)}),s]})},s))]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx(mt,{fromDate:j,toDate:f,onFromDateChange:he,onToDateChange:xe,onClear:Ve,label:"Filter by ETA Date"}),e.jsxs(p,{variant:$?"default":"outline",size:"sm",onClick:()=>Pe(!$),className:"gap-1",children:[e.jsx(tt,{className:q("h-4 w-4",$&&"fill-current")}),"Favorites",ae("shipments").length>0&&e.jsx(A,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:ae("shipments").length})]}),(C||h!=="all"||j||f||$)&&e.jsxs(p,{variant:"ghost",size:"sm",onClick:ps,className:"text-muted-foreground hover:text-foreground",children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),"Clear All"]})]}),(h!=="all"||j||f)&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[h!=="all"&&e.jsxs(A,{variant:"secondary",className:"gap-1",children:["Status: ",h,e.jsx("button",{onClick:()=>L("all"),className:"ml-1 hover:bg-secondary-foreground/20 rounded-full p-0.5",children:e.jsx(ue,{className:"h-3 w-3"})})]}),(j||f)&&e.jsxs(A,{variant:"secondary",className:"gap-1",children:["ETA: ",j||"..."," to ",f||"...",e.jsx("button",{onClick:Ve,className:"ml-1 hover:bg-secondary-foreground/20 rounded-full p-0.5",children:e.jsx(ue,{className:"h-3 w-3"})})]})]})]}),fe&&N&&e.jsx(Qs,{selectionCount:je,onClearSelection:y,isLoading:de||us,actions:[{id:"delete",label:"Delete",icon:e.jsx(Fe,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>ce(!0)}],actionGroups:[{id:"status-update",label:"Update Status",icon:e.jsx(Us,{className:"h-4 w-4 mr-1"}),options:[{value:"Pending",label:"Pending"},{value:"Processing",label:"Processing"},{value:"In Transit",label:"In Transit"},{value:"Delivered",label:"Delivered"}],onSelect:s=>Ss(s)}],className:"mb-4"}),e.jsx(we,{open:hs,onOpenChange:ce,children:e.jsxs(be,{className:"max-w-md",children:[e.jsxs(Ce,{children:[e.jsxs(Ie,{className:"flex items-center gap-2",children:[e.jsx(ct,{className:"h-5 w-5 text-destructive"}),"Delete ",je," Shipment",je!==1?"s":""]}),e.jsx(Te,{children:"Are you sure you want to delete the selected shipments?"})]}),me.length>0&&e.jsx("div",{className:"max-h-32 overflow-y-auto border rounded-md p-2 bg-muted/50",children:e.jsxs("ul",{className:"text-sm space-y-1",children:[me.slice(0,10).map((s,t)=>e.jsxs("li",{className:"truncate",children:["â€¢ ",s]},t)),me.length>10&&e.jsxs("li",{className:"text-muted-foreground",children:["...and ",me.length-10," more"]})]})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("div",{className:"p-3 border border-destructive/50 rounded-md bg-destructive/10",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Fe,{className:"h-4 w-4 mt-0.5 text-destructive"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-destructive",children:"Delete Shipments"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This action cannot be undone. Selected shipments will be permanently removed."})]})]})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(p,{variant:"outline",onClick:()=>ce(!1),disabled:de,children:"Cancel"}),e.jsx(p,{variant:"destructive",onClick:vs,disabled:de,children:de?"Deleting...":"Delete All"})]})]})]})}),es?e.jsx(Xs,{rows:8}):ne.length===0?e.jsx(Zs,{icon:ze,title:"No shipments found",description:C||h!=="all"||j||f?"Try adjusting your search or filters":"Get started by creating your first shipment",actionLabel:C||h!=="all"||j||f?void 0:"Create Shipment",onAction:C||h!=="all"||j||f?void 0:()=>Y(!0)}):e.jsxs("div",{className:"rounded-md border overflow-hidden",children:[e.jsx(et,{pageItemCount:Ke,totalItemCount:Re,isAllPagesSelected:ls,show:ns&&Re>Ke,onSelectAllPages:os,onClearSelection:y,itemLabel:"shipments"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(zs,{children:[e.jsx(Gs,{children:e.jsxs(Je,{children:[e.jsx(_e,{className:"w-12",children:e.jsx(Ye,{checked:is,ref:s=>{s&&(s.indeterminate=ds)},onCheckedChange:ve,"aria-label":"Select all shipments"})}),e.jsx(H,{sortKey:"id",currentSortKey:M.key,sortDirection:K("id"),onSort:s=>R(s),children:"Shipment ID"}),e.jsx(H,{sortKey:"salesOrderId",currentSortKey:M.key,sortDirection:K("salesOrderId"),onSort:s=>R(s),children:"Sales Order ID"}),e.jsx(H,{sortKey:"destination",currentSortKey:M.key,sortDirection:K("destination"),onSort:s=>R(s),children:"Destination"}),e.jsx(H,{sortKey:"carrier",currentSortKey:M.key,sortDirection:K("carrier"),onSort:s=>R(s),children:"Carrier"}),e.jsx(H,{sortKey:"status",currentSortKey:M.key,sortDirection:K("status"),onSort:s=>R(s),children:"Status"}),e.jsx(H,{sortKey:"eta",currentSortKey:M.key,sortDirection:K("eta"),onSort:s=>R(s),children:"ETA"}),e.jsx(_e,{children:"Actions"})]})}),e.jsx(Ws,{children:$e.map(s=>{const t=ms(s.id);return e.jsxs(Je,{className:q("transition-colors hover:bg-muted/50",t&&"bg-primary/5 hover:bg-primary/10"),children:[e.jsx(F,{children:e.jsx(Ye,{checked:t,onCheckedChange:()=>cs(s.id),"aria-label":`Select shipment ${s.id}`})}),e.jsx(F,{children:e.jsx("span",{className:"font-mono text-sm font-medium",children:s.id})}),e.jsx(F,{children:e.jsx(ke,{value:s.salesOrderId,type:"text",onSave:a=>Ne(s.id,"salesOrderId",a),disabled:!N})}),e.jsx(F,{children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ot,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx(ke,{value:s.destination,type:"text",onSave:a=>Ne(s.id,"destination",a),disabled:!N})]})}),e.jsx(F,{children:e.jsx(ke,{value:s.carrier,type:"text",onSave:a=>Ne(s.id,"carrier",a),disabled:!N})}),e.jsx(F,{children:e.jsxs(A,{variant:"outline",className:q("font-medium",oe(s.status)),children:[e.jsx("span",{className:"mr-1",children:P(s.status)}),s.status]})}),e.jsx(F,{children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Xe,{className:"h-3.5 w-3.5 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:new Date(s.eta).toLocaleDateString()})]})}),e.jsx(F,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(at,{entityType:"shipments",entityId:s.id,entityName:`${s.id} - ${s.destination}`}),e.jsxs(we,{open:pe===s.id,onOpenChange:a=>{ie(a?s.id:null),a&&v({...s})},children:[e.jsx(Ge,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"sm",disabled:!N,title:N?void 0:"You don't have permission to edit shipments",children:"View / Edit"})}),e.jsxs(be,{className:"sm:max-w-[500px]",children:[e.jsxs(Ce,{children:[e.jsx(Ie,{children:"Edit Shipment"}),e.jsxs(Te,{children:["Shipment ID: ",s.id]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit-salesOrderId",children:"Sales Order ID *"}),e.jsx(w,{id:"edit-salesOrderId",value:r.salesOrderId,onChange:a=>v({...r,salesOrderId:a.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit-status",children:"Status"}),e.jsxs(X,{value:r.status,onValueChange:a=>v({...r,status:a}),children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"Select status"})}),e.jsx(se,{children:Oe.map(a=>e.jsx(V,{value:a,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:P(a)}),a]})},a))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit-destination",children:"Destination *"}),e.jsx(w,{id:"edit-destination",value:r.destination,onChange:a=>v({...r,destination:a.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit-carrier",children:"Carrier *"}),e.jsxs(X,{value:r.carrier,onValueChange:a=>v({...r,carrier:a}),children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"Select carrier"})}),e.jsx(se,{children:Qe.map(a=>e.jsx(V,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit-eta",children:"ETA *"}),e.jsx(w,{id:"edit-eta",type:"date",value:r.eta,onChange:a=>v({...r,eta:a.target.value})})]})]})]}),e.jsxs(We,{className:"flex-col sm:flex-row gap-2",children:[e.jsxs(p,{variant:"destructive",onClick:()=>fs(s.id),className:"sm:mr-auto",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Delete"]}),e.jsx(p,{variant:"outline",onClick:()=>ie(null),children:"Cancel"}),e.jsx(p,{onClick:js,children:"Save Changes"})]})]})]})]})})]},s.id)})})]})}),ne.length>0&&e.jsx(st,{currentPage:Le,totalPages:ss,onPageChange:ts,itemsPerPage:rs,totalItems:as})]})]})]})]})}export{kt as ShipmentsView};
