import{c as Ie,i as ds,r as c,G as os,j as e,B as d,D as X,O as us,v as W,w as Z,x as ee,y as se,L as o,I as h,Q as ms,a6 as hs,X as De,P as Ce,l as ps,a7 as xs,a8 as vs,J as n,a9 as js,aa as Pe,t as ys,ab as gs,ac as Ns,ad as fs,ae as Ds,af as Cs,ag as Ps,ah as Ss,ai as bs}from"./index-DKGg0FpV.js";import{S as T,a as q,b as $,c as L,d as b,T as te,e as ws,f as Is,g as Se,h as ae,i as w,j as Os,k as y}from"./sortable-table-head-BPmyJdPD.js";import{a as ks,u as As,T as Rs,P as re,B as Fs,E as Es,c as be,d as Ts,b as qs}from"./editable-cell-wXN9SRl1.js";import{g as $s,h as z}from"./permissions-Cw15c-tK.js";import{F as Ls}from"./funnel-C1fLZnT2.js";import{S as we}from"./shopping-bag-B6mX9GTp.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],Us=Ie("download",Bs);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Ks=Ie("send",Vs),zs=["Draft","Pending Approval","Approved","Rejected","Ordered","Partially Received","Received","Cancelled"];function Js({initialOpenDialog:ie,onDialogOpened:ne,prefilledItem:j}){const{user:I}=ds(),B=I?$s(I.id):"user",O=z(B,"purchase_orders:create"),Oe=z(B,"purchase_orders:approve"),ke=z(B,"purchase_orders:receive"),U=z(B,"purchase_orders:delete"),[M,Ae]=c.useState(""),[k,Re]=c.useState("all"),[le,p]=c.useState(null),[g,Fe]=c.useState([]),[_,Ee]=c.useState([]),[Te,qe]=c.useState(!0),[Q,N]=c.useState(!1),[f,A]=c.useState(null),[R,V]=c.useState(null),[x,ce]=c.useState(null),[F,H]=c.useState("asc"),[l,v]=c.useState({supplierId:"",supplierName:"",items:[],expectedDeliveryDate:"",notes:""}),[de,oe]=c.useState({}),[ue,me]=c.useState(void 0),[$e,Y]=c.useState(!1),G=os(M,300),E=c.useMemo(()=>le??[],[le]),{selectedIds:he,toggleItem:Le,toggleAll:Be,isSelected:Ue,isAllSelected:Ve,isPartiallySelected:Ke,selectionCount:pe,hasSelection:ze,deselectAll:xe}=ks(E);c.useEffect(()=>{async function s(){try{const[t,a,r]=await Promise.all([ps(),xs(),vs()]);p(t),Fe(a.filter(i=>i.status==="Active")),Ee(r)}catch{n.error("Failed to load data")}finally{qe(!1)}}s()},[]),c.useEffect(()=>{j&&g.length>0&&(v({supplierId:j.supplierId,supplierName:j.supplierName,items:[{inventoryItemId:j.inventoryItemId,itemName:j.itemName,quantity:j.quantity,unitPrice:j.unitPrice,totalPrice:j.quantity*j.unitPrice}],expectedDeliveryDate:new Date(Date.now()+10080*60*1e3).toISOString().split("T")[0],notes:""}),N(!0))},[j,g]),c.useEffect(()=>{ie&&!Q&&(N(!0),ne?.())},[ie,ne,Q]);const J=c.useMemo(()=>{let s=E;if(G){const t=G.toLowerCase();s=s.filter(a=>a.id.toLowerCase().includes(t)||a.supplierName.toLowerCase().includes(t)||(a.items??[]).some(r=>r.itemName.toLowerCase().includes(t)))}return k!=="all"&&(s=s.filter(t=>t.status===k)),x&&(s=[...s].sort((t,a)=>{const r=t[x],i=a[x];return r==null?1:i==null?-1:typeof r=="string"&&typeof i=="string"?F==="asc"?r.localeCompare(i):i.localeCompare(r):typeof r=="number"&&typeof i=="number"?F==="asc"?r-i:i-r:0})),s},[E,G,k,x,F]),{paginatedData:Me,currentPage:_e,totalPages:Qe,goToPage:He,itemsPerPage:Ye,totalItems:Ge}=As(J,10),D=s=>{const t=s;x===t?F==="asc"?H("desc"):(ce(null),H("asc")):(ce(t),H("asc"))},C=s=>x===s?F:null,ve=s=>{const t={Draft:{variant:"secondary"},"Pending Approval":{variant:"outline",className:"border-yellow-500 text-yellow-600"},Approved:{variant:"outline",className:"border-blue-500 text-blue-600"},Rejected:{variant:"destructive"},Ordered:{variant:"outline",className:"border-purple-500 text-purple-600"},"Partially Received":{variant:"outline",className:"border-orange-500 text-orange-600"},Received:{variant:"default",className:"bg-green-500"},Cancelled:{variant:"secondary",className:"text-gray-500"}},{variant:a,className:r}=t[s];return e.jsx(ys,{variant:a,className:r,children:s})},P=()=>{v({supplierId:"",supplierName:"",items:[],expectedDeliveryDate:"",notes:""})},je=()=>{v(s=>({...s,items:[...s.items,{inventoryItemId:"",itemName:"",quantity:1,unitPrice:0,totalPrice:0}]}))},ye=s=>{v(t=>({...t,items:t.items.filter((a,r)=>r!==s)}))},S=(s,t,a)=>{v(r=>{const i=[...r.items];if(t==="inventoryItemId"){const u=_.find(m=>m.id===a);u&&(i[s]={...i[s],inventoryItemId:u.id,itemName:u.name,unitPrice:u.pricePerPiece,totalPrice:i[s].quantity*u.pricePerPiece})}else if(t==="quantity"){const u=Number(a)||0;i[s]={...i[s],quantity:u,totalPrice:u*i[s].unitPrice}}else if(t==="unitPrice"){const u=Number(a)||0;i[s]={...i[s],unitPrice:u,totalPrice:i[s].quantity*u}}return{...r,items:i}})},ge=s=>{const t=g.find(a=>a.id===s);v(a=>({...a,supplierId:s,supplierName:t?.name??""}))},Je=async()=>{if(!l.supplierId||l.items.length===0||!l.expectedDeliveryDate){n.error("Please fill in all required fields");return}try{const s=await js({supplierId:l.supplierId,supplierName:l.supplierName,items:l.items,expectedDeliveryDate:l.expectedDeliveryDate,notes:l.notes,createdBy:I?.id??"1"});p(t=>[s,...t??[]]),n.success(`Purchase Order ${s.id} created successfully`),N(!1),P()}catch(s){n.error(s instanceof Error?s.message:"Failed to create purchase order")}},Xe=async s=>{if(!l.supplierId||l.items.length===0||!l.expectedDeliveryDate){n.error("Please fill in all required fields");return}try{const t=await Pe({id:s,supplierId:l.supplierId,supplierName:l.supplierName,items:l.items,expectedDeliveryDate:l.expectedDeliveryDate,notes:l.notes});p(a=>a?.map(r=>r.id===s?t:r)??[]),n.success(`Purchase Order ${s} updated successfully`),A(null),P()}catch(t){n.error(t instanceof Error?t.message:"Failed to update purchase order")}},We=async s=>{try{await Ps(s),p(t=>t?.filter(a=>a.id!==s)??[]),n.success(`Purchase Order ${s} deleted`),A(null)}catch(t){n.error(t instanceof Error?t.message:"Failed to delete purchase order")}},Ne=async(s,t,a)=>{try{const r={[t]:a},i=await Pe({id:s,...r});p(u=>u?.map(m=>m.id===s?i:m)??[]),n.success(`${t.charAt(0).toUpperCase()+t.slice(1)} updated`)}catch(r){throw n.error(r?.message||"Failed to update"),r}},Ze=async s=>{try{const t=await gs(s);p(a=>a?.map(r=>r.id===s?t:r)??[]),n.success(`Purchase Order ${s} submitted for approval`)}catch(t){n.error(t instanceof Error?t.message:"Failed to submit for approval")}},es=async s=>{try{const t=await Ns(s,I?.id??"1");p(a=>a?.map(r=>r.id===s?t:r)??[]),n.success(`Purchase Order ${s} approved`)}catch(t){n.error(t instanceof Error?t.message:"Failed to approve")}},ss=async s=>{try{const t=await fs(s,I?.id??"1");p(a=>a?.map(r=>r.id===s?t:r)??[]),n.success(`Purchase Order ${s} rejected`)}catch(t){n.error(t instanceof Error?t.message:"Failed to reject")}},ts=async s=>{try{const t=await Ds(s);p(a=>a?.map(r=>r.id===s?t:r)??[]),n.success(`Purchase Order ${s} marked as ordered`)}catch(t){n.error(t instanceof Error?t.message:"Failed to mark as ordered")}},as=async s=>{try{const t=await Cs(s);p(a=>a?.map(r=>r.id===s?t:r)??[]),n.success(`Purchase Order ${s} cancelled`)}catch(t){n.error(t instanceof Error?t.message:"Failed to cancel")}},rs=s=>{const t={};(s.items??[]).forEach(a=>{const r=a.quantity-(a.quantityReceived??0);t[a.inventoryItemId]=r}),oe(t),me(s.totalAmount),V(s.id)},is=async s=>{try{const t=Object.entries(de).filter(([r,i])=>i>0).map(([r,i])=>({inventoryItemId:r,quantityReceived:i}));if(t.length===0){n.error("Please enter quantities to receive");return}const a=await Ss(s,t,ue);if(p(r=>r?.map(i=>i.id===s?a.purchaseOrder:i)??[]),a.inventoryUpdates.length>0){const r=a.inventoryUpdates.map(i=>`${i.itemName}: ${i.previousQty} → ${i.newQty}`).join(", ");n.success(`Items received. Inventory updated: ${r}`)}else n.success("Items received successfully");V(null)}catch(t){n.error(t instanceof Error?t.message:"Failed to receive items")}},ns=async()=>{try{const s=await bs(Array.from(he));s.success?n.success(`${s.successCount} purchase orders deleted`):n.warning(`${s.successCount} deleted, ${s.failedCount} failed: ${s.errors.join(", ")}`),p(t=>t?.filter(a=>!he.has(a.id))??[]),xe(),Y(!1)}catch{n.error("Failed to delete purchase orders")}},ls=s=>{v({supplierId:s.supplierId,supplierName:s.supplierName,items:(s.items??[]).map(t=>({inventoryItemId:t.inventoryItemId,itemName:t.itemName,quantity:t.quantity,unitPrice:t.unitPrice,totalPrice:t.totalPrice})),expectedDeliveryDate:s.expectedDeliveryDate,notes:s.notes}),A(s.id)},cs=()=>{const s=["PO ID","Supplier","Items","Total Amount","Status","Created Date","Expected Delivery","Notes"],t=J.map(m=>[m.id,m.supplierName,(m.items??[]).map(K=>`${K.itemName} (${K.quantity})`).join("; "),(m.totalAmount??0).toFixed(2),m.status,m.createdDate,m.expectedDeliveryDate,m.notes]),a=[s,...t].map(m=>m.map(K=>`"${K}"`).join(",")).join(`
`),r=new Blob([a],{type:"text/csv"}),i=URL.createObjectURL(r),u=document.createElement("a");u.href=i,u.download=`purchase-orders-${new Date().toISOString().split("T")[0]}.csv`,u.click(),URL.revokeObjectURL(i),n.success("Purchase orders exported to CSV")},fe=c.useMemo(()=>l.items.reduce((s,t)=>s+t.totalPrice,0),[l.items]);return Te?e.jsx("div",{className:"p-6",children:e.jsx(Rs,{rows:8})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Purchase Orders"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage purchase orders and supplier orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{variant:"outline",onClick:cs,children:[e.jsx(Us,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),O&&e.jsxs(X,{open:Q,onOpenChange:s=>{N(s),s||P()},children:[e.jsx(us,{asChild:!0,children:e.jsxs(d,{children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Create PO"]})}),e.jsxs(W,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Create Purchase Order"}),e.jsx(se,{children:"Create a new purchase order for supplier items"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Supplier *"}),e.jsxs(T,{value:l.supplierId,onValueChange:ge,children:[e.jsx(q,{children:e.jsx($,{placeholder:"Select supplier"})}),e.jsx(L,{children:g.map(s=>e.jsx(b,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Expected Delivery Date *"}),e.jsx(h,{type:"date",value:l.expectedDeliveryDate,onChange:s=>v(t=>({...t,expectedDeliveryDate:s.target.value}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{children:"Line Items *"}),e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:je,children:[e.jsx(re,{className:"h-4 w-4 mr-1"})," Add Item"]})]}),l.items.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:'No items added. Click "Add Item" to add items.'}):e.jsxs("div",{className:"space-y-2",children:[l.items.map((s,t)=>e.jsxs("div",{className:"flex gap-2 items-end p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Item"}),e.jsxs(T,{value:s.inventoryItemId,onValueChange:a=>S(t,"inventoryItemId",a),children:[e.jsx(q,{children:e.jsx($,{placeholder:"Select item"})}),e.jsx(L,{children:_.map(a=>e.jsxs(b,{value:a.id,children:[a.name," (",a.id,")"]},a.id))})]})]}),e.jsxs("div",{className:"w-24 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Quantity"}),e.jsx(h,{type:"number",min:"1",value:s.quantity,onChange:a=>S(t,"quantity",a.target.value)})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Unit Price"}),e.jsx(h,{type:"number",min:"0",step:"0.01",value:s.unitPrice,onChange:a=>S(t,"unitPrice",a.target.value)})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Total"}),e.jsx(h,{value:`₱${s.totalPrice.toFixed(2)}`,disabled:!0})]}),e.jsx(d,{type:"button",variant:"ghost",size:"icon",onClick:()=>ye(t),children:e.jsx(te,{className:"h-4 w-4 text-destructive"})})]},t)),e.jsxs("div",{className:"text-right font-semibold",children:["Total: ₱",fe.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Notes"}),e.jsx(h,{value:l.notes,onChange:s=>v(t=>({...t,notes:s.target.value})),placeholder:"Optional notes..."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>{N(!1),P()},children:"Cancel"}),e.jsx(d,{onClick:Je,children:"Create Purchase Order"})]})]})]})]})]})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(ms,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(h,{placeholder:"Search PO ID, supplier, or items...",value:M,onChange:s=>Ae(s.target.value),className:"pl-10"})]}),e.jsxs(T,{value:k,onValueChange:Re,children:[e.jsxs(q,{className:"w-48",children:[e.jsx(Ls,{className:"h-4 w-4 mr-2"}),e.jsx($,{placeholder:"Filter by status"})]}),e.jsxs(L,{children:[e.jsx(b,{value:"all",children:"All Statuses"}),zs.map(s=>e.jsx(b,{value:s,children:s},s))]})]})]}),ze&&U&&e.jsx(Fs,{selectionCount:pe,onClearSelection:xe,actions:[{label:"Delete Selected",onClick:()=>Y(!0),variant:"destructive"}]}),J.length===0?e.jsx(Es,{icon:we,title:"No purchase orders found",description:M||k!=="all"?"Try adjusting your search or filters":"Create your first purchase order to get started",actionLabel:O?"Create PO":void 0,onAction:O?()=>N(!0):void 0}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-lg",children:e.jsxs(ws,{children:[e.jsx(Is,{children:e.jsxs(Se,{children:[U&&e.jsx(ae,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:Ve,ref:s=>{s&&(s.indeterminate=Ke)},onChange:()=>Be(),className:"h-4 w-4"})}),e.jsx(w,{sortKey:"id",currentSortKey:x,sortDirection:C("id"),onSort:D,children:"PO ID"}),e.jsx(w,{sortKey:"supplierName",currentSortKey:x,sortDirection:C("supplierName"),onSort:D,children:"Supplier"}),e.jsx(ae,{children:"Items"}),e.jsx(w,{sortKey:"totalAmount",currentSortKey:x,sortDirection:C("totalAmount"),onSort:D,className:"text-right",children:"Total"}),e.jsx(w,{sortKey:"status",currentSortKey:x,sortDirection:C("status"),onSort:D,children:"Status"}),e.jsx(w,{sortKey:"createdDate",currentSortKey:x,sortDirection:C("createdDate"),onSort:D,children:"Created"}),e.jsx(w,{sortKey:"expectedDeliveryDate",currentSortKey:x,sortDirection:C("expectedDeliveryDate"),onSort:D,children:"Expected"}),e.jsx(ae,{children:"Actions"})]})}),e.jsx(Os,{children:Me.map(s=>e.jsxs(Se,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>ls(s),children:[U&&e.jsx(y,{onClick:t=>t.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:Ue(s.id),onChange:()=>Le(s.id),className:"h-4 w-4"})}),e.jsx(y,{className:"font-medium",children:s.id}),e.jsx(y,{onClick:t=>t.stopPropagation(),children:e.jsx(be,{value:s.supplierId,displayValue:s.supplierName,type:"select",options:g.filter(t=>t.status==="Active").map(t=>({value:t.id,label:t.name})),onSave:t=>{const a=g.find(r=>r.id===t);return Ne(s.id,"supplierName",a?.name??"")},disabled:s.status!=="Draft"||!O})}),e.jsx(y,{children:e.jsxs("span",{className:"text-sm",children:[(s.items??[]).length," item",(s.items??[]).length!==1?"s":""]})}),e.jsxs(y,{className:"text-right font-medium",children:["₱",(s.totalAmount??0).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(y,{children:ve(s.status)}),e.jsx(y,{children:s.createdDate}),e.jsx(y,{onClick:t=>t.stopPropagation(),children:e.jsx(be,{value:s.expectedDeliveryDate,type:"text",placeholder:"YYYY-MM-DD",onSave:t=>Ne(s.id,"expectedDeliveryDate",t),disabled:s.status!=="Draft"||!O})}),e.jsx(y,{onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"flex gap-1",children:[s.status==="Draft"&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Ze(s.id),title:"Submit for Approval",children:e.jsx(Ks,{className:"h-4 w-4"})}),s.status==="Pending Approval"&&Oe&&e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"sm",variant:"outline",className:"text-green-600",onClick:()=>es(s.id),title:"Approve",children:e.jsx(hs,{className:"h-4 w-4"})}),e.jsx(d,{size:"sm",variant:"outline",className:"text-red-600",onClick:()=>ss(s.id),title:"Reject",children:e.jsx(De,{className:"h-4 w-4"})})]}),s.status==="Approved"&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>ts(s.id),title:"Mark as Ordered",children:e.jsx(we,{className:"h-4 w-4"})}),(s.status==="Ordered"||s.status==="Partially Received")&&ke&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>rs(s),title:"Receive Items",children:e.jsx(Ce,{className:"h-4 w-4"})}),!["Received","Cancelled"].includes(s.status)&&e.jsx(d,{size:"sm",variant:"ghost",className:"text-destructive",onClick:()=>as(s.id),title:"Cancel",children:e.jsx(De,{className:"h-4 w-4"})})]})})]},s.id))})]})}),e.jsx(Ts,{currentPage:_e,totalPages:Qe,itemsPerPage:Ye,onPageChange:He,totalItems:Ge})]}),f&&e.jsx(X,{open:!!f,onOpenChange:s=>{s||(A(null),P())},children:e.jsxs(W,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsxs(ee,{children:["Edit Purchase Order - ",f]}),e.jsx(se,{children:"Update purchase order details"})]}),e.jsx("div",{className:"space-y-4 py-4",children:(()=>{const s=E.find(a=>a.id===f),t=s?.status==="Draft";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),s&&ve(s.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Supplier"}),e.jsxs(T,{value:l.supplierId,onValueChange:ge,disabled:!t,children:[e.jsx(q,{children:e.jsx($,{placeholder:"Select supplier"})}),e.jsx(L,{children:g.map(a=>e.jsx(b,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Expected Delivery Date"}),e.jsx(h,{type:"date",value:l.expectedDeliveryDate,onChange:a=>v(r=>({...r,expectedDeliveryDate:a.target.value})),disabled:!t})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{children:"Line Items"}),t&&e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:je,children:[e.jsx(re,{className:"h-4 w-4 mr-1"})," Add Item"]})]}),e.jsxs("div",{className:"space-y-2",children:[l.items.map((a,r)=>e.jsxs("div",{className:"flex gap-2 items-end p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Item"}),e.jsxs(T,{value:a.inventoryItemId,onValueChange:i=>S(r,"inventoryItemId",i),disabled:!t,children:[e.jsx(q,{children:e.jsx($,{placeholder:"Select item"})}),e.jsx(L,{children:_.map(i=>e.jsxs(b,{value:i.id,children:[i.name," (",i.id,")"]},i.id))})]})]}),e.jsxs("div",{className:"w-24 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Quantity"}),e.jsx(h,{type:"number",min:"1",value:a.quantity,onChange:i=>S(r,"quantity",i.target.value),disabled:!t})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Unit Price"}),e.jsx(h,{type:"number",min:"0",step:"0.01",value:a.unitPrice,onChange:i=>S(r,"unitPrice",i.target.value),disabled:!t})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Total"}),e.jsx(h,{value:`₱${a.totalPrice.toFixed(2)}`,disabled:!0})]}),t&&e.jsx(d,{type:"button",variant:"ghost",size:"icon",onClick:()=>ye(r),children:e.jsx(te,{className:"h-4 w-4 text-destructive"})})]},r)),e.jsxs("div",{className:"text-right font-semibold",children:["Total: ₱",fe.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Notes"}),e.jsx(h,{value:l.notes,onChange:a=>v(r=>({...r,notes:a.target.value})),placeholder:"Optional notes...",disabled:!t})]}),e.jsxs("div",{className:"flex justify-between",children:[U&&["Draft","Cancelled","Rejected"].includes(s?.status??"")&&e.jsxs(d,{variant:"destructive",onClick:()=>We(f),children:[e.jsx(te,{className:"h-4 w-4 mr-2"})," Delete"]}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsx(d,{variant:"outline",onClick:()=>{A(null),P()},children:"Close"}),t&&e.jsx(d,{onClick:()=>Xe(f),children:"Save Changes"})]})]})]})})()})]})}),R&&e.jsx(X,{open:!!R,onOpenChange:s=>{s||V(null)},children:e.jsxs(W,{className:"max-w-2xl",children:[e.jsxs(Z,{children:[e.jsxs(ee,{children:["Receive Items - ",R]}),e.jsx(se,{children:"Enter quantities received for each item"})]}),e.jsx("div",{className:"space-y-4 py-4",children:(()=>{const s=E.find(t=>t.id===R);return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:(s.items??[]).map(t=>{const a=t.quantity-(t.quantityReceived??0);return e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:t.itemName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Ordered: ",t.quantity," | Received: ",t.quantityReceived??0," | Remaining: ",a]})]}),e.jsxs("div",{className:"w-32",children:[e.jsx(o,{className:"text-xs",children:"Receive Qty"}),e.jsx(h,{type:"number",min:"0",max:a,value:de[t.inventoryItemId]??0,onChange:r=>oe(i=>({...i,[t.inventoryItemId]:Math.min(Number(r.target.value)||0,a)}))})]})]},t.inventoryItemId)})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Actual Cost (optional)"}),e.jsx(h,{type:"number",min:"0",step:"0.01",value:ue??"",onChange:t=>me(t.target.value?Number(t.target.value):void 0),placeholder:`Expected: ₱${s.totalAmount.toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>V(null),children:"Cancel"}),e.jsxs(d,{onClick:()=>is(R),children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"})," Receive Items"]})]})]}):null})()})]})}),e.jsx(qs,{open:$e,onOpenChange:Y,itemCount:pe,itemType:"purchase orders",onConfirm:ns})]})}export{Js as PurchaseOrdersView};
