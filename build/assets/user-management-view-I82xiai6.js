import{c as ae,i as fe,r as l,M as be,j as e,C as S,o as A,b8 as q,p as D,v as B,w as c,_ as U,q as H,B as n,ai as _,a0 as Y,U as Ne,a1 as ke,I as Ce,D as W,y as X,z as $,A as G,E as J,L as Q,F as Z,x as d,a9 as Se,b9 as Ae}from"./index-CNID8maY.js";import{S as L,a as O,b as T,c as I,d as o,e as De,f as Ue,g as E,i as p,h as Le,j as Oe,k as m,T as Te}from"./sortable-table-head-kj4O_3Ig.js";import{a as Ie,i as Ee,b as F,d as P,e as ee,f as se}from"./permissions-DeuZZz56.js";import{u as Fe}from"./useTableSort-Bq-RMo3s.js";import{S as Pe}from"./shopping-bag-Bjlf_ym2.js";import{C as Re}from"./crown-D1n4WJ2f.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]],ze=ae("user-cog",Ke);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Ve=ae("user-x",Me);function $e(){const{user:a,getAllUsers:R,getPendingUsers:qe,approveUser:te,rejectUser:re,updateUserRole:le,updateUserStatus:ne,deleteUser:ie}=fe(),[h,ce]=l.useState([]),[K,de]=l.useState(""),[v,oe]=l.useState("all"),[t,w]=l.useState(null),[me,f]=l.useState(!1),[xe,b]=l.useState(!1),[i,k]=l.useState({role:"Customer",status:"Active"}),C=be(K,300);l.useEffect(()=>{const s=()=>{const y=R();ce(y.map(x=>({id:x.id,email:x.email,name:x.name,role:x.role,status:x.status,createdAt:x.createdAt,lastLogin:x.lastLogin})))};s();const r=setInterval(s,2e3);return()=>clearInterval(r)},[R]);const he=l.useMemo(()=>{let s=h;if(C){const r=C.toLowerCase();s=s.filter(y=>y.name.toLowerCase().includes(r)||y.email.toLowerCase().includes(r)||y.id.toLowerCase().includes(r))}return v!=="all"&&(s=s.filter(r=>r.status===v)),s},[h,C,v]),{sortedData:z,sortConfig:u,requestSort:j,getSortDirection:g}=Fe(he),N=l.useMemo(()=>h.filter(s=>s.status==="Pending").length,[h]),ue=s=>{w(s),k({role:s.role,status:s.status}),f(!0)},je=s=>{w(s),b(!0)},M=async s=>{try{await te(s),d.success("User approved successfully")}catch(r){d.error(r?.message||"Failed to approve user")}},V=async s=>{try{await re(s),d.success("User rejected and removed")}catch(r){d.error(r?.message||"Failed to reject user")}},ge=async()=>{if(t)try{i.role!==t.role&&await le(t.id,i.role),i.status!==t.status&&await ne(t.id,i.status),d.success("User updated successfully"),f(!1),w(null)}catch(s){d.error(s?.message||"Failed to update user")}},pe=async()=>{if(t)try{await ie(t.id),d.success("User deleted successfully"),b(!1),w(null)}catch(s){d.error(s?.message||"Failed to delete user")}},ye=s=>{switch(s){case"Active":return e.jsxs(c,{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(Ae,{className:"h-3 w-3 mr-1"}),"Active"]});case"Pending":return e.jsxs(c,{className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),"Pending"]});case"Inactive":return e.jsxs(c,{className:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200",children:[e.jsx(Ve,{className:"h-3 w-3 mr-1"}),"Inactive"]})}},ve=s=>{switch(s){case"Owner":return e.jsxs(c,{className:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",children:[e.jsx(Re,{className:"h-3 w-3 mr-1"}),"Owner"]});case"Admin":return e.jsxs(c,{variant:"default",children:[e.jsx(q,{className:"h-3 w-3 mr-1"}),"Admin"]});case"Customer":return e.jsxs(c,{variant:"secondary",className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:[e.jsx(Pe,{className:"h-3 w-3 mr-1"}),"Customer"]});case"Viewer":return e.jsxs(c,{variant:"outline",children:[e.jsx(Se,{className:"h-3 w-3 mr-1"}),"Viewer"]})}},we=a?Ie(a.role):[];return!a||!Ee(a.role)?e.jsx("div",{className:"flex items-center justify-center h-full min-h-[400px]",children:e.jsx(S,{className:"max-w-md w-full mx-4",children:e.jsxs(A,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-12 w-12 rounded-full bg-destructive/10 flex items-center justify-center",children:e.jsx(q,{className:"h-6 w-6 text-destructive"})}),e.jsx(D,{className:"text-destructive",children:"Access Denied"}),e.jsx(B,{children:"You do not have permission to access user management."})]})})}):e.jsxs("div",{className:"space-y-6 px-4 sm:px-0",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"User Management"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Manage user accounts, roles, and permissions"})]}),N>0&&e.jsxs(c,{variant:"destructive",className:"text-sm px-3 py-1.5 gap-1.5 self-start md:self-auto animate-pulse",children:[e.jsx(U,{className:"h-3.5 w-3.5"}),N," pending approval",N!==1?"s":""]})]}),N>0&&e.jsxs(S,{className:"border-yellow-200 bg-yellow-50 dark:border-yellow-800 dark:bg-yellow-950/30",children:[e.jsxs(A,{className:"pb-3",children:[e.jsxs(D,{className:"text-lg flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-yellow-600"}),"Pending Approvals"]}),e.jsx(B,{children:"New user registrations awaiting your approval"})]}),e.jsx(H,{children:e.jsx("div",{className:"space-y-3",children:h.filter(s=>s.status==="Pending").map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-gray-900 rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Registered: ",new Date(s.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{size:"sm",variant:"outline",className:"text-green-600 hover:bg-green-50",onClick:()=>M(s.id),children:[e.jsx(_,{className:"h-4 w-4 mr-1"})," Approve"]}),e.jsxs(n,{size:"sm",variant:"outline",className:"text-red-600 hover:bg-red-50",onClick:()=>V(s.id),children:[e.jsx(Y,{className:"h-4 w-4 mr-1"})," Reject"]})]})]},s.id))})})]}),e.jsxs(S,{children:[e.jsx(A,{children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5"}),e.jsx(D,{children:"All Users"}),e.jsx(c,{variant:"secondary",children:h.length})]}),e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Search users...",value:K,onChange:s=>de(s.target.value),className:"pl-9 w-full md:w-64"})]}),e.jsxs(L,{value:v,onValueChange:s=>oe(s),children:[e.jsx(O,{className:"w-full md:w-40",children:e.jsx(T,{placeholder:"Filter by status"})}),e.jsxs(I,{children:[e.jsx(o,{value:"all",children:"All Status"}),e.jsx(o,{value:"Active",children:"Active"}),e.jsx(o,{value:"Pending",children:"Pending"}),e.jsx(o,{value:"Inactive",children:"Inactive"})]})]})]})]})}),e.jsx(H,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(De,{children:[e.jsx(Ue,{children:e.jsxs(E,{children:[e.jsx(p,{sortKey:"name",currentSortKey:u.key,sortDirection:g("name"),onSort:s=>j(s),children:"Name"}),e.jsx(p,{sortKey:"email",currentSortKey:u.key,sortDirection:g("email"),onSort:s=>j(s),children:"Email"}),e.jsx(p,{sortKey:"role",currentSortKey:u.key,sortDirection:g("role"),onSort:s=>j(s),children:"Role"}),e.jsx(p,{sortKey:"status",currentSortKey:u.key,sortDirection:g("status"),onSort:s=>j(s),children:"Status"}),e.jsx(p,{sortKey:"createdAt",currentSortKey:u.key,sortDirection:g("createdAt"),onSort:s=>j(s),children:"Created"}),e.jsx(p,{sortKey:"lastLogin",currentSortKey:u.key,sortDirection:g("lastLogin"),onSort:s=>j(s),children:"Last Login"}),e.jsx(Le,{children:"Actions"})]})}),e.jsx(Oe,{children:z.length===0?e.jsx(E,{children:e.jsx(m,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No users found"})}):z.map(s=>e.jsxs(E,{children:[e.jsx(m,{className:"font-medium",children:s.name}),e.jsx(m,{children:s.email}),e.jsx(m,{children:ve(s.role)}),e.jsx(m,{children:ye(s.status)}),e.jsx(m,{children:new Date(s.createdAt).toLocaleDateString()}),e.jsx(m,{children:s.lastLogin?new Date(s.lastLogin).toLocaleDateString():"Never"}),e.jsx(m,{children:e.jsxs("div",{className:"flex gap-1",children:[s.status==="Pending"&&F(a.role,s.role)&&e.jsxs(e.Fragment,{children:[e.jsx(n,{size:"sm",variant:"ghost",className:"text-green-600",onClick:()=>M(s.id),title:"Approve",children:e.jsx(_,{className:"h-4 w-4"})}),e.jsx(n,{size:"sm",variant:"ghost",className:"text-red-600",onClick:()=>V(s.id),title:"Reject",children:e.jsx(Y,{className:"h-4 w-4"})})]}),e.jsx(n,{size:"sm",variant:"ghost",onClick:()=>ue(s),title:s.id===a?.id?"Cannot edit your own account":P(s.role)?"Owner accounts cannot be modified":F(a.role,s.role)?"Edit":"Cannot edit users with equal or higher role",disabled:s.id===a?.id||P(s.role)||!F(a.role,s.role),children:e.jsx(ze,{className:"h-4 w-4"})}),e.jsx(n,{size:"sm",variant:"ghost",className:"text-red-600",onClick:()=>je(s),title:s.id===a?.id?"Cannot delete your own account":P(s.role)?"Owner accounts cannot be deleted":ee(a.role,s.role)?"Delete":"Cannot delete users with equal or higher role",disabled:s.id===a?.id||!ee(a.role,s.role),children:e.jsx(Te,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]}),e.jsx(W,{open:me,onOpenChange:f,children:e.jsxs(X,{children:[e.jsxs($,{children:[e.jsx(G,{children:"Edit User"}),e.jsxs(J,{children:["Update role and status for ",t?.name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[se(a.role)&&t&&t.role==="Admin"&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 rounded-lg",children:e.jsxs("p",{className:"text-xs text-amber-800 dark:text-amber-200",children:[e.jsx("strong",{children:"⚠️ Admin Account:"})," You are modifying an Admin account. Changes will take effect immediately."]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Role"}),e.jsxs(L,{value:i.role,onValueChange:s=>k({...i,role:s}),children:[e.jsx(O,{children:e.jsx(T,{})}),e.jsx(I,{children:we.map(s=>e.jsxs(o,{value:s,children:[s==="Owner"&&"Owner - Full system access",s==="Admin"&&"Admin - Full access (except admin management)",s==="Customer"&&"Customer - Limited access to own orders",s==="Viewer"&&"Viewer - Read-only access"]},s))})]}),a.role==="Admin"&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Note: Only the Owner can assign Admin or Owner roles."}),se(a.role)&&i.role==="Owner"&&t?.role!=="Owner"&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"⚠️ Warning: Promoting to Owner grants full system access including the ability to manage all users."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Status"}),e.jsxs(L,{value:i.status,onValueChange:s=>k({...i,status:s}),children:[e.jsx(O,{children:e.jsx(T,{})}),e.jsxs(I,{children:[e.jsx(o,{value:"Active",children:"Active"}),e.jsx(o,{value:"Pending",children:"Pending"}),e.jsx(o,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsxs(Z,{children:[e.jsx(n,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(n,{onClick:ge,children:"Save Changes"})]})]})}),e.jsx(W,{open:xe,onOpenChange:b,children:e.jsxs(X,{children:[e.jsxs($,{children:[e.jsx(G,{className:"text-destructive",children:"Delete User"}),e.jsxs(J,{children:["Are you sure you want to delete ",e.jsx("strong",{children:t?.name}),"? This action cannot be undone."]})]}),t&&t.role==="Admin"&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("p",{className:"text-xs text-red-800 dark:text-red-200",children:[e.jsx("strong",{children:"⚠️ Warning:"})," You are about to delete an Admin account. This will immediately revoke their access to the system."]})}),e.jsxs(Z,{children:[e.jsx(n,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(n,{variant:"destructive",onClick:pe,children:"Delete User"})]})]})})]})}export{$e as UserManagementView};
