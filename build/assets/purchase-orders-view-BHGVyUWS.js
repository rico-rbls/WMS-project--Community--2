import{c as ye,i as Rs,r as c,G as Ts,j as e,C as b,m as B,n as U,o as C,O as Fs,d as _,t as H,s as Es,B as o,D as oe,Q as qs,v as ue,w as me,x as xe,y as he,L as x,I as j,z as $s,V as Vs,X as pe,a8 as Ls,P as ze,l as Ms,a9 as zs,aa as Bs,J as n,ab as Us,ac as Be,ad as _s,ae as Hs,af as Ks,ag as Qs,ah as Ys,ai as Ws,aj as Gs,ak as Js}from"./index-COxwi-w8.js";import{S as K,a as Q,b as Y,c as W,d as F,T as ve,e as Xs,f as Zs,g as Ue,h as je,i as E,j as et,k as D}from"./sortable-table-head-C1W6sOow.js";import{a as st,u as tt,T as at,P as ge,F as rt,B as lt,E as nt,d as _e,c as it,b as ct}from"./editable-cell-i2fWey5q.js";import{g as dt,h as se}from"./permissions-DG7Pzl6t.js";import{D as ot}from"./dollar-sign-b6YUdnH4.js";import{T as ut}from"./trending-up-CZgYDVmF.js";import{S as He}from"./shopping-bag-FWXwXvPM.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],xt=ye("download",mt);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],pt=ye("file-text",ht);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],jt=ye("send",vt),gt=["Draft","Pending Approval","Approved","Rejected","Ordered","Partially Received","Received","Cancelled"];function wt({initialOpenDialog:fe,onDialogOpened:Ne,prefilledItem:N}){const{user:q}=Rs(),G=q?dt(q.id):"user",$=se(G,"purchase_orders:create"),Ke=se(G,"purchase_orders:approve"),Qe=se(G,"purchase_orders:receive"),J=se(G,"purchase_orders:delete"),[X,be]=c.useState(""),[p,S]=c.useState("all"),[Ce,g]=c.useState(null),[P,Ye]=c.useState([]),[te,We]=c.useState([]),[Ge,Je]=c.useState(!0),[ae,k]=c.useState(!1),[O,V]=c.useState(null),[L,Z]=c.useState(null),[y,De]=c.useState(null),[M,re]=c.useState("asc"),[i,f]=c.useState({supplierId:"",supplierName:"",items:[],expectedDeliveryDate:"",notes:""}),[Pe,we]=c.useState({}),[Se,ke]=c.useState(void 0),[Xe,le]=c.useState(!1),ne=Ts(X,300),h=c.useMemo(()=>Ce??[],[Ce]),{selectedIds:Oe,toggleItem:Ze,toggleAll:es,isSelected:ss,isAllSelected:ts,isPartiallySelected:as,selectionCount:Ie,hasSelection:rs,deselectAll:Ae}=st(h);c.useEffect(()=>{async function s(){try{const[t,a,r]=await Promise.all([Ms(),zs(),Bs()]);g(t),Ye(a.filter(l=>l.status==="Active")),We(r)}catch{n.error("Failed to load data")}finally{Je(!1)}}s()},[]),c.useEffect(()=>{N&&P.length>0&&(f({supplierId:N.supplierId,supplierName:N.supplierName,items:[{inventoryItemId:N.inventoryItemId,itemName:N.itemName,quantity:N.quantity,unitPrice:N.unitPrice,totalPrice:N.quantity*N.unitPrice}],expectedDeliveryDate:new Date(Date.now()+10080*60*1e3).toISOString().split("T")[0],notes:""}),k(!0))},[N,P]),c.useEffect(()=>{fe&&!ae&&(k(!0),Ne?.())},[fe,Ne,ae]);const ie=c.useMemo(()=>{let s=h;if(ne){const t=ne.toLowerCase();s=s.filter(a=>a.id.toLowerCase().includes(t)||a.supplierName.toLowerCase().includes(t)||(a.items??[]).some(r=>r.itemName.toLowerCase().includes(t)))}return p!=="all"&&(s=s.filter(t=>t.status===p)),y&&(s=[...s].sort((t,a)=>{const r=t[y],l=a[y];return r==null?1:l==null?-1:typeof r=="string"&&typeof l=="string"?M==="asc"?r.localeCompare(l):l.localeCompare(r):typeof r=="number"&&typeof l=="number"?M==="asc"?r-l:l-r:0})),s},[h,ne,p,y,M]),{paginatedData:ls,currentPage:ns,totalPages:is,goToPage:cs,itemsPerPage:ds,totalItems:os}=tt(ie,10),v=c.useMemo(()=>{const s=new Date,t=new Date(s.getTime()-10080*60*1e3),a=h.length,r=h.reduce((u,Me)=>u+(Me.totalAmount??0),0),l=a>0?r/a:0,d=h.filter(u=>u.status==="Draft").length,m=h.filter(u=>u.status==="Pending Approval").length,w=h.filter(u=>u.status==="Approved").length,ce=h.filter(u=>u.status==="Ordered").length,de=h.filter(u=>u.status==="Partially Received").length,Le=h.filter(u=>u.status==="Received").length,Ps=h.filter(u=>u.status==="Rejected").length,ws=h.filter(u=>u.status==="Cancelled").length,Ss=d+m+w+ce+de,ks=Le,Os=a>0?Math.round(ks/a*100):0,Is=h.filter(u=>new Date(u.createdDate)>=t).length,As=ce+de;return{totalPOs:a,totalValue:r,avgOrderValue:l,draftCount:d,pendingApprovalCount:m,approvedCount:w,orderedCount:ce,partiallyReceivedCount:de,receivedCount:Le,rejectedCount:Ps,cancelledCount:ws,activePOs:Ss,completionRate:Os,newThisWeek:Is,pendingDelivery:As}},[h]),Re=s=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),us=()=>{be(""),S("all")},z=s=>{switch(s){case"Draft":return"ðŸ“";case"Pending Approval":return"â³";case"Approved":return"âœ“";case"Rejected":return"âœ—";case"Ordered":return"ðŸ“¦";case"Partially Received":return"ðŸ“¥";case"Received":return"âœ“";case"Cancelled":return"â—‹";default:return"â—‹"}},ee=s=>{switch(s){case"Draft":return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200";case"Pending Approval":return"bg-amber-500/15 text-amber-700 dark:text-amber-400 border-amber-200";case"Approved":return"bg-blue-500/15 text-blue-700 dark:text-blue-400 border-blue-200";case"Rejected":return"bg-red-500/15 text-red-700 dark:text-red-400 border-red-200";case"Ordered":return"bg-purple-500/15 text-purple-700 dark:text-purple-400 border-purple-200";case"Partially Received":return"bg-orange-500/15 text-orange-700 dark:text-orange-400 border-orange-200";case"Received":return"bg-emerald-500/15 text-emerald-700 dark:text-emerald-400 border-emerald-200";case"Cancelled":return"bg-gray-500/15 text-gray-700 dark:text-gray-400 border-gray-200";default:return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200"}},I=s=>{const t=s;y===t?M==="asc"?re("desc"):(De(null),re("asc")):(De(t),re("asc"))},A=s=>y===s?M:null,Te=s=>{const t={Draft:{variant:"secondary"},"Pending Approval":{variant:"outline",className:"border-yellow-500 text-yellow-600"},Approved:{variant:"outline",className:"border-blue-500 text-blue-600"},Rejected:{variant:"destructive"},Ordered:{variant:"outline",className:"border-purple-500 text-purple-600"},"Partially Received":{variant:"outline",className:"border-orange-500 text-orange-600"},Received:{variant:"default",className:"bg-green-500"},Cancelled:{variant:"secondary",className:"text-gray-500"}},{variant:a,className:r}=t[s];return e.jsxs(H,{variant:a,className:_("gap-1",r),children:[e.jsx("span",{children:z(s)}),s]})},R=()=>{f({supplierId:"",supplierName:"",items:[],expectedDeliveryDate:"",notes:""})},Fe=()=>{f(s=>({...s,items:[...s.items,{inventoryItemId:"",itemName:"",quantity:1,unitPrice:0,totalPrice:0}]}))},Ee=s=>{f(t=>({...t,items:t.items.filter((a,r)=>r!==s)}))},T=(s,t,a)=>{f(r=>{const l=[...r.items];if(t==="inventoryItemId"){const d=te.find(m=>m.id===a);d&&(l[s]={...l[s],inventoryItemId:d.id,itemName:d.name,unitPrice:d.pricePerPiece,totalPrice:l[s].quantity*d.pricePerPiece})}else if(t==="quantity"){const d=Number(a)||0;l[s]={...l[s],quantity:d,totalPrice:d*l[s].unitPrice}}else if(t==="unitPrice"){const d=Number(a)||0;l[s]={...l[s],unitPrice:d,totalPrice:l[s].quantity*d}}return{...r,items:l}})},qe=s=>{const t=P.find(a=>a.id===s);f(a=>({...a,supplierId:s,supplierName:t?.name??""}))},ms=async()=>{if(!i.supplierId||i.items.length===0||!i.expectedDeliveryDate){n.error("Please fill in all required fields");return}try{const s=await Us({supplierId:i.supplierId,supplierName:i.supplierName,items:i.items,expectedDeliveryDate:i.expectedDeliveryDate,notes:i.notes,createdBy:q?.id??"1"});g(t=>[s,...t??[]]),n.success(`Purchase Order ${s.id} created successfully`),k(!1),R()}catch(s){n.error(s instanceof Error?s.message:"Failed to create purchase order")}},xs=async s=>{if(!i.supplierId||i.items.length===0||!i.expectedDeliveryDate){n.error("Please fill in all required fields");return}try{const t=await Be({id:s,supplierId:i.supplierId,supplierName:i.supplierName,items:i.items,expectedDeliveryDate:i.expectedDeliveryDate,notes:i.notes});g(a=>a?.map(r=>r.id===s?t:r)??[]),n.success(`Purchase Order ${s} updated successfully`),V(null),R()}catch(t){n.error(t instanceof Error?t.message:"Failed to update purchase order")}},hs=async s=>{try{await Ws(s),g(t=>t?.filter(a=>a.id!==s)??[]),n.success(`Purchase Order ${s} deleted`),V(null)}catch(t){n.error(t instanceof Error?t.message:"Failed to delete purchase order")}},$e=async(s,t,a)=>{try{const r={[t]:a},l=await Be({id:s,...r});g(d=>d?.map(m=>m.id===s?l:m)??[]),n.success(`${t.charAt(0).toUpperCase()+t.slice(1)} updated`)}catch(r){throw n.error(r?.message||"Failed to update"),r}},ps=async s=>{try{const t=await _s(s);g(a=>a?.map(r=>r.id===s?t:r)??[]),n.success(`Purchase Order ${s} submitted for approval`)}catch(t){n.error(t instanceof Error?t.message:"Failed to submit for approval")}},vs=async s=>{try{const t=await Hs(s,q?.id??"1");g(a=>a?.map(r=>r.id===s?t:r)??[]),n.success(`Purchase Order ${s} approved`)}catch(t){n.error(t instanceof Error?t.message:"Failed to approve")}},js=async s=>{try{const t=await Ks(s,q?.id??"1");g(a=>a?.map(r=>r.id===s?t:r)??[]),n.success(`Purchase Order ${s} rejected`)}catch(t){n.error(t instanceof Error?t.message:"Failed to reject")}},gs=async s=>{try{const t=await Qs(s);g(a=>a?.map(r=>r.id===s?t:r)??[]),n.success(`Purchase Order ${s} marked as ordered`)}catch(t){n.error(t instanceof Error?t.message:"Failed to mark as ordered")}},ys=async s=>{try{const t=await Ys(s);g(a=>a?.map(r=>r.id===s?t:r)??[]),n.success(`Purchase Order ${s} cancelled`)}catch(t){n.error(t instanceof Error?t.message:"Failed to cancel")}},fs=s=>{const t={};(s.items??[]).forEach(a=>{const r=a.quantity-(a.quantityReceived??0);t[a.inventoryItemId]=r}),we(t),ke(s.totalAmount),Z(s.id)},Ns=async s=>{try{const t=Object.entries(Pe).filter(([r,l])=>l>0).map(([r,l])=>({inventoryItemId:r,quantityReceived:l}));if(t.length===0){n.error("Please enter quantities to receive");return}const a=await Gs(s,t,Se);if(g(r=>r?.map(l=>l.id===s?a.purchaseOrder:l)??[]),a.inventoryUpdates.length>0){const r=a.inventoryUpdates.map(l=>`${l.itemName}: ${l.previousQty} â†’ ${l.newQty}`).join(", ");n.success(`Items received. Inventory updated: ${r}`)}else n.success("Items received successfully");Z(null)}catch(t){n.error(t instanceof Error?t.message:"Failed to receive items")}},bs=async()=>{try{const s=await Js(Array.from(Oe));s.success?n.success(`${s.successCount} purchase orders deleted`):n.warning(`${s.successCount} deleted, ${s.failedCount} failed: ${s.errors.join(", ")}`),g(t=>t?.filter(a=>!Oe.has(a.id))??[]),Ae(),le(!1)}catch{n.error("Failed to delete purchase orders")}},Cs=s=>{f({supplierId:s.supplierId,supplierName:s.supplierName,items:(s.items??[]).map(t=>({inventoryItemId:t.inventoryItemId,itemName:t.itemName,quantity:t.quantity,unitPrice:t.unitPrice,totalPrice:t.totalPrice})),expectedDeliveryDate:s.expectedDeliveryDate,notes:s.notes}),V(s.id)},Ds=()=>{const s=["PO ID","Supplier","Items","Total Amount","Status","Created Date","Expected Delivery","Notes"],t=ie.map(m=>[m.id,m.supplierName,(m.items??[]).map(w=>`${w.itemName} (${w.quantity})`).join("; "),(m.totalAmount??0).toFixed(2),m.status,m.createdDate,m.expectedDeliveryDate,m.notes]),a=[s,...t].map(m=>m.map(w=>`"${w}"`).join(",")).join(`
`),r=new Blob([a],{type:"text/csv"}),l=URL.createObjectURL(r),d=document.createElement("a");d.href=l,d.download=`purchase-orders-${new Date().toISOString().split("T")[0]}.csv`,d.click(),URL.revokeObjectURL(l),n.success("Purchase orders exported to CSV")},Ve=c.useMemo(()=>i.items.reduce((s,t)=>s+t.totalPrice,0),[i.items]);return Ge?e.jsx("div",{className:"p-6",children:e.jsx(at,{rows:8})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(b,{className:"relative overflow-hidden",children:[e.jsxs(B,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(U,{className:"text-sm font-medium text-muted-foreground",children:"Total POs"}),e.jsx(pt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:v.totalPOs}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[v.newThisWeek," new this week"]})]})]}),e.jsxs(b,{className:"relative overflow-hidden",children:[e.jsxs(B,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(U,{className:"text-sm font-medium text-muted-foreground",children:"Total Value"}),e.jsx(ot,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:Re(v.totalValue)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Avg: ",Re(v.avgOrderValue)," per PO"]})]})]}),e.jsxs(b,{className:"relative overflow-hidden",children:[e.jsxs(B,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(U,{className:"text-sm font-medium text-muted-foreground",children:"Active POs"}),e.jsx(Fs,{className:"h-4 w-4 text-amber-600"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:v.activePOs}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[v.orderedCount," ordered, ",v.pendingApprovalCount," pending approval"]})]})]}),e.jsxs(b,{className:"relative overflow-hidden",children:[e.jsxs(B,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(U,{className:"text-sm font-medium text-muted-foreground",children:"Completion Rate"}),e.jsx(ut,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[v.completionRate,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[v.completedPOs," received of ",v.totalPOs," total"]})]})]})]}),e.jsxs("div",{className:"grid gap-3 grid-cols-2 md:grid-cols-4",children:[e.jsx(b,{className:_("cursor-pointer transition-all hover:shadow-md border-l-4",p==="Draft"?"ring-2 ring-primary":"","border-l-slate-400"),onClick:()=>S(p==="Draft"?"all":"Draft"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Draft"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:v.draftCount})]}),e.jsx(H,{variant:"outline",className:ee("Draft"),children:z("Draft")})]})})}),e.jsx(b,{className:_("cursor-pointer transition-all hover:shadow-md border-l-4",p==="Pending Approval"?"ring-2 ring-primary":"","border-l-amber-400"),onClick:()=>S(p==="Pending Approval"?"all":"Pending Approval"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Pending Approval"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:v.pendingApprovalCount})]}),e.jsx(H,{variant:"outline",className:ee("Pending Approval"),children:z("Pending Approval")})]})})}),e.jsx(b,{className:_("cursor-pointer transition-all hover:shadow-md border-l-4",p==="Ordered"?"ring-2 ring-primary":"","border-l-blue-400"),onClick:()=>S(p==="Ordered"?"all":"Ordered"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Ordered"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:v.orderedCount})]}),e.jsx(H,{variant:"outline",className:ee("Ordered"),children:z("Ordered")})]})})}),e.jsx(b,{className:_("cursor-pointer transition-all hover:shadow-md border-l-4",p==="Received"?"ring-2 ring-primary":"","border-l-emerald-400"),onClick:()=>S(p==="Received"?"all":"Received"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Received"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:v.receivedCount})]}),e.jsx(H,{variant:"outline",className:ee("Received"),children:z("Received")})]})})})]}),e.jsxs(b,{children:[e.jsxs(B,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(U,{children:"Purchase Order Management"}),e.jsx(Es,{children:"Create and manage supplier purchase orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",onClick:Ds,children:[e.jsx(xt,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),$&&e.jsxs(oe,{open:ae,onOpenChange:s=>{k(s),s||R()},children:[e.jsx(qs,{asChild:!0,children:e.jsxs(o,{children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Create PO"]})}),e.jsxs(ue,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(me,{children:[e.jsx(xe,{children:"Create Purchase Order"}),e.jsx(he,{children:"Create a new purchase order for supplier items"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Supplier *"}),e.jsxs(K,{value:i.supplierId,onValueChange:qe,children:[e.jsx(Q,{children:e.jsx(Y,{placeholder:"Select supplier"})}),e.jsx(W,{children:P.map(s=>e.jsx(F,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Expected Delivery Date *"}),e.jsx(j,{type:"date",value:i.expectedDeliveryDate,onChange:s=>f(t=>({...t,expectedDeliveryDate:s.target.value}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{children:"Line Items *"}),e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:Fe,children:[e.jsx(ge,{className:"h-4 w-4 mr-1"})," Add Item"]})]}),i.items.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:'No items added. Click "Add Item" to add items.'}):e.jsxs("div",{className:"space-y-2",children:[i.items.map((s,t)=>e.jsxs("div",{className:"flex gap-2 items-end p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Item"}),e.jsxs(K,{value:s.inventoryItemId,onValueChange:a=>T(t,"inventoryItemId",a),children:[e.jsx(Q,{children:e.jsx(Y,{placeholder:"Select item"})}),e.jsx(W,{children:te.map(a=>e.jsxs(F,{value:a.id,children:[a.name," (",a.id,")"]},a.id))})]})]}),e.jsxs("div",{className:"w-24 space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Quantity"}),e.jsx(j,{type:"number",min:"1",value:s.quantity,onChange:a=>T(t,"quantity",a.target.value)})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Unit Price"}),e.jsx(j,{type:"number",min:"0",step:"0.01",value:s.unitPrice,onChange:a=>T(t,"unitPrice",a.target.value)})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Total"}),e.jsx(j,{value:`â‚±${s.totalPrice.toFixed(2)}`,disabled:!0})]}),e.jsx(o,{type:"button",variant:"ghost",size:"icon",onClick:()=>Ee(t),children:e.jsx(ve,{className:"h-4 w-4 text-destructive"})})]},t)),e.jsxs("div",{className:"text-right font-semibold",children:["Total: â‚±",Ve.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Notes"}),e.jsx(j,{value:i.notes,onChange:s=>f(t=>({...t,notes:s.target.value})),placeholder:"Optional notes..."})]}),e.jsxs($s,{children:[e.jsx(o,{variant:"outline",onClick:()=>{k(!1),R()},children:"Cancel"}),e.jsx(o,{onClick:ms,children:"Create Purchase Order"})]})]})]})]})]})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(Vs,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(j,{placeholder:"Search PO ID, supplier, or items...",value:X,onChange:s=>be(s.target.value),className:"pl-10"})]}),e.jsxs(K,{value:p,onValueChange:S,children:[e.jsxs(Q,{className:"w-48",children:[e.jsx(rt,{className:"h-4 w-4 mr-2"}),e.jsx(Y,{placeholder:"Filter by status"})]}),e.jsxs(W,{children:[e.jsx(F,{value:"all",children:"All Statuses"}),gt.map(s=>e.jsx(F,{value:s,children:s},s))]})]}),(X||p!=="all")&&e.jsxs(o,{variant:"ghost",size:"sm",onClick:us,className:"text-muted-foreground",children:[e.jsx(pe,{className:"h-4 w-4 mr-1"}),"Clear Filters"]})]}),rs&&J&&e.jsx(lt,{selectionCount:Ie,onClearSelection:Ae,actions:[{label:"Delete Selected",onClick:()=>le(!0),variant:"destructive"}]}),ie.length===0?e.jsx(nt,{icon:He,title:"No purchase orders found",description:X||p!=="all"?"Try adjusting your search or filters":"Create your first purchase order to get started",actionLabel:$?"Create PO":void 0,onAction:$?()=>k(!0):void 0}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-lg",children:e.jsxs(Xs,{children:[e.jsx(Zs,{children:e.jsxs(Ue,{children:[J&&e.jsx(je,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:ts,ref:s=>{s&&(s.indeterminate=as)},onChange:()=>es(),className:"h-4 w-4"})}),e.jsx(E,{sortKey:"id",currentSortKey:y,sortDirection:A("id"),onSort:I,children:"PO ID"}),e.jsx(E,{sortKey:"supplierName",currentSortKey:y,sortDirection:A("supplierName"),onSort:I,children:"Supplier"}),e.jsx(je,{children:"Items"}),e.jsx(E,{sortKey:"totalAmount",currentSortKey:y,sortDirection:A("totalAmount"),onSort:I,className:"text-right",children:"Total"}),e.jsx(E,{sortKey:"status",currentSortKey:y,sortDirection:A("status"),onSort:I,children:"Status"}),e.jsx(E,{sortKey:"createdDate",currentSortKey:y,sortDirection:A("createdDate"),onSort:I,children:"Created"}),e.jsx(E,{sortKey:"expectedDeliveryDate",currentSortKey:y,sortDirection:A("expectedDeliveryDate"),onSort:I,children:"Expected"}),e.jsx(je,{children:"Actions"})]})}),e.jsx(et,{children:ls.map(s=>e.jsxs(Ue,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>Cs(s),children:[J&&e.jsx(D,{onClick:t=>t.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:ss(s.id),onChange:()=>Ze(s.id),className:"h-4 w-4"})}),e.jsx(D,{className:"font-medium",children:s.id}),e.jsx(D,{onClick:t=>t.stopPropagation(),children:e.jsx(_e,{value:s.supplierId,displayValue:s.supplierName,type:"select",options:P.filter(t=>t.status==="Active").map(t=>({value:t.id,label:t.name})),onSave:t=>{const a=P.find(r=>r.id===t);return $e(s.id,"supplierName",a?.name??"")},disabled:s.status!=="Draft"||!$})}),e.jsx(D,{children:e.jsxs("span",{className:"text-sm",children:[(s.items??[]).length," item",(s.items??[]).length!==1?"s":""]})}),e.jsxs(D,{className:"text-right font-medium",children:["â‚±",(s.totalAmount??0).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(D,{children:Te(s.status)}),e.jsx(D,{children:s.createdDate}),e.jsx(D,{onClick:t=>t.stopPropagation(),children:e.jsx(_e,{value:s.expectedDeliveryDate,type:"text",placeholder:"YYYY-MM-DD",onSave:t=>$e(s.id,"expectedDeliveryDate",t),disabled:s.status!=="Draft"||!$})}),e.jsx(D,{onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"flex gap-1",children:[s.status==="Draft"&&e.jsx(o,{size:"sm",variant:"outline",onClick:()=>ps(s.id),title:"Submit for Approval",children:e.jsx(jt,{className:"h-4 w-4"})}),s.status==="Pending Approval"&&Ke&&e.jsxs(e.Fragment,{children:[e.jsx(o,{size:"sm",variant:"outline",className:"text-green-600",onClick:()=>vs(s.id),title:"Approve",children:e.jsx(Ls,{className:"h-4 w-4"})}),e.jsx(o,{size:"sm",variant:"outline",className:"text-red-600",onClick:()=>js(s.id),title:"Reject",children:e.jsx(pe,{className:"h-4 w-4"})})]}),s.status==="Approved"&&e.jsx(o,{size:"sm",variant:"outline",onClick:()=>gs(s.id),title:"Mark as Ordered",children:e.jsx(He,{className:"h-4 w-4"})}),(s.status==="Ordered"||s.status==="Partially Received")&&Qe&&e.jsx(o,{size:"sm",variant:"outline",onClick:()=>fs(s),title:"Receive Items",children:e.jsx(ze,{className:"h-4 w-4"})}),!["Received","Cancelled"].includes(s.status)&&e.jsx(o,{size:"sm",variant:"ghost",className:"text-destructive",onClick:()=>ys(s.id),title:"Cancel",children:e.jsx(pe,{className:"h-4 w-4"})})]})})]},s.id))})]})}),e.jsx(it,{currentPage:ns,totalPages:is,itemsPerPage:ds,onPageChange:cs,totalItems:os})]}),O&&e.jsx(oe,{open:!!O,onOpenChange:s=>{s||(V(null),R())},children:e.jsxs(ue,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(me,{children:[e.jsxs(xe,{children:["Edit Purchase Order - ",O]}),e.jsx(he,{children:"Update purchase order details"})]}),e.jsx("div",{className:"space-y-4 py-4",children:(()=>{const s=h.find(a=>a.id===O),t=s?.status==="Draft";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),s&&Te(s.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Supplier"}),e.jsxs(K,{value:i.supplierId,onValueChange:qe,disabled:!t,children:[e.jsx(Q,{children:e.jsx(Y,{placeholder:"Select supplier"})}),e.jsx(W,{children:P.map(a=>e.jsx(F,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Expected Delivery Date"}),e.jsx(j,{type:"date",value:i.expectedDeliveryDate,onChange:a=>f(r=>({...r,expectedDeliveryDate:a.target.value})),disabled:!t})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{children:"Line Items"}),t&&e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:Fe,children:[e.jsx(ge,{className:"h-4 w-4 mr-1"})," Add Item"]})]}),e.jsxs("div",{className:"space-y-2",children:[i.items.map((a,r)=>e.jsxs("div",{className:"flex gap-2 items-end p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Item"}),e.jsxs(K,{value:a.inventoryItemId,onValueChange:l=>T(r,"inventoryItemId",l),disabled:!t,children:[e.jsx(Q,{children:e.jsx(Y,{placeholder:"Select item"})}),e.jsx(W,{children:te.map(l=>e.jsxs(F,{value:l.id,children:[l.name," (",l.id,")"]},l.id))})]})]}),e.jsxs("div",{className:"w-24 space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Quantity"}),e.jsx(j,{type:"number",min:"1",value:a.quantity,onChange:l=>T(r,"quantity",l.target.value),disabled:!t})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Unit Price"}),e.jsx(j,{type:"number",min:"0",step:"0.01",value:a.unitPrice,onChange:l=>T(r,"unitPrice",l.target.value),disabled:!t})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(x,{className:"text-xs",children:"Total"}),e.jsx(j,{value:`â‚±${a.totalPrice.toFixed(2)}`,disabled:!0})]}),t&&e.jsx(o,{type:"button",variant:"ghost",size:"icon",onClick:()=>Ee(r),children:e.jsx(ve,{className:"h-4 w-4 text-destructive"})})]},r)),e.jsxs("div",{className:"text-right font-semibold",children:["Total: â‚±",Ve.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Notes"}),e.jsx(j,{value:i.notes,onChange:a=>f(r=>({...r,notes:a.target.value})),placeholder:"Optional notes...",disabled:!t})]}),e.jsxs("div",{className:"flex justify-between",children:[J&&["Draft","Cancelled","Rejected"].includes(s?.status??"")&&e.jsxs(o,{variant:"destructive",onClick:()=>hs(O),children:[e.jsx(ve,{className:"h-4 w-4 mr-2"})," Delete"]}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsx(o,{variant:"outline",onClick:()=>{V(null),R()},children:"Close"}),t&&e.jsx(o,{onClick:()=>xs(O),children:"Save Changes"})]})]})]})})()})]})}),L&&e.jsx(oe,{open:!!L,onOpenChange:s=>{s||Z(null)},children:e.jsxs(ue,{className:"max-w-2xl",children:[e.jsxs(me,{children:[e.jsxs(xe,{children:["Receive Items - ",L]}),e.jsx(he,{children:"Enter quantities received for each item"})]}),e.jsx("div",{className:"space-y-4 py-4",children:(()=>{const s=h.find(t=>t.id===L);return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:(s.items??[]).map(t=>{const a=t.quantity-(t.quantityReceived??0);return e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:t.itemName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Ordered: ",t.quantity," | Received: ",t.quantityReceived??0," | Remaining: ",a]})]}),e.jsxs("div",{className:"w-32",children:[e.jsx(x,{className:"text-xs",children:"Receive Qty"}),e.jsx(j,{type:"number",min:"0",max:a,value:Pe[t.inventoryItemId]??0,onChange:r=>we(l=>({...l,[t.inventoryItemId]:Math.min(Number(r.target.value)||0,a)}))})]})]},t.inventoryItemId)})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Actual Cost (optional)"}),e.jsx(j,{type:"number",min:"0",step:"0.01",value:Se??"",onChange:t=>ke(t.target.value?Number(t.target.value):void 0),placeholder:`Expected: â‚±${s.totalAmount.toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{variant:"outline",onClick:()=>Z(null),children:"Cancel"}),e.jsxs(o,{onClick:()=>Ns(L),children:[e.jsx(ze,{className:"h-4 w-4 mr-2"})," Receive Items"]})]})]}):null})()})]})}),e.jsx(ct,{open:Xe,onOpenChange:le,itemCount:Ie,itemType:"purchase orders",onConfirm:bs})]})]})]})}export{wt as PurchaseOrdersView};
