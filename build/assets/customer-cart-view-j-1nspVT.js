import{i as T,c1 as H,aC as R,r as n,aD as U,j as e,C as u,q as h,aA as P,B as a,P as Y,o as $,p as Q,L as g,I as W,aB as G,x as p,aF as J}from"./index-_25alozh.js";import{C as K}from"./circle-check-BgQ8eZfw.js";import{M as X}from"./map-pin-Dbyeqwdu.js";import{A as k}from"./arrow-left-B9TXNWtg.js";import{S as Z}from"./shopping-bag-COfmbE-9.js";import{I as _}from"./image-CeaKjuHq.js";import{M as I}from"./minus-7GooDCNp.js";import{P as S}from"./plus-Bmj7AHu8.js";import{T as A}from"./trash-2-CVD8GgHt.js";import{C as V}from"./credit-card-DZSWRXdk.js";function l(i){return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(i)}function oe({navigateToView:i}){const{user:j}=T(),{cart:c,updateQuantity:o,removeFromCart:N,clearCart:O,cartTotal:m,itemCount:D}=H(),{sendNotification:q}=R(),[y,F]=n.useState(""),[f,z]=n.useState(""),[x,M]=n.useState(""),[v,b]=n.useState(!1),[r,w]=n.useState(null),[C,B]=n.useState([]);n.useEffect(()=>{U().then(B).catch(()=>{})},[]);const t=n.useMemo(()=>j?.email?C.find(s=>s.email===j.email):null,[j?.email,C]),L=async()=>{if(c.length===0){p.error("Your cart is empty");return}if(!t){p.error("Customer account not found. Please contact support.");return}b(!0);try{const s=c.map(d=>({inventoryItemId:d.inventoryItemId,itemName:d.itemName,quantity:d.quantity,unitPrice:d.unitPrice,totalPrice:d.totalPrice})),E=await J({customerId:t.id,customerName:t.name,customerCountry:t.country,customerCity:t.city,deliveryAddress:f||t.address||void 0,soDate:new Date().toISOString().split("T")[0],items:s,totalAmount:m,receiptStatus:parseFloat(x)>=m?"Paid":parseFloat(x)>0?"Partially Paid":"Unpaid",notes:y||void 0,amountPaid:parseFloat(x)||0});w(E),O(),await q({title:"New Customer Order",message:`${t.name} placed an order for ${l(m)}`,type:"info",recipientRoles:["Admin","Owner"]}),p.success("Order placed successfully!")}catch{p.error("Failed to place order. Please try again.")}finally{b(!1)}};return r?e.jsx("div",{className:"max-w-2xl mx-auto py-8",children:e.jsx(u,{className:"border-green-200 bg-green-50/50 dark:bg-green-950/20",children:e.jsxs(h,{className:"pt-8 text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"rounded-full bg-green-100 dark:bg-green-900/50 p-4",children:e.jsx(K,{className:"h-12 w-12 text-green-600"})})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Order Placed Successfully!"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Thank you for your order. We'll process it shortly."}),e.jsxs("div",{className:"bg-background rounded-lg p-4 text-left space-y-2 mb-6",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Order ID:"}),e.jsx("span",{className:"font-mono font-medium",children:r.id})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date:"}),e.jsx("span",{children:new Date(r.soDate).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Items:"}),e.jsxs("span",{children:[r.items.length," item(s)"]})]}),r.deliveryAddress&&e.jsxs("div",{className:"flex items-start gap-2 pt-2",children:[e.jsx(X,{className:"h-4 w-4 text-muted-foreground mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Deliver to:"}),e.jsx("p",{className:"text-sm",children:r.deliveryAddress})]})]}),e.jsx(P,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"text-primary",children:l(r.totalAmount)})]}),r.amountPaid>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount Paid:"}),e.jsx("span",{children:l(r.amountPaid)})]})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx(a,{variant:"outline",onClick:()=>i("sales-orders"),children:"View My Orders"}),e.jsx(a,{onClick:()=>{w(null),i("products")},children:"Continue Shopping"})]})]})})}):c.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(a,{variant:"ghost",size:"icon",onClick:()=>i("products"),children:e.jsx(k,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Shopping Cart"}),e.jsx("p",{className:"text-muted-foreground",children:"Your cart is empty"})]})]}),e.jsx(u,{children:e.jsx(h,{className:"py-12",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx(Z,{className:"h-16 w-16 text-muted-foreground/50 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Your cart is empty"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Looks like you haven't added any items to your cart yet."}),e.jsxs(a,{onClick:()=>i("products"),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Browse Products"]})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx(a,{variant:"ghost",size:"icon",onClick:()=>i("products"),children:e.jsx(k,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"Shopping Cart"}),e.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground",children:[D," item(s) in your cart"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:c.map(s=>e.jsx(u,{children:e.jsx(h,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex gap-3 sm:gap-4",children:[e.jsx("div",{className:"w-16 h-16 sm:w-24 sm:h-24 bg-muted rounded-lg flex items-center justify-center overflow-hidden shrink-0",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.itemName,className:"w-full h-full object-cover"}):e.jsx(_,{className:"h-6 w-6 sm:h-8 sm:w-8 text-muted-foreground/50"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-sm sm:text-base line-clamp-2",children:s.itemName}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:s.brand}),e.jsx("p",{className:"text-primary font-medium mt-1 text-sm sm:text-base",children:l(s.unitPrice)}),e.jsxs("div",{className:"flex items-center justify-between mt-2 sm:hidden",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-accent rounded-lg p-0.5",children:[e.jsx(a,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>o(s.inventoryItemId,s.quantity-1),children:e.jsx(I,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-6 text-center font-semibold text-sm",children:s.quantity}),e.jsx(a,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>o(s.inventoryItemId,s.quantity+1),disabled:s.quantity>=s.availableStock,children:e.jsx(S,{className:"h-3 w-3"})})]}),e.jsx("p",{className:"font-semibold text-sm",children:l(s.totalPrice)})]})]}),e.jsxs("div",{className:"hidden sm:flex flex-col items-end gap-2",children:[e.jsx(a,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>N(s.inventoryItemId),children:e.jsx(A,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2 bg-accent rounded-lg p-1",children:[e.jsx(a,{size:"icon",variant:"ghost",className:"h-7 w-7",onClick:()=>o(s.inventoryItemId,s.quantity-1),children:e.jsx(I,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-8 text-center font-semibold",children:s.quantity}),e.jsx(a,{size:"icon",variant:"ghost",className:"h-7 w-7",onClick:()=>o(s.inventoryItemId,s.quantity+1),disabled:s.quantity>=s.availableStock,children:e.jsx(S,{className:"h-3 w-3"})})]}),e.jsx("p",{className:"font-semibold",children:l(s.totalPrice)})]}),e.jsx(a,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive shrink-0 sm:hidden",onClick:()=>N(s.inventoryItemId),children:e.jsx(A,{className:"h-4 w-4"})})]})})},s.inventoryItemId))}),e.jsx("div",{children:e.jsxs(u,{className:"sticky top-6",children:[e.jsx($,{children:e.jsx(Q,{children:"Order Summary"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:c.map(s=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground truncate mr-2",children:[s.itemName," Ã— ",s.quantity]}),e.jsx("span",{children:l(s.totalPrice)})]},s.inventoryItemId))}),e.jsx(P,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-primary",children:l(m)})]}),e.jsxs("div",{className:"space-y-3 pt-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"deliveryAddress",children:"Delivery Address"}),e.jsx("textarea",{id:"deliveryAddress",placeholder:t?.address||"Enter your delivery address...",value:f,onChange:s=>z(s.target.value),className:"mt-1.5 flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"}),t?.address&&!f&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Default: ",t.address,", ",t.city,", ",t.country]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"notes",children:"Order Notes (Optional)"}),e.jsx("textarea",{id:"notes",placeholder:"Any special instructions...",value:y,onChange:s=>F(s.target.value),className:"mt-1.5 flex min-h-[60px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"amountPaid",children:"Amount to Pay Now (Optional)"}),e.jsx(W,{id:"amountPaid",type:"number",placeholder:"0.00",value:x,onChange:s=>M(s.target.value),className:"mt-1.5"})]})]})]}),e.jsx(G,{children:e.jsx(a,{className:"w-full",size:"lg",onClick:L,disabled:v||c.length===0,children:v?"Placing Order...":e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Place Order"]})})})]})})]})]})}export{oe as CustomerCartView};
