import{F as Ge,i as ze,r as i,G as Ve,al as Ye,am as oe,J as n,an as Je,ao as Qe,j as e,C as F,m as A,n as E,o as P,P as We,D as ue,O as he,B as C,v as me,w as xe,x as fe,y as ge,L as m,I as u,Q as Xe,d as je,t as pe,X as _e,a4 as Ze,p as es,V as ye,ap as ss,aq as ts}from"./index-DYvcprlo.js";import{T as as,e as rs,f as is,g as ve,h as Se,i as D,j as ns,k as g}from"./sortable-table-head-C6QvISnr.js";import{u as ls,a as ds,P as cs,B as os,b as us,T as hs,E as ms,d as T,c as xs}from"./editable-cell-GzhRVN4n.js";import{D as fs}from"./date-range-filter-DVy-JTLZ.js";import{S as gs,F as js}from"./save-search-dialog-BVHVdWU-.js";import{u as ps}from"./useTableSort-CUcZ_tMQ.js";import{c as ys}from"./permissions-CDxI9Rm2.js";import{M as vs}from"./map-pin-Bi2Frs4B.js";import{S as Ss}from"./star-DH1xoabW.js";import"./calendar-Ds1ZIP8C.js";const Cs=["Pending","In Transit","Delivered"];function Ps({initialOpenDialog:G,onDialogOpened:z}){const{isFavorite:V,getFavoritesByType:Y}=Ge(),{user:J}=ze(),h=J?ys(J.role):!1,[p,Q]=i.useState(""),[l,B]=i.useState(""),[d,O]=i.useState(""),[j,W]=i.useState(!1),[X,f]=i.useState(null),[Ce,_]=i.useState(!0),[b,k]=i.useState(!1),[L,K]=i.useState(null),[r,o]=i.useState({id:"",orderId:"",destination:"",carrier:"",status:"Pending",eta:""}),$=Ve(p,300);i.useEffect(()=>{(async()=>{_(!0);const s=await Ye();f(s),_(!1)})()},[]),i.useEffect(()=>{G&&!b&&(k(!0),z?.())},[G,z,b]);const Z=i.useMemo(()=>X??[],[X]),U=i.useMemo(()=>Z.filter(s=>{if(j&&!V("shipments",s.id))return!1;if($){const a=$.toLowerCase();if(!(s.id.toLowerCase().includes(a)||s.orderId.toLowerCase().includes(a)||s.destination.toLowerCase().includes(a)))return!1}if(l||d)try{const a=new Date(s.eta);if(l){const t=new Date(l);if(a<t)return!1}if(d){const t=new Date(d);if(t.setHours(23,59,59,999),a>t)return!1}}catch{return!1}return!0}),[Z,$,l,d,j,V]),De=i.useCallback(s=>{s.searchTerm&&Q(s.searchTerm),s.filters.fromDate&&typeof s.filters.fromDate=="string"&&B(s.filters.fromDate),s.filters.toDate&&typeof s.filters.toDate=="string"&&O(s.filters.toDate),s.filters.favoritesOnly==="true"&&W(!0)},[]),be=i.useMemo(()=>{const s={};return l&&(s.fromDate=l),d&&(s.toDate=d),j&&(s.favoritesOnly="true"),s},[l,d,j]),{sortedData:Ne,sortConfig:y,requestSort:v,getSortDirection:S}=ps(U),{currentPage:ee,totalPages:we,paginatedData:se,goToPage:Te,totalItems:ke,itemsPerPage:Ie}=ls(Ne,25),{selectedIds:I,selectedItems:te,selectionCount:ae,isAllSelected:Fe,isPartiallySelected:Ae,hasSelection:M,toggleItem:Ee,toggleAll:H,deselectAll:x,isSelected:Pe}=ds(se),[re,ie]=i.useState(!1),[Be,ne]=i.useState(!1),[Oe,q]=i.useState(!1);i.useEffect(()=>{x()},[ee,x]),i.useEffect(()=>{const s=a=>{(a.metaKey||a.ctrlKey)&&a.key==="a"&&!b&&!L&&(a.preventDefault(),H()),a.key==="Escape"&&M&&x()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[H,x,M,b,L]);function R(){o({id:"",orderId:"",destination:"",carrier:"",status:"Pending",eta:""})}function le(){B(""),O("")}function de(){return r.orderId.trim()?r.destination.trim()?r.carrier.trim()?r.eta.trim()?null:"ETA is required":"Carrier is required":"Destination is required":"Order ID is required"}async function Le(){const s=de();if(s){n.error(s);return}try{const a=await ss({orderId:r.orderId,destination:r.destination,carrier:r.carrier,status:r.status,eta:r.eta});f(t=>[a,...t??[]]),k(!1),R(),n.success("Shipment created successfully")}catch(a){n.error(a?.message||"Failed to create shipment")}}async function Ke(){const s=de();if(s){n.error(s);return}if(!r.id){n.error("Missing shipment id");return}try{const a=await oe({id:r.id,orderId:r.orderId,destination:r.destination,carrier:r.carrier,status:r.status,eta:r.eta});f(t=>(t??[]).map(c=>c.id===a.id?a:c)),K(null),n.success("Shipment updated successfully")}catch(a){n.error(a?.message||"Failed to update shipment")}}async function $e(s){try{await ts(s),f(a=>(a??[]).filter(t=>t.id!==s)),K(null),n.success("Shipment deleted successfully")}catch(a){n.error(a?.message||"Failed to delete shipment")}}const N=i.useCallback(async(s,a,t)=>{try{const c={[a]:t},w=await oe({id:s,...c});f(Re=>(Re??[]).map(ce=>ce.id===s?w:ce)),n.success(`${a.charAt(0).toUpperCase()+a.slice(1)} updated`)}catch(c){throw n.error(c?.message||"Failed to update"),c}},[f]),Ue=s=>{switch(s){case"Delivered":return"bg-green-500/10 text-green-700";case"In Transit":return"bg-blue-500/10 text-blue-700";case"Processing":return"bg-orange-500/10 text-orange-700";case"Pending":return"bg-gray-500/10 text-gray-700";default:return"bg-gray-500/10 text-gray-700"}},Me=i.useCallback(async()=>{ie(!0);try{const s=Array.from(I),a=await Je(s);f(t=>t?.filter(c=>!s.includes(c.id))??[]),a.failedCount>0?n.warning(`Deleted ${a.successCount} shipments. ${a.failedCount} failed.`):n.success(`Successfully deleted ${a.successCount} shipment${a.successCount!==1?"s":""}`),x()}catch(s){n.error(s?.message||"Failed to delete shipments")}finally{ie(!1),q(!1)}},[I,x]),He=i.useCallback(async s=>{ne(!0);try{const a=Array.from(I),t=await Qe(a,s);f(c=>c&&c.map(w=>a.includes(w.id)?{...w,status:s}:w)),t.failedCount>0?n.warning(`Updated ${t.successCount} shipments. ${t.failedCount} failed.`):n.success(`Successfully updated ${t.successCount} shipment${t.successCount!==1?"s":""}`),x()}catch(a){n.error(a?.message||"Failed to update shipments")}finally{ne(!1)}},[I,x]),qe=i.useMemo(()=>te.map(s=>`${s.id} â†’ ${s.destination}`),[te]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(F,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(E,{className:"text-sm text-muted-foreground",children:"Active Shipments"})}),e.jsx(P,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-5 w-5 text-blue-600"}),e.jsx("div",{className:"text-2xl",children:"89"})]})})]}),e.jsxs(F,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(E,{className:"text-sm text-muted-foreground",children:"In Transit"})}),e.jsx(P,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vs,{className:"h-5 w-5 text-orange-600"}),e.jsx("div",{className:"text-2xl",children:"67"})]})})]}),e.jsxs(F,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(E,{className:"text-sm text-muted-foreground",children:"On-Time Rate"})}),e.jsx(P,{children:e.jsx("div",{className:"text-2xl",children:"94%"})})]})]}),e.jsxs(F,{children:[e.jsx(A,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(E,{children:"Shipment Tracking"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(ue,{open:b,onOpenChange:s=>{k(s),s||R()},children:[e.jsx(he,{asChild:!0,children:e.jsxs(C,{onClick:()=>R(),disabled:!h,title:h?void 0:"You don't have permission to add shipments",children:[e.jsx(cs,{className:"h-4 w-4 mr-2"}),"Add Shipment"]})}),e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(fe,{children:"Add New Shipment"}),e.jsx(ge,{children:"Enter the details for the new shipment."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"orderId",children:"Order ID"}),e.jsx(u,{id:"orderId",placeholder:"ORD-0001",value:r.orderId,onChange:s=>o({...r,orderId:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"destination",children:"Destination"}),e.jsx(u,{id:"destination",placeholder:"City, ST",value:r.destination,onChange:s=>o({...r,destination:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"carrier",children:"Carrier"}),e.jsx(u,{id:"carrier",placeholder:"FedEx/UPS/DHL",value:r.carrier,onChange:s=>o({...r,carrier:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"status",children:"Status"}),e.jsx(u,{id:"status",placeholder:"Pending",value:r.status,onChange:s=>o({...r,status:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"eta",children:"ETA"}),e.jsx(u,{id:"eta",placeholder:"Oct 20, 2025",value:r.eta,onChange:s=>o({...r,eta:s.target.value})})]}),e.jsx(C,{className:"w-full",onClick:Le,children:"Add Shipment"})]})]})]})})]})}),e.jsxs(P,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Xe,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(u,{placeholder:"Search shipments...",value:p,onChange:s=>Q(s.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx(fs,{fromDate:l,toDate:d,onFromDateChange:B,onToDateChange:O,onClear:le,label:"Filter by ETA Date"}),e.jsxs(C,{variant:j?"default":"outline",size:"sm",onClick:()=>W(!j),className:"gap-1",children:[e.jsx(Ss,{className:je("h-4 w-4",j&&"fill-current")}),"Favorites",Y("shipments").length>0&&e.jsx(pe,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:Y("shipments").length})]}),e.jsx(gs,{entityType:"shipments",currentSearchTerm:p,currentFilters:be,onApplySearch:De})]}),(l||d)&&e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(pe,{variant:"secondary",className:"gap-1",children:["ETA: ",l||"..."," to ",d||"...",e.jsx("button",{onClick:le,className:"ml-1 hover:bg-secondary-foreground/20 rounded-full p-0.5",children:e.jsx(_e,{className:"h-3 w-3"})})]})})]}),M&&h&&e.jsx(os,{selectionCount:ae,onClearSelection:x,isLoading:re||Be,actions:[{id:"delete",label:"Delete",icon:e.jsx(as,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>q(!0)}],actionGroups:[{id:"status-update",label:"Update Status",icon:e.jsx(Ze,{className:"h-4 w-4 mr-1"}),options:[{value:"Pending",label:"Pending"},{value:"Processing",label:"Processing"},{value:"In Transit",label:"In Transit"},{value:"Delivered",label:"Delivered"}],onSelect:s=>He(s)}],className:"mb-4"}),e.jsx(us,{open:Oe,onOpenChange:q,itemCount:ae,itemType:"shipment",itemNames:qe,onConfirm:Me,isLoading:re}),Ce?e.jsx(hs,{rows:8}):U.length===0?e.jsx(ms,{icon:es,title:"No shipments found",description:p||l||d?"Try adjusting your search or date filters":"Get started by creating your first shipment",actionLabel:p||l||d?void 0:"Create Shipment",onAction:p||l||d?void 0:()=>k(!0)}):e.jsxs("div",{className:"rounded-md border",children:[e.jsxs(rs,{children:[e.jsx(is,{children:e.jsxs(ve,{children:[e.jsx(Se,{className:"w-12",children:e.jsx(ye,{checked:Fe,ref:s=>{s&&(s.indeterminate=Ae)},onCheckedChange:H,"aria-label":"Select all shipments"})}),e.jsx(D,{sortKey:"id",currentSortKey:y.key,sortDirection:S("id"),onSort:s=>v(s),children:"Shipment ID"}),e.jsx(D,{sortKey:"orderId",currentSortKey:y.key,sortDirection:S("orderId"),onSort:s=>v(s),children:"Order ID"}),e.jsx(D,{sortKey:"destination",currentSortKey:y.key,sortDirection:S("destination"),onSort:s=>v(s),children:"Destination"}),e.jsx(D,{sortKey:"carrier",currentSortKey:y.key,sortDirection:S("carrier"),onSort:s=>v(s),children:"Carrier"}),e.jsx(D,{sortKey:"status",currentSortKey:y.key,sortDirection:S("status"),onSort:s=>v(s),children:"Status"}),e.jsx(D,{sortKey:"eta",currentSortKey:y.key,sortDirection:S("eta"),onSort:s=>v(s),children:"ETA"}),e.jsx(Se,{children:"Actions"})]})}),e.jsx(ns,{children:se.map(s=>{const a=Pe(s.id);return e.jsxs(ve,{className:je(a&&"bg-muted/50"),children:[e.jsx(g,{children:e.jsx(ye,{checked:a,onCheckedChange:()=>Ee(s.id),"aria-label":`Select shipment ${s.id}`})}),e.jsx(g,{children:s.id}),e.jsx(g,{children:e.jsx(T,{value:s.orderId,type:"text",onSave:t=>N(s.id,"orderId",t),disabled:!h})}),e.jsx(g,{children:e.jsx(T,{value:s.destination,type:"text",onSave:t=>N(s.id,"destination",t),disabled:!h})}),e.jsx(g,{children:e.jsx(T,{value:s.carrier,type:"text",onSave:t=>N(s.id,"carrier",t),disabled:!h})}),e.jsx(g,{children:e.jsx(T,{value:s.status,type:"badge",options:Cs.map(t=>({value:t,label:t})),badgeClassName:Ue(s.status),onSave:t=>N(s.id,"status",t),disabled:!h})}),e.jsx(g,{children:e.jsx(T,{value:s.eta,type:"text",onSave:t=>N(s.id,"eta",t),disabled:!h})}),e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(js,{entityType:"shipments",entityId:s.id,entityName:`${s.id} - ${s.destination}`}),e.jsxs(ue,{open:L===s.id,onOpenChange:t=>{K(t?s.id:null),t&&o({...s})},children:[e.jsx(he,{asChild:!0,children:e.jsx(C,{variant:"ghost",size:"sm",disabled:!h,title:h?void 0:"You don't have permission to edit shipments",children:"Track"})}),e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsxs(fe,{children:["Edit Shipment - ",s.id]}),e.jsx(ge,{children:"Update fields and save your changes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"edit-orderId",children:"Order ID"}),e.jsx(u,{id:"edit-orderId",value:r.orderId,onChange:t=>o({...r,orderId:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"edit-destination",children:"Destination"}),e.jsx(u,{id:"edit-destination",value:r.destination,onChange:t=>o({...r,destination:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"edit-carrier",children:"Carrier"}),e.jsx(u,{id:"edit-carrier",value:r.carrier,onChange:t=>o({...r,carrier:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"edit-status",children:"Status"}),e.jsx(u,{id:"edit-status",value:r.status,onChange:t=>o({...r,status:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"edit-eta",children:"ETA"}),e.jsx(u,{id:"edit-eta",value:r.eta,onChange:t=>o({...r,eta:t.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{className:"flex-1",onClick:Ke,children:"Save Changes"}),e.jsx(C,{variant:"destructive",onClick:()=>$e(s.id),children:"Delete"})]})]})]})]})]})})]},s.id)})})]}),U.length>0&&e.jsx(xs,{currentPage:ee,totalPages:we,onPageChange:Te,itemsPerPage:Ie,totalItems:ke})]})]})]})]})}export{Ps as ShipmentsView};
