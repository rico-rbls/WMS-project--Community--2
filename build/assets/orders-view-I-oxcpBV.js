import{r,A as be,D as Se,t as i,E as we,j as e,C as p,h as v,i as C,k as y,B as D,L as u,I as d,X as ke,f as Oe,S as Pe,v as Q,c as Te,F as Fe,G as Be,H as Ie,J as Ee}from"./index-DyWq3L3w.js";import{B as W}from"./badge-BiRkMtjm.js";import{u as Ae,j as Le,k as $e,D as Y,l as Z,P as He,a as _,b as ee,c as se,d as te,m as Ue,B as Me,T as qe,n as Re,o as Ge,E as Ke,p as ze,q as Je,r as ae,s as x,t as Ve,v as j,w as Xe}from"./bulk-delete-dialog-BXHSaD15.js";import{D as Qe}from"./date-range-filter-BzVaznTC.js";function ss(){const[f,le]=r.useState(""),[c,A]=r.useState(""),[o,L]=r.useState(""),[$,g]=r.useState(null),[re,H]=r.useState(!0),[b,S]=r.useState(!1),[w,k]=r.useState(null),[t,n]=r.useState({id:"",customer:"",items:0,total:"",status:"Pending",date:""}),O=Ae(f,300);r.useEffect(()=>{(async()=>{H(!0);const s=await be();g(s),H(!1)})()},[]);const U=r.useMemo(()=>$??[],[$]),P=r.useMemo(()=>U.filter(s=>{if(O){const a=O.toLowerCase();if(!(s.id.toLowerCase().includes(a)||s.customer.toLowerCase().includes(a)))return!1}if(c||o)try{const a=new Date(s.date);if(c){const l=new Date(c);if(a<l)return!1}if(o){const l=new Date(o);if(l.setHours(23,59,59,999),a>l)return!1}}catch{return!1}return!0}),[U,O,c,o]),{currentPage:M,totalPages:ne,paginatedData:q,goToPage:ie,totalItems:de,itemsPerPage:ce}=Le(P,25),{selectedIds:N,selectedItems:R,selectionCount:G,isAllSelected:oe,isPartiallySelected:ue,hasSelection:T,toggleItem:he,toggleAll:F,deselectAll:h,isSelected:me}=$e(q),[K,z]=r.useState(!1),[xe,J]=r.useState(!1),[je,B]=r.useState(!1),[We,ge]=r.useState(!1);r.useEffect(()=>{h()},[M,h]),r.useEffect(()=>{const s=a=>{(a.metaKey||a.ctrlKey)&&a.key==="a"&&!b&&!w&&(a.preventDefault(),F()),a.key==="Escape"&&T&&h()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[F,h,T,b,w]);function I(){n({id:"",customer:"",items:0,total:"",status:"Pending",date:""})}function V(){A(""),L("")}function X(){return t.customer.trim()?t.total.trim()?t.date.trim()?t.items<0?"Items cannot be negative":null:"Date is required":"Total is required":"Customer is required"}async function fe(){const s=X();if(s){i.error(s);return}const a=await Be({customer:t.customer,items:t.items,total:t.total,status:t.status,date:t.date});g(l=>[a,...l??[]]),S(!1),I(),i.success("Order created successfully")}async function pe(){const s=X();if(s){i.error(s);return}if(!t.id){i.error("Missing order id");return}const a=await Ie({id:t.id,customer:t.customer,items:t.items,total:t.total,status:t.status,date:t.date});g(l=>(l??[]).map(m=>m.id===a.id?a:m)),k(null),i.success("Order updated successfully")}async function ve(s){await Ee(s),g(a=>(a??[]).filter(l=>l.id!==s)),k(null),i.success("Order deleted successfully")}const Ce=s=>{switch(s){case"Delivered":return"bg-green-500/10 text-green-700";case"Shipped":return"bg-blue-500/10 text-blue-700";case"Processing":return"bg-orange-500/10 text-orange-700";case"Pending":return"bg-gray-500/10 text-gray-700";default:return"bg-gray-500/10 text-gray-700"}},ye=r.useCallback(async()=>{z(!0);try{const s=Array.from(N),a=await Se(s);g(l=>l?.filter(m=>!s.includes(m.id))??[]),a.failedCount>0?i.warning(`Deleted ${a.successCount} orders. ${a.failedCount} failed.`):i.success(`Successfully deleted ${a.successCount} order${a.successCount!==1?"s":""}`),h()}catch(s){i.error(s?.message||"Failed to delete orders")}finally{z(!1),B(!1)}},[N,h]),De=r.useCallback(async s=>{J(!0);try{const a=Array.from(N),l=await we(a,s);g(m=>m&&m.map(E=>a.includes(E.id)?{...E,status:s}:E)),l.failedCount>0?i.warning(`Updated ${l.successCount} orders. ${l.failedCount} failed.`):i.success(`Successfully updated ${l.successCount} order${l.successCount!==1?"s":""}`),h()}catch(a){i.error(a?.message||"Failed to update orders")}finally{J(!1),ge(!1)}},[N,h]),Ne=r.useMemo(()=>R.map(s=>`${s.id} - ${s.customer}`),[R]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(p,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(C,{className:"text-sm text-muted-foreground",children:"Total Orders"})}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl",children:"256"})})]}),e.jsxs(p,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(C,{className:"text-sm text-muted-foreground",children:"Pending"})}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl",children:"42"})})]}),e.jsxs(p,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(C,{className:"text-sm text-muted-foreground",children:"In Progress"})}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl",children:"89"})})]}),e.jsxs(p,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(C,{className:"text-sm text-muted-foreground",children:"Completed"})}),e.jsx(y,{children:e.jsx("div",{className:"text-2xl",children:"125"})})]})]}),e.jsxs(p,{children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(C,{children:"Order Management"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(Y,{open:b,onOpenChange:s=>{S(s),s||I()},children:[e.jsx(Z,{asChild:!0,children:e.jsxs(D,{onClick:()=>I(),children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"Add Order"]})}),e.jsxs(_,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Add New Order"}),e.jsx(te,{children:"Enter the details for the new order."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"customer",children:"Customer"}),e.jsx(d,{id:"customer",placeholder:"Customer name",value:t.customer,onChange:s=>n({...t,customer:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"items",children:"Items"}),e.jsx(d,{id:"items",type:"number",placeholder:"0",value:t.items,onChange:s=>n({...t,items:Number(s.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"total",children:"Total (PHP ₱)"}),e.jsx(d,{id:"total",placeholder:"₱0.00",value:t.total,onChange:s=>n({...t,total:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"status",children:"Status"}),e.jsx(d,{id:"status",placeholder:"Pending",value:t.status,onChange:s=>n({...t,status:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"date",children:"Date"}),e.jsx(d,{id:"date",placeholder:"2025-10-15",value:t.date,onChange:s=>n({...t,date:s.target.value})})]}),e.jsx(D,{className:"w-full",onClick:fe,children:"Add Order"})]})]})]})})]})}),e.jsxs(y,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(d,{placeholder:"Search orders...",value:f,onChange:s=>le(s.target.value),className:"pl-9"})]}),e.jsx(Qe,{fromDate:c,toDate:o,onFromDateChange:A,onToDateChange:L,onClear:V,label:"Filter by Order Date"}),(c||o)&&e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(W,{variant:"secondary",className:"gap-1",children:["Date: ",c||"..."," to ",o||"...",e.jsx("button",{onClick:V,className:"ml-1 hover:bg-secondary-foreground/20 rounded-full p-0.5",children:e.jsx(ke,{className:"h-3 w-3"})})]})})]}),T&&e.jsx(Me,{selectionCount:G,onClearSelection:h,isLoading:K||xe,actions:[{id:"delete",label:"Delete",icon:e.jsx(qe,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>B(!0)}],actionGroups:[{id:"status-update",label:"Update Status",icon:e.jsx(Oe,{className:"h-4 w-4 mr-1"}),options:[{value:"Pending",label:"Pending"},{value:"Processing",label:"Processing"},{value:"Shipped",label:"Shipped"},{value:"Delivered",label:"Delivered"}],onSelect:s=>De(s)}],className:"mb-4"}),e.jsx(Re,{open:je,onOpenChange:B,itemCount:G,itemType:"order",itemNames:Ne,onConfirm:ye,isLoading:K}),re?e.jsx(Ge,{rows:8}):P.length===0?e.jsx(Ke,{icon:Pe,title:"No orders found",description:f||c||o?"Try adjusting your search or date filters":"Get started by creating your first order",actionLabel:f||c||o?void 0:"Create Order",onAction:f||c||o?void 0:()=>S(!0)}):e.jsxs("div",{className:"rounded-md border",children:[e.jsxs(ze,{children:[e.jsx(Je,{children:e.jsxs(ae,{children:[e.jsx(x,{className:"w-12",children:e.jsx(Q,{checked:oe,ref:s=>{s&&(s.indeterminate=ue)},onCheckedChange:F,"aria-label":"Select all orders"})}),e.jsx(x,{children:"Order ID"}),e.jsx(x,{children:"Customer"}),e.jsx(x,{children:"Items"}),e.jsx(x,{children:"Total"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Date"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(Ve,{children:q.map(s=>{const a=me(s.id);return e.jsxs(ae,{className:Te(a&&"bg-muted/50"),children:[e.jsx(j,{children:e.jsx(Q,{checked:a,onCheckedChange:()=>he(s.id),"aria-label":`Select order ${s.id}`})}),e.jsx(j,{children:s.id}),e.jsx(j,{children:s.customer}),e.jsx(j,{children:s.items}),e.jsx(j,{children:s.total}),e.jsx(j,{children:e.jsx(W,{variant:"secondary",className:Ce(s.status),children:s.status})}),e.jsx(j,{children:s.date}),e.jsx(j,{children:e.jsxs(Y,{open:w===s.id,onOpenChange:l=>{k(l?s.id:null),l&&n({...s})},children:[e.jsx(Z,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"sm",children:e.jsx(Fe,{className:"h-4 w-4"})})}),e.jsxs(_,{children:[e.jsxs(ee,{children:[e.jsxs(se,{children:["Edit Order - ",s.id]}),e.jsx(te,{children:"Update fields and save your changes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-customer",children:"Customer"}),e.jsx(d,{id:"edit-customer",value:t.customer,onChange:l=>n({...t,customer:l.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-items",children:"Items"}),e.jsx(d,{id:"edit-items",type:"number",value:t.items,onChange:l=>n({...t,items:Number(l.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-total",children:"Total (PHP ₱)"}),e.jsx(d,{id:"edit-total",value:t.total,onChange:l=>n({...t,total:l.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-status",children:"Status"}),e.jsx(d,{id:"edit-status",value:t.status,onChange:l=>n({...t,status:l.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-date",children:"Date"}),e.jsx(d,{id:"edit-date",value:t.date,onChange:l=>n({...t,date:l.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(D,{className:"flex-1",onClick:pe,children:"Save Changes"}),e.jsx(D,{variant:"destructive",onClick:()=>ve(s.id),children:"Delete"})]})]})]})]})})]},s.id)})})]}),P.length>0&&e.jsx(Xe,{currentPage:M,totalPages:ne,onPageChange:ie,itemsPerPage:ce,totalItems:de})]})]})]})]})}export{ss as OrdersView};
