import{c as ne,i as Ce,r as n,M as De,j as e,C as A,o as U,bm as Y,p as L,v as $,w as d,_ as O,q as W,B as l,aj as X,a1 as G,U as Ae,a2 as Ue,I as Le,D as J,y as Q,z as Z,A as ee,E as se,L as te,F as ae,x as m,aa as Oe,aS as Te}from"./index-DgWTvQdt.js";import{S as T,a as R,b as E,c as I,d as x,D as Re,T as Ee,e as Ie,f as F,h as v,g as Fe,i as Pe,j as h}from"./sortable-table-head-DDkBZ-it.js";import{a as Ke,i as Ve,b as P,d as K,e as re,f as le}from"./permissions-DeuZZz56.js";import{u as ze}from"./useTableSort-BWQsE1_O.js";import{T as Me}from"./trash-2-Dump8JUL.js";import{S as Be}from"./shopping-bag-DhS_P8qJ.js";import{C as qe}from"./crown-Dnjhr39K.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]],_e=ne("user-cog",He);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],$e=ne("user-x",Ye);function ts(){const{user:t,getAllUsers:V,getPendingUsers:We,approveUser:ie,rejectUser:ce,updateUserRole:oe,updateUserStatus:de,deleteUser:me}=Ce(),[j,xe]=n.useState([]),[z,he]=n.useState(""),[w,ue]=n.useState("all"),[a,f]=n.useState(null),[je,b]=n.useState(!1),[ge,N]=n.useState(!1),[i,S]=n.useState({role:"Customer",status:"Active"}),C=De(z,300);n.useEffect(()=>{const s=()=>{const u=V();xe(u.map(c=>({id:c.id,email:c.email,name:c.name,role:c.role,status:c.status,createdAt:c.createdAt,lastLogin:c.lastLogin})))};s();const r=setInterval(s,2e3);return()=>clearInterval(r)},[V]);const M=n.useMemo(()=>{let s=j;if(C){const r=C.toLowerCase();s=s.filter(u=>u.name.toLowerCase().includes(r)||u.email.toLowerCase().includes(r)||u.id.toLowerCase().includes(r))}return w!=="all"&&(s=s.filter(r=>r.status===w)),s},[j,C,w]),{sortedData:B,sortConfig:g,requestSort:p,getSortDirection:y}=ze(M),k=n.useMemo(()=>j.filter(s=>s.status==="Pending").length,[j]),pe=()=>{const s=["User ID","Name","Email","Role","Status","Registered At","Last Login"],r=M.map(o=>[o.id,o.name,o.email,o.role,o.status,o.registeredAt||"",o.lastLoginAt||""]),u=[s,...r].map(o=>o.map(Se=>`"${Se}"`).join(",")).join(`
`),c=new Blob([u],{type:"text/csv"}),_=URL.createObjectURL(c),D=document.createElement("a");D.href=_,D.download=`users-${new Date().toISOString().split("T")[0]}.csv`,D.click(),URL.revokeObjectURL(_),m.success("Users exported to CSV")},ye=s=>{f(s),S({role:s.role,status:s.status}),b(!0)},ve=s=>{f(s),N(!0)},q=async s=>{try{await ie(s),m.success("User approved successfully")}catch(r){m.error(r?.message||"Failed to approve user")}},H=async s=>{try{await ce(s),m.success("User rejected and removed")}catch(r){m.error(r?.message||"Failed to reject user")}},we=async()=>{if(a)try{i.role!==a.role&&await oe(a.id,i.role),i.status!==a.status&&await de(a.id,i.status),m.success("User updated successfully"),b(!1),f(null)}catch(s){m.error(s?.message||"Failed to update user")}},fe=async()=>{if(a)try{await me(a.id),m.success("User deleted successfully"),N(!1),f(null)}catch(s){m.error(s?.message||"Failed to delete user")}},be=s=>{switch(s){case"Active":return e.jsxs(d,{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(Te,{className:"h-3 w-3 mr-1"}),"Active"]});case"Pending":return e.jsxs(d,{className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:[e.jsx(O,{className:"h-3 w-3 mr-1"}),"Pending"]});case"Inactive":return e.jsxs(d,{className:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200",children:[e.jsx($e,{className:"h-3 w-3 mr-1"}),"Inactive"]})}},Ne=s=>{switch(s){case"Owner":return e.jsxs(d,{className:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",children:[e.jsx(qe,{className:"h-3 w-3 mr-1"}),"Owner"]});case"Admin":return e.jsxs(d,{variant:"default",children:[e.jsx(Y,{className:"h-3 w-3 mr-1"}),"Admin"]});case"Customer":return e.jsxs(d,{variant:"secondary",className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:[e.jsx(Be,{className:"h-3 w-3 mr-1"}),"Customer"]});case"Viewer":return e.jsxs(d,{variant:"outline",children:[e.jsx(Oe,{className:"h-3 w-3 mr-1"}),"Viewer"]})}},ke=t?Ke(t.role):[];return!t||!Ve(t.role)?e.jsx("div",{className:"flex items-center justify-center h-full min-h-[400px]",children:e.jsx(A,{className:"max-w-md w-full mx-4",children:e.jsxs(U,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-12 w-12 rounded-full bg-destructive/10 flex items-center justify-center",children:e.jsx(Y,{className:"h-6 w-6 text-destructive"})}),e.jsx(L,{className:"text-destructive",children:"Access Denied"}),e.jsx($,{children:"You do not have permission to access user management."})]})})}):e.jsxs("div",{className:"space-y-6 px-4 sm:px-0",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"User Management"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Manage user accounts, roles, and permissions"})]}),k>0&&e.jsxs(d,{variant:"destructive",className:"text-sm px-3 py-1.5 gap-1.5 self-start md:self-auto animate-pulse",children:[e.jsx(O,{className:"h-3.5 w-3.5"}),k," pending approval",k!==1?"s":""]})]}),k>0&&e.jsxs(A,{className:"border-yellow-200 bg-yellow-50 dark:border-yellow-800 dark:bg-yellow-950/30",children:[e.jsxs(U,{className:"pb-3",children:[e.jsxs(L,{className:"text-lg flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5 text-yellow-600"}),"Pending Approvals"]}),e.jsx($,{children:"New user registrations awaiting your approval"})]}),e.jsx(W,{children:e.jsx("div",{className:"space-y-3",children:j.filter(s=>s.status==="Pending").map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-gray-900 rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Registered: ",new Date(s.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{size:"sm",variant:"outline",className:"text-green-600 hover:bg-green-50",onClick:()=>q(s.id),children:[e.jsx(X,{className:"h-4 w-4 mr-1"})," Approve"]}),e.jsxs(l,{size:"sm",variant:"outline",className:"text-red-600 hover:bg-red-50",onClick:()=>H(s.id),children:[e.jsx(G,{className:"h-4 w-4 mr-1"})," Reject"]})]})]},s.id))})})]}),e.jsxs(A,{children:[e.jsx(U,{children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-5 w-5"}),e.jsx(L,{children:"All Users"}),e.jsx(d,{variant:"secondary",children:j.length})]}),e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(Le,{placeholder:"Search users...",value:z,onChange:s=>he(s.target.value),className:"pl-9 w-full md:w-64"})]}),e.jsxs(T,{value:w,onValueChange:s=>ue(s),children:[e.jsx(R,{className:"w-full md:w-40",children:e.jsx(E,{placeholder:"Filter by status"})}),e.jsxs(I,{children:[e.jsx(x,{value:"all",children:"All Status"}),e.jsx(x,{value:"Active",children:"Active"}),e.jsx(x,{value:"Pending",children:"Pending"}),e.jsx(x,{value:"Inactive",children:"Inactive"})]})]}),e.jsxs(l,{variant:"outline",onClick:pe,children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]})]})}),e.jsx(W,{children:e.jsx("div",{className:"rounded-md border overflow-x-auto",children:e.jsxs(Ee,{children:[e.jsx(Ie,{children:e.jsxs(F,{children:[e.jsx(v,{sortKey:"name",currentSortKey:g.key,sortDirection:y("name"),onSort:s=>p(s),children:"Name"}),e.jsx(v,{sortKey:"email",currentSortKey:g.key,sortDirection:y("email"),onSort:s=>p(s),children:"Email"}),e.jsx(v,{sortKey:"role",currentSortKey:g.key,sortDirection:y("role"),onSort:s=>p(s),children:"Role"}),e.jsx(v,{sortKey:"status",currentSortKey:g.key,sortDirection:y("status"),onSort:s=>p(s),children:"Status"}),e.jsx(v,{sortKey:"createdAt",currentSortKey:g.key,sortDirection:y("createdAt"),onSort:s=>p(s),children:"Created"}),e.jsx(v,{sortKey:"lastLogin",currentSortKey:g.key,sortDirection:y("lastLogin"),onSort:s=>p(s),children:"Last Login"}),e.jsx(Fe,{children:"Actions"})]})}),e.jsx(Pe,{children:B.length===0?e.jsx(F,{children:e.jsx(h,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No users found"})}):B.map(s=>e.jsxs(F,{children:[e.jsx(h,{className:"font-medium",children:s.name}),e.jsx(h,{children:s.email}),e.jsx(h,{children:Ne(s.role)}),e.jsx(h,{children:be(s.status)}),e.jsx(h,{children:new Date(s.createdAt).toLocaleDateString()}),e.jsx(h,{children:s.lastLogin?new Date(s.lastLogin).toLocaleDateString():"Never"}),e.jsx(h,{children:e.jsxs("div",{className:"flex gap-1",children:[s.status==="Pending"&&P(t.role,s.role)&&e.jsxs(e.Fragment,{children:[e.jsx(l,{size:"sm",variant:"ghost",className:"text-green-600",onClick:()=>q(s.id),title:"Approve",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(l,{size:"sm",variant:"ghost",className:"text-red-600",onClick:()=>H(s.id),title:"Reject",children:e.jsx(G,{className:"h-4 w-4"})})]}),e.jsx(l,{size:"sm",variant:"ghost",onClick:()=>ye(s),title:s.id===t?.id?"Cannot edit your own account":K(s.role)?"Owner accounts cannot be modified":P(t.role,s.role)?"Edit":"Cannot edit users with equal or higher role",disabled:s.id===t?.id||K(s.role)||!P(t.role,s.role),children:e.jsx(_e,{className:"h-4 w-4"})}),e.jsx(l,{size:"sm",variant:"ghost",className:"text-red-600",onClick:()=>ve(s),title:s.id===t?.id?"Cannot delete your own account":K(s.role)?"Owner accounts cannot be deleted":re(t.role,s.role)?"Delete":"Cannot delete users with equal or higher role",disabled:s.id===t?.id||!re(t.role,s.role),children:e.jsx(Me,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]}),e.jsx(J,{open:je,onOpenChange:b,children:e.jsxs(Q,{children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Edit User"}),e.jsxs(se,{children:["Update role and status for ",a?.name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[le(t.role)&&a&&a.role==="Admin"&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 rounded-lg",children:e.jsxs("p",{className:"text-xs text-amber-800 dark:text-amber-200",children:[e.jsx("strong",{children:"⚠️ Admin Account:"})," You are modifying an Admin account. Changes will take effect immediately."]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{children:"Role"}),e.jsxs(T,{value:i.role,onValueChange:s=>S({...i,role:s}),children:[e.jsx(R,{children:e.jsx(E,{})}),e.jsx(I,{children:ke.map(s=>e.jsxs(x,{value:s,children:[s==="Owner"&&"Owner - Full system access",s==="Admin"&&"Admin - Full access (except admin management)",s==="Customer"&&"Customer - Limited access to own orders",s==="Viewer"&&"Viewer - Read-only access"]},s))})]}),t.role==="Admin"&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Note: Only the Owner can assign Admin or Owner roles."}),le(t.role)&&i.role==="Owner"&&a?.role!=="Owner"&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"⚠️ Warning: Promoting to Owner grants full system access including the ability to manage all users."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{children:"Status"}),e.jsxs(T,{value:i.status,onValueChange:s=>S({...i,status:s}),children:[e.jsx(R,{children:e.jsx(E,{})}),e.jsxs(I,{children:[e.jsx(x,{value:"Active",children:"Active"}),e.jsx(x,{value:"Pending",children:"Pending"}),e.jsx(x,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsxs(ae,{children:[e.jsx(l,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(l,{onClick:we,children:"Save Changes"})]})]})}),e.jsx(J,{open:ge,onOpenChange:N,children:e.jsxs(Q,{children:[e.jsxs(Z,{children:[e.jsx(ee,{className:"text-destructive",children:"Delete User"}),e.jsxs(se,{children:["Are you sure you want to delete ",e.jsx("strong",{children:a?.name}),"? This action cannot be undone."]})]}),a&&a.role==="Admin"&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("p",{className:"text-xs text-red-800 dark:text-red-200",children:[e.jsx("strong",{children:"⚠️ Warning:"})," You are about to delete an Admin account. This will immediately revoke their access to the system."]})}),e.jsxs(ae,{children:[e.jsx(l,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(l,{variant:"destructive",onClick:fe,children:"Delete User"})]})]})})]})}export{ts as UserManagementView};
