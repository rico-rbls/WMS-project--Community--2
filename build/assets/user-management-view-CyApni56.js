import{c as te,i as Ne,r as l,V as be,j as e,C,q as A,ba as M,s as D,x as q,z as c,y as U,t as B,B as n,am as _,a4 as Y,U as ke,a5 as Se,J as Ce,D as W,E as X,F as G,G as J,H as $,I as Q,K as Z,A as d,ad as Ae,bb as De}from"./index-CMIKxpnp.js";import{S as O,a as T,b as L,c as I,d as o,e as Ue,f as Oe,g as R,i as p,h as Te,j as Le,k as x,T as Ie}from"./sortable-table-head-z2ywGpQp.js";import{a as Re,i as Ee,b as E,d as F,e as ee,f as se}from"./permissions-DJnvoGTW.js";import{u as Fe}from"./useTableSort-BFTwzeb3.js";import{C as Ke}from"./crown-B8jT-s0a.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]],ae=te("user-cog",Pe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Ve=te("user-x",ze);function We(){const{user:a,getAllUsers:K,getPendingUsers:He,approveUser:re,rejectUser:le,updateUserRole:ne,updateUserStatus:ie,deleteUser:ce}=Ne(),[h,de]=l.useState([]),[P,oe]=l.useState(""),[v,xe]=l.useState("all"),[t,w]=l.useState(null),[me,f]=l.useState(!1),[he,N]=l.useState(!1),[i,k]=l.useState({role:"Operator",status:"Active"}),S=be(P,300);l.useEffect(()=>{const s=()=>{const y=K();de(y.map(m=>({id:m.id,email:m.email,name:m.name,role:m.role,status:m.status,createdAt:m.createdAt,lastLogin:m.lastLogin})))};s();const r=setInterval(s,2e3);return()=>clearInterval(r)},[K]);const ue=l.useMemo(()=>{let s=h;if(S){const r=S.toLowerCase();s=s.filter(y=>y.name.toLowerCase().includes(r)||y.email.toLowerCase().includes(r)||y.id.toLowerCase().includes(r))}return v!=="all"&&(s=s.filter(r=>r.status===v)),s},[h,S,v]),{sortedData:z,sortConfig:u,requestSort:j,getSortDirection:g}=Fe(ue),b=l.useMemo(()=>h.filter(s=>s.status==="Pending").length,[h]),je=s=>{w(s),k({role:s.role,status:s.status}),f(!0)},ge=s=>{w(s),N(!0)},V=async s=>{try{await re(s),d.success("User approved successfully")}catch(r){d.error(r?.message||"Failed to approve user")}},H=async s=>{try{await le(s),d.success("User rejected and removed")}catch(r){d.error(r?.message||"Failed to reject user")}},pe=async()=>{if(t)try{i.role!==t.role&&await ne(t.id,i.role),i.status!==t.status&&await ie(t.id,i.status),d.success("User updated successfully"),f(!1),w(null)}catch(s){d.error(s?.message||"Failed to update user")}},ye=async()=>{if(t)try{await ce(t.id),d.success("User deleted successfully"),N(!1),w(null)}catch(s){d.error(s?.message||"Failed to delete user")}},ve=s=>{switch(s){case"Active":return e.jsxs(c,{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:[e.jsx(De,{className:"h-3 w-3 mr-1"}),"Active"]});case"Pending":return e.jsxs(c,{className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),"Pending"]});case"Inactive":return e.jsxs(c,{className:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200",children:[e.jsx(Ve,{className:"h-3 w-3 mr-1"}),"Inactive"]})}},we=s=>{switch(s){case"Owner":return e.jsxs(c,{className:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",children:[e.jsx(Ke,{className:"h-3 w-3 mr-1"}),"Owner"]});case"Admin":return e.jsxs(c,{variant:"default",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),"Admin"]});case"Operator":return e.jsxs(c,{variant:"secondary",children:[e.jsx(ae,{className:"h-3 w-3 mr-1"}),"Operator"]});case"Viewer":return e.jsxs(c,{variant:"outline",children:[e.jsx(Ae,{className:"h-3 w-3 mr-1"}),"Viewer"]})}},fe=a?Re(a.role):[];return!a||!Ee(a.role)?e.jsx("div",{className:"flex items-center justify-center h-full min-h-[400px]",children:e.jsx(C,{className:"max-w-md w-full mx-4",children:e.jsxs(A,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 h-12 w-12 rounded-full bg-destructive/10 flex items-center justify-center",children:e.jsx(M,{className:"h-6 w-6 text-destructive"})}),e.jsx(D,{className:"text-destructive",children:"Access Denied"}),e.jsx(q,{children:"You do not have permission to access user management."})]})})}):e.jsxs("div",{className:"space-y-6 px-4 sm:px-0",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:"User Management"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Manage user accounts, roles, and permissions"})]}),b>0&&e.jsxs(c,{variant:"destructive",className:"text-sm px-3 py-1.5 gap-1.5 self-start md:self-auto animate-pulse",children:[e.jsx(U,{className:"h-3.5 w-3.5"}),b," pending approval",b!==1?"s":""]})]}),b>0&&e.jsxs(C,{className:"border-yellow-200 bg-yellow-50 dark:border-yellow-800 dark:bg-yellow-950/30",children:[e.jsxs(A,{className:"pb-3",children:[e.jsxs(D,{className:"text-lg flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-yellow-600"}),"Pending Approvals"]}),e.jsx(q,{children:"New user registrations awaiting your approval"})]}),e.jsx(B,{children:e.jsx("div",{className:"space-y-3",children:h.filter(s=>s.status==="Pending").map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white dark:bg-gray-900 rounded-lg border",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Registered: ",new Date(s.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{size:"sm",variant:"outline",className:"text-green-600 hover:bg-green-50",onClick:()=>V(s.id),children:[e.jsx(_,{className:"h-4 w-4 mr-1"})," Approve"]}),e.jsxs(n,{size:"sm",variant:"outline",className:"text-red-600 hover:bg-red-50",onClick:()=>H(s.id),children:[e.jsx(Y,{className:"h-4 w-4 mr-1"})," Reject"]})]})]},s.id))})})]}),e.jsxs(C,{children:[e.jsx(A,{children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5"}),e.jsx(D,{children:"All Users"}),e.jsx(c,{variant:"secondary",children:h.length})]}),e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(Ce,{placeholder:"Search users...",value:P,onChange:s=>oe(s.target.value),className:"pl-9 w-full md:w-64"})]}),e.jsxs(O,{value:v,onValueChange:s=>xe(s),children:[e.jsx(T,{className:"w-full md:w-40",children:e.jsx(L,{placeholder:"Filter by status"})}),e.jsxs(I,{children:[e.jsx(o,{value:"all",children:"All Status"}),e.jsx(o,{value:"Active",children:"Active"}),e.jsx(o,{value:"Pending",children:"Pending"}),e.jsx(o,{value:"Inactive",children:"Inactive"})]})]})]})]})}),e.jsx(B,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(Ue,{children:[e.jsx(Oe,{children:e.jsxs(R,{children:[e.jsx(p,{sortKey:"name",currentSortKey:u.key,sortDirection:g("name"),onSort:s=>j(s),children:"Name"}),e.jsx(p,{sortKey:"email",currentSortKey:u.key,sortDirection:g("email"),onSort:s=>j(s),children:"Email"}),e.jsx(p,{sortKey:"role",currentSortKey:u.key,sortDirection:g("role"),onSort:s=>j(s),children:"Role"}),e.jsx(p,{sortKey:"status",currentSortKey:u.key,sortDirection:g("status"),onSort:s=>j(s),children:"Status"}),e.jsx(p,{sortKey:"createdAt",currentSortKey:u.key,sortDirection:g("createdAt"),onSort:s=>j(s),children:"Created"}),e.jsx(p,{sortKey:"lastLogin",currentSortKey:u.key,sortDirection:g("lastLogin"),onSort:s=>j(s),children:"Last Login"}),e.jsx(Te,{children:"Actions"})]})}),e.jsx(Le,{children:z.length===0?e.jsx(R,{children:e.jsx(x,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No users found"})}):z.map(s=>e.jsxs(R,{children:[e.jsx(x,{className:"font-medium",children:s.name}),e.jsx(x,{children:s.email}),e.jsx(x,{children:we(s.role)}),e.jsx(x,{children:ve(s.status)}),e.jsx(x,{children:new Date(s.createdAt).toLocaleDateString()}),e.jsx(x,{children:s.lastLogin?new Date(s.lastLogin).toLocaleDateString():"Never"}),e.jsx(x,{children:e.jsxs("div",{className:"flex gap-1",children:[s.status==="Pending"&&E(a.role,s.role)&&e.jsxs(e.Fragment,{children:[e.jsx(n,{size:"sm",variant:"ghost",className:"text-green-600",onClick:()=>V(s.id),title:"Approve",children:e.jsx(_,{className:"h-4 w-4"})}),e.jsx(n,{size:"sm",variant:"ghost",className:"text-red-600",onClick:()=>H(s.id),title:"Reject",children:e.jsx(Y,{className:"h-4 w-4"})})]}),e.jsx(n,{size:"sm",variant:"ghost",onClick:()=>je(s),title:s.id===a?.id?"Cannot edit your own account":F(s.role)?"Owner accounts cannot be modified":E(a.role,s.role)?"Edit":"Cannot edit users with equal or higher role",disabled:s.id===a?.id||F(s.role)||!E(a.role,s.role),children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsx(n,{size:"sm",variant:"ghost",className:"text-red-600",onClick:()=>ge(s),title:s.id===a?.id?"Cannot delete your own account":F(s.role)?"Owner accounts cannot be deleted":ee(a.role,s.role)?"Delete":"Cannot delete users with equal or higher role",disabled:s.id===a?.id||!ee(a.role,s.role),children:e.jsx(Ie,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]}),e.jsx(W,{open:me,onOpenChange:f,children:e.jsxs(X,{children:[e.jsxs(G,{children:[e.jsx(J,{children:"Edit User"}),e.jsxs($,{children:["Update role and status for ",t?.name]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[se(a.role)&&t&&t.role==="Admin"&&e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 rounded-lg",children:e.jsxs("p",{className:"text-xs text-amber-800 dark:text-amber-200",children:[e.jsx("strong",{children:"⚠️ Admin Account:"})," You are modifying an Admin account. Changes will take effect immediately."]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Role"}),e.jsxs(O,{value:i.role,onValueChange:s=>k({...i,role:s}),children:[e.jsx(T,{children:e.jsx(L,{})}),e.jsx(I,{children:fe.map(s=>e.jsxs(o,{value:s,children:[s==="Owner"&&"Owner - Full system access",s==="Admin"&&"Admin - Full access (except admin management)",s==="Operator"&&"Operator - Read-only access",s==="Viewer"&&"Viewer - Read-only access"]},s))})]}),a.role==="Admin"&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Note: Only the Owner can assign Admin or Owner roles."}),se(a.role)&&i.role==="Owner"&&t?.role!=="Owner"&&e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"⚠️ Warning: Promoting to Owner grants full system access including the ability to manage all users."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{children:"Status"}),e.jsxs(O,{value:i.status,onValueChange:s=>k({...i,status:s}),children:[e.jsx(T,{children:e.jsx(L,{})}),e.jsxs(I,{children:[e.jsx(o,{value:"Active",children:"Active"}),e.jsx(o,{value:"Pending",children:"Pending"}),e.jsx(o,{value:"Inactive",children:"Inactive"})]})]})]})]}),e.jsxs(Z,{children:[e.jsx(n,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(n,{onClick:pe,children:"Save Changes"})]})]})}),e.jsx(W,{open:he,onOpenChange:N,children:e.jsxs(X,{children:[e.jsxs(G,{children:[e.jsx(J,{className:"text-destructive",children:"Delete User"}),e.jsxs($,{children:["Are you sure you want to delete ",e.jsx("strong",{children:t?.name}),"? This action cannot be undone."]})]}),t&&t.role==="Admin"&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("p",{className:"text-xs text-red-800 dark:text-red-200",children:[e.jsx("strong",{children:"⚠️ Warning:"})," You are about to delete an Admin account. This will immediately revoke their access to the system."]})}),e.jsxs(Z,{children:[e.jsx(n,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(n,{variant:"destructive",onClick:ye,children:"Delete User"})]})]})})]})}export{We as UserManagementView};
