import{O as gs,i as ps,r as l,V as js,aB as ys,a_ as Ue,A as n,a$ as fs,b0 as vs,b1 as Ns,b2 as Cs,b3 as bs,j as e,C as N,q as H,s as G,U as de,t as C,S as Ss,P as ws,d as D,z as B,x as Fs,D as me,a2 as ks,B as x,E as ue,F as he,G as xe,H as ge,I as o,J as m,K as pe,b4 as As,a4 as Ds,a3 as Ps,p as Ts,ab as Ke,aW as Oe,ac as Es,b5 as Is,b6 as $s,b7 as Bs}from"./index-B9CZxgBG.js";import{S as _,a as W,b as J,c as X,d as R,T as Me,e as Ls,f as Us,g as Re,h as ze,i as k,j as Ks,k as y}from"./sortable-table-head-sFuKYft8.js";import{u as Os,a as Ms,P as Rs,F as zs,B as Vs,b as qs,T as Hs,E as Gs,c as _s}from"./bulk-delete-dialog-DgFC3-UA.js";import{F as Ve}from"./favorite-button-BT7JoVOt.js";import{u as Ws}from"./useTableSort-DjFXLZQY.js";import{c as Js,i as Xs}from"./permissions-DJnvoGTW.js";import{E as je}from"./editable-cell-Bw46bihc.js";import{C as Ys}from"./circle-check-big-DJXDZx6R.js";import{S as Qs}from"./star-Ds4fWSGi.js";import{A as Y,a as qe}from"./archive-BOTQBF3w.js";import{P as He}from"./phone-Dnf99L5q.js";import{S as Ge}from"./square-pen-C2AiDAw8.js";import{M as Zs}from"./map-pin-7JWJTf4e.js";import{D as et}from"./dollar-sign-DNQjQ9F6.js";import"./skeleton-HtHo4pbP.js";const ye=["Active","Inactive"],fe=["Technology","Startup","Enterprise","Retail","Healthcare","Finance","Other"];function pt({initialOpenDialog:ve,onDialogOpened:Ne,initialCustomerId:Q,onCustomerDialogOpened:Ce}){const{isFavorite:be,getFavoritesByType:Se}=gs(),{user:Z}=ps(),f=Z?Js(Z.role):!1,we=Z?Xs(Z.role):!1,[L,Fe]=l.useState(""),[b,ee]=l.useState("all"),[U,ke]=l.useState(!1),[d,Ae]=l.useState(!1),[z,p]=l.useState(null),[_e,De]=l.useState(!0),[V,q]=l.useState(!1),[K,P]=l.useState(null),[ae,O]=l.useState(null),[t,c]=l.useState({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0}),re=js(L,300);l.useEffect(()=>{(async()=>{De(!0);const s=await ys();p(s),De(!1)})()},[]),l.useEffect(()=>{ve&&!V&&(q(!0),Ne?.())},[ve,Ne,V]),l.useEffect(()=>{Q&&z&&z.find(a=>a.id===Q)&&(O(Q),Ce?.())},[Q,z,Ce]);const j=l.useMemo(()=>z??[],[z]),g=l.useMemo(()=>{const s=j.length,a=j.filter(u=>u.status==="Active").length,r=j.filter(u=>u.status==="Inactive").length,i=new Set(j.map(u=>u.category)).size,I=j.reduce((u,$)=>u+$.purchases,0),oe=j.reduce((u,$)=>u+$.payments,0),te=j.reduce((u,$)=>u+$.balance,0);let Le=null;if(j.length>0){const u=[...j].sort(($,xs)=>xs.purchases-$.purchases);u[0].purchases>0&&(Le={id:u[0].id,name:u[0].name,value:u[0].purchases})}return{totalCustomers:s,activeCustomers:a,inactiveCustomers:r,uniqueCategories:i,totalPurchases:I,totalPayments:oe,totalBalance:te,topCustomerByPurchases:Le}},[j]),le=l.useMemo(()=>j.filter(s=>{if(s.archived!==d||U&&!be("customers",s.id)||b!=="all"&&s.status!==b)return!1;if(re){const a=re.toLowerCase();if(!(s.name.toLowerCase().includes(a)||s.id.toLowerCase().includes(a)||s.category.toLowerCase().includes(a)||s.contact.toLowerCase().includes(a)||s.email.toLowerCase().includes(a)))return!1}return!0}),[j,re,b,U,be,d]);function We(){Fe(""),ee("all"),ke(!1),Ae(!1)}async function Je(s){try{const a=await Bs(s);p(r=>(r??[]).map(i=>i.id===s?a:i)),P(null),n.success("Customer archived successfully")}catch(a){n.error(a?.message||"Failed to archive customer")}}async function Xe(s){try{const a=await Is(s);p(r=>(r??[]).map(i=>i.id===s?a:i)),P(null),n.success("Customer restored successfully")}catch(a){n.error(a?.message||"Failed to restore customer")}}async function Ye(s){try{await $s(s),p(a=>(a??[]).filter(r=>r.id!==s)),P(null),n.success("Customer permanently deleted")}catch(a){n.error(a?.message||"Failed to permanently delete customer")}}const T=s=>{switch(s){case"Active":return"✓";case"Inactive":return"○";default:return"○"}},se=s=>{switch(s){case"Active":return"bg-emerald-500/15 text-emerald-700 dark:text-emerald-400 border-emerald-200";case"Inactive":return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200";default:return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200"}},{sortedData:Qe,sortConfig:S,requestSort:w,getSortDirection:F}=Ws(le),{currentPage:Pe,totalPages:Ze,paginatedData:Te,goToPage:es,totalItems:ss,itemsPerPage:ts}=Os(Qe,25),{selectedIds:v,selectedItems:Ee,selectionCount:M,isAllSelected:as,isPartiallySelected:rs,hasSelection:ne,toggleItem:ls,toggleAll:ie,deselectAll:h,isSelected:ns}=Ms(Te),[Ie,A]=l.useState(!1),[is,$e]=l.useState(!1),[cs,E]=l.useState(!1);l.useEffect(()=>{h()},[Pe,h]),l.useEffect(()=>{const s=a=>{(a.metaKey||a.ctrlKey)&&a.key==="a"&&!V&&!K&&(a.preventDefault(),ie()),a.key==="Escape"&&ne&&h()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[ie,h,ne,V,K]);const ce=l.useCallback(async(s,a,r)=>{try{const i={[a]:r},I=await Ue({id:s,...i});p(oe=>(oe??[]).map(te=>te.id===s?I:te)),n.success(`${a.charAt(0).toUpperCase()+a.slice(1)} updated`)}catch(i){throw n.error(i?.message||"Failed to update"),i}},[p]);l.useCallback(async()=>{A(!0);try{const s=Array.from(v),a=await fs(s);p(r=>r?.filter(i=>!s.includes(i.id))??[]),a.failedCount>0?n.warning(`Deleted ${a.successCount} customers. ${a.failedCount} failed.`):n.success(`Successfully deleted ${a.successCount} customer${a.successCount!==1?"s":""}`),h()}catch(s){n.error(s?.message||"Failed to delete customers")}finally{A(!1),E(!1)}},[v,h]);const os=l.useCallback(async()=>{A(!0);try{const s=Array.from(v),a=await vs(s);p(r=>r&&r.map(i=>s.includes(i.id)?{...i,archived:!0,archivedAt:new Date().toISOString()}:i)),a.failedCount>0?n.warning(`Archived ${a.successCount} customers. ${a.failedCount} failed.`):n.success(`Successfully archived ${a.successCount} customer${a.successCount!==1?"s":""}`),h()}catch(s){n.error(s?.message||"Failed to archive customers")}finally{A(!1),E(!1)}},[v,h]),ds=l.useCallback(async()=>{A(!0);try{const s=Array.from(v),a=await Ns(s);p(r=>r&&r.map(i=>s.includes(i.id)?{...i,archived:!1,archivedAt:void 0}:i)),a.failedCount>0?n.warning(`Restored ${a.successCount} customers. ${a.failedCount} failed.`):n.success(`Successfully restored ${a.successCount} customer${a.successCount!==1?"s":""}`),h()}catch(s){n.error(s?.message||"Failed to restore customers")}finally{A(!1),E(!1)}},[v,h]),ms=l.useCallback(async()=>{A(!0);try{const s=Array.from(v),a=await Cs(s);p(r=>r?.filter(i=>!s.includes(i.id))??[]),a.failedCount>0?n.warning(`Permanently deleted ${a.successCount} customers. ${a.failedCount} failed.`):n.success(`Permanently deleted ${a.successCount} customer${a.successCount!==1?"s":""}`),h()}catch(s){n.error(s?.message||"Failed to permanently delete customers")}finally{A(!1),E(!1)}},[v,h]),us=l.useCallback(async s=>{$e(!0);try{const a=Array.from(v),r=await bs(a,s);p(i=>i&&i.map(I=>a.includes(I.id)?{...I,status:s}:I)),r.failedCount>0?n.warning(`Updated ${r.successCount} customers. ${r.failedCount} failed.`):n.success(`Successfully updated ${r.successCount} customer${r.successCount!==1?"s":""}`),h()}catch(a){n.error(a?.message||"Failed to update customers")}finally{$e(!1)}},[v,h]),Be=l.useCallback(s=>{c({id:s.id,name:s.name,contact:s.contact,email:s.email,phone:s.phone,category:s.category,status:s.status,country:s.country||"",city:s.city||"",address:s.address||"",purchases:s.purchases||0,payments:s.payments||0}),P(s.id)},[]),hs=l.useMemo(()=>Ee.map(s=>s.name),[Ee]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Customers"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage customer profiles, contact details, and sales relationships"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(N,{className:"relative overflow-hidden",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(G,{className:"text-sm font-medium text-muted-foreground",children:"Total Customers"}),e.jsx(de,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g.totalCustomers}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[g.activeCustomers," active, ",g.inactiveCustomers," inactive"]})]})]}),e.jsxs(N,{className:"relative overflow-hidden",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(G,{className:"text-sm font-medium text-muted-foreground",children:"Active Customers"}),e.jsx(Ys,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:g.activeCustomers}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:g.totalCustomers>0?`${Math.round(g.activeCustomers/g.totalCustomers*100)}% of total`:"No customers yet"})]})]}),e.jsxs(N,{className:"relative overflow-hidden",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(G,{className:"text-sm font-medium text-muted-foreground",children:"Total Purchases"}),e.jsx(Ss,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["₱",g.totalPurchases.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:g.topCustomerByPurchases?`Top: ${g.topCustomerByPurchases.name}`:"No purchases yet"})]})]}),e.jsxs(N,{className:"relative overflow-hidden",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(G,{className:"text-sm font-medium text-muted-foreground",children:"Categories"}),e.jsx(ws,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:g.uniqueCategories}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Outstanding balance: ₱",g.totalBalance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})]}),e.jsxs("div",{className:"grid gap-3 grid-cols-1 sm:grid-cols-2",children:[e.jsx(N,{className:D("cursor-pointer transition-all hover:shadow-md border-l-4",b==="Active"?"ring-2 ring-primary":"","border-l-emerald-400"),onClick:()=>ee(b==="Active"?"all":"Active"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Active"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:g.activeCustomers})]}),e.jsx(B,{variant:"outline",className:se("Active"),children:T("Active")})]})})}),e.jsx(N,{className:D("cursor-pointer transition-all hover:shadow-md border-l-4",b==="Inactive"?"ring-2 ring-primary":"","border-l-slate-400"),onClick:()=>ee(b==="Inactive"?"all":"Inactive"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Inactive"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:g.inactiveCustomers})]}),e.jsx(B,{variant:"outline",className:se("Inactive"),children:T("Inactive")})]})})})]}),e.jsxs(N,{children:[e.jsx(H,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(G,{className:"text-xl",children:"Customer Management"}),e.jsx(Fs,{className:"mt-1",children:"Manage your customer relationships and contacts"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(me,{open:V,onOpenChange:s=>{q(s),s||c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0})},children:[e.jsx(ks,{asChild:!0,children:e.jsxs(x,{onClick:()=>c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0}),disabled:!f,title:f?void 0:"You don't have permission to add customers",children:[e.jsx(Rs,{className:"h-4 w-4 mr-2"}),"Add Customer"]})}),e.jsxs(ue,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(he,{children:[e.jsx(xe,{children:"Create New Customer"}),e.jsx(ge,{children:"Enter the details for the new customer."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"customer-name",children:"Customer Name *"}),e.jsx(m,{id:"customer-name",placeholder:"Enter customer name",value:t.name,onChange:s=>c({...t,name:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"customer-status",children:"Status"}),e.jsxs(_,{value:t.status,onValueChange:s=>c({...t,status:s}),children:[e.jsx(W,{children:e.jsx(J,{placeholder:"Select status"})}),e.jsx(X,{children:ye.map(s=>e.jsx(R,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:T(s)}),s]})},s))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"contact-name",children:"Contact Person *"}),e.jsx(m,{id:"contact-name",placeholder:"Enter contact name",value:t.contact,onChange:s=>c({...t,contact:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"email",children:"Email *"}),e.jsx(m,{id:"email",type:"email",placeholder:"email@example.com",value:t.email,onChange:s=>c({...t,email:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"phone",children:"Phone *"}),e.jsx(m,{id:"phone",placeholder:"+1 (555) 000-0000",value:t.phone,onChange:s=>c({...t,phone:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"category",children:"Category *"}),e.jsxs(_,{value:t.category,onValueChange:s=>c({...t,category:s}),children:[e.jsx(W,{children:e.jsx(J,{placeholder:"Select category"})}),e.jsx(X,{children:fe.map(s=>e.jsx(R,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Location Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"country",children:"Country"}),e.jsx(m,{id:"country",placeholder:"e.g., United States",value:t.country,onChange:s=>c({...t,country:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"city",children:"City"}),e.jsx(m,{id:"city",placeholder:"e.g., San Francisco",value:t.city,onChange:s=>c({...t,city:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2 mt-4",children:[e.jsx(o,{htmlFor:"address",children:"Address"}),e.jsx(m,{id:"address",placeholder:"Full street address",value:t.address,onChange:s=>c({...t,address:s.target.value})})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Financial Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"purchases",children:"Total Purchases (₱)"}),e.jsx(m,{id:"purchases",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.purchases,onChange:s=>c({...t,purchases:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"payments",children:"Total Payments (₱)"}),e.jsx(m,{id:"payments",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.payments,onChange:s=>c({...t,payments:parseFloat(s.target.value)||0})})]})]})]})]}),e.jsxs(pe,{children:[e.jsx(x,{variant:"outline",onClick:()=>q(!1),children:"Cancel"}),e.jsx(x,{onClick:async()=>{if(!t.name.trim()||!t.contact.trim()||!t.email.trim()||!t.phone.trim()||!t.category.trim()){n.error("Please fill all required fields");return}try{const s=await As({name:t.name,contact:t.contact,email:t.email,phone:t.phone,category:t.category,status:t.status,country:t.country,city:t.city,address:t.address,purchases:t.purchases,payments:t.payments});p(a=>[s,...a??[]]),q(!1),n.success("Customer added successfully"),c({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active",country:"",city:"",address:"",purchases:0,payments:0})}catch(s){n.error(s?.message||"Failed to add customer")}},children:"Create Customer"})]})]})]})})]})}),e.jsxs(C,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ds,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(m,{placeholder:"Search customers by name, contact, email...",value:L,onChange:s=>Fe(s.target.value),className:"pl-9"})]}),e.jsxs(_,{value:b,onValueChange:ee,children:[e.jsxs(W,{className:"w-full sm:w-[180px]",children:[e.jsx(zs,{className:"h-4 w-4 mr-2"}),e.jsx(J,{placeholder:"Filter by status"})]}),e.jsxs(X,{children:[e.jsx(R,{value:"all",children:"All Statuses"}),ye.map(s=>e.jsx(R,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:T(s)}),s]})},s))]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(x,{variant:U?"default":"outline",size:"sm",onClick:()=>ke(!U),className:"gap-1",children:[e.jsx(Qs,{className:D("h-4 w-4",U&&"fill-current")}),"Favorites",Se("customers").length>0&&e.jsx(B,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:Se("customers").length})]}),e.jsxs(x,{variant:d?"default":"outline",size:"sm",onClick:()=>Ae(!d),className:d?"bg-orange-500 hover:bg-orange-600 text-white":"",children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),d?"Viewing Archived":"View Archived"]}),(L||b!=="all"||U||d)&&e.jsxs(x,{variant:"ghost",size:"sm",onClick:We,className:"gap-1 text-muted-foreground hover:text-foreground",children:[e.jsx(Ps,{className:"h-4 w-4"}),"Clear All Filters"]})]})]}),ne&&f&&e.jsx(Vs,{selectionCount:M,onClearSelection:h,isLoading:Ie||is,actions:d?[{id:"restore",label:"Restore",icon:e.jsx(qe,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:ds},...we?[{id:"permanent-delete",label:"Permanently Delete",icon:e.jsx(Me,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>E(!0)}]:[]]:[{id:"archive",label:"Archive",icon:e.jsx(Y,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:()=>E(!0)}],actionGroups:d?[]:[{id:"status-update",label:"Update Status",icon:e.jsx(Ts,{className:"h-4 w-4 mr-1"}),options:[{value:"Active",label:"Active"},{value:"Inactive",label:"Inactive"}],onSelect:s=>us(s)}],className:"mb-4"}),e.jsx(qs,{open:cs,onOpenChange:E,itemCount:M,itemType:"customer",itemNames:hs,onConfirm:d?ms:os,isLoading:Ie,title:d?"Permanently Delete Customers":"Archive Customers",description:d?`Are you sure you want to permanently delete ${M} customer${M!==1?"s":""}? This action cannot be undone.`:`Are you sure you want to archive ${M} customer${M!==1?"s":""}? Archived customers can be restored later.`,confirmLabel:d?"Permanently Delete":"Archive"}),_e?e.jsx(Hs,{rows:8}):le.length===0?e.jsx(Gs,{icon:d?Y:de,title:d?"No archived customers":"No customers found",description:d?"Archived customers will appear here":L?"Try adjusting your search criteria":"Get started by adding your first customer",actionLabel:!d&&!L?"Add Customer":void 0,onAction:!d&&!L?()=>q(!0):void 0}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(Ls,{children:[e.jsx(Us,{children:e.jsxs(Re,{children:[e.jsx(ze,{className:"w-12",children:e.jsx(Ke,{checked:as,ref:s=>{s&&(s.indeterminate=rs)},onCheckedChange:ie,"aria-label":"Select all customers"})}),e.jsx(k,{sortKey:"id",currentSortKey:S.key,sortDirection:F("id"),onSort:s=>w(s),children:"Customer ID"}),e.jsx(k,{sortKey:"name",currentSortKey:S.key,sortDirection:F("name"),onSort:s=>w(s),children:"Customer Name"}),e.jsx(k,{sortKey:"contact",currentSortKey:S.key,sortDirection:F("contact"),onSort:s=>w(s),children:"Contact"}),e.jsx(k,{sortKey:"category",currentSortKey:S.key,sortDirection:F("category"),onSort:s=>w(s),children:"Category"}),e.jsx(k,{sortKey:"status",currentSortKey:S.key,sortDirection:F("status"),onSort:s=>w(s),children:"Status"}),e.jsx(k,{sortKey:"country",currentSortKey:S.key,sortDirection:F("country"),onSort:s=>w(s),children:"Location"}),e.jsx(k,{sortKey:"purchases",currentSortKey:S.key,sortDirection:F("purchases"),onSort:s=>w(s),children:"Purchases"}),e.jsx(k,{sortKey:"payments",currentSortKey:S.key,sortDirection:F("payments"),onSort:s=>w(s),children:"Payments"}),e.jsx(k,{sortKey:"balance",currentSortKey:S.key,sortDirection:F("balance"),onSort:s=>w(s),children:"Balance"}),e.jsx(ze,{children:"Actions"})]})}),e.jsx(Ks,{children:Te.map(s=>{const a=ns(s.id);return e.jsxs(Re,{className:D("hover:bg-muted/50 transition-colors",a&&"bg-muted/50"),children:[e.jsx(y,{children:e.jsx(Ke,{checked:a,onCheckedChange:()=>ls(s.id),"aria-label":`Select customer ${s.name}`})}),e.jsx(y,{className:"font-mono text-sm",children:s.id}),e.jsx(y,{children:e.jsx("button",{className:"text-left font-medium text-primary hover:underline cursor-pointer bg-transparent border-none p-0",onClick:()=>O(s.id),children:s.name})}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(Oe,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(je,{value:s.email,type:"text",onSave:r=>ce(s.id,"email",r),disabled:!f,className:"text-xs text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(He,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(je,{value:s.phone,type:"text",onSave:r=>ce(s.id,"phone",r),disabled:!f,className:"text-xs text-muted-foreground"})]})]})}),e.jsx(y,{children:e.jsx(je,{value:s.category,type:"select",options:fe.map(r=>({value:r,label:r})),onSave:r=>ce(s.id,"category",r),disabled:!f})}),e.jsx(y,{children:e.jsxs(B,{variant:"outline",className:D("gap-1",se(s.status)),children:[e.jsx("span",{children:T(s.status)}),s.status]})}),e.jsx(y,{children:e.jsx("div",{className:"text-sm",children:s.city&&s.country?e.jsxs("span",{children:[s.city,", ",s.country]}):s.city||s.country?e.jsx("span",{children:s.city||s.country}):e.jsx("span",{className:"text-muted-foreground",children:"—"})})}),e.jsxs(y,{className:"text-right font-medium",children:["₱",s.purchases.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(y,{className:"text-right font-medium",children:["₱",s.payments.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(y,{className:D("text-right font-medium",s.balance>0?"text-amber-600":s.balance<0?"text-emerald-600":""),children:["₱",s.balance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx(y,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ve,{entityType:"customers",entityId:s.id,entityName:s.name}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>O(s.id),children:e.jsx(Es,{className:"h-4 w-4"})}),d?e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Xe(s.id),disabled:!f,title:"Restore customer",children:e.jsx(qe,{className:"h-4 w-4"})}),we&&e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>Ye(s.id),title:"Permanently delete",children:e.jsx(Me,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Be(s),disabled:!f,title:"Edit customer",children:e.jsx(Ge,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Je(s.id),disabled:!f,title:"Archive customer",children:e.jsx(Y,{className:"h-4 w-4"})})]})]})})]},s.id)})})]})}),le.length>0&&e.jsx(_s,{currentPage:Pe,totalPages:Ze,totalItems:ss,itemsPerPage:ts,onPageChange:es,className:"mt-4"})]})]}),K&&e.jsx(me,{open:!!K,onOpenChange:s=>{s||P(null)},children:e.jsxs(ue,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(he,{children:[e.jsx(xe,{children:"Edit Customer"}),e.jsx(ge,{children:"Update the customer details."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-customer-name",children:"Customer Name *"}),e.jsx(m,{id:"edit-customer-name",placeholder:"Enter customer name",value:t.name,onChange:s=>c({...t,name:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-customer-status",children:"Status"}),e.jsxs(_,{value:t.status,onValueChange:s=>c({...t,status:s}),children:[e.jsx(W,{children:e.jsx(J,{placeholder:"Select status"})}),e.jsx(X,{children:ye.map(s=>e.jsx(R,{value:s,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:T(s)}),s]})},s))})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-contact-name",children:"Contact Person *"}),e.jsx(m,{id:"edit-contact-name",placeholder:"Enter contact name",value:t.contact,onChange:s=>c({...t,contact:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-email",children:"Email *"}),e.jsx(m,{id:"edit-email",type:"email",placeholder:"email@example.com",value:t.email,onChange:s=>c({...t,email:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-phone",children:"Phone *"}),e.jsx(m,{id:"edit-phone",placeholder:"+1 (555) 000-0000",value:t.phone,onChange:s=>c({...t,phone:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-category",children:"Category *"}),e.jsxs(_,{value:t.category,onValueChange:s=>c({...t,category:s}),children:[e.jsx(W,{children:e.jsx(J,{placeholder:"Select category"})}),e.jsx(X,{children:fe.map(s=>e.jsx(R,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Location Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-country",children:"Country"}),e.jsx(m,{id:"edit-country",placeholder:"e.g., United States",value:t.country,onChange:s=>c({...t,country:s.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-city",children:"City"}),e.jsx(m,{id:"edit-city",placeholder:"e.g., San Francisco",value:t.city,onChange:s=>c({...t,city:s.target.value})})]})]}),e.jsxs("div",{className:"grid gap-2 mt-4",children:[e.jsx(o,{htmlFor:"edit-address",children:"Address"}),e.jsx(m,{id:"edit-address",placeholder:"Full street address",value:t.address,onChange:s=>c({...t,address:s.target.value})})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground mb-3 block",children:"Financial Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-purchases",children:"Total Purchases (₱)"}),e.jsx(m,{id:"edit-purchases",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.purchases,onChange:s=>c({...t,purchases:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"edit-payments",children:"Total Payments (₱)"}),e.jsx(m,{id:"edit-payments",type:"number",min:"0",step:"0.01",placeholder:"0.00",value:t.payments,onChange:s=>c({...t,payments:parseFloat(s.target.value)||0})})]})]})]})]}),e.jsxs(pe,{children:[e.jsx(x,{variant:"outline",onClick:()=>P(null),children:"Cancel"}),e.jsx(x,{onClick:async()=>{if(!t.name.trim()||!t.contact.trim()||!t.email.trim()||!t.phone.trim()||!t.category.trim()){n.error("Please fill all required fields");return}try{const s=await Ue({id:K,name:t.name,contact:t.contact,email:t.email,phone:t.phone,category:t.category,status:t.status,country:t.country,city:t.city,address:t.address,purchases:t.purchases,payments:t.payments});p(a=>(a??[]).map(r=>r.id===K?s:r)),P(null),n.success("Customer updated successfully")}catch(s){n.error(s?.message||"Failed to update customer")}},children:"Save Changes"})]})]})}),ae&&(()=>{const s=j.find(a=>a.id===ae);return s?e.jsx(me,{open:!!ae,onOpenChange:a=>{a||O(null)},children:e.jsxs(ue,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsx(he,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(xe,{className:"text-xl",children:s.name}),e.jsxs(ge,{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"font-mono",children:s.id}),e.jsxs(B,{variant:"outline",className:D("gap-1",se(s.status)),children:[e.jsx("span",{children:T(s.status)}),s.status]}),s.archived&&e.jsxs(B,{variant:"outline",className:"bg-orange-500/15 text-orange-700 dark:text-orange-400 border-orange-200",children:[e.jsx(Y,{className:"h-3 w-3 mr-1"}),"Archived"]})]})]}),e.jsx(Ve,{entityType:"customers",entityId:s.id,entityName:s.name})]})}),e.jsxs("div",{className:"grid gap-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Contact Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Contact Person"}),e.jsx("p",{className:"font-medium",children:s.contact})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Category"}),e.jsx(B,{variant:"secondary",children:s.category})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(Oe,{className:"h-3 w-3 text-muted-foreground"}),s.email]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Phone"}),e.jsxs("p",{className:"font-medium flex items-center gap-1",children:[e.jsx(He,{className:"h-3 w-3 text-muted-foreground"}),s.phone]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(Zs,{className:"h-4 w-4"}),"Location"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"City / Country"}),e.jsx("p",{className:"font-medium",children:s.city&&s.country?`${s.city}, ${s.country}`:s.city||s.country||"—"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Address"}),e.jsx("p",{className:"font-medium",children:s.address||"—"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(et,{className:"h-4 w-4"}),"Financial Summary"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(N,{children:e.jsxs(C,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Purchases"}),e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:["₱",s.purchases.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})}),e.jsx(N,{children:e.jsxs(C,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Payments"}),e.jsxs("p",{className:"text-lg font-bold text-emerald-600",children:["₱",s.payments.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})}),e.jsx(N,{children:e.jsxs(C,{className:"p-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Balance"}),e.jsxs("p",{className:D("text-lg font-bold",s.balance>0?"text-amber-600":s.balance<0?"text-emerald-600":""),children:["₱",s.balance.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})})]})]})]}),e.jsxs(pe,{children:[e.jsx(x,{variant:"outline",onClick:()=>O(null),children:"Close"}),!s.archived&&f&&e.jsxs(x,{onClick:()=>{O(null),Be(s)},children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Edit Customer"]})]})]})}):null})()]})}export{pt as CustomersView};
