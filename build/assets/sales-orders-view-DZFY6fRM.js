import{c as At,i as Tt,aD as kt,r as j,V as Rt,j as e,B as u,C as f,q as S,s as C,t as D,z as ce,S as Ke,y as Ft,D as ye,a3 as Lt,E as fe,F as Se,G as Ce,H as De,I as p,J as h,d as de,K as ze,a5 as Bt,a4 as Vt,ad as Et,m as be,aE as $t,ao as qt,A as x,aF as Kt,aG as zt,aH as Ut,aI as Ht,aJ as Mt,aK as _t,aL as Gt,aM as Jt}from"./index-xwWdscAO.js";import{g as Qt,h as we}from"./permissions-DeuZZz56.js";import{u as Wt,a as Xt,T as Yt,E as Ue,P as Ie,F as Zt,B as es,S as ts,b as ss}from"./select-all-banner-CHI-SY1G.js";import{e as oe,f as me,g as A,h as c,j as ue,k as i,S as U,a as H,b as M,c as _,d as F,T as G,i as T}from"./sortable-table-head-DzJRvkfG.js";import{u as as,P as rs,D as is}from"./printable-receipt-D7YqAPxX.js";import{F as ls}from"./file-text-nJYsfL_F.js";import{D as ns}from"./dollar-sign-DvGksN1a.js";import{T as cs}from"./trending-up-BI7LGd2O.js";import{A as ee,a as He}from"./archive-CTUkrPI_.js";import{C as ds}from"./circle-alert-B2xUnS4e.js";import"./skeleton-DhpkY8tQ.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ms=At("arrow-left",os),us=["Unpaid","Partially Paid","Paid","Overdue"],xs=["Pending","Processing","Shipped","In Transit","Out for Delivery","Delivered","Failed","Returned"],k=b=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(b);function bs(){const{user:b}=Tt(),{createNotification:Me}=kt(),L=b?Qt(b.id):"Viewer",B=L==="Customer",xe=B||we(L,"purchase_orders:create");!B&&we(L,"purchase_orders:update");const te=!B&&we(L,"purchase_orders:delete"),Pe=L==="Owner"||L==="Admin",{printReceipt:_e}=as(),[se,I]=j.useState(null),[he,Ge]=j.useState([]),[ae,Je]=j.useState([]),[Qe,We]=j.useState(!0),[re,Oe]=j.useState(""),J=Rt(re,300),[V,Ae]=j.useState("all"),[N,Te]=j.useState(!1),[Xe,ie]=j.useState(!1),[E,Q]=j.useState(null),[Ye,R]=j.useState(!1),[y,ke]=j.useState(null),[W,je]=j.useState("asc"),[n,le]=j.useState(null),[r,v]=j.useState({soDate:new Date().toISOString().split("T")[0],customerId:"",customerName:"",customerCountry:"",customerCity:"",invoiceNumber:"",items:[],expectedDeliveryDate:"",notes:"",totalReceived:0,shippingStatus:"Pending"});j.useEffect(()=>{(async()=>{try{const[s,a,l]=await Promise.all([be(),$t(),qt()]);I(s),Ge(a),Je(l)}catch{x.error("Failed to load data")}finally{We(!1)}})()},[]);const $=se??[],X=j.useMemo(()=>$.filter(t=>{if(B&&b?.email&&t.createdBy!==b.email)return!1;const s=t.archived===!0;if(N!==s)return!1;const a=!J||t.id.toLowerCase().includes(J.toLowerCase())||t.customerName.toLowerCase().includes(J.toLowerCase())||t.items.some(d=>d.itemName.toLowerCase().includes(J.toLowerCase())),l=V==="all"||t.receiptStatus===V;return a&&l}),[$,J,V,N,B,b?.email]),Re=j.useMemo(()=>y?[...X].sort((t,s)=>{const a=t[y],l=s[y];if(a==null&&l==null)return 0;if(a==null)return 1;if(l==null)return-1;if(typeof a=="number"&&typeof l=="number")return W==="asc"?a-l:l-a;const d=String(a).toLowerCase(),o=String(l).toLowerCase();return W==="asc"?d.localeCompare(o):o.localeCompare(d)}):X,[X,y,W]),{currentPage:Ze,totalPages:et,paginatedData:Fe,goToPage:tt,itemsPerPage:st,totalItems:at}=Wt(Re,10),{selectedIds:ne,isSelected:rt,toggleItem:it,toggleAll:lt,selectAllPages:nt,deselectAll:Y,isAllSelected:ct,isAllPageSelected:dt,isAllPagesSelected:ot,isPartiallySelected:mt,selectionCount:pe,hasSelection:ut,totalItemCount:Le,pageItemCount:Be}=Xt(Fe,Re),w=j.useMemo(()=>{const t=$.filter(g=>!g.archived),s=t.length,a=t.reduce((g,Ne)=>g+Ne.totalAmount,0),l=t.reduce((g,Ne)=>g+Ne.totalReceived,0),d=t.filter(g=>g.receiptStatus==="Paid").length,o=t.filter(g=>g.receiptStatus==="Unpaid").length,m=t.filter(g=>g.receiptStatus==="Partially Paid").length,z=t.filter(g=>g.receiptStatus==="Overdue").length,Pt=t.filter(g=>g.shippingStatus==="Delivered").length,ge=new Date;ge.setDate(ge.getDate()-7);const Ot=t.filter(g=>new Date(g.createdDate)>=ge).length;return{totalSOs:s,totalValue:a,totalReceived:l,outstandingBalance:a-l,paidCount:d,unpaidCount:o,partiallyPaidCount:m,overdueCount:z,deliveredCount:Pt,newThisWeek:Ot,avgOrderValue:s>0?a/s:0,collectionRate:a>0?Math.round(l/a*100):0}},[$]),P=t=>{const s=t;y===s?W==="asc"?je("desc"):(ke(null),je("asc")):(ke(s),je("asc"))},O=t=>y===t?W:null,xt=(t,s)=>`${t}-D${String(s+1).padStart(3,"0")}`,ht=t=>{const s=ae.find(a=>a.id===t);return{itemId:s?.id??t,itemType:s?.brand??"-",itemCategory:s?.category??"-",itemSubcategory:s?.subcategory??"-"}},jt=t=>{le(t)},pt=()=>{le(null)};j.useEffect(()=>{if(n&&se){const t=se.find(s=>s.id===n.id);t&&JSON.stringify(t)!==JSON.stringify(n)?le(t):t||le(null)}},[se,n]);const ve=t=>{const s={Unpaid:{variant:"outline",className:"border-gray-500 text-gray-600"},"Partially Paid":{variant:"outline",className:"border-yellow-500 text-yellow-600"},Paid:{variant:"default",className:"bg-green-500"},Overdue:{variant:"destructive"}},{variant:a,className:l}=s[t];return e.jsx(ce,{variant:a,className:de("gap-1",l),children:t})},Z=()=>{v({soDate:new Date().toISOString().split("T")[0],customerId:"",customerName:"",customerCountry:"",customerCity:"",invoiceNumber:"",items:[],expectedDeliveryDate:"",notes:"",totalReceived:0,shippingStatus:"Pending"})},Ve=()=>{v(t=>({...t,items:[...t.items,{inventoryItemId:"",itemName:"",quantity:1,unitPrice:0,totalPrice:0}]}))},Ee=t=>{v(s=>({...s,items:s.items.filter((a,l)=>l!==t)}))},q=(t,s,a)=>{v(l=>{const d=[...l.items];if(s==="inventoryItemId"){const o=ae.find(m=>m.id===a);o&&(d[t]={...d[t],inventoryItemId:o.id,itemName:o.name,unitPrice:o.pricePerPiece,totalPrice:d[t].quantity*o.pricePerPiece})}else if(s==="quantity"){const o=Number(a)||0;d[t]={...d[t],quantity:o,totalPrice:o*d[t].unitPrice}}else if(s==="unitPrice"){const o=Number(a)||0;d[t]={...d[t],unitPrice:o,totalPrice:d[t].quantity*o}}return{...l,items:d}})},$e=t=>{const s=he.find(a=>a.id===t);v(a=>({...a,customerId:t,customerName:s?.name??"",customerCountry:s?.country??"",customerCity:s?.city??""}))},vt=async()=>{if(!r.customerId||r.items.length===0||!r.expectedDeliveryDate){x.error("Please fill in all required fields");return}try{const t=await Kt({soDate:r.soDate,customerId:r.customerId,customerName:r.customerName,customerCountry:r.customerCountry,customerCity:r.customerCity,invoiceNumber:r.invoiceNumber,items:r.items.map(s=>({...s,quantityShipped:0})),expectedDeliveryDate:r.expectedDeliveryDate,notes:r.notes,createdBy:b?.email??b?.id??"unknown",totalReceived:r.totalReceived});if(I(s=>[t,...s??[]]),x.success(`Sales Order ${t.id} created successfully`),B&&b?.email){const s=r.items.reduce((a,l)=>a+l.totalPrice,0);await Me({type:"new_sales_order",title:"New Sales Order Created",message:`${b.name||b.email} created order ${t.id} for ${r.customerName} - ${k(s)}`,salesOrderId:t.id,customerName:r.customerName,createdBy:b.email,targetRoles:["Owner","Admin"]})}ie(!1),Z()}catch(t){x.error(t instanceof Error?t.message:"Failed to create sales order")}},gt=async t=>{if(!r.customerId||r.items.length===0||!r.expectedDeliveryDate){x.error("Please fill in all required fields");return}try{const s=$.find(d=>d.id===t),a=new Map(s?.items?.map(d=>[d.inventoryItemId,d.quantityShipped??0])??[]),l=await _t({id:t,soDate:r.soDate,customerId:r.customerId,customerName:r.customerName,customerCountry:r.customerCountry,customerCity:r.customerCity,invoiceNumber:r.invoiceNumber,items:r.items.map(d=>({...d,quantityShipped:a.get(d.inventoryItemId)??0})),expectedDeliveryDate:r.expectedDeliveryDate,notes:r.notes,totalReceived:r.totalReceived,shippingStatus:r.shippingStatus});I(d=>d?.map(o=>o.id===t?l:o)??[]),x.success(`Sales Order ${t} updated successfully`),Q(null),Z()}catch(s){x.error(s instanceof Error?s.message:"Failed to update sales order")}},Nt=async t=>{try{await Mt(t),I(s=>s?.filter(a=>a.id!==t)??[]),x.success(`Sales Order ${t} deleted`),Q(null)}catch(s){x.error(s instanceof Error?s.message:"Failed to delete sales order")}},yt=async t=>{try{await Ht(t),I(s=>s?.map(a=>a.id===t?{...a,archived:!0}:a)??[]),x.success(`Sales Order ${t} archived`)}catch(s){x.error(s instanceof Error?s.message:"Failed to archive sales order")}},ft=async t=>{try{await Ut(t),I(s=>s?.map(a=>a.id===t?{...a,archived:!1}:a)??[]),x.success(`Sales Order ${t} restored`)}catch(s){x.error(s instanceof Error?s.message:"Failed to restore sales order")}},St=async()=>{try{const t=await Jt(Array.from(ne));t.success?x.success(`${t.successCount} sales orders archived`):x.warning(`${t.successCount} archived, ${t.failedCount} failed`);const s=await be();I(s),Y(),R(!1)}catch{x.error("Failed to archive sales orders")}},Ct=async()=>{try{const t=await zt(Array.from(ne));t.success?x.success(`${t.successCount} sales orders restored`):x.warning(`${t.successCount} restored, ${t.failedCount} failed`);const s=await be();I(s),Y()}catch{x.error("Failed to restore sales orders")}},qe=async()=>{try{const t=await Gt(Array.from(ne));t.success?x.success(`${t.successCount} sales orders permanently deleted`):x.warning(`${t.successCount} deleted, ${t.failedCount} failed`),I(s=>s?.filter(a=>!ne.has(a.id))??[]),Y(),R(!1)}catch{x.error("Failed to permanently delete sales orders")}},Dt=t=>{v({soDate:t.soDate??t.createdDate,customerId:t.customerId,customerName:t.customerName,customerCountry:t.customerCountry??"",customerCity:t.customerCity??"",invoiceNumber:t.invoiceNumber??"",items:(t.items??[]).map(s=>({inventoryItemId:s.inventoryItemId,itemName:s.itemName,quantity:s.quantity,unitPrice:s.unitPrice,totalPrice:s.totalPrice})),expectedDeliveryDate:t.expectedDeliveryDate??"",notes:t.notes??"",totalReceived:t.totalReceived??0,shippingStatus:t.shippingStatus??"Pending"}),Q(t.id)},bt=()=>{const t=["Date","SO ID","Customer ID","Customer Name","Invoice #","Country","City","Items","Total Amount","Total Received","SO Balance","Receipt Status","Shipping Status","Expected Delivery","Notes"],s=X.map(m=>[m.soDate??m.createdDate,m.id,m.customerId,m.customerName,m.invoiceNumber??"",m.customerCountry??"",m.customerCity??"",(m.items??[]).map(z=>`${z.itemName} (${z.quantity})`).join("; "),(m.totalAmount??0).toFixed(2),(m.totalReceived??0).toFixed(2),(m.soBalance??m.totalAmount??0).toFixed(2),m.receiptStatus,m.shippingStatus??"Pending",m.expectedDeliveryDate??"",m.notes??""]),a=[t,...s].map(m=>m.map(z=>`"${z}"`).join(",")).join(`
`),l=new Blob([a],{type:"text/csv"}),d=URL.createObjectURL(l),o=document.createElement("a");o.href=d,o.download=`sales-orders-${new Date().toISOString().split("T")[0]}.csv`,o.click(),URL.revokeObjectURL(d),x.success("Sales orders exported to CSV")},wt=()=>{Oe(""),Ae("all"),Te(!1)},K=j.useMemo(()=>r.items.reduce((t,s)=>t+s.totalPrice,0),[r.items]),It=t=>{const s={type:"sales-order",documentNumber:t.id,documentDate:t.soDate??t.createdDate,partyType:"Customer",partyName:t.customerName,partyCity:t.customerCity,partyCountry:t.customerCountry,referenceNumber:t.invoiceNumber,referenceLabel:"Invoice No.",items:t.items?.map(a=>({description:a.itemName,quantity:a.quantity,unitPrice:a.unitPrice,total:a.totalPrice}))||[],totalAmount:t.totalAmount??0,amountPaid:t.totalReceived??0,balance:t.soBalance??t.totalAmount-t.totalReceived??0,status:`${t.receiptStatus} / ${t.shippingStatus}`,expectedDeliveryDate:t.expectedDeliveryDate,notes:t.notes,createdBy:t.createdBy};_e(s)};return Qe?e.jsx("div",{className:"p-6",children:e.jsx(Yt,{rows:8})}):n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:pt,children:[e.jsx(ms,{className:"h-4 w-4 mr-1"}),"Back to List"]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Sales Order Details - ",n.id]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[n.customerName," • ",n.soDate??n.createdDate]})]})]}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>It(n),children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),"Print Invoice"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(f,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Customer"})}),e.jsxs(D,{children:[e.jsx("div",{className:"font-medium",children:n.customerName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:n.customerId})]})]}),e.jsxs(f,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Location"})}),e.jsxs(D,{children:[e.jsx("div",{className:"font-medium",children:n.customerCity||"-"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:n.customerCountry||"-"})]})]}),e.jsxs(f,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Total Amount"})}),e.jsxs(D,{children:[e.jsx("div",{className:"text-lg font-bold text-emerald-600",children:k(n.totalAmount??0)}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[n.items?.length??0," line items"]})]})]}),e.jsxs(f,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Status"})}),e.jsx(D,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[ve(n.receiptStatus),e.jsx(ce,{variant:n.shippingStatus==="Delivered"?"default":"outline",className:"w-fit mt-1",children:n.shippingStatus??"Pending"})]})})]})]}),e.jsxs(f,{children:[e.jsxs(S,{children:[e.jsx(C,{children:"Line Items"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Detailed breakdown of all items in this sales order"})]}),e.jsxs(D,{children:[!n.items||n.items.length===0?e.jsx(Ue,{icon:Ke,title:"No line items",description:"This sales order has no line items"}):e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs(oe,{children:[e.jsx(me,{children:e.jsxs(A,{children:[e.jsx(c,{children:"SO Date"}),e.jsx(c,{children:"SO ID"}),e.jsx(c,{children:"Detail ID"}),e.jsx(c,{children:"Customer ID"}),e.jsx(c,{children:"Customer Name"}),e.jsx(c,{children:"Country"}),e.jsx(c,{children:"City"}),e.jsx(c,{children:"Invoice Num"}),e.jsx(c,{children:"Item ID"}),e.jsx(c,{children:"Item Type"}),e.jsx(c,{children:"Item Category"}),e.jsx(c,{children:"Item Subcategory"}),e.jsx(c,{children:"Item Name"}),e.jsx(c,{className:"text-right",children:"QTY Sold"}),e.jsx(c,{className:"text-right",children:"Unit Price"}),e.jsx(c,{className:"text-right",children:"Total Sales Price"})]})}),e.jsx(ue,{children:n.items.map((t,s)=>{const a=ht(t.inventoryItemId);return e.jsxs(A,{children:[e.jsx(i,{className:"whitespace-nowrap",children:n.soDate??n.createdDate}),e.jsx(i,{className:"font-medium",children:n.id}),e.jsx(i,{className:"font-mono text-sm",children:xt(n.id,s)}),e.jsx(i,{className:"text-muted-foreground",children:n.customerId}),e.jsx(i,{children:n.customerName}),e.jsx(i,{children:n.customerCountry||"-"}),e.jsx(i,{children:n.customerCity||"-"}),e.jsx(i,{children:n.invoiceNumber||"-"}),e.jsx(i,{className:"font-mono text-sm",children:a.itemId}),e.jsx(i,{children:a.itemType}),e.jsx(i,{children:a.itemCategory}),e.jsx(i,{children:a.itemSubcategory}),e.jsx(i,{children:t.itemName}),e.jsx(i,{className:"text-right",children:t.quantity}),e.jsx(i,{className:"text-right",children:k(t.unitPrice)}),e.jsx(i,{className:"text-right font-medium",children:k(t.totalPrice)})]},s)})})]})}),n.items&&n.items.length>0&&e.jsx("div",{className:"mt-4 pt-4 border-t flex justify-end",children:e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Grand Total"}),e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:k(n.totalAmount??0)})]})})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Sales Orders"}),e.jsx("p",{className:"text-muted-foreground",children:"Create and manage customer orders, track payments, and monitor delivery status"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(f,{className:"relative overflow-hidden",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Total SOs"}),e.jsx(ls,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold",children:w.totalSOs}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[w.newThisWeek," new this week"]})]})]}),e.jsxs(f,{className:"relative overflow-hidden",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Total Value"}),e.jsx(ns,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:k(w.totalValue)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Avg: ",k(w.avgOrderValue)," per SO"]})]})]}),e.jsxs(f,{className:"relative overflow-hidden",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Outstanding"}),e.jsx(Ft,{className:"h-4 w-4 text-amber-600"})]}),e.jsxs(D,{children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:k(w.outstandingBalance)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[w.unpaidCount," unpaid, ",w.overdueCount," overdue"]})]})]}),e.jsxs(f,{className:"relative overflow-hidden",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Collection Rate"}),e.jsx(cs,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(D,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[w.collectionRate,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[w.paidCount," paid of ",w.totalSOs," total"]})]})]})]}),e.jsxs(f,{children:[e.jsxs(S,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(C,{children:"Sales Orders"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage customer sales orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:bt,children:[e.jsx(is,{className:"h-4 w-4 mr-1"}),"Export CSV"]}),xe&&e.jsxs(ye,{open:Xe,onOpenChange:ie,children:[e.jsx(Lt,{asChild:!0,children:e.jsxs(u,{size:"sm",children:[e.jsx(Ie,{className:"h-4 w-4 mr-1"}),"Create SO"]})}),e.jsxs(fe,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Se,{children:[e.jsx(Ce,{children:"Create Sales Order"}),e.jsx(De,{children:"Create a new sales order for a customer"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs(f,{children:[e.jsx(S,{className:"pb-3",children:e.jsx(C,{className:"text-base",children:"Sales Order Information"})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"SO Date *"}),e.jsx(h,{type:"date",value:r.soDate,onChange:t=>v(s=>({...s,soDate:t.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Customer *"}),e.jsxs(U,{value:r.customerId,onValueChange:$e,children:[e.jsx(H,{children:e.jsx(M,{placeholder:"Select customer"})}),e.jsx(_,{children:he.filter(t=>t.status==="Active").map(t=>e.jsx(F,{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Customer ID"}),e.jsx(h,{value:r.customerId,disabled:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Country"}),e.jsx(h,{value:r.customerCountry,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"City"}),e.jsx(h,{value:r.customerCity,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Invoice #"}),e.jsx(h,{value:r.invoiceNumber,onChange:t=>v(s=>({...s,invoiceNumber:t.target.value})),placeholder:"INV-2025-0001"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Expected Delivery Date *"}),e.jsx(h,{type:"date",value:r.expectedDeliveryDate,onChange:t=>v(s=>({...s,expectedDeliveryDate:t.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Total Received (₱)"}),e.jsx(h,{type:"number",min:"0",step:"0.01",value:r.totalReceived,onChange:t=>v(s=>({...s,totalReceived:parseFloat(t.target.value)||0}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Notes"}),e.jsx(h,{value:r.notes,onChange:t=>v(s=>({...s,notes:t.target.value})),placeholder:"Additional notes..."})]})]})]}),e.jsxs(f,{children:[e.jsxs(S,{className:"pb-3 flex flex-row items-center justify-between",children:[e.jsx(C,{className:"text-base",children:"Line Items"}),e.jsxs(u,{size:"sm",variant:"outline",onClick:Ve,children:[e.jsx(Ie,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),e.jsxs(D,{children:[r.items.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:'No items added. Click "Add Item" to add line items.'}):e.jsxs(oe,{children:[e.jsx(me,{children:e.jsxs(A,{children:[e.jsx(c,{children:"Item"}),e.jsx(c,{className:"w-24",children:"Qty"}),e.jsx(c,{className:"w-32",children:"Unit Price"}),e.jsx(c,{className:"w-32 text-right",children:"Total"}),e.jsx(c,{className:"w-12"})]})}),e.jsx(ue,{children:r.items.map((t,s)=>e.jsxs(A,{children:[e.jsx(i,{children:e.jsxs(U,{value:t.inventoryItemId,onValueChange:a=>q(s,"inventoryItemId",a),children:[e.jsx(H,{children:e.jsx(M,{placeholder:"Select item"})}),e.jsx(_,{children:ae.map(a=>e.jsx(F,{value:a.id,children:a.name},a.id))})]})}),e.jsx(i,{children:e.jsx(h,{type:"number",min:"1",value:t.quantity,onChange:a=>q(s,"quantity",a.target.value)})}),e.jsx(i,{children:e.jsx(h,{type:"number",min:"0",step:"0.01",value:t.unitPrice,onChange:a=>q(s,"unitPrice",a.target.value)})}),e.jsxs(i,{className:"text-right font-medium",children:["₱",t.totalPrice.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(i,{children:e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>Ee(s),children:e.jsx(G,{className:"h-4 w-4 text-destructive"})})})]},s))})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grand Total:"}),e.jsxs("span",{className:"ml-2 text-xl font-bold",children:["₱",K.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"SO Balance:"}),e.jsxs("span",{className:de("ml-2 text-xl font-bold",K-r.totalReceived>0?"text-orange-600":"text-green-600"),children:["₱",(K-r.totalReceived).toLocaleString(void 0,{minimumFractionDigits:2})]})]})]})]})]}),e.jsxs(ze,{children:[e.jsx(u,{variant:"outline",onClick:()=>{ie(!1),Z()},children:"Cancel"}),e.jsx(u,{onClick:vt,children:"Create Sales Order"})]})]})]})]})]})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(Bt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(h,{placeholder:"Search SO ID, customer, or items...",value:re,onChange:t=>Oe(t.target.value),className:"pl-10"})]}),e.jsxs(U,{value:V,onValueChange:Ae,children:[e.jsxs(H,{className:"w-48",children:[e.jsx(Zt,{className:"h-4 w-4 mr-2"}),e.jsx(M,{placeholder:"Filter by status"})]}),e.jsxs(_,{children:[e.jsx(F,{value:"all",children:"All Statuses"}),us.map(t=>e.jsx(F,{value:t,children:t},t))]})]}),e.jsxs(u,{variant:N?"default":"outline",size:"sm",onClick:()=>Te(!N),className:N?"bg-orange-500 hover:bg-orange-600 text-white":"",children:[e.jsx(ee,{className:"h-4 w-4 mr-1"}),N?"Viewing Archived":"View Archived"]}),(re||V!=="all"||N)&&e.jsxs(u,{variant:"ghost",size:"sm",onClick:wt,className:"text-muted-foreground",children:[e.jsx(Vt,{className:"h-4 w-4 mr-1"}),"Clear Filters"]})]}),ut&&te&&e.jsx(es,{selectionCount:pe,onClearSelection:Y,actions:N?[{id:"restore",label:"Restore",icon:e.jsx(He,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:Ct},...Pe?[{id:"permanent-delete",label:"Permanently Delete",icon:e.jsx(G,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>R(!0)}]:[]]:[{id:"archive",label:"Archive",icon:e.jsx(ee,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:()=>R(!0)}]}),X.length===0?e.jsx(Ue,{icon:N?ee:Ke,title:N?"No archived sales orders":"No sales orders found",description:N?"Archived sales orders will appear here":re||V!=="all"?"Try adjusting your search or filters":"Create your first sales order to get started",actionLabel:!N&&xe?"Create SO":void 0,onAction:!N&&xe?()=>ie(!0):void 0}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx(ts,{pageItemCount:Be,totalItemCount:Le,isAllPagesSelected:ot,show:dt&&Le>Be,onSelectAllPages:nt,onClearSelection:Y,itemLabel:"orders"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(oe,{children:[e.jsx(me,{children:e.jsxs(A,{children:[te&&e.jsx(c,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:ct,ref:t=>{t&&(t.indeterminate=mt)},onChange:()=>lt(),className:"h-4 w-4"})}),e.jsx(T,{sortKey:"soDate",currentSortKey:y,sortDirection:O("soDate"),onSort:P,children:"Date"}),e.jsx(T,{sortKey:"id",currentSortKey:y,sortDirection:O("id"),onSort:P,children:"SO ID"}),e.jsx(c,{children:"Customer ID"}),e.jsx(T,{sortKey:"customerName",currentSortKey:y,sortDirection:O("customerName"),onSort:P,children:"Customer Name"}),e.jsx(c,{children:"Invoice #"}),e.jsx(c,{children:"Country"}),e.jsx(c,{children:"City"}),e.jsx(T,{sortKey:"totalAmount",currentSortKey:y,sortDirection:O("totalAmount"),onSort:P,className:"text-right",children:"Total Amount"}),e.jsx(T,{sortKey:"totalReceived",currentSortKey:y,sortDirection:O("totalReceived"),onSort:P,className:"text-right",children:"Total Received"}),e.jsx(T,{sortKey:"soBalance",currentSortKey:y,sortDirection:O("soBalance"),onSort:P,className:"text-right",children:"SO Balance"}),e.jsx(T,{sortKey:"receiptStatus",currentSortKey:y,sortDirection:O("receiptStatus"),onSort:P,children:"Receipt Status"}),e.jsx(T,{sortKey:"shippingStatus",currentSortKey:y,sortDirection:O("shippingStatus"),onSort:P,children:"Shipping"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(ue,{children:Fe.map(t=>e.jsxs(A,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>Dt(t),children:[te&&e.jsx(i,{onClick:s=>s.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:rt(t.id),onChange:()=>it(t.id),className:"h-4 w-4"})}),e.jsx(i,{className:"whitespace-nowrap",children:t.soDate??t.createdDate}),e.jsx(i,{className:"font-medium",children:t.id}),e.jsx(i,{className:"text-muted-foreground",children:t.customerId}),e.jsx(i,{children:t.customerName}),e.jsx(i,{className:"text-muted-foreground",children:t.invoiceNumber||"-"}),e.jsx(i,{children:t.customerCountry||"-"}),e.jsx(i,{children:t.customerCity||"-"}),e.jsxs(i,{className:"text-right font-medium",children:["₱",(t.totalAmount??0).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs(i,{className:"text-right",children:["₱",(t.totalReceived??0).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(i,{className:"text-right font-medium",children:e.jsxs("span",{className:de((t.soBalance??t.totalAmount??0)>0?"text-orange-600":"text-green-600"),children:["₱",(t.soBalance??t.totalAmount??0).toLocaleString(void 0,{minimumFractionDigits:2})]})}),e.jsx(i,{children:ve(t.receiptStatus)}),e.jsx(i,{children:e.jsx(ce,{variant:t.shippingStatus==="Delivered"?"default":t.shippingStatus==="In Transit"||t.shippingStatus==="Shipped"?"secondary":t.shippingStatus==="Failed"||t.shippingStatus==="Returned"?"destructive":"outline",children:t.shippingStatus??"Pending"})}),e.jsx(i,{onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(u,{size:"sm",variant:"outline",onClick:()=>jt(t),title:"View Details",children:e.jsx(Et,{className:"h-4 w-4"})}),N?e.jsx(u,{size:"sm",variant:"outline",onClick:()=>ft(t.id),title:"Restore",children:e.jsx(He,{className:"h-4 w-4"})}):e.jsx(u,{size:"sm",variant:"ghost",className:"text-destructive",onClick:()=>yt(t.id),title:"Archive",children:e.jsx(ee,{className:"h-4 w-4"})})]})})]},t.id))})]})})]}),e.jsx(ss,{currentPage:Ze,totalPages:et,itemsPerPage:st,onPageChange:tt,totalItems:at})]}),E&&e.jsx(ye,{open:!!E,onOpenChange:t=>{t||(Q(null),Z())},children:e.jsxs(fe,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Se,{children:[e.jsxs(Ce,{children:["Edit Sales Order - ",E]}),e.jsx(De,{children:"Update sales order details"})]}),e.jsx("div",{className:"space-y-6 py-4",children:(()=>{const t=$.find(s=>s.id===E);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Receipt Status:"}),t&&ve(t.receiptStatus),e.jsx("span",{className:"text-sm text-muted-foreground ml-4",children:"Shipping:"}),e.jsx(ce,{variant:t?.shippingStatus==="Delivered"?"default":t?.shippingStatus==="In Transit"||t?.shippingStatus==="Shipped"?"secondary":t?.shippingStatus==="Failed"||t?.shippingStatus==="Returned"?"destructive":"outline",children:t?.shippingStatus??"Pending"})]}),e.jsxs(f,{children:[e.jsx(S,{className:"pb-3",children:e.jsx(C,{className:"text-base",children:"Sales Order Information"})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"SO Date"}),e.jsx(h,{type:"date",value:r.soDate,onChange:s=>v(a=>({...a,soDate:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Customer"}),e.jsxs(U,{value:r.customerId,onValueChange:$e,children:[e.jsx(H,{children:e.jsx(M,{placeholder:"Select customer"})}),e.jsx(_,{children:he.map(s=>e.jsx(F,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Customer ID"}),e.jsx(h,{value:r.customerId,disabled:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Country"}),e.jsx(h,{value:r.customerCountry,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"City"}),e.jsx(h,{value:r.customerCity,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Invoice #"}),e.jsx(h,{value:r.invoiceNumber,onChange:s=>v(a=>({...a,invoiceNumber:s.target.value}))})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Expected Delivery Date"}),e.jsx(h,{type:"date",value:r.expectedDeliveryDate,onChange:s=>v(a=>({...a,expectedDeliveryDate:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Total Received (₱)"}),e.jsx(h,{type:"number",min:"0",step:"0.01",value:r.totalReceived,onChange:s=>v(a=>({...a,totalReceived:parseFloat(s.target.value)||0}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Shipping Status"}),e.jsxs(U,{value:r.shippingStatus,onValueChange:s=>v(a=>({...a,shippingStatus:s})),children:[e.jsx(H,{children:e.jsx(M,{})}),e.jsx(_,{children:xs.map(s=>e.jsx(F,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Notes"}),e.jsx(h,{value:r.notes,onChange:s=>v(a=>({...a,notes:s.target.value})),placeholder:"Optional notes..."})]})]})]}),e.jsxs(f,{children:[e.jsxs(S,{className:"pb-3 flex flex-row items-center justify-between",children:[e.jsx(C,{className:"text-base",children:"Line Items"}),e.jsxs(u,{size:"sm",variant:"outline",onClick:Ve,children:[e.jsx(Ie,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),e.jsxs(D,{children:[r.items.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No items added."}):e.jsxs(oe,{children:[e.jsx(me,{children:e.jsxs(A,{children:[e.jsx(c,{children:"Item"}),e.jsx(c,{className:"w-24",children:"Qty"}),e.jsx(c,{className:"w-32",children:"Unit Price"}),e.jsx(c,{className:"w-32 text-right",children:"Total"}),e.jsx(c,{className:"w-12"})]})}),e.jsx(ue,{children:r.items.map((s,a)=>e.jsxs(A,{children:[e.jsx(i,{children:e.jsxs(U,{value:s.inventoryItemId,onValueChange:l=>q(a,"inventoryItemId",l),children:[e.jsx(H,{children:e.jsx(M,{placeholder:"Select item"})}),e.jsx(_,{children:ae.map(l=>e.jsx(F,{value:l.id,children:l.name},l.id))})]})}),e.jsx(i,{children:e.jsx(h,{type:"number",min:"1",value:s.quantity,onChange:l=>q(a,"quantity",l.target.value)})}),e.jsx(i,{children:e.jsx(h,{type:"number",min:"0",step:"0.01",value:s.unitPrice,onChange:l=>q(a,"unitPrice",l.target.value)})}),e.jsxs(i,{className:"text-right font-medium",children:["₱",s.totalPrice.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(i,{children:e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>Ee(a),children:e.jsx(G,{className:"h-4 w-4 text-destructive"})})})]},a))})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grand Total:"}),e.jsxs("span",{className:"ml-2 text-xl font-bold",children:["₱",K.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"SO Balance:"}),e.jsxs("span",{className:de("ml-2 text-xl font-bold",K-r.totalReceived>0?"text-orange-600":"text-green-600"),children:["₱",(K-r.totalReceived).toLocaleString(void 0,{minimumFractionDigits:2})]})]})]})]})]}),e.jsxs(ze,{className:"gap-2",children:[te&&e.jsxs(u,{variant:"destructive",onClick:()=>Nt(E),children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Delete"]}),e.jsx(u,{variant:"outline",onClick:()=>{Q(null),Z()},children:"Cancel"}),e.jsx(u,{onClick:()=>gt(E),children:"Save Changes"})]})]})})()})]})})]})]}),e.jsx(ye,{open:Ye,onOpenChange:R,children:e.jsxs(fe,{className:"max-w-md",children:[e.jsxs(Se,{children:[e.jsxs(Ce,{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"h-5 w-5 text-destructive"}),"Delete ",pe," Sales Order",pe!==1?"s":""]}),e.jsx(De,{children:N?"These sales orders are already archived. This action will permanently remove them from the system.":"Choose how you want to delete the selected sales orders:"})]}),N?e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("div",{className:"p-3 border border-destructive/50 rounded-md bg-destructive/10",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(G,{className:"h-4 w-4 mt-0.5 text-destructive"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-destructive",children:"Permanent Deletion"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This cannot be undone. All data will be permanently removed."})]})]})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(u,{variant:"outline",onClick:()=>R(!1),children:"Cancel"}),e.jsx(u,{variant:"destructive",onClick:qe,children:"Permanently Delete All"})]})]}):e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("div",{className:"p-3 border rounded-md hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ee,{className:"h-4 w-4 mt-0.5 text-muted-foreground"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Archive"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Move to archive. Sales orders can be restored later."})]}),e.jsx(u,{variant:"secondary",size:"sm",onClick:St,children:"Archive"})]})}),Pe&&e.jsx("div",{className:"p-3 border border-destructive/50 rounded-md bg-destructive/10",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(G,{className:"h-4 w-4 mt-0.5 text-destructive"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-destructive",children:"Delete Permanently"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cannot be undone. Data will be permanently removed."})]}),e.jsx(u,{variant:"destructive",size:"sm",onClick:qe,children:"Delete"})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(u,{variant:"outline",onClick:()=>R(!1),children:"Cancel"})})]})]})})]})}export{bs as SalesOrdersView};
