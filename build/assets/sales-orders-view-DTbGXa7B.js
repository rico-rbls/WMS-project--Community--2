import{i as ht,r as x,H as xt,j as e,C as f,m as C,n as D,o as b,X as jt,B as g,D as Ie,Y as pt,v as Pe,w as Oe,x as Te,y as Ae,L as u,I as o,d as te,z as Re,_ as vt,Z as gt,S as yt,t as de,aC as me,aD as Nt,an as St,K as c,aE as ft,aF as Ct,aG as Dt,aH as bt,aI as wt,aJ as It,aK as Pt,aL as Ot}from"./index-DAmY26jO.js";import{g as Tt,h as ue}from"./permissions-BqDqHH54.js";import{u as At,a as Rt,T as kt,P as he,F as Ft,B as Lt,E as Bt,c as Et,b as Vt}from"./bulk-delete-dialog-BqmtpdJ-.js";import{S as L,a as B,b as E,c as V,d as O,e as xe,f as je,g as $,h as v,j as pe,k as l,T as se,i as P}from"./sortable-table-head-CHnmQFwl.js";import{F as $t}from"./file-text-ClEMYgQm.js";import{D as Kt}from"./dollar-sign-9c8enFQA.js";import{T as qt}from"./trending-up-9pz2FEDO.js";import{D as Ut}from"./download-D_1nE-Co.js";import{A as ae,a as ke}from"./archive-RiWFCdTQ.js";import"./skeleton-BhBBfVPx.js";const zt=["Unpaid","Partially Paid","Paid","Overdue"],Ht=["Pending","Processing","Shipped","In Transit","Out for Delivery","Delivered","Failed","Returned"],ve=K=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(K);function ts(){const{user:K}=ht(),q=K?Tt(K.id):"Viewer",re=ue(q,"purchase_orders:create");ue(q,"purchase_orders:update");const Q=ue(q,"purchase_orders:delete"),Fe=q==="Owner"||q==="Admin",[Le,S]=x.useState(null),[ie,Be]=x.useState([]),[le,Ee]=x.useState([]),[Ve,$e]=x.useState(!0),[X,ge]=x.useState(""),U=xt(X,300),[T,ye]=x.useState("all"),[h,Ne]=x.useState(!1),[Ke,Y]=x.useState(!1),[A,z]=x.useState(null),[qe,H]=x.useState(!1),[y,Se]=x.useState(null),[_,ne]=x.useState("asc"),[r,j]=x.useState({soDate:new Date().toISOString().split("T")[0],customerId:"",customerName:"",customerCountry:"",customerCity:"",invoiceNumber:"",items:[],expectedDeliveryDate:"",notes:"",totalReceived:0,shippingStatus:"Pending"});x.useEffect(()=>{(async()=>{try{const[s,a,i]=await Promise.all([me(),Nt(),St()]);S(s),Be(a),Ee(i)}catch{c.error("Failed to load data")}finally{$e(!1)}})()},[]);const M=Le??[],G=x.useMemo(()=>M.filter(t=>{const s=t.archived===!0;if(h!==s)return!1;const a=!U||t.id.toLowerCase().includes(U.toLowerCase())||t.customerName.toLowerCase().includes(U.toLowerCase())||t.items.some(d=>d.itemName.toLowerCase().includes(U.toLowerCase())),i=T==="all"||t.receiptStatus===T;return a&&i}),[M,U,T,h]),Ue=x.useMemo(()=>y?[...G].sort((t,s)=>{const a=t[y],i=s[y];if(a==null&&i==null)return 0;if(a==null)return 1;if(i==null)return-1;if(typeof a=="number"&&typeof i=="number")return _==="asc"?a-i:i-a;const d=String(a).toLowerCase(),m=String(i).toLowerCase();return _==="asc"?d.localeCompare(m):m.localeCompare(d)}):G,[G,y,_]),{currentPage:ze,totalPages:He,paginatedData:fe,goToPage:_e,itemsPerPage:Me,totalItems:Ge}=At(Ue,10),{selectedIds:J,isSelected:We,toggleItem:Qe,toggleAll:Xe,deselectAll:Z,isAllSelected:Ye,isPartiallySelected:Je,selectionCount:ee,hasSelection:Ze}=Rt(fe.map(t=>t.id)),N=x.useMemo(()=>{const t=M.filter(p=>!p.archived),s=t.length,a=t.reduce((p,oe)=>p+oe.totalAmount,0),i=t.reduce((p,oe)=>p+oe.totalReceived,0),d=t.filter(p=>p.receiptStatus==="Paid").length,m=t.filter(p=>p.receiptStatus==="Unpaid").length,n=t.filter(p=>p.receiptStatus==="Partially Paid").length,F=t.filter(p=>p.receiptStatus==="Overdue").length,mt=t.filter(p=>p.shippingStatus==="Delivered").length,ce=new Date;ce.setDate(ce.getDate()-7);const ut=t.filter(p=>new Date(p.createdDate)>=ce).length;return{totalSOs:s,totalValue:a,totalReceived:i,outstandingBalance:a-i,paidCount:d,unpaidCount:m,partiallyPaidCount:n,overdueCount:F,deliveredCount:mt,newThisWeek:ut,avgOrderValue:s>0?a/s:0,collectionRate:a>0?Math.round(i/a*100):0}},[M]),w=t=>{const s=t;y===s?_==="asc"?ne("desc"):(Se(null),ne("asc")):(Se(s),ne("asc"))},I=t=>y===t?_:null,Ce=t=>{const s={Unpaid:{variant:"outline",className:"border-gray-500 text-gray-600"},"Partially Paid":{variant:"outline",className:"border-yellow-500 text-yellow-600"},Paid:{variant:"default",className:"bg-green-500"},Overdue:{variant:"destructive"}},{variant:a,className:i}=s[t];return e.jsx(de,{variant:a,className:te("gap-1",i),children:t})},W=()=>{j({soDate:new Date().toISOString().split("T")[0],customerId:"",customerName:"",customerCountry:"",customerCity:"",invoiceNumber:"",items:[],expectedDeliveryDate:"",notes:"",totalReceived:0,shippingStatus:"Pending"})},De=()=>{j(t=>({...t,items:[...t.items,{inventoryItemId:"",itemName:"",quantity:1,unitPrice:0,totalPrice:0}]}))},be=t=>{j(s=>({...s,items:s.items.filter((a,i)=>i!==t)}))},R=(t,s,a)=>{j(i=>{const d=[...i.items];if(s==="inventoryItemId"){const m=le.find(n=>n.id===a);m&&(d[t]={...d[t],inventoryItemId:m.id,itemName:m.name,unitPrice:m.pricePerPiece,totalPrice:d[t].quantity*m.pricePerPiece})}else if(s==="quantity"){const m=Number(a)||0;d[t]={...d[t],quantity:m,totalPrice:m*d[t].unitPrice}}else if(s==="unitPrice"){const m=Number(a)||0;d[t]={...d[t],unitPrice:m,totalPrice:d[t].quantity*m}}return{...i,items:d}})},we=t=>{const s=ie.find(a=>a.id===t);j(a=>({...a,customerId:t,customerName:s?.name??"",customerCountry:s?.country??"",customerCity:s?.city??""}))},et=async()=>{if(!r.customerId||r.items.length===0||!r.expectedDeliveryDate){c.error("Please fill in all required fields");return}try{const t=await ft({soDate:r.soDate,customerId:r.customerId,customerName:r.customerName,customerCountry:r.customerCountry,customerCity:r.customerCity,invoiceNumber:r.invoiceNumber,items:r.items.map(s=>({...s,quantityShipped:0})),expectedDeliveryDate:r.expectedDeliveryDate,notes:r.notes,createdBy:K?.id??"1",totalReceived:r.totalReceived});S(s=>[t,...s??[]]),c.success(`Sales Order ${t.id} created successfully`),Y(!1),W()}catch(t){c.error(t instanceof Error?t.message:"Failed to create sales order")}},tt=async t=>{if(!r.customerId||r.items.length===0||!r.expectedDeliveryDate){c.error("Please fill in all required fields");return}try{const s=await It({id:t,soDate:r.soDate,customerId:r.customerId,customerName:r.customerName,customerCountry:r.customerCountry,customerCity:r.customerCity,invoiceNumber:r.invoiceNumber,items:r.items.map(a=>({...a,quantityShipped:0})),expectedDeliveryDate:r.expectedDeliveryDate,notes:r.notes,totalReceived:r.totalReceived,shippingStatus:r.shippingStatus});S(a=>a?.map(i=>i.id===t?s:i)??[]),c.success(`Sales Order ${t} updated successfully`),z(null),W()}catch(s){c.error(s instanceof Error?s.message:"Failed to update sales order")}},st=async t=>{try{await wt(t),S(s=>s?.filter(a=>a.id!==t)??[]),c.success(`Sales Order ${t} deleted`),z(null)}catch(s){c.error(s instanceof Error?s.message:"Failed to delete sales order")}},at=async t=>{try{await bt(t),S(s=>s?.map(a=>a.id===t?{...a,archived:!0}:a)??[]),c.success(`Sales Order ${t} archived`)}catch(s){c.error(s instanceof Error?s.message:"Failed to archive sales order")}},rt=async t=>{try{await Dt(t),S(s=>s?.map(a=>a.id===t?{...a,archived:!1}:a)??[]),c.success(`Sales Order ${t} restored`)}catch(s){c.error(s instanceof Error?s.message:"Failed to restore sales order")}},it=async()=>{try{const t=await Ot(Array.from(J));t.success?c.success(`${t.successCount} sales orders archived`):c.warning(`${t.successCount} archived, ${t.failedCount} failed`);const s=await me();S(s),Z(),H(!1)}catch{c.error("Failed to archive sales orders")}},lt=async()=>{try{const t=await Ct(Array.from(J));t.success?c.success(`${t.successCount} sales orders restored`):c.warning(`${t.successCount} restored, ${t.failedCount} failed`);const s=await me();S(s),Z()}catch{c.error("Failed to restore sales orders")}},nt=async()=>{try{const t=await Pt(Array.from(J));t.success?c.success(`${t.successCount} sales orders permanently deleted`):c.warning(`${t.successCount} deleted, ${t.failedCount} failed`),S(s=>s?.filter(a=>!J.has(a.id))??[]),Z(),H(!1)}catch{c.error("Failed to permanently delete sales orders")}},ct=t=>{j({soDate:t.soDate??t.createdDate,customerId:t.customerId,customerName:t.customerName,customerCountry:t.customerCountry??"",customerCity:t.customerCity??"",invoiceNumber:t.invoiceNumber??"",items:(t.items??[]).map(s=>({inventoryItemId:s.inventoryItemId,itemName:s.itemName,quantity:s.quantity,unitPrice:s.unitPrice,totalPrice:s.totalPrice})),expectedDeliveryDate:t.expectedDeliveryDate??"",notes:t.notes??"",totalReceived:t.totalReceived??0,shippingStatus:t.shippingStatus??"Pending"}),z(t.id)},ot=()=>{const t=["Date","SO ID","Customer ID","Customer Name","Invoice #","Country","City","Items","Total Amount","Total Received","SO Balance","Receipt Status","Shipping Status","Expected Delivery","Notes"],s=G.map(n=>[n.soDate??n.createdDate,n.id,n.customerId,n.customerName,n.invoiceNumber??"",n.customerCountry??"",n.customerCity??"",(n.items??[]).map(F=>`${F.itemName} (${F.quantity})`).join("; "),(n.totalAmount??0).toFixed(2),(n.totalReceived??0).toFixed(2),(n.soBalance??n.totalAmount??0).toFixed(2),n.receiptStatus,n.shippingStatus??"Pending",n.expectedDeliveryDate??"",n.notes??""]),a=[t,...s].map(n=>n.map(F=>`"${F}"`).join(",")).join(`
`),i=new Blob([a],{type:"text/csv"}),d=URL.createObjectURL(i),m=document.createElement("a");m.href=d,m.download=`sales-orders-${new Date().toISOString().split("T")[0]}.csv`,m.click(),URL.revokeObjectURL(d),c.success("Sales orders exported to CSV")},dt=()=>{ge(""),ye("all"),Ne(!1)},k=x.useMemo(()=>r.items.reduce((t,s)=>t+s.totalPrice,0),[r.items]);return Ve?e.jsx("div",{className:"p-6",children:e.jsx(kt,{rows:8})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(f,{className:"relative overflow-hidden",children:[e.jsxs(C,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"Total SOs"}),e.jsx($t,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:N.totalSOs}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[N.newThisWeek," new this week"]})]})]}),e.jsxs(f,{className:"relative overflow-hidden",children:[e.jsxs(C,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"Total Value"}),e.jsx(Kt,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:ve(N.totalValue)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Avg: ",ve(N.avgOrderValue)," per SO"]})]})]}),e.jsxs(f,{className:"relative overflow-hidden",children:[e.jsxs(C,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"Outstanding"}),e.jsx(jt,{className:"h-4 w-4 text-amber-600"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:ve(N.outstandingBalance)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[N.unpaidCount," unpaid, ",N.overdueCount," overdue"]})]})]}),e.jsxs(f,{className:"relative overflow-hidden",children:[e.jsxs(C,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"Collection Rate"}),e.jsx(qt,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[N.collectionRate,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[N.paidCount," paid of ",N.totalSOs," total"]})]})]})]}),e.jsxs(f,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(D,{children:"Sales Orders"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage customer sales orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:ot,children:[e.jsx(Ut,{className:"h-4 w-4 mr-1"}),"Export CSV"]}),re&&e.jsxs(Ie,{open:Ke,onOpenChange:Y,children:[e.jsx(pt,{asChild:!0,children:e.jsxs(g,{size:"sm",children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"Create SO"]})}),e.jsxs(Pe,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Oe,{children:[e.jsx(Te,{children:"Create Sales Order"}),e.jsx(Ae,{children:"Create a new sales order for a customer"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs(f,{children:[e.jsx(C,{className:"pb-3",children:e.jsx(D,{className:"text-base",children:"Sales Order Information"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"SO Date *"}),e.jsx(o,{type:"date",value:r.soDate,onChange:t=>j(s=>({...s,soDate:t.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Customer *"}),e.jsxs(L,{value:r.customerId,onValueChange:we,children:[e.jsx(B,{children:e.jsx(E,{placeholder:"Select customer"})}),e.jsx(V,{children:ie.filter(t=>t.status==="Active").map(t=>e.jsx(O,{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Customer ID"}),e.jsx(o,{value:r.customerId,disabled:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Country"}),e.jsx(o,{value:r.customerCountry,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"City"}),e.jsx(o,{value:r.customerCity,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Invoice #"}),e.jsx(o,{value:r.invoiceNumber,onChange:t=>j(s=>({...s,invoiceNumber:t.target.value})),placeholder:"INV-2025-0001"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Expected Delivery Date *"}),e.jsx(o,{type:"date",value:r.expectedDeliveryDate,onChange:t=>j(s=>({...s,expectedDeliveryDate:t.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Total Received (₱)"}),e.jsx(o,{type:"number",min:"0",step:"0.01",value:r.totalReceived,onChange:t=>j(s=>({...s,totalReceived:parseFloat(t.target.value)||0}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Notes"}),e.jsx(o,{value:r.notes,onChange:t=>j(s=>({...s,notes:t.target.value})),placeholder:"Additional notes..."})]})]})]}),e.jsxs(f,{children:[e.jsxs(C,{className:"pb-3 flex flex-row items-center justify-between",children:[e.jsx(D,{className:"text-base",children:"Line Items"}),e.jsxs(g,{size:"sm",variant:"outline",onClick:De,children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),e.jsxs(b,{children:[r.items.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:'No items added. Click "Add Item" to add line items.'}):e.jsxs(xe,{children:[e.jsx(je,{children:e.jsxs($,{children:[e.jsx(v,{children:"Item"}),e.jsx(v,{className:"w-24",children:"Qty"}),e.jsx(v,{className:"w-32",children:"Unit Price"}),e.jsx(v,{className:"w-32 text-right",children:"Total"}),e.jsx(v,{className:"w-12"})]})}),e.jsx(pe,{children:r.items.map((t,s)=>e.jsxs($,{children:[e.jsx(l,{children:e.jsxs(L,{value:t.inventoryItemId,onValueChange:a=>R(s,"inventoryItemId",a),children:[e.jsx(B,{children:e.jsx(E,{placeholder:"Select item"})}),e.jsx(V,{children:le.map(a=>e.jsx(O,{value:a.id,children:a.name},a.id))})]})}),e.jsx(l,{children:e.jsx(o,{type:"number",min:"1",value:t.quantity,onChange:a=>R(s,"quantity",a.target.value)})}),e.jsx(l,{children:e.jsx(o,{type:"number",min:"0",step:"0.01",value:t.unitPrice,onChange:a=>R(s,"unitPrice",a.target.value)})}),e.jsxs(l,{className:"text-right font-medium",children:["₱",t.totalPrice.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(l,{children:e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>be(s),children:e.jsx(se,{className:"h-4 w-4 text-destructive"})})})]},s))})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grand Total:"}),e.jsxs("span",{className:"ml-2 text-xl font-bold",children:["₱",k.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"SO Balance:"}),e.jsxs("span",{className:te("ml-2 text-xl font-bold",k-r.totalReceived>0?"text-orange-600":"text-green-600"),children:["₱",(k-r.totalReceived).toLocaleString(void 0,{minimumFractionDigits:2})]})]})]})]})]}),e.jsxs(Re,{children:[e.jsx(g,{variant:"outline",onClick:()=>{Y(!1),W()},children:"Cancel"}),e.jsx(g,{onClick:et,children:"Create Sales Order"})]})]})]})]})]})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(vt,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(o,{placeholder:"Search SO ID, customer, or items...",value:X,onChange:t=>ge(t.target.value),className:"pl-10"})]}),e.jsxs(L,{value:T,onValueChange:ye,children:[e.jsxs(B,{className:"w-48",children:[e.jsx(Ft,{className:"h-4 w-4 mr-2"}),e.jsx(E,{placeholder:"Filter by status"})]}),e.jsxs(V,{children:[e.jsx(O,{value:"all",children:"All Statuses"}),zt.map(t=>e.jsx(O,{value:t,children:t},t))]})]}),e.jsxs(g,{variant:h?"default":"outline",size:"sm",onClick:()=>Ne(!h),className:h?"bg-orange-500 hover:bg-orange-600 text-white":"",children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),h?"Viewing Archived":"View Archived"]}),(X||T!=="all"||h)&&e.jsxs(g,{variant:"ghost",size:"sm",onClick:dt,className:"text-muted-foreground",children:[e.jsx(gt,{className:"h-4 w-4 mr-1"}),"Clear Filters"]})]}),Ze&&Q&&e.jsx(Lt,{selectionCount:ee,onClearSelection:Z,actions:h?[{id:"restore",label:"Restore",icon:e.jsx(ke,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:lt},...Fe?[{id:"permanent-delete",label:"Permanently Delete",icon:e.jsx(se,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>H(!0)}]:[]]:[{id:"archive",label:"Archive",icon:e.jsx(ae,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:()=>H(!0)}]}),G.length===0?e.jsx(Bt,{icon:h?ae:yt,title:h?"No archived sales orders":"No sales orders found",description:h?"Archived sales orders will appear here":X||T!=="all"?"Try adjusting your search or filters":"Create your first sales order to get started",actionLabel:!h&&re?"Create SO":void 0,onAction:!h&&re?()=>Y(!0):void 0}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs(xe,{children:[e.jsx(je,{children:e.jsxs($,{children:[Q&&e.jsx(v,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:Ye,ref:t=>{t&&(t.indeterminate=Je)},onChange:()=>Xe(),className:"h-4 w-4"})}),e.jsx(P,{sortKey:"soDate",currentSortKey:y,sortDirection:I("soDate"),onSort:w,children:"Date"}),e.jsx(P,{sortKey:"id",currentSortKey:y,sortDirection:I("id"),onSort:w,children:"SO ID"}),e.jsx(v,{children:"Customer ID"}),e.jsx(P,{sortKey:"customerName",currentSortKey:y,sortDirection:I("customerName"),onSort:w,children:"Customer Name"}),e.jsx(v,{children:"Invoice #"}),e.jsx(v,{children:"Country"}),e.jsx(v,{children:"City"}),e.jsx(P,{sortKey:"totalAmount",currentSortKey:y,sortDirection:I("totalAmount"),onSort:w,className:"text-right",children:"Total Amount"}),e.jsx(P,{sortKey:"totalReceived",currentSortKey:y,sortDirection:I("totalReceived"),onSort:w,className:"text-right",children:"Total Received"}),e.jsx(P,{sortKey:"soBalance",currentSortKey:y,sortDirection:I("soBalance"),onSort:w,className:"text-right",children:"SO Balance"}),e.jsx(P,{sortKey:"receiptStatus",currentSortKey:y,sortDirection:I("receiptStatus"),onSort:w,children:"Receipt Status"}),e.jsx(P,{sortKey:"shippingStatus",currentSortKey:y,sortDirection:I("shippingStatus"),onSort:w,children:"Shipping"}),e.jsx(v,{children:"Actions"})]})}),e.jsx(pe,{children:fe.map(t=>e.jsxs($,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>ct(t),children:[Q&&e.jsx(l,{onClick:s=>s.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:We(t.id),onChange:()=>Qe(t.id),className:"h-4 w-4"})}),e.jsx(l,{className:"whitespace-nowrap",children:t.soDate??t.createdDate}),e.jsx(l,{className:"font-medium",children:t.id}),e.jsx(l,{className:"text-muted-foreground",children:t.customerId}),e.jsx(l,{children:t.customerName}),e.jsx(l,{className:"text-muted-foreground",children:t.invoiceNumber||"-"}),e.jsx(l,{children:t.customerCountry||"-"}),e.jsx(l,{children:t.customerCity||"-"}),e.jsxs(l,{className:"text-right font-medium",children:["₱",(t.totalAmount??0).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs(l,{className:"text-right",children:["₱",(t.totalReceived??0).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(l,{className:"text-right font-medium",children:e.jsxs("span",{className:te((t.soBalance??t.totalAmount??0)>0?"text-orange-600":"text-green-600"),children:["₱",(t.soBalance??t.totalAmount??0).toLocaleString(void 0,{minimumFractionDigits:2})]})}),e.jsx(l,{children:Ce(t.receiptStatus)}),e.jsx(l,{children:e.jsx(de,{variant:t.shippingStatus==="Delivered"?"default":t.shippingStatus==="In Transit"||t.shippingStatus==="Shipped"?"secondary":t.shippingStatus==="Failed"||t.shippingStatus==="Returned"?"destructive":"outline",children:t.shippingStatus??"Pending"})}),e.jsx(l,{onClick:s=>s.stopPropagation(),children:e.jsx("div",{className:"flex gap-1",children:h?e.jsx(g,{size:"sm",variant:"outline",onClick:()=>rt(t.id),title:"Restore",children:e.jsx(ke,{className:"h-4 w-4"})}):e.jsx(g,{size:"sm",variant:"ghost",className:"text-destructive",onClick:()=>at(t.id),title:"Archive",children:e.jsx(ae,{className:"h-4 w-4"})})})})]},t.id))})]})}),e.jsx(Et,{currentPage:ze,totalPages:He,itemsPerPage:Me,onPageChange:_e,totalItems:Ge})]}),A&&e.jsx(Ie,{open:!!A,onOpenChange:t=>{t||(z(null),W())},children:e.jsxs(Pe,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Oe,{children:[e.jsxs(Te,{children:["Edit Sales Order - ",A]}),e.jsx(Ae,{children:"Update sales order details"})]}),e.jsx("div",{className:"space-y-6 py-4",children:(()=>{const t=M.find(s=>s.id===A);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Receipt Status:"}),t&&Ce(t.receiptStatus),e.jsx("span",{className:"text-sm text-muted-foreground ml-4",children:"Shipping:"}),e.jsx(de,{variant:t?.shippingStatus==="Delivered"?"default":t?.shippingStatus==="In Transit"||t?.shippingStatus==="Shipped"?"secondary":t?.shippingStatus==="Failed"||t?.shippingStatus==="Returned"?"destructive":"outline",children:t?.shippingStatus??"Pending"})]}),e.jsxs(f,{children:[e.jsx(C,{className:"pb-3",children:e.jsx(D,{className:"text-base",children:"Sales Order Information"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"SO Date"}),e.jsx(o,{type:"date",value:r.soDate,onChange:s=>j(a=>({...a,soDate:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Customer"}),e.jsxs(L,{value:r.customerId,onValueChange:we,children:[e.jsx(B,{children:e.jsx(E,{placeholder:"Select customer"})}),e.jsx(V,{children:ie.map(s=>e.jsx(O,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Customer ID"}),e.jsx(o,{value:r.customerId,disabled:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Country"}),e.jsx(o,{value:r.customerCountry,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"City"}),e.jsx(o,{value:r.customerCity,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Invoice #"}),e.jsx(o,{value:r.invoiceNumber,onChange:s=>j(a=>({...a,invoiceNumber:s.target.value}))})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Expected Delivery Date"}),e.jsx(o,{type:"date",value:r.expectedDeliveryDate,onChange:s=>j(a=>({...a,expectedDeliveryDate:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Total Received (₱)"}),e.jsx(o,{type:"number",min:"0",step:"0.01",value:r.totalReceived,onChange:s=>j(a=>({...a,totalReceived:parseFloat(s.target.value)||0}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Shipping Status"}),e.jsxs(L,{value:r.shippingStatus,onValueChange:s=>j(a=>({...a,shippingStatus:s})),children:[e.jsx(B,{children:e.jsx(E,{})}),e.jsx(V,{children:Ht.map(s=>e.jsx(O,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Notes"}),e.jsx(o,{value:r.notes,onChange:s=>j(a=>({...a,notes:s.target.value})),placeholder:"Optional notes..."})]})]})]}),e.jsxs(f,{children:[e.jsxs(C,{className:"pb-3 flex flex-row items-center justify-between",children:[e.jsx(D,{className:"text-base",children:"Line Items"}),e.jsxs(g,{size:"sm",variant:"outline",onClick:De,children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"Add Item"]})]}),e.jsxs(b,{children:[r.items.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No items added."}):e.jsxs(xe,{children:[e.jsx(je,{children:e.jsxs($,{children:[e.jsx(v,{children:"Item"}),e.jsx(v,{className:"w-24",children:"Qty"}),e.jsx(v,{className:"w-32",children:"Unit Price"}),e.jsx(v,{className:"w-32 text-right",children:"Total"}),e.jsx(v,{className:"w-12"})]})}),e.jsx(pe,{children:r.items.map((s,a)=>e.jsxs($,{children:[e.jsx(l,{children:e.jsxs(L,{value:s.inventoryItemId,onValueChange:i=>R(a,"inventoryItemId",i),children:[e.jsx(B,{children:e.jsx(E,{placeholder:"Select item"})}),e.jsx(V,{children:le.map(i=>e.jsx(O,{value:i.id,children:i.name},i.id))})]})}),e.jsx(l,{children:e.jsx(o,{type:"number",min:"1",value:s.quantity,onChange:i=>R(a,"quantity",i.target.value)})}),e.jsx(l,{children:e.jsx(o,{type:"number",min:"0",step:"0.01",value:s.unitPrice,onChange:i=>R(a,"unitPrice",i.target.value)})}),e.jsxs(l,{className:"text-right font-medium",children:["₱",s.totalPrice.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(l,{children:e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>be(a),children:e.jsx(se,{className:"h-4 w-4 text-destructive"})})})]},a))})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Grand Total:"}),e.jsxs("span",{className:"ml-2 text-xl font-bold",children:["₱",k.toLocaleString(void 0,{minimumFractionDigits:2})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"SO Balance:"}),e.jsxs("span",{className:te("ml-2 text-xl font-bold",k-r.totalReceived>0?"text-orange-600":"text-green-600"),children:["₱",(k-r.totalReceived).toLocaleString(void 0,{minimumFractionDigits:2})]})]})]})]})]}),e.jsxs(Re,{className:"gap-2",children:[Q&&e.jsxs(g,{variant:"destructive",onClick:()=>st(A),children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"Delete"]}),e.jsx(g,{variant:"outline",onClick:()=>{z(null),W()},children:"Cancel"}),e.jsx(g,{onClick:()=>tt(A),children:"Save Changes"})]})]})})()})]})})]})]}),e.jsx(Vt,{open:qe,onOpenChange:H,itemCount:ee,itemType:"sales order",onConfirm:h?nt:it,title:h?"Permanently Delete Sales Orders?":"Archive Sales Orders?",description:h?`This will permanently delete ${ee} sales order(s). This action cannot be undone.`:`This will archive ${ee} sales order(s). You can restore them later from the archived view.`,confirmLabel:h?"Permanently Delete":"Archive"})]})}export{ts as SalesOrdersView};
