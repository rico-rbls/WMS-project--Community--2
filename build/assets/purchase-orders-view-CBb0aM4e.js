import{c as Se,f as ns,r as l,j as e,B as d,L as o,I as m,W as cs,X as fe,P as De,i as ls,Y as ds,Z as os,t as c,_ as us,s as ms,$ as hs,a0 as ps,a1 as xs,a2 as vs,a3 as js,a4 as ys,a5 as gs,a6 as Ns,a7 as fs}from"./index-BbQSPos2.js";import{u as Ds,D as Z,j as Cs,a as G,b as J,c as ee,d as se,S as T,e as E,f as q,g as $,h as S,T as te,k as Ps,l as Ss,m as bs,n as Ce,o as ae,p as b,q as Is,r as y}from"./sortable-table-head-Dcn1n-EY.js";import{a as ws,u as Os,T as ks,P as re,B as As,E as Rs,c as Fs,b as Ts}from"./bulk-delete-dialog-CG6FgPQu.js";import{g as Es,h as V}from"./permissions-BcPR9JhQ.js";import{F as qs}from"./funnel-BP5-pCtK.js";import{S as Pe}from"./shopping-bag-CnvKUIYU.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],Ls=Se("download",$s);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Ks=Se("send",Bs),Us=["Draft","Pending Approval","Approved","Rejected","Ordered","Partially Received","Received","Cancelled"];function Ws({initialOpenDialog:ie,onDialogOpened:ne,prefilledItem:j}){const{user:I}=ns(),L=I?Es(I.id):"user",_=V(L,"purchase_orders:create"),be=V(L,"purchase_orders:approve"),Ie=V(L,"purchase_orders:receive"),B=V(L,"purchase_orders:delete"),[z,we]=l.useState(""),[w,Oe]=l.useState("all"),[ce,x]=l.useState(null),[O,ke]=l.useState([]),[M,Ae]=l.useState([]),[Re,Fe]=l.useState(!0),[H,g]=l.useState(!1),[N,k]=l.useState(null),[A,K]=l.useState(null),[h,le]=l.useState(null),[R,Q]=l.useState("asc"),[n,v]=l.useState({supplierId:"",supplierName:"",items:[],expectedDeliveryDate:"",notes:""}),[de,oe]=l.useState({}),[ue,me]=l.useState(void 0),[Te,W]=l.useState(!1),X=Ds(z,300),F=l.useMemo(()=>ce??[],[ce]),{selectedIds:he,toggleItem:Ee,toggleAll:qe,isSelected:$e,isAllSelected:Le,isPartiallySelected:Be,selectionCount:pe,hasSelection:Ke,deselectAll:xe}=ws(F);l.useEffect(()=>{async function s(){try{const[t,a,r]=await Promise.all([ls(),ds(),os()]);x(t),ke(a.filter(i=>i.status==="Active")),Ae(r)}catch{c.error("Failed to load data")}finally{Fe(!1)}}s()},[]),l.useEffect(()=>{j&&O.length>0&&(v({supplierId:j.supplierId,supplierName:j.supplierName,items:[{inventoryItemId:j.inventoryItemId,itemName:j.itemName,quantity:j.quantity,unitPrice:j.unitPrice,totalPrice:j.quantity*j.unitPrice}],expectedDeliveryDate:new Date(Date.now()+10080*60*1e3).toISOString().split("T")[0],notes:""}),g(!0))},[j,O]),l.useEffect(()=>{ie&&!H&&(g(!0),ne?.())},[ie,ne,H]);const Y=l.useMemo(()=>{let s=F;if(X){const t=X.toLowerCase();s=s.filter(a=>a.id.toLowerCase().includes(t)||a.supplierName.toLowerCase().includes(t)||(a.items??[]).some(r=>r.itemName.toLowerCase().includes(t)))}return w!=="all"&&(s=s.filter(t=>t.status===w)),h&&(s=[...s].sort((t,a)=>{const r=t[h],i=a[h];return r==null?1:i==null?-1:typeof r=="string"&&typeof i=="string"?R==="asc"?r.localeCompare(i):i.localeCompare(r):typeof r=="number"&&typeof i=="number"?R==="asc"?r-i:i-r:0})),s},[F,X,w,h,R]),{paginatedData:Ue,currentPage:Ve,totalPages:_e,goToPage:ze,itemsPerPage:Me,totalItems:He}=Os(Y,10),f=s=>{const t=s;h===t?R==="asc"?Q("desc"):(le(null),Q("asc")):(le(t),Q("asc"))},D=s=>h===s?R:null,ve=s=>{const t={Draft:{variant:"secondary"},"Pending Approval":{variant:"outline",className:"border-yellow-500 text-yellow-600"},Approved:{variant:"outline",className:"border-blue-500 text-blue-600"},Rejected:{variant:"destructive"},Ordered:{variant:"outline",className:"border-purple-500 text-purple-600"},"Partially Received":{variant:"outline",className:"border-orange-500 text-orange-600"},Received:{variant:"default",className:"bg-green-500"},Cancelled:{variant:"secondary",className:"text-gray-500"}},{variant:a,className:r}=t[s];return e.jsx(ms,{variant:a,className:r,children:s})},C=()=>{v({supplierId:"",supplierName:"",items:[],expectedDeliveryDate:"",notes:""})},je=()=>{v(s=>({...s,items:[...s.items,{inventoryItemId:"",itemName:"",quantity:1,unitPrice:0,totalPrice:0}]}))},ye=s=>{v(t=>({...t,items:t.items.filter((a,r)=>r!==s)}))},P=(s,t,a)=>{v(r=>{const i=[...r.items];if(t==="inventoryItemId"){const u=M.find(p=>p.id===a);u&&(i[s]={...i[s],inventoryItemId:u.id,itemName:u.name,unitPrice:u.pricePerPiece,totalPrice:i[s].quantity*u.pricePerPiece})}else if(t==="quantity"){const u=Number(a)||0;i[s]={...i[s],quantity:u,totalPrice:u*i[s].unitPrice}}else if(t==="unitPrice"){const u=Number(a)||0;i[s]={...i[s],unitPrice:u,totalPrice:i[s].quantity*u}}return{...r,items:i}})},ge=s=>{const t=O.find(a=>a.id===s);v(a=>({...a,supplierId:s,supplierName:t?.name??""}))},Qe=async()=>{if(!n.supplierId||n.items.length===0||!n.expectedDeliveryDate){c.error("Please fill in all required fields");return}try{const s=await us({supplierId:n.supplierId,supplierName:n.supplierName,items:n.items,expectedDeliveryDate:n.expectedDeliveryDate,notes:n.notes,createdBy:I?.id??"1"});x(t=>[s,...t??[]]),c.success(`Purchase Order ${s.id} created successfully`),g(!1),C()}catch(s){c.error(s instanceof Error?s.message:"Failed to create purchase order")}},We=async s=>{if(!n.supplierId||n.items.length===0||!n.expectedDeliveryDate){c.error("Please fill in all required fields");return}try{const t=await gs({id:s,supplierId:n.supplierId,supplierName:n.supplierName,items:n.items,expectedDeliveryDate:n.expectedDeliveryDate,notes:n.notes});x(a=>a?.map(r=>r.id===s?t:r)??[]),c.success(`Purchase Order ${s} updated successfully`),k(null),C()}catch(t){c.error(t instanceof Error?t.message:"Failed to update purchase order")}},Xe=async s=>{try{await ys(s),x(t=>t?.filter(a=>a.id!==s)??[]),c.success(`Purchase Order ${s} deleted`),k(null)}catch(t){c.error(t instanceof Error?t.message:"Failed to delete purchase order")}},Ye=async s=>{try{const t=await hs(s);x(a=>a?.map(r=>r.id===s?t:r)??[]),c.success(`Purchase Order ${s} submitted for approval`)}catch(t){c.error(t instanceof Error?t.message:"Failed to submit for approval")}},Ze=async s=>{try{const t=await ps(s,I?.id??"1");x(a=>a?.map(r=>r.id===s?t:r)??[]),c.success(`Purchase Order ${s} approved`)}catch(t){c.error(t instanceof Error?t.message:"Failed to approve")}},Ge=async s=>{try{const t=await xs(s,I?.id??"1");x(a=>a?.map(r=>r.id===s?t:r)??[]),c.success(`Purchase Order ${s} rejected`)}catch(t){c.error(t instanceof Error?t.message:"Failed to reject")}},Je=async s=>{try{const t=await vs(s);x(a=>a?.map(r=>r.id===s?t:r)??[]),c.success(`Purchase Order ${s} marked as ordered`)}catch(t){c.error(t instanceof Error?t.message:"Failed to mark as ordered")}},es=async s=>{try{const t=await js(s);x(a=>a?.map(r=>r.id===s?t:r)??[]),c.success(`Purchase Order ${s} cancelled`)}catch(t){c.error(t instanceof Error?t.message:"Failed to cancel")}},ss=s=>{const t={};(s.items??[]).forEach(a=>{const r=a.quantity-(a.quantityReceived??0);t[a.inventoryItemId]=r}),oe(t),me(s.totalAmount),K(s.id)},ts=async s=>{try{const t=Object.entries(de).filter(([r,i])=>i>0).map(([r,i])=>({inventoryItemId:r,quantityReceived:i}));if(t.length===0){c.error("Please enter quantities to receive");return}const a=await Ns(s,t,ue);if(x(r=>r?.map(i=>i.id===s?a.purchaseOrder:i)??[]),a.inventoryUpdates.length>0){const r=a.inventoryUpdates.map(i=>`${i.itemName}: ${i.previousQty} → ${i.newQty}`).join(", ");c.success(`Items received. Inventory updated: ${r}`)}else c.success("Items received successfully");K(null)}catch(t){c.error(t instanceof Error?t.message:"Failed to receive items")}},as=async()=>{try{const s=await fs(Array.from(he));s.success?c.success(`${s.successCount} purchase orders deleted`):c.warning(`${s.successCount} deleted, ${s.failedCount} failed: ${s.errors.join(", ")}`),x(t=>t?.filter(a=>!he.has(a.id))??[]),xe(),W(!1)}catch{c.error("Failed to delete purchase orders")}},rs=s=>{v({supplierId:s.supplierId,supplierName:s.supplierName,items:(s.items??[]).map(t=>({inventoryItemId:t.inventoryItemId,itemName:t.itemName,quantity:t.quantity,unitPrice:t.unitPrice,totalPrice:t.totalPrice})),expectedDeliveryDate:s.expectedDeliveryDate,notes:s.notes}),k(s.id)},is=()=>{const s=["PO ID","Supplier","Items","Total Amount","Status","Created Date","Expected Delivery","Notes"],t=Y.map(p=>[p.id,p.supplierName,(p.items??[]).map(U=>`${U.itemName} (${U.quantity})`).join("; "),(p.totalAmount??0).toFixed(2),p.status,p.createdDate,p.expectedDeliveryDate,p.notes]),a=[s,...t].map(p=>p.map(U=>`"${U}"`).join(",")).join(`
`),r=new Blob([a],{type:"text/csv"}),i=URL.createObjectURL(r),u=document.createElement("a");u.href=i,u.download=`purchase-orders-${new Date().toISOString().split("T")[0]}.csv`,u.click(),URL.revokeObjectURL(i),c.success("Purchase orders exported to CSV")},Ne=l.useMemo(()=>n.items.reduce((s,t)=>s+t.totalPrice,0),[n.items]);return Re?e.jsx("div",{className:"p-6",children:e.jsx(ks,{rows:8})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Purchase Orders"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage purchase orders and supplier orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{variant:"outline",onClick:is,children:[e.jsx(Ls,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),_&&e.jsxs(Z,{open:H,onOpenChange:s=>{g(s),s||C()},children:[e.jsx(Cs,{asChild:!0,children:e.jsxs(d,{children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Create PO"]})}),e.jsxs(G,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(J,{children:[e.jsx(ee,{children:"Create Purchase Order"}),e.jsx(se,{children:"Create a new purchase order for supplier items"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Supplier *"}),e.jsxs(T,{value:n.supplierId,onValueChange:ge,children:[e.jsx(E,{children:e.jsx(q,{placeholder:"Select supplier"})}),e.jsx($,{children:O.map(s=>e.jsx(S,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Expected Delivery Date *"}),e.jsx(m,{type:"date",value:n.expectedDeliveryDate,onChange:s=>v(t=>({...t,expectedDeliveryDate:s.target.value}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{children:"Line Items *"}),e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:je,children:[e.jsx(re,{className:"h-4 w-4 mr-1"})," Add Item"]})]}),n.items.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:'No items added. Click "Add Item" to add items.'}):e.jsxs("div",{className:"space-y-2",children:[n.items.map((s,t)=>e.jsxs("div",{className:"flex gap-2 items-end p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Item"}),e.jsxs(T,{value:s.inventoryItemId,onValueChange:a=>P(t,"inventoryItemId",a),children:[e.jsx(E,{children:e.jsx(q,{placeholder:"Select item"})}),e.jsx($,{children:M.map(a=>e.jsxs(S,{value:a.id,children:[a.name," (",a.id,")"]},a.id))})]})]}),e.jsxs("div",{className:"w-24 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Quantity"}),e.jsx(m,{type:"number",min:"1",value:s.quantity,onChange:a=>P(t,"quantity",a.target.value)})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Unit Price"}),e.jsx(m,{type:"number",min:"0",step:"0.01",value:s.unitPrice,onChange:a=>P(t,"unitPrice",a.target.value)})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Total"}),e.jsx(m,{value:`₱${s.totalPrice.toFixed(2)}`,disabled:!0})]}),e.jsx(d,{type:"button",variant:"ghost",size:"icon",onClick:()=>ye(t),children:e.jsx(te,{className:"h-4 w-4 text-destructive"})})]},t)),e.jsxs("div",{className:"text-right font-semibold",children:["Total: ₱",Ne.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Notes"}),e.jsx(m,{value:n.notes,onChange:s=>v(t=>({...t,notes:s.target.value})),placeholder:"Optional notes..."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>{g(!1),C()},children:"Cancel"}),e.jsx(d,{onClick:Qe,children:"Create Purchase Order"})]})]})]})]})]})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(Ps,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Search PO ID, supplier, or items...",value:z,onChange:s=>we(s.target.value),className:"pl-10"})]}),e.jsxs(T,{value:w,onValueChange:Oe,children:[e.jsxs(E,{className:"w-48",children:[e.jsx(qs,{className:"h-4 w-4 mr-2"}),e.jsx(q,{placeholder:"Filter by status"})]}),e.jsxs($,{children:[e.jsx(S,{value:"all",children:"All Statuses"}),Us.map(s=>e.jsx(S,{value:s,children:s},s))]})]})]}),Ke&&B&&e.jsx(As,{selectionCount:pe,onClearSelection:xe,actions:[{label:"Delete Selected",onClick:()=>W(!0),variant:"destructive"}]}),Y.length===0?e.jsx(Rs,{icon:Pe,title:"No purchase orders found",description:z||w!=="all"?"Try adjusting your search or filters":"Create your first purchase order to get started",actionLabel:_?"Create PO":void 0,onAction:_?()=>g(!0):void 0}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-lg",children:e.jsxs(Ss,{children:[e.jsx(bs,{children:e.jsxs(Ce,{children:[B&&e.jsx(ae,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:Le,ref:s=>{s&&(s.indeterminate=Be)},onChange:()=>qe(),className:"h-4 w-4"})}),e.jsx(b,{sortKey:"id",currentSortKey:h,sortDirection:D("id"),onSort:f,children:"PO ID"}),e.jsx(b,{sortKey:"supplierName",currentSortKey:h,sortDirection:D("supplierName"),onSort:f,children:"Supplier"}),e.jsx(ae,{children:"Items"}),e.jsx(b,{sortKey:"totalAmount",currentSortKey:h,sortDirection:D("totalAmount"),onSort:f,className:"text-right",children:"Total"}),e.jsx(b,{sortKey:"status",currentSortKey:h,sortDirection:D("status"),onSort:f,children:"Status"}),e.jsx(b,{sortKey:"createdDate",currentSortKey:h,sortDirection:D("createdDate"),onSort:f,children:"Created"}),e.jsx(b,{sortKey:"expectedDeliveryDate",currentSortKey:h,sortDirection:D("expectedDeliveryDate"),onSort:f,children:"Expected"}),e.jsx(ae,{children:"Actions"})]})}),e.jsx(Is,{children:Ue.map(s=>e.jsxs(Ce,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>rs(s),children:[B&&e.jsx(y,{onClick:t=>t.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:$e(s.id),onChange:()=>Ee(s.id),className:"h-4 w-4"})}),e.jsx(y,{className:"font-medium",children:s.id}),e.jsx(y,{children:s.supplierName}),e.jsx(y,{children:e.jsxs("span",{className:"text-sm",children:[(s.items??[]).length," item",(s.items??[]).length!==1?"s":""]})}),e.jsxs(y,{className:"text-right font-medium",children:["₱",(s.totalAmount??0).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(y,{children:ve(s.status)}),e.jsx(y,{children:s.createdDate}),e.jsx(y,{children:s.expectedDeliveryDate}),e.jsx(y,{onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"flex gap-1",children:[s.status==="Draft"&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Ye(s.id),title:"Submit for Approval",children:e.jsx(Ks,{className:"h-4 w-4"})}),s.status==="Pending Approval"&&be&&e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"sm",variant:"outline",className:"text-green-600",onClick:()=>Ze(s.id),title:"Approve",children:e.jsx(cs,{className:"h-4 w-4"})}),e.jsx(d,{size:"sm",variant:"outline",className:"text-red-600",onClick:()=>Ge(s.id),title:"Reject",children:e.jsx(fe,{className:"h-4 w-4"})})]}),s.status==="Approved"&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Je(s.id),title:"Mark as Ordered",children:e.jsx(Pe,{className:"h-4 w-4"})}),(s.status==="Ordered"||s.status==="Partially Received")&&Ie&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>ss(s),title:"Receive Items",children:e.jsx(De,{className:"h-4 w-4"})}),!["Received","Cancelled"].includes(s.status)&&e.jsx(d,{size:"sm",variant:"ghost",className:"text-destructive",onClick:()=>es(s.id),title:"Cancel",children:e.jsx(fe,{className:"h-4 w-4"})})]})})]},s.id))})]})}),e.jsx(Fs,{currentPage:Ve,totalPages:_e,itemsPerPage:Me,onPageChange:ze,totalItems:He})]}),N&&e.jsx(Z,{open:!!N,onOpenChange:s=>{s||(k(null),C())},children:e.jsxs(G,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(J,{children:[e.jsxs(ee,{children:["Edit Purchase Order - ",N]}),e.jsx(se,{children:"Update purchase order details"})]}),e.jsx("div",{className:"space-y-4 py-4",children:(()=>{const s=F.find(a=>a.id===N),t=s?.status==="Draft";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),s&&ve(s.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Supplier"}),e.jsxs(T,{value:n.supplierId,onValueChange:ge,disabled:!t,children:[e.jsx(E,{children:e.jsx(q,{placeholder:"Select supplier"})}),e.jsx($,{children:O.map(a=>e.jsx(S,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Expected Delivery Date"}),e.jsx(m,{type:"date",value:n.expectedDeliveryDate,onChange:a=>v(r=>({...r,expectedDeliveryDate:a.target.value})),disabled:!t})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{children:"Line Items"}),t&&e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:je,children:[e.jsx(re,{className:"h-4 w-4 mr-1"})," Add Item"]})]}),e.jsxs("div",{className:"space-y-2",children:[n.items.map((a,r)=>e.jsxs("div",{className:"flex gap-2 items-end p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Item"}),e.jsxs(T,{value:a.inventoryItemId,onValueChange:i=>P(r,"inventoryItemId",i),disabled:!t,children:[e.jsx(E,{children:e.jsx(q,{placeholder:"Select item"})}),e.jsx($,{children:M.map(i=>e.jsxs(S,{value:i.id,children:[i.name," (",i.id,")"]},i.id))})]})]}),e.jsxs("div",{className:"w-24 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Quantity"}),e.jsx(m,{type:"number",min:"1",value:a.quantity,onChange:i=>P(r,"quantity",i.target.value),disabled:!t})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Unit Price"}),e.jsx(m,{type:"number",min:"0",step:"0.01",value:a.unitPrice,onChange:i=>P(r,"unitPrice",i.target.value),disabled:!t})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(o,{className:"text-xs",children:"Total"}),e.jsx(m,{value:`₱${a.totalPrice.toFixed(2)}`,disabled:!0})]}),t&&e.jsx(d,{type:"button",variant:"ghost",size:"icon",onClick:()=>ye(r),children:e.jsx(te,{className:"h-4 w-4 text-destructive"})})]},r)),e.jsxs("div",{className:"text-right font-semibold",children:["Total: ₱",Ne.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Notes"}),e.jsx(m,{value:n.notes,onChange:a=>v(r=>({...r,notes:a.target.value})),placeholder:"Optional notes...",disabled:!t})]}),e.jsxs("div",{className:"flex justify-between",children:[B&&["Draft","Cancelled","Rejected"].includes(s?.status??"")&&e.jsxs(d,{variant:"destructive",onClick:()=>Xe(N),children:[e.jsx(te,{className:"h-4 w-4 mr-2"})," Delete"]}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsx(d,{variant:"outline",onClick:()=>{k(null),C()},children:"Close"}),t&&e.jsx(d,{onClick:()=>We(N),children:"Save Changes"})]})]})]})})()})]})}),A&&e.jsx(Z,{open:!!A,onOpenChange:s=>{s||K(null)},children:e.jsxs(G,{className:"max-w-2xl",children:[e.jsxs(J,{children:[e.jsxs(ee,{children:["Receive Items - ",A]}),e.jsx(se,{children:"Enter quantities received for each item"})]}),e.jsx("div",{className:"space-y-4 py-4",children:(()=>{const s=F.find(t=>t.id===A);return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:(s.items??[]).map(t=>{const a=t.quantity-(t.quantityReceived??0);return e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:t.itemName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Ordered: ",t.quantity," | Received: ",t.quantityReceived??0," | Remaining: ",a]})]}),e.jsxs("div",{className:"w-32",children:[e.jsx(o,{className:"text-xs",children:"Receive Qty"}),e.jsx(m,{type:"number",min:"0",max:a,value:de[t.inventoryItemId]??0,onChange:r=>oe(i=>({...i,[t.inventoryItemId]:Math.min(Number(r.target.value)||0,a)}))})]})]},t.inventoryItemId)})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Actual Cost (optional)"}),e.jsx(m,{type:"number",min:"0",step:"0.01",value:ue??"",onChange:t=>me(t.target.value?Number(t.target.value):void 0),placeholder:`Expected: ₱${s.totalAmount.toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>K(null),children:"Cancel"}),e.jsxs(d,{onClick:()=>ts(A),children:[e.jsx(De,{className:"h-4 w-4 mr-2"})," Receive Items"]})]})]}):null})()})]})}),e.jsx(Ts,{open:Te,onOpenChange:W,itemCount:pe,itemType:"purchase orders",onConfirm:as})]})}export{Ws as PurchaseOrdersView};
