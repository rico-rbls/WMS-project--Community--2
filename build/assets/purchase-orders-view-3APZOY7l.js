import{c as Ze,i as Ms,r as c,G as _s,j as e,C as b,m as H,n as Q,o as C,W as Ks,d as Y,t as W,s as Hs,B as d,D as ve,X as Qs,v as je,w as ge,x as ye,y as fe,L as h,I as g,z as Ys,Z as Ws,Y as Ne,ac as Xs,P as Qe,l as be,ad as Gs,ae as Js,J as l,af as Zs,ag as et,ah as Ye,ai as st,aj as tt,ak as rt,al as at,am as nt,an as lt,ao as it,ap as ct,aq as dt,ar as ot,as as ut}from"./index-CEafwXpg.js";import{S as X,a as G,b as J,c as Z,d as q,T as ie,e as mt,f as ht,g as We,h as Ce,i as L,j as xt,k as w}from"./sortable-table-head-DvIzrOi6.js";import{a as pt,u as vt,T as jt,P as we,F as gt,B as yt,E as ft,d as Xe,c as Nt,b as bt}from"./editable-cell-B1egpBOW.js";import{g as Ct,h as ee}from"./permissions-BqDqHH54.js";import{F as wt}from"./file-text-DT3urs_i.js";import{D as Pt}from"./dollar-sign-DUyDfLP-.js";import{T as Dt}from"./skeleton-DYm6c1at.js";import{A as ce,a as Ge}from"./archive-CIm8sytE.js";import{S as Je}from"./shopping-bag-V7s2KWZR.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],kt=Ze("download",St);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],At=Ze("send",Ot),It=["Draft","Pending Approval","Approved","Rejected","Ordered","Partially Received","Received","Cancelled"];function Ut({initialOpenDialog:Pe,onDialogOpened:De,prefilledItem:N}){const{user:V}=Ms(),B=V?Ct(V.id):"user",U=ee(B,"purchase_orders:create"),es=ee(B,"purchase_orders:approve"),ss=ee(B,"purchase_orders:receive"),se=ee(B,"purchase_orders:delete"),Se=ee(B,"purchase_orders:permanent_delete"),[x,ke]=c.useState(!1),[te,Oe]=c.useState(""),[v,A]=c.useState("all"),[Ae,p]=c.useState(null),[D,ts]=c.useState([]),[de,rs]=c.useState([]),[as,ns]=c.useState(!0),[oe,I]=c.useState(!1),[P,S]=c.useState(null),[z,re]=c.useState(null),[y,Ie]=c.useState(null),[M,ue]=c.useState("asc"),[i,f]=c.useState({supplierId:"",supplierName:"",items:[],expectedDeliveryDate:"",notes:""}),[Re,Fe]=c.useState({}),[Te,Ee]=c.useState(void 0),[ls,_]=c.useState(!1),me=_s(te,300),k=c.useMemo(()=>Ae??[],[Ae]),{selectedIds:ae,toggleItem:is,toggleAll:cs,isSelected:ds,isAllSelected:os,isPartiallySelected:us,selectionCount:R,hasSelection:ms,deselectAll:ne}=pt(k);c.useEffect(()=>{async function s(){try{const[t,r,a]=await Promise.all([be(),Gs(),Js()]);p(t),ts(r.filter(n=>n.status==="Active")),rs(a)}catch{l.error("Failed to load data")}finally{ns(!1)}}s()},[]),c.useEffect(()=>{N&&D.length>0&&(f({supplierId:N.supplierId,supplierName:N.supplierName,items:[{inventoryItemId:N.inventoryItemId,itemName:N.itemName,quantity:N.quantity,unitPrice:N.unitPrice,totalPrice:N.quantity*N.unitPrice}],expectedDeliveryDate:new Date(Date.now()+10080*60*1e3).toISOString().split("T")[0],notes:""}),I(!0))},[N,D]),c.useEffect(()=>{Pe&&!oe&&(I(!0),De?.())},[Pe,De,oe]);const he=c.useMemo(()=>{let s=k;if(s=s.filter(t=>t.archived===x),me){const t=me.toLowerCase();s=s.filter(r=>r.id.toLowerCase().includes(t)||r.supplierName.toLowerCase().includes(t)||(r.items??[]).some(a=>a.itemName.toLowerCase().includes(t)))}return v!=="all"&&(s=s.filter(t=>t.status===v)),y&&(s=[...s].sort((t,r)=>{const a=t[y],n=r[y];return a==null?1:n==null?-1:typeof a=="string"&&typeof n=="string"?M==="asc"?a.localeCompare(n):n.localeCompare(a):typeof a=="number"&&typeof n=="number"?M==="asc"?a-n:n-a:0})),s},[k,me,v,y,M,x]),{paginatedData:hs,currentPage:xs,totalPages:ps,goToPage:vs,itemsPerPage:js,totalItems:gs}=vt(he,10),j=c.useMemo(()=>{const s=k.filter(o=>!o.archived),t=new Date,r=new Date(t.getTime()-10080*60*1e3),a=s.length,n=s.reduce((o,He)=>o+(He.totalAmount??0),0),u=a>0?n/a:0,m=s.filter(o=>o.status==="Draft").length,O=s.filter(o=>o.status==="Pending Approval").length,Me=s.filter(o=>o.status==="Approved").length,xe=s.filter(o=>o.status==="Ordered").length,pe=s.filter(o=>o.status==="Partially Received").length,_e=s.filter(o=>o.status==="Received").length,qs=s.filter(o=>o.status==="Rejected").length,Ls=s.filter(o=>o.status==="Cancelled").length,Vs=m+O+Me+xe+pe,Ke=_e,Bs=a>0?Math.round(Ke/a*100):0,Us=s.filter(o=>new Date(o.createdDate)>=r).length,zs=xe+pe;return{totalPOs:a,totalValue:n,avgOrderValue:u,draftCount:m,pendingApprovalCount:O,approvedCount:Me,orderedCount:xe,partiallyReceivedCount:pe,receivedCount:_e,rejectedCount:qs,cancelledCount:Ls,activePOs:Vs,completionRate:Bs,newThisWeek:Us,pendingDelivery:zs,completedPOs:Ke}},[k]),$e=s=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),ys=()=>{Oe(""),A("all"),ke(!1)},K=s=>{switch(s){case"Draft":return"ðŸ“";case"Pending Approval":return"â³";case"Approved":return"âœ“";case"Rejected":return"âœ—";case"Ordered":return"ðŸ“¦";case"Partially Received":return"ðŸ“¥";case"Received":return"âœ“";case"Cancelled":return"â—‹";default:return"â—‹"}},le=s=>{switch(s){case"Draft":return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200";case"Pending Approval":return"bg-amber-500/15 text-amber-700 dark:text-amber-400 border-amber-200";case"Approved":return"bg-blue-500/15 text-blue-700 dark:text-blue-400 border-blue-200";case"Rejected":return"bg-red-500/15 text-red-700 dark:text-red-400 border-red-200";case"Ordered":return"bg-purple-500/15 text-purple-700 dark:text-purple-400 border-purple-200";case"Partially Received":return"bg-orange-500/15 text-orange-700 dark:text-orange-400 border-orange-200";case"Received":return"bg-emerald-500/15 text-emerald-700 dark:text-emerald-400 border-emerald-200";case"Cancelled":return"bg-gray-500/15 text-gray-700 dark:text-gray-400 border-gray-200";default:return"bg-slate-500/15 text-slate-700 dark:text-slate-400 border-slate-200"}},F=s=>{const t=s;y===t?M==="asc"?ue("desc"):(Ie(null),ue("asc")):(Ie(t),ue("asc"))},T=s=>y===s?M:null,qe=s=>{const t={Draft:{variant:"secondary"},"Pending Approval":{variant:"outline",className:"border-yellow-500 text-yellow-600"},Approved:{variant:"outline",className:"border-blue-500 text-blue-600"},Rejected:{variant:"destructive"},Ordered:{variant:"outline",className:"border-purple-500 text-purple-600"},"Partially Received":{variant:"outline",className:"border-orange-500 text-orange-600"},Received:{variant:"default",className:"bg-green-500"},Cancelled:{variant:"secondary",className:"text-gray-500"}},{variant:r,className:a}=t[s];return e.jsxs(W,{variant:r,className:Y("gap-1",a),children:[e.jsx("span",{children:K(s)}),s]})},E=()=>{f({supplierId:"",supplierName:"",items:[],expectedDeliveryDate:"",notes:""})},Le=()=>{f(s=>({...s,items:[...s.items,{inventoryItemId:"",itemName:"",quantity:1,unitPrice:0,totalPrice:0}]}))},Ve=s=>{f(t=>({...t,items:t.items.filter((r,a)=>a!==s)}))},$=(s,t,r)=>{f(a=>{const n=[...a.items];if(t==="inventoryItemId"){const u=de.find(m=>m.id===r);u&&(n[s]={...n[s],inventoryItemId:u.id,itemName:u.name,unitPrice:u.pricePerPiece,totalPrice:n[s].quantity*u.pricePerPiece})}else if(t==="quantity"){const u=Number(r)||0;n[s]={...n[s],quantity:u,totalPrice:u*n[s].unitPrice}}else if(t==="unitPrice"){const u=Number(r)||0;n[s]={...n[s],unitPrice:u,totalPrice:n[s].quantity*u}}return{...a,items:n}})},Be=s=>{const t=D.find(r=>r.id===s);f(r=>({...r,supplierId:s,supplierName:t?.name??""}))},fs=async()=>{if(!i.supplierId||i.items.length===0||!i.expectedDeliveryDate){l.error("Please fill in all required fields");return}try{const s=await Zs({supplierId:i.supplierId,supplierName:i.supplierName,items:i.items,expectedDeliveryDate:i.expectedDeliveryDate,notes:i.notes,createdBy:V?.id??"1"});p(t=>[s,...t??[]]),l.success(`Purchase Order ${s.id} created successfully`),I(!1),E()}catch(s){l.error(s instanceof Error?s.message:"Failed to create purchase order")}},Ns=async s=>{if(!i.supplierId||i.items.length===0||!i.expectedDeliveryDate){l.error("Please fill in all required fields");return}try{const t=await Ye({id:s,supplierId:i.supplierId,supplierName:i.supplierName,items:i.items,expectedDeliveryDate:i.expectedDeliveryDate,notes:i.notes});p(r=>r?.map(a=>a.id===s?t:a)??[]),l.success(`Purchase Order ${s} updated successfully`),S(null),E()}catch(t){l.error(t instanceof Error?t.message:"Failed to update purchase order")}},Ue=async(s,t,r)=>{try{const a={[t]:r},n=await Ye({id:s,...a});p(u=>u?.map(m=>m.id===s?n:m)??[]),l.success(`${t.charAt(0).toUpperCase()+t.slice(1)} updated`)}catch(a){throw l.error(a?.message||"Failed to update"),a}},bs=async s=>{try{const t=await st(s);p(r=>r?.map(a=>a.id===s?t:a)??[]),l.success(`Purchase Order ${s} submitted for approval`)}catch(t){l.error(t instanceof Error?t.message:"Failed to submit for approval")}},Cs=async s=>{try{const t=await tt(s,V?.id??"1");p(r=>r?.map(a=>a.id===s?t:a)??[]),l.success(`Purchase Order ${s} approved`)}catch(t){l.error(t instanceof Error?t.message:"Failed to approve")}},ws=async s=>{try{const t=await rt(s,V?.id??"1");p(r=>r?.map(a=>a.id===s?t:a)??[]),l.success(`Purchase Order ${s} rejected`)}catch(t){l.error(t instanceof Error?t.message:"Failed to reject")}},Ps=async s=>{try{const t=await at(s);p(r=>r?.map(a=>a.id===s?t:a)??[]),l.success(`Purchase Order ${s} marked as ordered`)}catch(t){l.error(t instanceof Error?t.message:"Failed to mark as ordered")}},Ds=async s=>{try{const t=await nt(s);p(r=>r?.map(a=>a.id===s?t:a)??[]),l.success(`Purchase Order ${s} cancelled`)}catch(t){l.error(t instanceof Error?t.message:"Failed to cancel")}},Ss=s=>{const t={};(s.items??[]).forEach(r=>{const a=r.quantity-(r.quantityReceived??0);t[r.inventoryItemId]=a}),Fe(t),Ee(s.totalAmount),re(s.id)},ks=async s=>{try{const t=Object.entries(Re).filter(([a,n])=>n>0).map(([a,n])=>({inventoryItemId:a,quantityReceived:n}));if(t.length===0){l.error("Please enter quantities to receive");return}const r=await dt(s,t,Te);if(p(a=>a?.map(n=>n.id===s?r.purchaseOrder:n)??[]),r.inventoryUpdates.length>0){const a=r.inventoryUpdates.map(n=>`${n.itemName}: ${n.previousQty} â†’ ${n.newQty}`).join(", ");l.success(`Items received. Inventory updated: ${a}`)}else l.success("Items received successfully");re(null)}catch(t){l.error(t instanceof Error?t.message:"Failed to receive items")}},Os=async s=>{try{const t=await ct(s);p(r=>(r??[]).map(a=>a.id===s?t:a)),S(null),l.success("Purchase order archived")}catch(t){l.error(t instanceof Error?t.message:"Failed to archive purchase order")}},As=async s=>{try{const t=await lt(s);p(r=>(r??[]).map(a=>a.id===s?t:a)),S(null),l.success("Purchase order restored")}catch(t){l.error(t instanceof Error?t.message:"Failed to restore purchase order")}},Is=async s=>{try{await it(s),p(t=>(t??[]).filter(r=>r.id!==s)),S(null),l.success("Purchase order permanently deleted")}catch(t){l.error(t instanceof Error?t.message:"Failed to permanently delete purchase order")}},Rs=async()=>{try{const s=await ut(Array.from(ae));s.success?l.success(`${s.successCount} purchase orders archived`):l.warning(`${s.successCount} archived, ${s.failedCount} failed`);const t=await be();p(t),ne(),_(!1)}catch{l.error("Failed to archive purchase orders")}},Fs=async()=>{try{const s=await et(Array.from(ae));s.success?l.success(`${s.successCount} purchase orders restored`):l.warning(`${s.successCount} restored, ${s.failedCount} failed`);const t=await be();p(t),ne()}catch{l.error("Failed to restore purchase orders")}},Ts=async()=>{try{const s=await ot(Array.from(ae));s.success?l.success(`${s.successCount} purchase orders permanently deleted`):l.warning(`${s.successCount} deleted, ${s.failedCount} failed`),p(t=>t?.filter(r=>!ae.has(r.id))??[]),ne(),_(!1)}catch{l.error("Failed to permanently delete purchase orders")}},Es=s=>{f({supplierId:s.supplierId,supplierName:s.supplierName,items:(s.items??[]).map(t=>({inventoryItemId:t.inventoryItemId,itemName:t.itemName,quantity:t.quantity,unitPrice:t.unitPrice,totalPrice:t.totalPrice})),expectedDeliveryDate:s.expectedDeliveryDate,notes:s.notes}),S(s.id)},$s=()=>{const s=["PO ID","Supplier","Items","Total Amount","Status","Created Date","Expected Delivery","Notes"],t=he.map(m=>[m.id,m.supplierName,(m.items??[]).map(O=>`${O.itemName} (${O.quantity})`).join("; "),(m.totalAmount??0).toFixed(2),m.status,m.createdDate,m.expectedDeliveryDate,m.notes]),r=[s,...t].map(m=>m.map(O=>`"${O}"`).join(",")).join(`
`),a=new Blob([r],{type:"text/csv"}),n=URL.createObjectURL(a),u=document.createElement("a");u.href=n,u.download=`purchase-orders-${new Date().toISOString().split("T")[0]}.csv`,u.click(),URL.revokeObjectURL(n),l.success("Purchase orders exported to CSV")},ze=c.useMemo(()=>i.items.reduce((s,t)=>s+t.totalPrice,0),[i.items]);return as?e.jsx("div",{className:"p-6",children:e.jsx(jt,{rows:8})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(b,{className:"relative overflow-hidden",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(Q,{className:"text-sm font-medium text-muted-foreground",children:"Total POs"}),e.jsx(wt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold",children:j.totalPOs}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[j.newThisWeek," new this week"]})]})]}),e.jsxs(b,{className:"relative overflow-hidden",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(Q,{className:"text-sm font-medium text-muted-foreground",children:"Total Value"}),e.jsx(Pt,{className:"h-4 w-4 text-emerald-600"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:$e(j.totalValue)}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Avg: ",$e(j.avgOrderValue)," per PO"]})]})]}),e.jsxs(b,{className:"relative overflow-hidden",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(Q,{className:"text-sm font-medium text-muted-foreground",children:"Active POs"}),e.jsx(Ks,{className:"h-4 w-4 text-amber-600"})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:j.activePOs}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[j.orderedCount," ordered, ",j.pendingApprovalCount," pending approval"]})]})]}),e.jsxs(b,{className:"relative overflow-hidden",children:[e.jsxs(H,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(Q,{className:"text-sm font-medium text-muted-foreground",children:"Completion Rate"}),e.jsx(Dt,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[j.completionRate,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[j.completedPOs," received of ",j.totalPOs," total"]})]})]})]}),e.jsxs("div",{className:"grid gap-3 grid-cols-2 md:grid-cols-4",children:[e.jsx(b,{className:Y("cursor-pointer transition-all hover:shadow-md border-l-4",v==="Draft"?"ring-2 ring-primary":"","border-l-slate-400"),onClick:()=>A(v==="Draft"?"all":"Draft"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Draft"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:j.draftCount})]}),e.jsx(W,{variant:"outline",className:le("Draft"),children:K("Draft")})]})})}),e.jsx(b,{className:Y("cursor-pointer transition-all hover:shadow-md border-l-4",v==="Pending Approval"?"ring-2 ring-primary":"","border-l-amber-400"),onClick:()=>A(v==="Pending Approval"?"all":"Pending Approval"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Pending Approval"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:j.pendingApprovalCount})]}),e.jsx(W,{variant:"outline",className:le("Pending Approval"),children:K("Pending Approval")})]})})}),e.jsx(b,{className:Y("cursor-pointer transition-all hover:shadow-md border-l-4",v==="Ordered"?"ring-2 ring-primary":"","border-l-blue-400"),onClick:()=>A(v==="Ordered"?"all":"Ordered"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Ordered"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:j.orderedCount})]}),e.jsx(W,{variant:"outline",className:le("Ordered"),children:K("Ordered")})]})})}),e.jsx(b,{className:Y("cursor-pointer transition-all hover:shadow-md border-l-4",v==="Received"?"ring-2 ring-primary":"","border-l-emerald-400"),onClick:()=>A(v==="Received"?"all":"Received"),children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Received"}),e.jsx("p",{className:"text-xl font-bold mt-1",children:j.receivedCount})]}),e.jsx(W,{variant:"outline",className:le("Received"),children:K("Received")})]})})})]}),e.jsxs(b,{children:[e.jsxs(H,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Q,{children:"Purchase Order Management"}),e.jsx(Hs,{children:"Create and manage supplier purchase orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{variant:"outline",onClick:$s,children:[e.jsx(kt,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),U&&e.jsxs(ve,{open:oe,onOpenChange:s=>{I(s),s||E()},children:[e.jsx(Qs,{asChild:!0,children:e.jsxs(d,{children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Create PO"]})}),e.jsxs(je,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ge,{children:[e.jsx(ye,{children:"Create Purchase Order"}),e.jsx(fe,{children:"Create a new purchase order for supplier items"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Supplier *"}),e.jsxs(X,{value:i.supplierId,onValueChange:Be,children:[e.jsx(G,{children:e.jsx(J,{placeholder:"Select supplier"})}),e.jsx(Z,{children:D.map(s=>e.jsx(q,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Expected Delivery Date *"}),e.jsx(g,{type:"date",value:i.expectedDeliveryDate,onChange:s=>f(t=>({...t,expectedDeliveryDate:s.target.value}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(h,{children:"Line Items *"}),e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:Le,children:[e.jsx(we,{className:"h-4 w-4 mr-1"})," Add Item"]})]}),i.items.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:'No items added. Click "Add Item" to add items.'}):e.jsxs("div",{className:"space-y-2",children:[i.items.map((s,t)=>e.jsxs("div",{className:"flex gap-2 items-end p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Item"}),e.jsxs(X,{value:s.inventoryItemId,onValueChange:r=>$(t,"inventoryItemId",r),children:[e.jsx(G,{children:e.jsx(J,{placeholder:"Select item"})}),e.jsx(Z,{children:de.map(r=>e.jsxs(q,{value:r.id,children:[r.name," (",r.id,")"]},r.id))})]})]}),e.jsxs("div",{className:"w-24 space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Quantity"}),e.jsx(g,{type:"number",min:"1",value:s.quantity,onChange:r=>$(t,"quantity",r.target.value)})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Unit Price"}),e.jsx(g,{type:"number",min:"0",step:"0.01",value:s.unitPrice,onChange:r=>$(t,"unitPrice",r.target.value)})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Total"}),e.jsx(g,{value:`â‚±${s.totalPrice.toFixed(2)}`,disabled:!0})]}),e.jsx(d,{type:"button",variant:"ghost",size:"icon",onClick:()=>Ve(t),children:e.jsx(ie,{className:"h-4 w-4 text-destructive"})})]},t)),e.jsxs("div",{className:"text-right font-semibold",children:["Total: â‚±",ze.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Notes"}),e.jsx(g,{value:i.notes,onChange:s=>f(t=>({...t,notes:s.target.value})),placeholder:"Optional notes..."})]}),e.jsxs(Ys,{children:[e.jsx(d,{variant:"outline",onClick:()=>{I(!1),E()},children:"Cancel"}),e.jsx(d,{onClick:fs,children:"Create Purchase Order"})]})]})]})]})]})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(Ws,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(g,{placeholder:"Search PO ID, supplier, or items...",value:te,onChange:s=>Oe(s.target.value),className:"pl-10"})]}),e.jsxs(X,{value:v,onValueChange:A,children:[e.jsxs(G,{className:"w-48",children:[e.jsx(gt,{className:"h-4 w-4 mr-2"}),e.jsx(J,{placeholder:"Filter by status"})]}),e.jsxs(Z,{children:[e.jsx(q,{value:"all",children:"All Statuses"}),It.map(s=>e.jsx(q,{value:s,children:s},s))]})]}),e.jsxs(d,{variant:x?"default":"outline",size:"sm",onClick:()=>ke(!x),className:x?"bg-orange-500 hover:bg-orange-600 text-white":"",children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),x?"Viewing Archived":"View Archived"]}),(te||v!=="all"||x)&&e.jsxs(d,{variant:"ghost",size:"sm",onClick:ys,className:"text-muted-foreground",children:[e.jsx(Ne,{className:"h-4 w-4 mr-1"}),"Clear Filters"]})]}),ms&&se&&e.jsx(yt,{selectionCount:R,onClearSelection:ne,actions:x?[{id:"restore",label:"Restore",icon:e.jsx(Ge,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:Fs},...Se?[{id:"permanent-delete",label:"Permanently Delete",icon:e.jsx(ie,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>_(!0)}]:[]]:[{id:"archive",label:"Archive",icon:e.jsx(ce,{className:"h-4 w-4 mr-1"}),variant:"outline",onClick:()=>_(!0)}]}),he.length===0?e.jsx(ft,{icon:x?ce:Je,title:x?"No archived purchase orders":"No purchase orders found",description:x?"Archived purchase orders will appear here":te||v!=="all"?"Try adjusting your search or filters":"Create your first purchase order to get started",actionLabel:!x&&U?"Create PO":void 0,onAction:!x&&U?()=>I(!0):void 0}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-lg",children:e.jsxs(mt,{children:[e.jsx(ht,{children:e.jsxs(We,{children:[se&&e.jsx(Ce,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:os,ref:s=>{s&&(s.indeterminate=us)},onChange:()=>cs(),className:"h-4 w-4"})}),e.jsx(L,{sortKey:"id",currentSortKey:y,sortDirection:T("id"),onSort:F,children:"PO ID"}),e.jsx(L,{sortKey:"supplierName",currentSortKey:y,sortDirection:T("supplierName"),onSort:F,children:"Supplier"}),e.jsx(Ce,{children:"Items"}),e.jsx(L,{sortKey:"totalAmount",currentSortKey:y,sortDirection:T("totalAmount"),onSort:F,className:"text-right",children:"Total"}),e.jsx(L,{sortKey:"status",currentSortKey:y,sortDirection:T("status"),onSort:F,children:"Status"}),e.jsx(L,{sortKey:"createdDate",currentSortKey:y,sortDirection:T("createdDate"),onSort:F,children:"Created"}),e.jsx(L,{sortKey:"expectedDeliveryDate",currentSortKey:y,sortDirection:T("expectedDeliveryDate"),onSort:F,children:"Expected"}),e.jsx(Ce,{children:"Actions"})]})}),e.jsx(xt,{children:hs.map(s=>e.jsxs(We,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>Es(s),children:[se&&e.jsx(w,{onClick:t=>t.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:ds(s.id),onChange:()=>is(s.id),className:"h-4 w-4"})}),e.jsx(w,{className:"font-medium",children:s.id}),e.jsx(w,{onClick:t=>t.stopPropagation(),children:e.jsx(Xe,{value:s.supplierId,displayValue:s.supplierName,type:"select",options:D.filter(t=>t.status==="Active").map(t=>({value:t.id,label:t.name})),onSave:t=>{const r=D.find(a=>a.id===t);return Ue(s.id,"supplierName",r?.name??"")},disabled:s.status!=="Draft"||!U})}),e.jsx(w,{children:e.jsxs("span",{className:"text-sm",children:[(s.items??[]).length," item",(s.items??[]).length!==1?"s":""]})}),e.jsxs(w,{className:"text-right font-medium",children:["â‚±",(s.totalAmount??0).toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsx(w,{children:qe(s.status)}),e.jsx(w,{children:s.createdDate}),e.jsx(w,{onClick:t=>t.stopPropagation(),children:e.jsx(Xe,{value:s.expectedDeliveryDate,type:"text",placeholder:"YYYY-MM-DD",onSave:t=>Ue(s.id,"expectedDeliveryDate",t),disabled:s.status!=="Draft"||!U})}),e.jsx(w,{onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"flex gap-1",children:[s.status==="Draft"&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>bs(s.id),title:"Submit for Approval",children:e.jsx(At,{className:"h-4 w-4"})}),s.status==="Pending Approval"&&es&&e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"sm",variant:"outline",className:"text-green-600",onClick:()=>Cs(s.id),title:"Approve",children:e.jsx(Xs,{className:"h-4 w-4"})}),e.jsx(d,{size:"sm",variant:"outline",className:"text-red-600",onClick:()=>ws(s.id),title:"Reject",children:e.jsx(Ne,{className:"h-4 w-4"})})]}),s.status==="Approved"&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Ps(s.id),title:"Mark as Ordered",children:e.jsx(Je,{className:"h-4 w-4"})}),(s.status==="Ordered"||s.status==="Partially Received")&&ss&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>Ss(s),title:"Receive Items",children:e.jsx(Qe,{className:"h-4 w-4"})}),!["Received","Cancelled"].includes(s.status)&&e.jsx(d,{size:"sm",variant:"ghost",className:"text-destructive",onClick:()=>Ds(s.id),title:"Cancel",children:e.jsx(Ne,{className:"h-4 w-4"})})]})})]},s.id))})]})}),e.jsx(Nt,{currentPage:xs,totalPages:ps,itemsPerPage:js,onPageChange:vs,totalItems:gs})]}),P&&e.jsx(ve,{open:!!P,onOpenChange:s=>{s||(S(null),E())},children:e.jsxs(je,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ge,{children:[e.jsxs(ye,{children:["Edit Purchase Order - ",P]}),e.jsx(fe,{children:"Update purchase order details"})]}),e.jsx("div",{className:"space-y-4 py-4",children:(()=>{const s=k.find(r=>r.id===P),t=s?.status==="Draft";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),s&&qe(s.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Supplier"}),e.jsxs(X,{value:i.supplierId,onValueChange:Be,disabled:!t,children:[e.jsx(G,{children:e.jsx(J,{placeholder:"Select supplier"})}),e.jsx(Z,{children:D.map(r=>e.jsx(q,{value:r.id,children:r.name},r.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Expected Delivery Date"}),e.jsx(g,{type:"date",value:i.expectedDeliveryDate,onChange:r=>f(a=>({...a,expectedDeliveryDate:r.target.value})),disabled:!t})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(h,{children:"Line Items"}),t&&e.jsxs(d,{type:"button",variant:"outline",size:"sm",onClick:Le,children:[e.jsx(we,{className:"h-4 w-4 mr-1"})," Add Item"]})]}),e.jsxs("div",{className:"space-y-2",children:[i.items.map((r,a)=>e.jsxs("div",{className:"flex gap-2 items-end p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Item"}),e.jsxs(X,{value:r.inventoryItemId,onValueChange:n=>$(a,"inventoryItemId",n),disabled:!t,children:[e.jsx(G,{children:e.jsx(J,{placeholder:"Select item"})}),e.jsx(Z,{children:de.map(n=>e.jsxs(q,{value:n.id,children:[n.name," (",n.id,")"]},n.id))})]})]}),e.jsxs("div",{className:"w-24 space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Quantity"}),e.jsx(g,{type:"number",min:"1",value:r.quantity,onChange:n=>$(a,"quantity",n.target.value),disabled:!t})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Unit Price"}),e.jsx(g,{type:"number",min:"0",step:"0.01",value:r.unitPrice,onChange:n=>$(a,"unitPrice",n.target.value),disabled:!t})]}),e.jsxs("div",{className:"w-28 space-y-1",children:[e.jsx(h,{className:"text-xs",children:"Total"}),e.jsx(g,{value:`â‚±${r.totalPrice.toFixed(2)}`,disabled:!0})]}),t&&e.jsx(d,{type:"button",variant:"ghost",size:"icon",onClick:()=>Ve(a),children:e.jsx(ie,{className:"h-4 w-4 text-destructive"})})]},a)),e.jsxs("div",{className:"text-right font-semibold",children:["Total: â‚±",ze.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Notes"}),e.jsx(g,{value:i.notes,onChange:r=>f(a=>({...a,notes:r.target.value})),placeholder:"Optional notes...",disabled:!t})]}),e.jsxs("div",{className:"flex justify-between",children:[s?.archived?e.jsxs(e.Fragment,{children:[e.jsxs(d,{variant:"outline",onClick:()=>As(P),children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Restore"]}),Se&&e.jsxs(d,{variant:"destructive",onClick:()=>Is(P),children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Permanently Delete"]})]}):se&&["Draft","Cancelled","Rejected"].includes(s?.status??"")&&e.jsxs(d,{variant:"outline",onClick:()=>Os(P),className:"text-orange-600 border-orange-300 hover:bg-orange-50",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Archive"]}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsx(d,{variant:"outline",onClick:()=>{S(null),E()},children:"Close"}),t&&!s?.archived&&e.jsx(d,{onClick:()=>Ns(P),children:"Save Changes"})]})]})]})})()})]})}),z&&e.jsx(ve,{open:!!z,onOpenChange:s=>{s||re(null)},children:e.jsxs(je,{className:"max-w-2xl",children:[e.jsxs(ge,{children:[e.jsxs(ye,{children:["Receive Items - ",z]}),e.jsx(fe,{children:"Enter quantities received for each item"})]}),e.jsx("div",{className:"space-y-4 py-4",children:(()=>{const s=k.find(t=>t.id===z);return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:(s.items??[]).map(t=>{const r=t.quantity-(t.quantityReceived??0);return e.jsxs("div",{className:"flex items-center gap-4 p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:t.itemName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Ordered: ",t.quantity," | Received: ",t.quantityReceived??0," | Remaining: ",r]})]}),e.jsxs("div",{className:"w-32",children:[e.jsx(h,{className:"text-xs",children:"Receive Qty"}),e.jsx(g,{type:"number",min:"0",max:r,value:Re[t.inventoryItemId]??0,onChange:a=>Fe(n=>({...n,[t.inventoryItemId]:Math.min(Number(a.target.value)||0,r)}))})]})]},t.inventoryItemId)})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Actual Cost (optional)"}),e.jsx(g,{type:"number",min:"0",step:"0.01",value:Te??"",onChange:t=>Ee(t.target.value?Number(t.target.value):void 0),placeholder:`Expected: â‚±${s.totalAmount.toFixed(2)}`})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>re(null),children:"Cancel"}),e.jsxs(d,{onClick:()=>ks(z),children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"})," Receive Items"]})]})]}):null})()})]})}),e.jsx(bt,{open:ls,onOpenChange:_,itemCount:R,itemType:"purchase orders",onConfirm:x?Ts:Rs,title:x?"Permanently Delete Purchase Orders":"Archive Purchase Orders",description:x?`Are you sure you want to permanently delete ${R} purchase order${R!==1?"s":""}? This action cannot be undone.`:`Are you sure you want to archive ${R} purchase order${R!==1?"s":""}? Archived purchase orders can be restored later.`,confirmLabel:x?"Permanently Delete":"Archive"})]})]})]})}export{Ut as PurchaseOrdersView};
