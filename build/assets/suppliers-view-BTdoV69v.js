import{c as Ve,F as _e,i as We,r as l,G as Ye,a9 as Je,l as Qe,aa as Xe,ar as me,J as c,as as Ze,at as es,j as e,C as A,m as I,n as F,o as E,D as he,O as xe,B as N,v as ge,w as ye,x as je,y as fe,L as x,I as p,Y as ss,Q as ts,d as ve,t as as,a4 as rs,U as ls,V as Se,au as is,av as ns}from"./index-6LLHEeRD.js";import{T as cs,e as os,f as ds,g as Ce,h as Ne,i as O,j as us,k as S}from"./sortable-table-head-CFycei8c.js";import{u as ps,a as ms,P as hs,B as xs,b as gs,T as ys,E as js,d as B,c as fs}from"./editable-cell-CZqhOGe3.js";import{S as vs,F as Ss}from"./save-search-dialog-9ltWKVbO.js";import{u as Cs}from"./useTableSort-CxV5xyBh.js";import{c as Ns}from"./permissions-CAP6Xwpf.js";import{S as bs}from"./star-C6dCWkZw.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],ks=Ve("phone",ws),Ds=["Active","Inactive"],Ps=["Electronics","Furniture","Clothing","Food","Other"];function Ls({initialOpenDialog:W,onDialogOpened:Y}){const{isFavorite:J,getFavoritesByType:Q}=_e(),{user:X}=We(),m=X?Ns(X.role):!1,[C,Z]=l.useState(""),[f,ee]=l.useState(!1),[se,j]=l.useState(null),[L,be]=l.useState([]),[te,we]=l.useState([]),[ke,ae]=l.useState(!0),[b,U]=l.useState(!1),[M,q]=l.useState(null),[a,d]=l.useState({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active"}),R=Ye(C,300);l.useEffect(()=>{(async()=>{ae(!0);const[s,r,t]=await Promise.all([Je(),Qe(),Xe()]);j(s),be(r),we(t),ae(!1)})()},[]),l.useEffect(()=>{W&&!b&&(U(!0),Y?.())},[W,Y,b]);const g=l.useMemo(()=>se??[],[se]),u=l.useMemo(()=>{const s=g.length,r=g.filter(i=>i.status==="Active").length,t=g.filter(i=>i.status==="Inactive").length,o=new Set(g.map(i=>i.category)).size,h=L.length,$=L.reduce((i,n)=>(i[n.supplierId]=(i[n.supplierId]||0)+1,i),{});let T=null;if(Object.keys($).length>0){const i=Object.entries($).sort((v,_)=>_[1]-v[1])[0],n=g.find(v=>v.id===i[0]);n&&(T={id:n.id,name:n.name,count:i[1]})}const ue=L.reduce((i,n)=>(i[n.supplierId]=(i[n.supplierId]||0)+n.totalAmount,i),{});let pe=null;if(Object.keys(ue).length>0){const i=Object.entries(ue).sort((v,_)=>_[1]-v[1])[0],n=g.find(v=>v.id===i[0]);n&&(pe={id:n.id,name:n.name,value:i[1]})}const ze=te.reduce((i,n)=>(n.supplierId&&(i[n.supplierId]=(i[n.supplierId]||0)+1),i),{}),Ge=Object.keys(ze).length;return{totalSuppliers:s,activeSuppliers:r,inactiveSuppliers:t,uniqueCategories:o,totalPurchaseOrders:h,topSupplierByPO:T,topSupplierByValue:pe,suppliersWithProducts:Ge}},[g,L,te]),H=l.useMemo(()=>g.filter(s=>{if(f&&!J("suppliers",s.id))return!1;if(R){const r=R.toLowerCase();if(!(s.name.toLowerCase().includes(r)||s.id.toLowerCase().includes(r)||s.category.toLowerCase().includes(r)))return!1}return!0}),[g,R,f,J]),De=l.useCallback(s=>{s.searchTerm&&Z(s.searchTerm),s.filters.favoritesOnly==="true"&&ee(!0)},[]),Pe=l.useMemo(()=>{const s={};return f&&(s.favoritesOnly="true"),s},[f]),{sortedData:Te,sortConfig:w,requestSort:k,getSortDirection:D}=Cs(H),{currentPage:re,totalPages:Ae,paginatedData:le,goToPage:Ie,totalItems:Fe,itemsPerPage:Ee}=ps(Te,25),{selectedIds:K,selectedItems:ie,selectionCount:ne,isAllSelected:Oe,isPartiallySelected:Be,hasSelection:z,toggleItem:Le,toggleAll:G,deselectAll:y,isSelected:Ue}=ms(le),[ce,oe]=l.useState(!1),[Ke,de]=l.useState(!1),[$e,V]=l.useState(!1);l.useEffect(()=>{y()},[re,y]),l.useEffect(()=>{const s=r=>{(r.metaKey||r.ctrlKey)&&r.key==="a"&&!b&&!M&&(r.preventDefault(),G()),r.key==="Escape"&&z&&y()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[G,y,z,b,M]);const Me=s=>s==="Active"?"bg-green-500/10 text-green-700":"bg-gray-500/10 text-gray-700",P=l.useCallback(async(s,r,t)=>{try{const o={[r]:t},h=await me({id:s,...o});j($=>($??[]).map(T=>T.id===s?h:T)),c.success(`${r.charAt(0).toUpperCase()+r.slice(1)} updated`)}catch(o){throw c.error(o?.message||"Failed to update"),o}},[j]),qe=l.useCallback(async()=>{oe(!0);try{const s=Array.from(K),r=await Ze(s);j(t=>t?.filter(o=>!s.includes(o.id))??[]),r.failedCount>0?c.warning(`Deleted ${r.successCount} suppliers. ${r.failedCount} failed.`):c.success(`Successfully deleted ${r.successCount} supplier${r.successCount!==1?"s":""}`),y()}catch(s){c.error(s?.message||"Failed to delete suppliers")}finally{oe(!1),V(!1)}},[K,y]),Re=l.useCallback(async s=>{de(!0);try{const r=Array.from(K),t=await es(r,s);j(o=>o&&o.map(h=>r.includes(h.id)?{...h,status:s}:h)),t.failedCount>0?c.warning(`Updated ${t.successCount} suppliers. ${t.failedCount} failed.`):c.success(`Successfully updated ${t.successCount} supplier${t.successCount!==1?"s":""}`),y()}catch(r){c.error(r?.message||"Failed to update suppliers")}finally{de(!1)}},[K,y]),He=l.useMemo(()=>ie.map(s=>s.name),[ie]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(A,{children:[e.jsx(I,{className:"pb-2",children:e.jsx(F,{className:"text-sm text-muted-foreground",children:"Total Suppliers"})}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.totalSuppliers}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[u.activeSuppliers," active, ",u.inactiveSuppliers," inactive"]})]})]}),e.jsxs(A,{children:[e.jsx(I,{className:"pb-2",children:e.jsx(F,{className:"text-sm text-muted-foreground",children:"Active Suppliers"})}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u.activeSuppliers}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:u.totalSuppliers>0?`${Math.round(u.activeSuppliers/u.totalSuppliers*100)}% of total`:"No suppliers yet"})]})]}),e.jsxs(A,{children:[e.jsx(I,{className:"pb-2",children:e.jsx(F,{className:"text-sm text-muted-foreground",children:"Total Purchase Orders"})}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.totalPurchaseOrders}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:u.topSupplierByPO?`Top: ${u.topSupplierByPO.name} (${u.topSupplierByPO.count})`:"No orders yet"})]})]}),e.jsxs(A,{children:[e.jsx(I,{className:"pb-2",children:e.jsx(F,{className:"text-sm text-muted-foreground",children:"Categories"})}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.uniqueCategories}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[u.suppliersWithProducts," suppliers with products"]})]})]})]}),e.jsxs(A,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(F,{children:"Supplier Management"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(he,{open:b,onOpenChange:s=>{U(s),s||d({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active"})},children:[e.jsx(xe,{asChild:!0,children:e.jsxs(N,{onClick:()=>d({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active"}),disabled:!m,title:m?void 0:"You don't have permission to add suppliers",children:[e.jsx(hs,{className:"h-4 w-4 mr-2"}),"Add Supplier"]})}),e.jsxs(ge,{children:[e.jsxs(ye,{children:[e.jsx(je,{children:"Add New Supplier"}),e.jsx(fe,{children:"Enter the details for the new supplier."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"supplier-name",children:"Company Name"}),e.jsx(p,{id:"supplier-name",placeholder:"Enter company name",value:a.name,onChange:s=>d({...a,name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"contact-name",children:"Contact Person"}),e.jsx(p,{id:"contact-name",placeholder:"Enter contact name",value:a.contact,onChange:s=>d({...a,contact:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"email",children:"Email"}),e.jsx(p,{id:"email",type:"email",placeholder:"email@example.com",value:a.email,onChange:s=>d({...a,email:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"phone",children:"Phone"}),e.jsx(p,{id:"phone",placeholder:"+1 (555) 000-0000",value:a.phone,onChange:s=>d({...a,phone:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"category",children:"Category"}),e.jsx(p,{id:"category",placeholder:"e.g., Electronics",value:a.category,onChange:s=>d({...a,category:s.target.value})})]}),e.jsx(N,{className:"w-full",onClick:async()=>{if(!a.name.trim()||!a.contact.trim()||!a.email.trim()||!a.phone.trim()||!a.category.trim()){c.error("Please fill all required fields");return}try{const s=await ss({name:a.name,contact:a.contact,email:a.email,phone:a.phone,category:a.category,status:a.status});j(r=>[s,...r??[]]),U(!1),c.success("Supplier added successfully"),d({id:"",name:"",contact:"",email:"",phone:"",category:"",status:"Active"})}catch(s){c.error(s?.message||"Failed to add supplier")}},children:"Add Supplier"})]})]})]})})]})}),e.jsxs(E,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ts,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(p,{placeholder:"Search suppliers...",value:C,onChange:s=>Z(s.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs(N,{variant:f?"default":"outline",size:"sm",onClick:()=>ee(!f),className:"gap-1",children:[e.jsx(bs,{className:ve("h-4 w-4",f&&"fill-current")}),"Favorites",Q("suppliers").length>0&&e.jsx(as,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:Q("suppliers").length})]}),e.jsx(vs,{entityType:"suppliers",currentSearchTerm:C,currentFilters:Pe,onApplySearch:De})]})]}),z&&m&&e.jsx(xs,{selectionCount:ne,onClearSelection:y,isLoading:ce||Ke,actions:[{id:"delete",label:"Delete",icon:e.jsx(cs,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>V(!0)}],actionGroups:[{id:"status-update",label:"Update Status",icon:e.jsx(rs,{className:"h-4 w-4 mr-1"}),options:[{value:"Active",label:"Active"},{value:"Inactive",label:"Inactive"}],onSelect:s=>Re(s)}],className:"mb-4"}),e.jsx(gs,{open:$e,onOpenChange:V,itemCount:ne,itemType:"supplier",itemNames:He,onConfirm:qe,isLoading:ce}),ke?e.jsx(ys,{rows:8}):H.length===0?e.jsx(js,{icon:ls,title:"No suppliers found",description:C?"Try adjusting your search criteria":"Get started by adding your first supplier",actionLabel:C?void 0:"Add Supplier",onAction:C?void 0:()=>U(!0)}):e.jsxs("div",{className:"rounded-md border",children:[e.jsxs(os,{children:[e.jsx(ds,{children:e.jsxs(Ce,{children:[e.jsx(Ne,{className:"w-12",children:e.jsx(Se,{checked:Oe,ref:s=>{s&&(s.indeterminate=Be)},onCheckedChange:G,"aria-label":"Select all suppliers"})}),e.jsx(O,{sortKey:"id",currentSortKey:w.key,sortDirection:D("id"),onSort:s=>k(s),children:"Supplier ID"}),e.jsx(O,{sortKey:"name",currentSortKey:w.key,sortDirection:D("name"),onSort:s=>k(s),children:"Company Name"}),e.jsx(O,{sortKey:"contact",currentSortKey:w.key,sortDirection:D("contact"),onSort:s=>k(s),children:"Contact"}),e.jsx(O,{sortKey:"category",currentSortKey:w.key,sortDirection:D("category"),onSort:s=>k(s),children:"Category"}),e.jsx(O,{sortKey:"status",currentSortKey:w.key,sortDirection:D("status"),onSort:s=>k(s),children:"Status"}),e.jsx(Ne,{children:"Actions"})]})}),e.jsx(us,{children:le.map(s=>{const r=Ue(s.id);return e.jsxs(Ce,{className:ve(r&&"bg-muted/50"),children:[e.jsx(S,{children:e.jsx(Se,{checked:r,onCheckedChange:()=>Le(s.id),"aria-label":`Select supplier ${s.name}`})}),e.jsx(S,{children:s.id}),e.jsx(S,{children:e.jsx(B,{value:s.name,type:"text",onSave:t=>P(s.id,"name",t),disabled:!m})}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(is,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(B,{value:s.email,type:"text",onSave:t=>P(s.id,"email",t),disabled:!m,className:"text-xs text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(ks,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(B,{value:s.phone,type:"text",onSave:t=>P(s.id,"phone",t),disabled:!m,className:"text-xs text-muted-foreground"})]})]})}),e.jsx(S,{children:e.jsx(B,{value:s.category,type:"select",options:Ps.map(t=>({value:t,label:t})),onSave:t=>P(s.id,"category",t),disabled:!m})}),e.jsx(S,{children:e.jsx(B,{value:s.status,type:"badge",options:Ds.map(t=>({value:t,label:t})),badgeClassName:Me(s.status),onSave:t=>P(s.id,"status",t),disabled:!m})}),e.jsx(S,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ss,{entityType:"suppliers",entityId:s.id,entityName:s.name}),e.jsxs(he,{open:M===s.id,onOpenChange:t=>{q(t?s.id:null),t&&d({...s})},children:[e.jsx(xe,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"sm",disabled:!m,title:m?void 0:"You don't have permission to edit suppliers",children:"Edit"})}),e.jsxs(ge,{children:[e.jsxs(ye,{children:[e.jsx(je,{children:"Edit Supplier"}),e.jsx(fe,{children:"Update fields and save your changes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-name",children:"Company Name"}),e.jsx(p,{id:"edit-name",value:a.name,onChange:t=>d({...a,name:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-contact",children:"Contact Person"}),e.jsx(p,{id:"edit-contact",value:a.contact,onChange:t=>d({...a,contact:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-email",children:"Email"}),e.jsx(p,{id:"edit-email",value:a.email,onChange:t=>d({...a,email:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-phone",children:"Phone"}),e.jsx(p,{id:"edit-phone",value:a.phone,onChange:t=>d({...a,phone:t.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"edit-category",children:"Category"}),e.jsx(p,{id:"edit-category",value:a.category,onChange:t=>d({...a,category:t.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{className:"flex-1",onClick:async()=>{if(!a.id){c.error("Missing supplier id");return}if(!a.name.trim()||!a.contact.trim()||!a.email.trim()||!a.phone.trim()||!a.category.trim()){c.error("Please fill all required fields");return}try{const t=await me({id:a.id,name:a.name,contact:a.contact,email:a.email,phone:a.phone,category:a.category,status:a.status});j(o=>(o??[]).map(h=>h.id===t.id?t:h)),q(null),c.success("Supplier updated")}catch(t){c.error(t?.message||"Failed to update supplier")}},children:"Save Changes"}),e.jsx(N,{variant:"destructive",onClick:async()=>{try{await ns(s.id),j(t=>(t??[]).filter(o=>o.id!==s.id)),q(null),c.success("Supplier deleted")}catch(t){c.error(t?.message||"Failed to delete supplier")}},children:"Delete"})]})]})]})]})]})})]},s.id)})})]}),H.length>0&&e.jsx(fs,{currentPage:re,totalPages:Ae,onPageChange:Ie,itemsPerPage:Ee,totalItems:Fe})]})]})]})]})}export{Ls as SuppliersView};
