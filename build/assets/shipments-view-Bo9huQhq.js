import{q as Pe,w as Ee,r as i,a8 as Be,a9 as Le,t as c,aa as Oe,j as e,C as D,i as N,k as b,l as w,P as $e,B as v,L as u,I as o,z as Ue,c as ae,p as U,X as qe,h as Me,m as He,A as re,ab as Re,ac as ze,ad as Ke}from"./index-Cw173fUK.js";import{u as Ge,j as _e,k as Ve,D as ie,l as ne,P as Xe,a as le,b as de,c as ce,d as oe,m as Je,B as Qe,T as We,n as Ye,o as Ze,E as es,p as ss,q as ts,r as ue,s as x,t as as,v as f,w as rs}from"./bulk-delete-dialog-CVayApkR.js";import{D as is}from"./date-range-filter-DYCq7FAY.js";import{S as ns,F as ls}from"./save-search-dialog-CuacRHbu.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],cs=Pe("map-pin",ds);function xs({initialOpenDialog:q,onDialogOpened:M}){const{isFavorite:H,getFavoritesByType:R}=Ee(),[g,z]=i.useState(""),[n,T]=i.useState(""),[l,k]=i.useState(""),[j,K]=i.useState(!1),[G,p]=i.useState(null),[he,_]=i.useState(!0),[y,S]=i.useState(!1),[I,F]=i.useState(null),[t,d]=i.useState({id:"",orderId:"",destination:"",carrier:"",status:"Pending",eta:""}),A=Ge(g,300);i.useEffect(()=>{(async()=>{_(!0);const s=await Be();p(s),_(!1)})()},[]),i.useEffect(()=>{q&&!y&&(S(!0),M?.())},[q,M,y]);const V=i.useMemo(()=>G??[],[G]),P=i.useMemo(()=>V.filter(s=>{if(j&&!H("shipments",s.id))return!1;if(A){const a=A.toLowerCase();if(!(s.id.toLowerCase().includes(a)||s.orderId.toLowerCase().includes(a)||s.destination.toLowerCase().includes(a)))return!1}if(n||l)try{const a=new Date(s.eta);if(n){const r=new Date(n);if(a<r)return!1}if(l){const r=new Date(l);if(r.setHours(23,59,59,999),a>r)return!1}}catch{return!1}return!0}),[V,A,n,l,j,H]),me=i.useCallback(s=>{s.searchTerm&&z(s.searchTerm),s.filters.fromDate&&typeof s.filters.fromDate=="string"&&T(s.filters.fromDate),s.filters.toDate&&typeof s.filters.toDate=="string"&&k(s.filters.toDate),s.filters.favoritesOnly==="true"&&K(!0)},[]),xe=i.useMemo(()=>{const s={};return n&&(s.fromDate=n),l&&(s.toDate=l),j&&(s.favoritesOnly="true"),s},[n,l,j]),{currentPage:X,totalPages:fe,paginatedData:J,goToPage:je,totalItems:ge,itemsPerPage:pe}=_e(P,25),{selectedIds:C,selectedItems:Q,selectionCount:W,isAllSelected:ve,isPartiallySelected:ye,hasSelection:E,toggleItem:Se,toggleAll:B,deselectAll:h,isSelected:Ce}=Ve(J),[Y,Z]=i.useState(!1),[De,ee]=i.useState(!1),[Ne,L]=i.useState(!1);i.useEffect(()=>{h()},[X,h]),i.useEffect(()=>{const s=a=>{(a.metaKey||a.ctrlKey)&&a.key==="a"&&!y&&!I&&(a.preventDefault(),B()),a.key==="Escape"&&E&&h()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[B,h,E,y,I]);function O(){d({id:"",orderId:"",destination:"",carrier:"",status:"Pending",eta:""})}function se(){T(""),k("")}function te(){return t.orderId.trim()?t.destination.trim()?t.carrier.trim()?t.eta.trim()?null:"ETA is required":"Carrier is required":"Destination is required":"Order ID is required"}async function be(){const s=te();if(s){c.error(s);return}const a=await Re({orderId:t.orderId,destination:t.destination,carrier:t.carrier,status:t.status,eta:t.eta});p(r=>[a,...r??[]]),S(!1),O(),c.success("Shipment created successfully")}async function we(){const s=te();if(s){c.error(s);return}if(!t.id){c.error("Missing shipment id");return}const a=await ze({id:t.id,orderId:t.orderId,destination:t.destination,carrier:t.carrier,status:t.status,eta:t.eta});p(r=>(r??[]).map(m=>m.id===a.id?a:m)),F(null),c.success("Shipment updated successfully")}async function Te(s){await Ke(s),p(a=>(a??[]).filter(r=>r.id!==s)),F(null),c.success("Shipment deleted successfully")}const ke=s=>{switch(s){case"Delivered":return"bg-green-500/10 text-green-700";case"In Transit":return"bg-blue-500/10 text-blue-700";case"Processing":return"bg-orange-500/10 text-orange-700";case"Pending":return"bg-gray-500/10 text-gray-700";default:return"bg-gray-500/10 text-gray-700"}},Ie=i.useCallback(async()=>{Z(!0);try{const s=Array.from(C),a=await Le(s);p(r=>r?.filter(m=>!s.includes(m.id))??[]),a.failedCount>0?c.warning(`Deleted ${a.successCount} shipments. ${a.failedCount} failed.`):c.success(`Successfully deleted ${a.successCount} shipment${a.successCount!==1?"s":""}`),h()}catch(s){c.error(s?.message||"Failed to delete shipments")}finally{Z(!1),L(!1)}},[C,h]),Fe=i.useCallback(async s=>{ee(!0);try{const a=Array.from(C),r=await Oe(a,s);p(m=>m&&m.map($=>a.includes($.id)?{...$,status:s}:$)),r.failedCount>0?c.warning(`Updated ${r.successCount} shipments. ${r.failedCount} failed.`):c.success(`Successfully updated ${r.successCount} shipment${r.successCount!==1?"s":""}`),h()}catch(a){c.error(a?.message||"Failed to update shipments")}finally{ee(!1)}},[C,h]),Ae=i.useMemo(()=>Q.map(s=>`${s.id} â†’ ${s.destination}`),[Q]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(D,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(b,{className:"text-sm text-muted-foreground",children:"Active Shipments"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-5 w-5 text-blue-600"}),e.jsx("div",{className:"text-2xl",children:"89"})]})})]}),e.jsxs(D,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(b,{className:"text-sm text-muted-foreground",children:"In Transit"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"h-5 w-5 text-orange-600"}),e.jsx("div",{className:"text-2xl",children:"67"})]})})]}),e.jsxs(D,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(b,{className:"text-sm text-muted-foreground",children:"On-Time Rate"})}),e.jsx(w,{children:e.jsx("div",{className:"text-2xl",children:"94%"})})]})]}),e.jsxs(D,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(b,{children:"Shipment Tracking"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(ie,{open:y,onOpenChange:s=>{S(s),s||O()},children:[e.jsx(ne,{asChild:!0,children:e.jsxs(v,{onClick:()=>O(),children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Add Shipment"]})}),e.jsxs(le,{children:[e.jsxs(de,{children:[e.jsx(ce,{children:"Add New Shipment"}),e.jsx(oe,{children:"Enter the details for the new shipment."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"orderId",children:"Order ID"}),e.jsx(o,{id:"orderId",placeholder:"ORD-0001",value:t.orderId,onChange:s=>d({...t,orderId:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"destination",children:"Destination"}),e.jsx(o,{id:"destination",placeholder:"City, ST",value:t.destination,onChange:s=>d({...t,destination:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"carrier",children:"Carrier"}),e.jsx(o,{id:"carrier",placeholder:"FedEx/UPS/DHL",value:t.carrier,onChange:s=>d({...t,carrier:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"status",children:"Status"}),e.jsx(o,{id:"status",placeholder:"Pending",value:t.status,onChange:s=>d({...t,status:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"eta",children:"ETA"}),e.jsx(o,{id:"eta",placeholder:"Oct 20, 2025",value:t.eta,onChange:s=>d({...t,eta:s.target.value})})]}),e.jsx(v,{className:"w-full",onClick:be,children:"Add Shipment"})]})]})]})})]})}),e.jsxs(w,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Je,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(o,{placeholder:"Search shipments...",value:g,onChange:s=>z(s.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx(is,{fromDate:n,toDate:l,onFromDateChange:T,onToDateChange:k,onClear:se,label:"Filter by ETA Date"}),e.jsxs(v,{variant:j?"default":"outline",size:"sm",onClick:()=>K(!j),className:"gap-1",children:[e.jsx(Ue,{className:ae("h-4 w-4",j&&"fill-current")}),"Favorites",R("shipments").length>0&&e.jsx(U,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:R("shipments").length})]}),e.jsx(ns,{entityType:"shipments",currentSearchTerm:g,currentFilters:xe,onApplySearch:me})]}),(n||l)&&e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(U,{variant:"secondary",className:"gap-1",children:["ETA: ",n||"..."," to ",l||"...",e.jsx("button",{onClick:se,className:"ml-1 hover:bg-secondary-foreground/20 rounded-full p-0.5",children:e.jsx(qe,{className:"h-3 w-3"})})]})})]}),E&&e.jsx(Qe,{selectionCount:W,onClearSelection:h,isLoading:Y||De,actions:[{id:"delete",label:"Delete",icon:e.jsx(We,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>L(!0)}],actionGroups:[{id:"status-update",label:"Update Status",icon:e.jsx(Me,{className:"h-4 w-4 mr-1"}),options:[{value:"Pending",label:"Pending"},{value:"Processing",label:"Processing"},{value:"In Transit",label:"In Transit"},{value:"Delivered",label:"Delivered"}],onSelect:s=>Fe(s)}],className:"mb-4"}),e.jsx(Ye,{open:Ne,onOpenChange:L,itemCount:W,itemType:"shipment",itemNames:Ae,onConfirm:Ie,isLoading:Y}),he?e.jsx(Ze,{rows:8}):P.length===0?e.jsx(es,{icon:He,title:"No shipments found",description:g||n||l?"Try adjusting your search or date filters":"Get started by creating your first shipment",actionLabel:g||n||l?void 0:"Create Shipment",onAction:g||n||l?void 0:()=>S(!0)}):e.jsxs("div",{className:"rounded-md border",children:[e.jsxs(ss,{children:[e.jsx(ts,{children:e.jsxs(ue,{children:[e.jsx(x,{className:"w-12",children:e.jsx(re,{checked:ve,ref:s=>{s&&(s.indeterminate=ye)},onCheckedChange:B,"aria-label":"Select all shipments"})}),e.jsx(x,{children:"Shipment ID"}),e.jsx(x,{children:"Order ID"}),e.jsx(x,{children:"Destination"}),e.jsx(x,{children:"Carrier"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"ETA"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(as,{children:J.map(s=>{const a=Ce(s.id);return e.jsxs(ue,{className:ae(a&&"bg-muted/50"),children:[e.jsx(f,{children:e.jsx(re,{checked:a,onCheckedChange:()=>Se(s.id),"aria-label":`Select shipment ${s.id}`})}),e.jsx(f,{children:s.id}),e.jsx(f,{children:s.orderId}),e.jsx(f,{children:s.destination}),e.jsx(f,{children:s.carrier}),e.jsx(f,{children:e.jsx(U,{variant:"secondary",className:ke(s.status),children:s.status})}),e.jsx(f,{children:s.eta}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ls,{entityType:"shipments",entityId:s.id,entityName:`${s.id} - ${s.destination}`}),e.jsxs(ie,{open:I===s.id,onOpenChange:r=>{F(r?s.id:null),r&&d({...s})},children:[e.jsx(ne,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"sm",children:"Track"})}),e.jsxs(le,{children:[e.jsxs(de,{children:[e.jsxs(ce,{children:["Edit Shipment - ",s.id]}),e.jsx(oe,{children:"Update fields and save your changes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-orderId",children:"Order ID"}),e.jsx(o,{id:"edit-orderId",value:t.orderId,onChange:r=>d({...t,orderId:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-destination",children:"Destination"}),e.jsx(o,{id:"edit-destination",value:t.destination,onChange:r=>d({...t,destination:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-carrier",children:"Carrier"}),e.jsx(o,{id:"edit-carrier",value:t.carrier,onChange:r=>d({...t,carrier:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-status",children:"Status"}),e.jsx(o,{id:"edit-status",value:t.status,onChange:r=>d({...t,status:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-eta",children:"ETA"}),e.jsx(o,{id:"edit-eta",value:t.eta,onChange:r=>d({...t,eta:r.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{className:"flex-1",onClick:we,children:"Save Changes"}),e.jsx(v,{variant:"destructive",onClick:()=>Te(s.id),children:"Delete"})]})]})]})]})]})})]},s.id)})})]}),P.length>0&&e.jsx(rs,{currentPage:X,totalPages:fe,onPageChange:je,itemsPerPage:pe,totalItems:ge})]})]})]})]})}export{xs as ShipmentsView};
