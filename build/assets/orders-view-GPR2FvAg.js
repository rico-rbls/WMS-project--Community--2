import{s as Ie,r as l,F as Ee,G as Ae,t as d,H as Le,j as e,C,h as N,i as D,k as S,B as v,L as u,I as o,x as $e,c as ae,n as H,X as He,f as Me,S as Ue,y as re,J as qe,K as Ke,M as Re,N as Ge}from"./index-i1eRUAgL.js";import{u as ze,j as Je,k as Ve,D as le,l as ie,P as Xe,a as ne,b as ce,c as de,d as oe,m as Qe,n as We,B as Ye,T as Ze,o as _e,p as es,E as ss,q as ts,r as as,s as ue,t as x,v as rs,w as f,F as ls,x as is}from"./save-search-dialog-Bcn-8jW8.js";import{D as ns}from"./date-range-filter-CQ7OnTVZ.js";function ms({initialOpenDialog:M,onDialogOpened:U}){const{isFavorite:q,getFavoritesByType:K}=Ie(),[g,R]=l.useState(""),[i,k]=l.useState(""),[n,T]=l.useState(""),[j,G]=l.useState(!1),[z,p]=l.useState(null),[me,J]=l.useState(!0),[y,b]=l.useState(!1),[F,O]=l.useState(null),[t,c]=l.useState({id:"",customer:"",items:0,total:"",status:"Pending",date:""}),P=ze(g,300);l.useEffect(()=>{(async()=>{J(!0);const s=await Ee();p(s),J(!1)})()},[]),l.useEffect(()=>{M&&!y&&(b(!0),U?.())},[M,U,y]);const V=l.useMemo(()=>z??[],[z]),B=l.useMemo(()=>V.filter(s=>{if(j&&!q("orders",s.id))return!1;if(P){const a=P.toLowerCase();if(!(s.id.toLowerCase().includes(a)||s.customer.toLowerCase().includes(a)))return!1}if(i||n)try{const a=new Date(s.date);if(i){const r=new Date(i);if(a<r)return!1}if(n){const r=new Date(n);if(r.setHours(23,59,59,999),a>r)return!1}}catch{return!1}return!0}),[V,P,i,n,j,q]),he=l.useCallback(s=>{s.searchTerm&&R(s.searchTerm),s.filters.fromDate&&typeof s.filters.fromDate=="string"&&k(s.filters.fromDate),s.filters.toDate&&typeof s.filters.toDate=="string"&&T(s.filters.toDate),s.filters.favoritesOnly==="true"&&G(!0)},[]),xe=l.useMemo(()=>{const s={};return i&&(s.fromDate=i),n&&(s.toDate=n),j&&(s.favoritesOnly="true"),s},[i,n,j]),{currentPage:X,totalPages:fe,paginatedData:Q,goToPage:je,totalItems:ge,itemsPerPage:pe}=Je(B,25),{selectedIds:w,selectedItems:W,selectionCount:Y,isAllSelected:ve,isPartiallySelected:ye,hasSelection:I,toggleItem:Ce,toggleAll:E,deselectAll:m,isSelected:Ne}=Ve(Q),[Z,_]=l.useState(!1),[De,ee]=l.useState(!1),[Se,A]=l.useState(!1),[cs,be]=l.useState(!1);l.useEffect(()=>{m()},[X,m]),l.useEffect(()=>{const s=a=>{(a.metaKey||a.ctrlKey)&&a.key==="a"&&!y&&!F&&(a.preventDefault(),E()),a.key==="Escape"&&I&&m()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[E,m,I,y,F]);function L(){c({id:"",customer:"",items:0,total:"",status:"Pending",date:""})}function se(){k(""),T("")}function te(){return t.customer.trim()?t.total.trim()?t.date.trim()?t.items<0?"Items cannot be negative":null:"Date is required":"Total is required":"Customer is required"}async function we(){const s=te();if(s){d.error(s);return}const a=await Ke({customer:t.customer,items:t.items,total:t.total,status:t.status,date:t.date});p(r=>[a,...r??[]]),b(!1),L(),d.success("Order created successfully")}async function ke(){const s=te();if(s){d.error(s);return}if(!t.id){d.error("Missing order id");return}const a=await Re({id:t.id,customer:t.customer,items:t.items,total:t.total,status:t.status,date:t.date});p(r=>(r??[]).map(h=>h.id===a.id?a:h)),O(null),d.success("Order updated successfully")}async function Te(s){await Ge(s),p(a=>(a??[]).filter(r=>r.id!==s)),O(null),d.success("Order deleted successfully")}const Fe=s=>{switch(s){case"Delivered":return"bg-green-500/10 text-green-700";case"Shipped":return"bg-blue-500/10 text-blue-700";case"Processing":return"bg-orange-500/10 text-orange-700";case"Pending":return"bg-gray-500/10 text-gray-700";default:return"bg-gray-500/10 text-gray-700"}},Oe=l.useCallback(async()=>{_(!0);try{const s=Array.from(w),a=await Ae(s);p(r=>r?.filter(h=>!s.includes(h.id))??[]),a.failedCount>0?d.warning(`Deleted ${a.successCount} orders. ${a.failedCount} failed.`):d.success(`Successfully deleted ${a.successCount} order${a.successCount!==1?"s":""}`),m()}catch(s){d.error(s?.message||"Failed to delete orders")}finally{_(!1),A(!1)}},[w,m]),Pe=l.useCallback(async s=>{ee(!0);try{const a=Array.from(w),r=await Le(a,s);p(h=>h&&h.map($=>a.includes($.id)?{...$,status:s}:$)),r.failedCount>0?d.warning(`Updated ${r.successCount} orders. ${r.failedCount} failed.`):d.success(`Successfully updated ${r.successCount} order${r.successCount!==1?"s":""}`),m()}catch(a){d.error(a?.message||"Failed to update orders")}finally{ee(!1),be(!1)}},[w,m]),Be=l.useMemo(()=>W.map(s=>`${s.id} - ${s.customer}`),[W]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(C,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(D,{className:"text-sm text-muted-foreground",children:"Total Orders"})}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl",children:"256"})})]}),e.jsxs(C,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(D,{className:"text-sm text-muted-foreground",children:"Pending"})}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl",children:"42"})})]}),e.jsxs(C,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(D,{className:"text-sm text-muted-foreground",children:"In Progress"})}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl",children:"89"})})]}),e.jsxs(C,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(D,{className:"text-sm text-muted-foreground",children:"Completed"})}),e.jsx(S,{children:e.jsx("div",{className:"text-2xl",children:"125"})})]})]}),e.jsxs(C,{children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{children:"Order Management"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(le,{open:y,onOpenChange:s=>{b(s),s||L()},children:[e.jsx(ie,{asChild:!0,children:e.jsxs(v,{onClick:()=>L(),children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Add Order"]})}),e.jsxs(ne,{children:[e.jsxs(ce,{children:[e.jsx(de,{children:"Add New Order"}),e.jsx(oe,{children:"Enter the details for the new order."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"customer",children:"Customer"}),e.jsx(o,{id:"customer",placeholder:"Customer name",value:t.customer,onChange:s=>c({...t,customer:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"items",children:"Items"}),e.jsx(o,{id:"items",type:"number",placeholder:"0",value:t.items,onChange:s=>c({...t,items:Number(s.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"total",children:"Total (PHP ₱)"}),e.jsx(o,{id:"total",placeholder:"₱0.00",value:t.total,onChange:s=>c({...t,total:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"status",children:"Status"}),e.jsx(o,{id:"status",placeholder:"Pending",value:t.status,onChange:s=>c({...t,status:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"date",children:"Date"}),e.jsx(o,{id:"date",placeholder:"2025-10-15",value:t.date,onChange:s=>c({...t,date:s.target.value})})]}),e.jsx(v,{className:"w-full",onClick:we,children:"Add Order"})]})]})]})})]})}),e.jsxs(S,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Qe,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(o,{placeholder:"Search orders...",value:g,onChange:s=>R(s.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx(ns,{fromDate:i,toDate:n,onFromDateChange:k,onToDateChange:T,onClear:se,label:"Filter by Order Date"}),e.jsxs(v,{variant:j?"default":"outline",size:"sm",onClick:()=>G(!j),className:"gap-1",children:[e.jsx($e,{className:ae("h-4 w-4",j&&"fill-current")}),"Favorites",K("orders").length>0&&e.jsx(H,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:K("orders").length})]}),e.jsx(We,{entityType:"orders",currentSearchTerm:g,currentFilters:xe,onApplySearch:he})]}),(i||n)&&e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(H,{variant:"secondary",className:"gap-1",children:["Date: ",i||"..."," to ",n||"...",e.jsx("button",{onClick:se,className:"ml-1 hover:bg-secondary-foreground/20 rounded-full p-0.5",children:e.jsx(He,{className:"h-3 w-3"})})]})})]}),I&&e.jsx(Ye,{selectionCount:Y,onClearSelection:m,isLoading:Z||De,actions:[{id:"delete",label:"Delete",icon:e.jsx(Ze,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>A(!0)}],actionGroups:[{id:"status-update",label:"Update Status",icon:e.jsx(Me,{className:"h-4 w-4 mr-1"}),options:[{value:"Pending",label:"Pending"},{value:"Processing",label:"Processing"},{value:"Shipped",label:"Shipped"},{value:"Delivered",label:"Delivered"}],onSelect:s=>Pe(s)}],className:"mb-4"}),e.jsx(_e,{open:Se,onOpenChange:A,itemCount:Y,itemType:"order",itemNames:Be,onConfirm:Oe,isLoading:Z}),me?e.jsx(es,{rows:8}):B.length===0?e.jsx(ss,{icon:Ue,title:"No orders found",description:g||i||n?"Try adjusting your search or date filters":"Get started by creating your first order",actionLabel:g||i||n?void 0:"Create Order",onAction:g||i||n?void 0:()=>b(!0)}):e.jsxs("div",{className:"rounded-md border",children:[e.jsxs(ts,{children:[e.jsx(as,{children:e.jsxs(ue,{children:[e.jsx(x,{className:"w-12",children:e.jsx(re,{checked:ve,ref:s=>{s&&(s.indeterminate=ye)},onCheckedChange:E,"aria-label":"Select all orders"})}),e.jsx(x,{children:"Order ID"}),e.jsx(x,{children:"Customer"}),e.jsx(x,{children:"Items"}),e.jsx(x,{children:"Total"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Date"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(rs,{children:Q.map(s=>{const a=Ne(s.id);return e.jsxs(ue,{className:ae(a&&"bg-muted/50"),children:[e.jsx(f,{children:e.jsx(re,{checked:a,onCheckedChange:()=>Ce(s.id),"aria-label":`Select order ${s.id}`})}),e.jsx(f,{children:s.id}),e.jsx(f,{children:s.customer}),e.jsx(f,{children:s.items}),e.jsx(f,{children:s.total}),e.jsx(f,{children:e.jsx(H,{variant:"secondary",className:Fe(s.status),children:s.status})}),e.jsx(f,{children:s.date}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ls,{entityType:"orders",entityId:s.id,entityName:`${s.id} - ${s.customer}`}),e.jsxs(le,{open:F===s.id,onOpenChange:r=>{O(r?s.id:null),r&&c({...s})},children:[e.jsx(ie,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"sm",children:e.jsx(qe,{className:"h-4 w-4"})})}),e.jsxs(ne,{children:[e.jsxs(ce,{children:[e.jsxs(de,{children:["Edit Order - ",s.id]}),e.jsx(oe,{children:"Update fields and save your changes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-customer",children:"Customer"}),e.jsx(o,{id:"edit-customer",value:t.customer,onChange:r=>c({...t,customer:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-items",children:"Items"}),e.jsx(o,{id:"edit-items",type:"number",value:t.items,onChange:r=>c({...t,items:Number(r.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-total",children:"Total (PHP ₱)"}),e.jsx(o,{id:"edit-total",value:t.total,onChange:r=>c({...t,total:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-status",children:"Status"}),e.jsx(o,{id:"edit-status",value:t.status,onChange:r=>c({...t,status:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-date",children:"Date"}),e.jsx(o,{id:"edit-date",value:t.date,onChange:r=>c({...t,date:r.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{className:"flex-1",onClick:ke,children:"Save Changes"}),e.jsx(v,{variant:"destructive",onClick:()=>Te(s.id),children:"Delete"})]})]})]})]})]})})]},s.id)})})]}),B.length>0&&e.jsx(is,{currentPage:X,totalPages:fe,onPageChange:je,itemsPerPage:pe,totalItems:ge})]})]})]})]})}export{ms as OrdersView};
