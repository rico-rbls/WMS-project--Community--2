import{F as Me,f as Ue,r as l,G as qe,X as Re,Y as Ge,t as o,Z as Ye,j as e,C as b,l as w,m as k,n as T,D as ce,K as oe,B as S,v as de,w as ue,x as me,y as he,L as u,I as d,M as ze,d as xe,s as q,_ as Xe,k as Ve,S as We,N as fe,$ as Ze,a0 as _e,a1 as Je,a2 as Qe}from"./index-DNXTvTWD.js";import{T as es,e as ss,f as ts,g as ge,h as je,i as C,j as as,k as x}from"./sortable-table-head-DeQUWW-W.js";import{u as rs,a as ls,P as is,B as ns,b as cs,T as os,E as ds,c as us}from"./bulk-delete-dialog-BMkAbUZa.js";import{D as ms}from"./date-range-filter-Cs3-jSrf.js";import{S as hs,a as xs,F as fs}from"./save-search-dialog-S7yzJk3O.js";import{u as gs}from"./useTableSort-wMMUO26A.js";import{c as js}from"./permissions-DJBQ2eGO.js";import"./calendar-bN-4MKcD.js";function ks({initialOpenDialog:R,onDialogOpened:G}){const{isFavorite:Y,getFavoritesByType:z}=Me(),{user:X}=Ue(),D=X?js(X.role):!1,[g,V]=l.useState(""),[i,P]=l.useState(""),[n,B]=l.useState(""),[f,W]=l.useState(!1),[Z,j]=l.useState(null),[pe,_]=l.useState(!0),[N,F]=l.useState(!1),[I,A]=l.useState(null),[t,c]=l.useState({id:"",customer:"",items:0,total:"",status:"Pending",date:""}),E=qe(g,300);l.useEffect(()=>{(async()=>{_(!0);const s=await Re();j(s),_(!1)})()},[]),l.useEffect(()=>{R&&!N&&(F(!0),G?.())},[R,G,N]);const J=l.useMemo(()=>Z??[],[Z]),K=l.useMemo(()=>J.filter(s=>{if(f&&!Y("orders",s.id))return!1;if(E){const a=E.toLowerCase();if(!(s.id.toLowerCase().includes(a)||s.customer.toLowerCase().includes(a)))return!1}if(i||n)try{const a=new Date(s.date);if(i){const r=new Date(i);if(a<r)return!1}if(n){const r=new Date(n);if(r.setHours(23,59,59,999),a>r)return!1}}catch{return!1}return!0}),[J,E,i,n,f,Y]),ye=l.useCallback(s=>{s.searchTerm&&V(s.searchTerm),s.filters.fromDate&&typeof s.filters.fromDate=="string"&&P(s.filters.fromDate),s.filters.toDate&&typeof s.filters.toDate=="string"&&B(s.filters.toDate),s.filters.favoritesOnly==="true"&&W(!0)},[]),ve=l.useMemo(()=>{const s={};return i&&(s.fromDate=i),n&&(s.toDate=n),f&&(s.favoritesOnly="true"),s},[i,n,f]),{sortedData:Se,sortConfig:p,requestSort:y,getSortDirection:v}=gs(K),{currentPage:Q,totalPages:Ce,paginatedData:ee,goToPage:De,totalItems:Ne,itemsPerPage:be}=rs(Se,25),{selectedIds:O,selectedItems:se,selectionCount:te,isAllSelected:we,isPartiallySelected:ke,hasSelection:L,toggleItem:Te,toggleAll:$,deselectAll:m,isSelected:Fe}=ls(ee),[ae,re]=l.useState(!1),[Oe,le]=l.useState(!1),[Pe,H]=l.useState(!1),[ps,Be]=l.useState(!1);l.useEffect(()=>{m()},[Q,m]),l.useEffect(()=>{const s=a=>{(a.metaKey||a.ctrlKey)&&a.key==="a"&&!N&&!I&&(a.preventDefault(),$()),a.key==="Escape"&&L&&m()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[$,m,L,N,I]);function M(){c({id:"",customer:"",items:0,total:"",status:"Pending",date:""})}function ie(){P(""),B("")}function ne(){return t.customer.trim()?t.total.trim()?t.date.trim()?t.items<0?"Items cannot be negative":null:"Date is required":"Total is required":"Customer is required"}async function Ie(){const s=ne();if(s){o.error(s);return}const a=await _e({customer:t.customer,items:t.items,total:t.total,status:t.status,date:t.date});j(r=>[a,...r??[]]),F(!1),M(),o.success("Order created successfully")}async function Ae(){const s=ne();if(s){o.error(s);return}if(!t.id){o.error("Missing order id");return}const a=await Je({id:t.id,customer:t.customer,items:t.items,total:t.total,status:t.status,date:t.date});j(r=>(r??[]).map(h=>h.id===a.id?a:h)),A(null),o.success("Order updated successfully")}async function Ee(s){await Qe(s),j(a=>(a??[]).filter(r=>r.id!==s)),A(null),o.success("Order deleted successfully")}const Ke=s=>{switch(s){case"Delivered":return"bg-green-500/10 text-green-700";case"Shipped":return"bg-blue-500/10 text-blue-700";case"Processing":return"bg-orange-500/10 text-orange-700";case"Pending":return"bg-gray-500/10 text-gray-700";default:return"bg-gray-500/10 text-gray-700"}},Le=l.useCallback(async()=>{re(!0);try{const s=Array.from(O),a=await Ge(s);j(r=>r?.filter(h=>!s.includes(h.id))??[]),a.failedCount>0?o.warning(`Deleted ${a.successCount} orders. ${a.failedCount} failed.`):o.success(`Successfully deleted ${a.successCount} order${a.successCount!==1?"s":""}`),m()}catch(s){o.error(s?.message||"Failed to delete orders")}finally{re(!1),H(!1)}},[O,m]),$e=l.useCallback(async s=>{le(!0);try{const a=Array.from(O),r=await Ye(a,s);j(h=>h&&h.map(U=>a.includes(U.id)?{...U,status:s}:U)),r.failedCount>0?o.warning(`Updated ${r.successCount} orders. ${r.failedCount} failed.`):o.success(`Successfully updated ${r.successCount} order${r.successCount!==1?"s":""}`),m()}catch(a){o.error(a?.message||"Failed to update orders")}finally{le(!1),Be(!1)}},[O,m]),He=l.useMemo(()=>se.map(s=>`${s.id} - ${s.customer}`),[se]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(b,{children:[e.jsx(w,{className:"pb-2",children:e.jsx(k,{className:"text-sm text-muted-foreground",children:"Total Orders"})}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl",children:"256"})})]}),e.jsxs(b,{children:[e.jsx(w,{className:"pb-2",children:e.jsx(k,{className:"text-sm text-muted-foreground",children:"Pending"})}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl",children:"42"})})]}),e.jsxs(b,{children:[e.jsx(w,{className:"pb-2",children:e.jsx(k,{className:"text-sm text-muted-foreground",children:"In Progress"})}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl",children:"89"})})]}),e.jsxs(b,{children:[e.jsx(w,{className:"pb-2",children:e.jsx(k,{className:"text-sm text-muted-foreground",children:"Completed"})}),e.jsx(T,{children:e.jsx("div",{className:"text-2xl",children:"125"})})]})]}),e.jsxs(b,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{children:"Order Management"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(ce,{open:N,onOpenChange:s=>{F(s),s||M()},children:[e.jsx(oe,{asChild:!0,children:e.jsxs(S,{onClick:()=>M(),disabled:!D,title:D?void 0:"You don't have permission to add orders",children:[e.jsx(is,{className:"h-4 w-4 mr-2"}),"Add Order"]})}),e.jsxs(de,{children:[e.jsxs(ue,{children:[e.jsx(me,{children:"Add New Order"}),e.jsx(he,{children:"Enter the details for the new order."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"customer",children:"Customer"}),e.jsx(d,{id:"customer",placeholder:"Customer name",value:t.customer,onChange:s=>c({...t,customer:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"items",children:"Items"}),e.jsx(d,{id:"items",type:"number",placeholder:"0",value:t.items,onChange:s=>c({...t,items:Number(s.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"total",children:"Total (PHP ₱)"}),e.jsx(d,{id:"total",placeholder:"₱0.00",value:t.total,onChange:s=>c({...t,total:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"status",children:"Status"}),e.jsx(d,{id:"status",placeholder:"Pending",value:t.status,onChange:s=>c({...t,status:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"date",children:"Date"}),e.jsx(d,{id:"date",placeholder:"2025-10-15",value:t.date,onChange:s=>c({...t,date:s.target.value})})]}),e.jsx(S,{className:"w-full",onClick:Ie,children:"Add Order"})]})]})]})})]})}),e.jsxs(T,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(d,{placeholder:"Search orders...",value:g,onChange:s=>V(s.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx(ms,{fromDate:i,toDate:n,onFromDateChange:P,onToDateChange:B,onClear:ie,label:"Filter by Order Date"}),e.jsxs(S,{variant:f?"default":"outline",size:"sm",onClick:()=>W(!f),className:"gap-1",children:[e.jsx(hs,{className:xe("h-4 w-4",f&&"fill-current")}),"Favorites",z("orders").length>0&&e.jsx(q,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:z("orders").length})]}),e.jsx(xs,{entityType:"orders",currentSearchTerm:g,currentFilters:ve,onApplySearch:ye})]}),(i||n)&&e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(q,{variant:"secondary",className:"gap-1",children:["Date: ",i||"..."," to ",n||"...",e.jsx("button",{onClick:ie,className:"ml-1 hover:bg-secondary-foreground/20 rounded-full p-0.5",children:e.jsx(Xe,{className:"h-3 w-3"})})]})})]}),L&&D&&e.jsx(ns,{selectionCount:te,onClearSelection:m,isLoading:ae||Oe,actions:[{id:"delete",label:"Delete",icon:e.jsx(es,{className:"h-4 w-4 mr-1"}),variant:"destructive",onClick:()=>H(!0)}],actionGroups:[{id:"status-update",label:"Update Status",icon:e.jsx(Ve,{className:"h-4 w-4 mr-1"}),options:[{value:"Pending",label:"Pending"},{value:"Processing",label:"Processing"},{value:"Shipped",label:"Shipped"},{value:"Delivered",label:"Delivered"}],onSelect:s=>$e(s)}],className:"mb-4"}),e.jsx(cs,{open:Pe,onOpenChange:H,itemCount:te,itemType:"order",itemNames:He,onConfirm:Le,isLoading:ae}),pe?e.jsx(os,{rows:8}):K.length===0?e.jsx(ds,{icon:We,title:"No orders found",description:g||i||n?"Try adjusting your search or date filters":"Get started by creating your first order",actionLabel:g||i||n?void 0:"Create Order",onAction:g||i||n?void 0:()=>F(!0)}):e.jsxs("div",{className:"rounded-md border",children:[e.jsxs(ss,{children:[e.jsx(ts,{children:e.jsxs(ge,{children:[e.jsx(je,{className:"w-12",children:e.jsx(fe,{checked:we,ref:s=>{s&&(s.indeterminate=ke)},onCheckedChange:$,"aria-label":"Select all orders"})}),e.jsx(C,{sortKey:"id",currentSortKey:p.key,sortDirection:v("id"),onSort:s=>y(s),children:"Order ID"}),e.jsx(C,{sortKey:"customer",currentSortKey:p.key,sortDirection:v("customer"),onSort:s=>y(s),children:"Customer"}),e.jsx(C,{sortKey:"items",currentSortKey:p.key,sortDirection:v("items"),onSort:s=>y(s),children:"Items"}),e.jsx(C,{sortKey:"total",currentSortKey:p.key,sortDirection:v("total"),onSort:s=>y(s),children:"Total"}),e.jsx(C,{sortKey:"status",currentSortKey:p.key,sortDirection:v("status"),onSort:s=>y(s),children:"Status"}),e.jsx(C,{sortKey:"date",currentSortKey:p.key,sortDirection:v("date"),onSort:s=>y(s),children:"Date"}),e.jsx(je,{children:"Actions"})]})}),e.jsx(as,{children:ee.map(s=>{const a=Fe(s.id);return e.jsxs(ge,{className:xe(a&&"bg-muted/50"),children:[e.jsx(x,{children:e.jsx(fe,{checked:a,onCheckedChange:()=>Te(s.id),"aria-label":`Select order ${s.id}`})}),e.jsx(x,{children:s.id}),e.jsx(x,{children:s.customer}),e.jsx(x,{children:s.items}),e.jsx(x,{children:s.total}),e.jsx(x,{children:e.jsx(q,{variant:"secondary",className:Ke(s.status),children:s.status})}),e.jsx(x,{children:s.date}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fs,{entityType:"orders",entityId:s.id,entityName:`${s.id} - ${s.customer}`}),e.jsxs(ce,{open:I===s.id,onOpenChange:r=>{A(r?s.id:null),r&&c({...s})},children:[e.jsx(oe,{asChild:!0,children:e.jsx(S,{variant:"ghost",size:"sm",disabled:!D,title:D?void 0:"You don't have permission to edit orders",children:e.jsx(Ze,{className:"h-4 w-4"})})}),e.jsxs(de,{children:[e.jsxs(ue,{children:[e.jsxs(me,{children:["Edit Order - ",s.id]}),e.jsx(he,{children:"Update fields and save your changes."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-customer",children:"Customer"}),e.jsx(d,{id:"edit-customer",value:t.customer,onChange:r=>c({...t,customer:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-items",children:"Items"}),e.jsx(d,{id:"edit-items",type:"number",value:t.items,onChange:r=>c({...t,items:Number(r.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-total",children:"Total (PHP ₱)"}),e.jsx(d,{id:"edit-total",value:t.total,onChange:r=>c({...t,total:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-status",children:"Status"}),e.jsx(d,{id:"edit-status",value:t.status,onChange:r=>c({...t,status:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"edit-date",children:"Date"}),e.jsx(d,{id:"edit-date",value:t.date,onChange:r=>c({...t,date:r.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{className:"flex-1",onClick:Ae,children:"Save Changes"}),e.jsx(S,{variant:"destructive",onClick:()=>Ee(s.id),children:"Delete"})]})]})]})]})]})})]},s.id)})})]}),K.length>0&&e.jsx(us,{currentPage:Q,totalPages:Ce,onPageChange:De,itemsPerPage:be,totalItems:Ne})]})]})]})]})}export{ks as OrdersView};
